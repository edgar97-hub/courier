import"./chunk-F5X5MWHG.js";import{a as y,b as F,c as Ce,d as le,e as ct,f as pt,h as P,i as dt,j as me,k as ut,l as ce,m as ft}from"./chunk-G2LEJN5O.js";import{a as Se,b as xe}from"./chunk-24IQJ7FX.js";import{a as W,b as Oe}from"./chunk-UIDYBQS3.js";import{a as Tt,b as Dt,c as Ot,e as kt,f as Ft,g as At,h as ke}from"./chunk-ER5OI6BC.js";import{a as Lt,b as $t,c as Bt,d as Rt,e as Nt,f as Vt,g as jt,h as Ht,i as zt,j as qt,k as Gt,l as Qt,m as Kt,n as Yt,o as Wt,p as Zt,q as Jt,r as Xt,s as Fe,t as er,u as Ae,v as tr,w as rr}from"./chunk-E6UBJVMD.js";import"./chunk-JB6WOIQO.js";import{a as be,d as ve,e as _t,f as Me,g as Ut,h as Ct,i as Y}from"./chunk-V3FD5NRF.js";import{a as Ie,b as wt,e as ye,h as Pe,i as we,m as Te,n as De}from"./chunk-7NEAIHF5.js";import{b as bt,d as Ee,f as vt,g as Mt,k as St,n as xt,o as Et,q as It,r as yt,s as Pt,t as I,u as v}from"./chunk-TIJNC7MJ.js";import{$a as at,A as oe,Ac as gt,B as x,Ba as nt,Bb as se,Bc as ht,Cb as a,Db as E,Eb as h,K as Ze,La as s,Lb as _e,Mb as D,Nb as O,Pa as ae,Qb as st,Ua as U,V as ge,W as ne,X as M,Za as p,a as f,aa as he,ab as m,b as g,c as rt,cc as $,ec as Q,fa as c,i as H,j as it,jb as n,jc as C,kb as o,lb as S,ld as R,ma as ot,mb as w,mc as tt,na as A,nb as T,nd as k,oa as L,oc as lt,p as V,pb as G,pd as b,q as z,rb as d,s as q,sb as u,sc as mt,uc as B,va as j,vc as Ue,wb as Je,xb as Xe,yb as et,zc as K}from"./chunk-GBK3QFXL.js";var Z=y("[User Page/API] Load Users"),Le=y("[User API] Load Users Success",F()),$e=y("[User API] Load Users Failure",F()),J=y("[User Create Page] Create User",F()),pe=y("[User API] Create User Success",F()),Be=y("[User API] Create User Failure",F()),X=y("[User Page] Delete User",F()),Re=y("[User API] Delete User Success",F()),Ne=y("[User API] Delete User Failure",F()),Ve=y("[User Store] Clear User Error");var He=ct("users"),ir=le(He,t=>t.users),or=le(He,t=>t.isLoading),ze=le(He,t=>t.error),nr=le(He,t=>t.isSubmitting);var fr=()=>[5,10,25,100];function gr(t,e){t&1&&(n(0,"div",10),S(1,"mat-progress-spinner",11),o())}function hr(t,e){t&1&&(n(0,"th",25),a(1,"N\xB0"),o())}function _r(t,e){if(t&1&&(n(0,"td",26),a(1),o()),t&2){let r=e.$implicit;s(),E(r.code)}}function Ur(t,e){t&1&&(n(0,"th",25),a(1,"Username"),o())}function Cr(t,e){if(t&1&&(n(0,"td",26),a(1),o()),t&2){let r=e.$implicit;s(),E(r.username)}}function br(t,e){t&1&&(n(0,"th",25),a(1,"Name"),o())}function vr(t,e){if(t&1&&(n(0,"td",26),a(1),o()),t&2){let r=e.$implicit;s(),E(r.name)}}function Mr(t,e){t&1&&(n(0,"th",25),a(1,"Email"),o())}function Sr(t,e){if(t&1&&(n(0,"td",26),a(1),o()),t&2){let r=e.$implicit;s(),E(r.email)}}function xr(t,e){t&1&&(n(0,"th",25),a(1,"Role"),o())}function Er(t,e){if(t&1&&(n(0,"td",26),a(1),o()),t&2){let r=e.$implicit;s(),E(r.role||"N/A")}}function Ir(t,e){t&1&&(n(0,"th",27),a(1,"Actions"),o())}function yr(t,e){if(t&1){let r=G();n(0,"td",26)(1,"button",28),d("click",function(){let l=A(r).$implicit,_=u(2);return L(_.onEdit(l))}),n(2,"mat-icon"),a(3,"edit"),o()(),n(4,"button",29),d("click",function(){let l=A(r).$implicit,_=u(2);return L(_.onDelete(l))}),n(5,"mat-icon"),a(6,"delete"),o()()()}}function Pr(t,e){t&1&&S(0,"tr",30)}function wr(t,e){t&1&&S(0,"tr",31)}function Tr(t,e){if(t&1&&(n(0,"tr",32)(1,"td",33),a(2),o()()),t&2){let r=u(2),i=se(6);s(),at("colspan",r.displayedColumns.length),s(),h(' No data matching the filter "',i.value,'" ')}}function Dr(t,e){if(t&1&&(n(0,"table",12),w(1,13),p(2,hr,2,0,"th",14)(3,_r,2,1,"td",15),T(),w(4,16),p(5,Ur,2,0,"th",14)(6,Cr,2,1,"td",15),T(),w(7,17),p(8,br,2,0,"th",14)(9,vr,2,1,"td",15),T(),w(10,18),p(11,Mr,2,0,"th",14)(12,Sr,2,1,"td",15),T(),w(13,19),p(14,xr,2,0,"th",14)(15,Er,2,1,"td",15),T(),w(16,20),p(17,Ir,2,0,"th",21)(18,yr,7,0,"td",15),T(),p(19,Pr,1,0,"tr",22)(20,wr,1,0,"tr",23)(21,Tr,3,2,"tr",24),o()),t&2){let r=u();m("dataSource",r.dataSource),s(19),m("matHeaderRowDef",r.displayedColumns)("matHeaderRowDefSticky",!0),s(),m("matRowDefColumns",r.displayedColumns)}}function Or(t,e){t&1&&(n(0,"div",34),a(1," No users found. Try dispatching the load action or check your API. "),o())}var qe=class t{users=[];isLoading=!1;displayedColumns=["code","username","email","rol","actions"];dataSource=new Kt;paginator;sort;ngOnChanges(e){e.users&&this.users?(console.log("UserTableComponent: Users received via @Input()",this.users),this.dataSource.data=this.users):e.users&&!this.users&&(this.dataSource.data=[])}ngAfterViewInit(){this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort,this.dataSource.sortingDataAccessor=(e,r)=>e[r]}applyFilter(e){let r=e.target.value;this.dataSource.filter=r.trim().toLowerCase(),this.dataSource.paginator&&this.dataSource.paginator.firstPage()}viewUser=new j;editUser=new j;deleteUser=new j;onView(e){this.viewUser.emit(e)}onEdit(e){this.editUser.emit(e)}onDelete(e){this.deleteUser.emit(e)}static \u0275fac=function(r){return new(r||t)};static \u0275cmp=U({type:t,selectors:[["app-user-table"]],viewQuery:function(r,i){if(r&1&&(Je(Fe,5),Je(Ae,5)),r&2){let l;Xe(l=et())&&(i.paginator=l.first),Xe(l=et())&&(i.sort=l.first)}},inputs:{users:"users",isLoading:"isLoading"},outputs:{viewUser:"viewUser",editUser:"editUser",deleteUser:"deleteUser"},features:[ot],decls:13,vars:5,consts:[["input",""],[1,"table-container","mat-elevation-z4"],[1,"table-header"],["appearance","outline",1,"filter-field"],["matInput","","placeholder","Search...",3,"keyup"],["matSuffix",""],["class","spinner-container",4,"ngIf"],["mat-table","","matSort","","class","user-data-table",3,"dataSource",4,"ngIf"],["class","no-data-message",4,"ngIf"],["showFirstLastButtons","","aria-label","Select page of users",3,"pageSizeOptions"],[1,"spinner-container"],["mode","indeterminate","diameter","50"],["mat-table","","matSort","",1,"user-data-table",3,"dataSource"],["matColumnDef","code"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","username"],["matColumnDef","name"],["matColumnDef","email"],["matColumnDef","rol"],["matColumnDef","actions"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-cell",""],["mat-icon-button","","color","accent","matTooltip","Edit User",3,"click"],["mat-icon-button","","color","warn","matTooltip","Delete User",3,"click"],["mat-header-row",""],["mat-row",""],[1,"mat-row"],[1,"mat-cell"],[1,"no-data-message"]],template:function(r,i){if(r&1){let l=G();n(0,"div",1)(1,"div",2)(2,"mat-form-field",3)(3,"mat-label"),a(4,"Filter Users"),o(),n(5,"input",4,0),d("keyup",function(cr){return A(l),L(i.applyFilter(cr))}),o(),n(7,"mat-icon",5),a(8,"search"),o()()(),p(9,gr,2,0,"div",6)(10,Dr,22,4,"table",7)(11,Or,2,0,"div",8),S(12,"mat-paginator",9),o()}if(r&2){let l=se(6);s(9),m("ngIf",i.isLoading),s(),m("ngIf",!i.isLoading&&i.dataSource.data.length>0),s(),m("ngIf",!i.isLoading&&i.dataSource.data.length===0&&!l.value),s(),m("pageSizeOptions",_e(4,fr))}},dependencies:[C,$,Qt,Lt,Bt,jt,Rt,$t,Ht,Nt,Vt,zt,qt,Gt,er,Fe,rr,Ae,tr,we,Pe,Ie,ye,De,Te,v,I,b,R,xe,Se,Xt,Jt],styles:[".table-container[_ngcontent-%COMP%]{margin:20px;overflow:auto;border-radius:8px;background-color:#fff}.table-header[_ngcontent-%COMP%]{padding:16px;display:flex;justify-content:space-between;align-items:center;background-color:#f5f5f5;border-top-left-radius:8px;border-top-right-radius:8px}.filter-field[_ngcontent-%COMP%]{width:100%;max-width:400px;font-size:.9em}.user-data-table[_ngcontent-%COMP%]{width:100%}th.mat-header-cell[_ngcontent-%COMP%], td.mat-cell[_ngcontent-%COMP%]{padding:12px 16px;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:#e0e0e0}th.mat-header-cell[_ngcontent-%COMP%]{font-weight:500;color:#333;background-color:#fafafa}tr.mat-row[_ngcontent-%COMP%]:hover{background-color:#f9f9f9}.mat-mdc-paginator[_ngcontent-%COMP%]{background-color:#f5f5f5;border-bottom-left-radius:8px;border-bottom-right-radius:8px}.spinner-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;padding:50px;min-height:200px}.no-data-message[_ngcontent-%COMP%]{text-align:center;padding:30px;color:#757575;font-style:italic}td.mat-cell[_ngcontent-%COMP%]   button.mat-icon-button[_ngcontent-%COMP%]{margin-right:4px}"]})};var Ge=class t{constructor(e,r){this.dialogRef=e;this.data=r}onConfirm(){this.dialogRef.close(!0)}onDismiss(){this.dialogRef.close(!1)}static \u0275fac=function(r){return new(r||t)(ae(Tt),ae(Dt))};static \u0275cmp=U({type:t,selectors:[["app-confirm-dialog"]],decls:10,vars:4,consts:[["mat-dialog-title","",1,"dialog-title"],[1,"dialog-content"],["align","end",1,"dialog-actions"],["mat-stroked-button","",3,"click"],["mat-flat-button","","color","warn","cdkFocusInitial","",3,"click"]],template:function(r,i){r&1&&(n(0,"h2",0),a(1),o(),n(2,"mat-dialog-content",1)(3,"p"),a(4),o()(),n(5,"mat-dialog-actions",2)(6,"button",3),d("click",function(){return i.onDismiss()}),a(7),o(),n(8,"button",4),d("click",function(){return i.onConfirm()}),a(9),o()()),r&2&&(s(),h(" ",i.data.title," "),s(3),E(i.data.message),s(3),h(" ",i.data.cancelText||"Cancel"," "),s(2),h(" ",i.data.confirmText||"Delete"," "))},dependencies:[C,ke,kt,At,Ft,b,k,v],styles:[".dialog-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-weight:500;color:#d32f2f}.dialog-content[_ngcontent-%COMP%]{line-height:1.6;color:#555}.dialog-actions[_ngcontent-%COMP%]{padding-top:16px}.title-icon[_ngcontent-%COMP%]{vertical-align:middle}"]})};var kr=()=>[],Qe=class t{store=c(Ce);router=c(B);dialog=c(Ot);snackBar=c(W);users$;isLoading$;error$;destroy$=new H;constructor(){this.users$=this.store.select(ir).pipe(M(e=>console.log("UserListPageComponent: Users from store:",e))),this.isLoading$=this.store.select(or).pipe(M(e=>console.log("UserListPageComponent: IsLoading from store:",e))),this.error$=this.store.select(ze).pipe(oe(e=>!!e),M(e=>{console.error("UserListPageComponent: Error from store:",e)}))}ngOnInit(){console.log("UserListPageComponent: ngOnInit - dispatching loadUsers"),this.store.dispatch(Z())}handleViewUser(e){this.router.navigate(["/users",e.id])}handleEditUser(e){this.router.navigate(["/configuracion/users","edit",e.id])}handleDeleteUser(e){this.dialog.open(Ge,{width:"350px",data:{title:"Confirm Delete",message:`Are you sure you want to delete user "${e.username}" (ID: ${e.id})? This action cannot be undone.`}}).afterClosed().pipe(oe(i=>!!i),ne(this.destroy$)).subscribe(()=>{this.performDelete(e)})}performDelete(e){this.store.dispatch(X({userId:e.id||""}))}navigateToCreate(){this.router.navigate(["/users/create"])}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(r){return new(r||t)};static \u0275cmp=U({type:t,selectors:[["app-user-list-page"]],decls:11,vars:7,consts:[[1,"page-container"],[1,"page-header"],["mat-flat-button","","color","primary",3,"click"],[3,"viewUser","editUser","deleteUser","users","isLoading"]],template:function(r,i){if(r&1&&(n(0,"div",0)(1,"div",1)(2,"h1"),a(3,"Gesti\xF3n de usuarios"),o(),n(4,"button",2),d("click",function(){return i.navigateToCreate()}),n(5,"mat-icon"),a(6,"add_circle_outline"),o(),a(7," Crear nuevo usuario "),o()(),n(8,"app-user-table",3),D(9,"async"),D(10,"async"),d("viewUser",function(_){return i.handleViewUser(_)})("editUser",function(_){return i.handleEditUser(_)})("deleteUser",function(_){return i.handleDeleteUser(_)}),o()()),r&2){let l;s(8),m("users",O(9,2,i.users$)||_e(6,kr))("isLoading",(l=O(10,4,i.isLoading$))!==null&&l!==void 0?l:!1)}},dependencies:[C,Q,K,qe,b,k,v,I,ke,Oe],styles:[".page-container[_ngcontent-%COMP%]{padding:24px;background-color:#f9f9f9;min-height:calc(100vh - 64px)}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;padding-bottom:16px;border-bottom:1px solid #e0e0e0}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:2em;font-weight:500;color:#3f51b5}.page-header[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{font-weight:500}"]})};function Ar(t,e){t&1&&(n(0,"mat-error"),a(1," Username is required. "),o())}function Lr(t,e){t&1&&(n(0,"mat-error"),a(1," Email is required. "),o())}function $r(t,e){t&1&&(n(0,"mat-error"),a(1," Please enter a valid email address. "),o())}var re=class t{constructor(e){this.fb=e}userToEdit=null;isLoading=!1;formSubmit=new j;formCancel=new j;userForm;hidePassword=nt(!0);ngOnInit(){this.initForm(),this.userToEdit&&this.userForm.patchValue(this.userToEdit)}initForm(){this.userForm=this.fb.group({id:[null],username:["",Ee.required],email:["",[Ee.required,Ee.email]],password:["",[]],role:["CUSTOMER"]})}get username(){return this.userForm.get("username")}get email(){return this.userForm.get("email")}onSubmit(){if(this.userForm.valid)if(this.userToEdit&&this.userToEdit.id){let r=g(f(f({},this.userToEdit),this.userForm.value),{id:this.userToEdit.id});this.formSubmit.emit(r)}else{let e=this.userForm.value,{id:r}=e,i=rt(e,["id"]);this.formSubmit.emit(i)}else this.userForm.markAllAsTouched()}onCancel(){this.formCancel.emit()}static \u0275fac=function(r){return new(r||t)(ae(yt))};static \u0275cmp=U({type:t,selectors:[["app-user-form"]],inputs:{userToEdit:"userToEdit",isLoading:"isLoading"},outputs:{formSubmit:"formSubmit",formCancel:"formCancel"},decls:38,vars:8,consts:[[3,"ngSubmit","formGroup"],[1,"form-row"],["appearance","outline",1,"full-width-field"],["matInput","","formControlName","username","autocomplete","off","required",""],[4,"ngIf"],["matInput","","formControlName","email","type","email","required",""],["matInput","","placeholder","Ingrese su contrase\xF1a","formControlName","password","autocomplete","new-password",3,"type"],["mat-icon-button","","matSuffix","","type","button",3,"click"],["formControlName","role"],["value","ADMIN"],["value","MOTORIZED"],["value","CUSTOMER"],["appFieldError",""],["align","end",1,"mat-card-actions"],["mat-stroked-button","","type","button",3,"click"],["mat-flat-button","","color","primary","type","submit",3,"disabled"]],template:function(r,i){r&1&&(n(0,"mat-card")(1,"mat-card-content")(2,"form",0),d("ngSubmit",function(){return i.onSubmit()}),n(3,"div",1)(4,"mat-form-field",2)(5,"mat-label"),a(6,"Username"),o(),S(7,"input",3),p(8,Ar,2,0,"mat-error",4),o()(),n(9,"mat-form-field",2)(10,"mat-label"),a(11,"Email"),o(),S(12,"input",5),p(13,Lr,2,0,"mat-error",4)(14,$r,2,0,"mat-error",4),o(),n(15,"mat-form-field",2)(16,"mat-label"),a(17,"contrase\xF1a"),o(),S(18,"input",6),n(19,"button",7),d("click",function(){return i.hidePassword.set(!i.hidePassword())}),n(20,"mat-icon"),a(21),o()()(),n(22,"mat-form-field",2)(23,"mat-label"),a(24,"Rol"),o(),n(25,"mat-select",8)(26,"mat-option",9),a(27,"Administrador"),o(),n(28,"mat-option",10),a(29,"Motorizado"),o(),n(30,"mat-option",11),a(31,"Cliente"),o()(),S(32,"mat-error",12),o(),n(33,"mat-card-actions",13)(34,"button",14),d("click",function(){return i.onCancel()}),a(35," Cancelar "),o(),n(36,"button",15),a(37),o()()()()()),r&2&&(s(2),m("formGroup",i.userForm),s(6),m("ngIf",(i.username==null?null:i.username.invalid)&&((i.username==null?null:i.username.dirty)||(i.username==null?null:i.username.touched))),s(5),m("ngIf",(i.email==null||i.email.errors==null?null:i.email.errors.required)&&((i.email==null?null:i.email.dirty)||(i.email==null?null:i.email.touched))),s(),m("ngIf",(i.email==null||i.email.errors==null?null:i.email.errors.email)&&((i.email==null?null:i.email.dirty)||(i.email==null?null:i.email.touched))),s(4),m("type",i.hidePassword()?"password":"text"),s(3),E(i.hidePassword()?"visibility_off":"visibility"),s(15),m("disabled",i.isLoading||i.userForm.invalid),s(),h(" ",i.isLoading?"Saving...":i.userToEdit?"Actualizar":"Guardar"," "))},dependencies:[C,$,Pt,St,bt,vt,Mt,It,xt,Et,we,Pe,Ie,wt,ye,De,Te,b,k,R,Y,be,Me,ve,Zt,Wt,Yt,v,I],styles:[".form-row[_ngcontent-%COMP%]{display:flex;gap:16px;margin-bottom:8px}.form-field[_ngcontent-%COMP%]{flex:1}.full-width-field[_ngcontent-%COMP%]{width:100%;margin-bottom:16px}.mat-card-actions[_ngcontent-%COMP%]{display:flex;gap:5px;margin-top:20px}.group-title[_ngcontent-%COMP%]{font-size:1.1em;margin-top:20px;margin-bottom:10px;color:#555;border-bottom:1px solid #eee;padding-bottom:5px}"]})};var Ke=class t{store=c(Ce);router=c(B);isSubmitting$;error$;destroy$=new H;constructor(){this.isSubmitting$=this.store.select(nr),this.error$=this.store.select(ze)}ngOnInit(){this.store.dispatch(Ve())}handleFormSubmit(e){console.log("UserCreatePageComponent: Form submitted",e),this.store.dispatch(J({user:e}))}handleFormCancel(){this.router.navigate(["/users"])}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(r){return new(r||t)};static \u0275cmp=U({type:t,selectors:[["app-user-create-page"]],decls:9,vars:4,consts:[[1,"page-container","form-page-container"],[1,"page-header"],["mat-icon-button","","routerLink","/users","matTooltip","Back to User List","aria-label","Back to user list"],[3,"formSubmit","formCancel","userToEdit","isLoading"]],template:function(r,i){r&1&&(n(0,"div",0)(1,"div",1)(2,"button",2)(3,"mat-icon"),a(4,"arrow_back"),o()(),n(5,"h1"),a(6,"Create New User"),o()(),n(7,"app-user-form",3),D(8,"async"),d("formSubmit",function(_){return i.handleFormSubmit(_)})("formCancel",function(){return i.handleFormCancel()}),o()()),r&2&&(s(7),m("userToEdit",null)("isLoading",!!O(8,2,i.isSubmitting$)))},dependencies:[C,Q,K,Ue,re,v,I,b,R],styles:[".page-container[_ngcontent-%COMP%]{padding:24px;background-color:#f9f9f9}.form-page-container[_ngcontent-%COMP%]{max-width:700px;margin:30px auto;background-color:#fff;border-radius:8px;box-shadow:0 2px 10px #0000001a;padding:24px}.page-header[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:24px;padding-bottom:16px;border-bottom:1px solid #e0e0e0}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0 0 0 16px;font-size:1.6em;font-weight:500;color:#3f51b5}"]})};function Rr(t,e){if(t&1&&(n(0,"p")(1,"mat-icon",3),a(2,"phone"),o(),a(3),o()),t&2){let r=u(2);s(3),h(" ",r.user.rol,"")}}function Nr(t,e){if(t&1&&(n(0,"mat-card",1)(1,"mat-card-header")(2,"div",2)(3,"mat-icon"),a(4,"account_circle"),o()(),n(5,"mat-card-subtitle"),a(6),o()(),n(7,"mat-card-content")(8,"p")(9,"mat-icon",3),a(10,"email"),o(),a(11),o(),p(12,Rr,4,1,"p",4),o(),n(13,"mat-card-actions",5)(14,"button",6)(15,"mat-icon"),a(16,"visibility"),o(),a(17," View Details "),o(),n(18,"button",7)(19,"mat-icon"),a(20,"edit"),o(),a(21," Edit "),o()()()),t&2){let r=u();s(6),E(r.user.username),s(5),h(" ",r.user.email,""),s(),m("ngIf",r.user.rol)}}var Ye=class t{user;static \u0275fac=function(r){return new(r||t)};static \u0275cmp=U({type:t,selectors:[["app-user-card"]],inputs:{user:"user"},decls:1,vars:1,consts:[["class","user-card",4,"ngIf"],[1,"user-card"],["mat-card-avatar","",1,"user-avatar"],["inline",""],[4,"ngIf"],["align","end"],["mat-stroked-button","","color","primary"],["mat-stroked-button","","color","accent"]],template:function(r,i){r&1&&p(0,Nr,22,3,"mat-card",0),r&2&&m("ngIf",i.user)},dependencies:[C,$,Y,be,Me,Ct,ve,Ut,_t,v,I,b,k],styles:[".user-card[_ngcontent-%COMP%]{margin-bottom:20px;transition:box-shadow .3s ease-in-out}.user-card[_ngcontent-%COMP%]:hover{box-shadow:0 4px 20px #0000001f}.user-avatar[_ngcontent-%COMP%]{background-color:#e0e0e0;display:flex;align-items:center;justify-content:center}.user-avatar[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:40px;height:40px;width:40px}mat-card-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-bottom:8px}mat-card-actions[_ngcontent-%COMP%]{padding:8px 16px!important}.company-info[_ngcontent-%COMP%], .address-info[_ngcontent-%COMP%]{margin-top:16px;padding-top:12px;border-top:1px solid #eee}.company-info[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%], .address-info[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin-top:0;margin-bottom:8px;font-size:.9em;color:#757575}"]})};var ie=class t{apiUrl=gt.apiUrl+"/users";http=c(lt);authService=c(ht);constructor(){console.log("UserService (NgRx integrated) initialized")}getAuthHeaders(){let e=this.authService.getAccessToken();return e?new tt({"Content-Type":"application/json",codrr_token:e}):new tt({"Content-Type":"application/json"})}getUsers(){let e=this.getAuthHeaders();return this.authService.getAccessToken()?(console.log("UserService: Fetching all users from API"),this.http.get(`${this.apiUrl}/all`,{headers:e}).pipe(q(r=>r||[]),x(this.handleError))):z(()=>new Error("Not authenticated to fetch users."))}getUserById(e){let r=this.getAuthHeaders();return this.authService.getAccessToken()?(console.log(`UserService: Fetching user by ID: ${e}`),this.http.get(`${this.apiUrl}/${e}`,{headers:r}).pipe(x(this.handleError))):z(()=>new Error("Not authenticated to fetch user by ID."))}createUser(e){let r=this.getAuthHeaders();return console.log("UserService: Attempting to create user - POST",`${this.apiUrl}/register`,e),this.http.post(this.apiUrl+"/register",e,{headers:r}).pipe(M(i=>console.log("UserService: User created via API",i)),x(this.handleError))}updateUser(e){let r=this.getAuthHeaders();return this.authService.getAccessToken()?(console.log("UserService: Updating user via API",e),this.http.put(`${this.apiUrl}/edit/${e.id}`,e,{headers:r}).pipe(x(this.handleError))):z(()=>new Error("Not authenticated to update user."))}deleteUser(e){let r=this.getAuthHeaders();return this.authService.getAccessToken()?(console.log(`UserService: Deleting user via API, ID: ${e}`),this.http.delete(`${this.apiUrl}/delete/${e}`,{headers:r}).pipe(x(this.handleError))):z(()=>new Error("Not authenticated to delete user."))}handleError(e){let r="An unknown error occurred in UserService!";return e.error instanceof ErrorEvent?r=`Client-side error: ${e.error.message}`:(r=`Server-side error Code: ${e.status}
Message: ${e.message}`,e.status===401?r="Unauthorized. Your session may have expired or you lack permissions.":e.status===403&&(r="Forbidden. You do not have permission for this action.")),console.error("UserService API Error:",r,e),z(()=>new Error(r))}static \u0275fac=function(r){return new(r||t)};static \u0275prov=he({token:t,factory:t.\u0275fac,providedIn:"root"})};function Vr(t,e){if(t&1&&(w(0),n(1,"h1"),a(2),o(),T()),t&2){let r=e.ngIf,i=u();s(2),h(" ",i.isEditMode?"Edit User: "+r.username:"User Details: "+r.username," ")}}function jr(t,e){if(t&1&&(n(0,"h1"),a(1),o()),t&2){let r=u();s(),h(" ",r.isLoading?"Loading User...":r.isEditMode?"Edit User":"User Details"," ")}}function Hr(t,e){if(t&1){let r=G();n(0,"button",9),d("click",function(){A(r);let l=u();return L(l.navigateToEdit())}),n(1,"mat-icon"),a(2,"edit"),o(),a(3," Edit User "),o()}}function zr(t,e){t&1&&(n(0,"div",10),S(1,"mat-progress-spinner",11),o())}function qr(t,e){if(t&1){let r=G();n(0,"div",14)(1,"app-user-form",15),d("formSubmit",function(l){A(r);let _=u(2);return L(_.handleFormSubmit(l))})("formCancel",function(){A(r);let l=u(2);return L(l.handleFormCancel())}),o()()}if(t&2){let r=u().ngIf,i=u();s(),m("userToEdit",r)("isLoading",i.isLoading)}}function Gr(t,e){if(t&1&&(n(0,"div",16),S(1,"app-user-card",17),o()),t&2){let r=u().ngIf;s(),m("user",r)}}function Qr(t,e){if(t&1&&(w(0),p(1,qr,2,2,"div",12)(2,Gr,2,1,"div",13),T()),t&2){let r=u();s(),m("ngIf",r.isEditMode),s(),m("ngIf",!r.isEditMode)}}function Kr(t,e){if(t&1&&(n(0,"p",18),a(1),o()),t&2){let r=u();s(),h(" User with ID ",r.userId," not found or could not be loaded. ")}}var fe=class t{route=c(mt);router=c(B);userService=c(ie);snackBar=c(W);userSubject=new it(null);user$=this.userSubject.asObservable();isLoading=!0;isEditMode=!1;userId=null;destroy$=new H;ngOnInit(){this.route.paramMap.pipe(ne(this.destroy$),M(()=>{this.isLoading=!0,this.userSubject.next(null)}),ge(e=>{let r=e.get("id");return r?(this.userId=r,this.isEditMode=this.router.url.includes(`/edit/${this.userId}`),this.userService.getUserById(this.userId)):(this.snackBar.open("User ID not provided in URL.","Close",{duration:3e3}),this.router.navigate(["/users"]),V(null))}),x(e=>(this.isLoading=!1,this.snackBar.open("Error fetching user data.","Close",{duration:3e3,panelClass:["error-snackbar"]}),this.router.navigate(["/users"]),V(null))),oe(e=>e!==null)).subscribe(e=>{this.isLoading=!1,e?this.userSubject.next(e):this.userId&&(this.snackBar.open(`User with ID ${this.userId} not found.`,"Close",{duration:3e3}),this.router.navigate(["/users"]))})}navigateToEdit(){this.userId&&this.router.navigate(["/users","edit",this.userId])}navigateToView(){this.userId&&this.router.navigate(["/users",this.userId])}handleFormSubmit(e){if(!this.userId){this.snackBar.open("Cannot update user: User ID is missing.","Close",{duration:3e3,panelClass:["error-snackbar"]});return}this.isLoading=!0;let r=g(f({},e),{id:this.userId});this.userService.updateUser(r).pipe(ne(this.destroy$)).subscribe({next:i=>{this.isLoading=!1,this.userSubject.next(i),this.snackBar.open(`User "${i.username}" updated successfully!`,"OK",{duration:3e3,verticalPosition:"top",panelClass:["success-snackbar"]}),this.isEditMode=!1,this.router.navigate(["/configuracion/users"])},error:i=>{this.isLoading=!1,this.snackBar.open("Error updating user. Please try again.","Retry",{duration:5e3,verticalPosition:"top",panelClass:["error-snackbar"]}),console.error("Error updating user:",i)}})}handleFormCancel(){this.isEditMode=!1,this.router.navigate(["/configuracion/users"])}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(r){return new(r||t)};static \u0275cmp=U({type:t,selectors:[["app-user-detail-page"]],decls:16,vars:14,consts:[["loadingOrMissingTitle",""],[1,"page-container","detail-page-container"],[1,"page-header"],["mat-icon-button","","routerLink","/configuracion/users","matTooltip","Back to User List","aria-label","Back to user list"],[4,"ngIf","ngIfElse"],["mat-stroked-button","","color","accent",3,"click",4,"ngIf"],["class","spinner-container",4,"ngIf"],[4,"ngIf"],["class","not-found-message",4,"ngIf"],["mat-stroked-button","","color","accent",3,"click"],[1,"spinner-container"],["mode","indeterminate","diameter","60"],["class","form-wrapper",4,"ngIf"],["class","card-wrapper",4,"ngIf"],[1,"form-wrapper"],[3,"formSubmit","formCancel","userToEdit","isLoading"],[1,"card-wrapper"],[3,"user"],[1,"not-found-message"]],template:function(r,i){if(r&1&&(n(0,"div",1)(1,"div",2)(2,"button",3)(3,"mat-icon"),a(4,"arrow_back"),o()(),p(5,Vr,3,1,"ng-container",4),D(6,"async"),p(7,jr,2,1,"ng-template",null,0,st)(9,Hr,4,0,"button",5),D(10,"async"),o(),p(11,zr,2,0,"div",6)(12,Qr,3,2,"ng-container",7),D(13,"async"),p(14,Kr,2,1,"p",8),D(15,"async"),o()),r&2){let l=se(8);s(5),m("ngIf",O(6,6,i.user$))("ngIfElse",l),s(4),m("ngIf",!i.isLoading&&O(10,8,i.user$)&&!i.isEditMode),s(2),m("ngIf",i.isLoading),s(),m("ngIf",!i.isLoading&&O(13,10,i.user$)),s(2),m("ngIf",!i.isLoading&&!O(15,12,i.user$)&&i.userId)}},dependencies:[C,$,Q,K,Ue,Ye,re,b,k,R,v,I,xe,Se,Oe,Y],styles:[".page-container[_ngcontent-%COMP%]{padding:24px;background-color:#f9f9f9}.detail-page-container[_ngcontent-%COMP%]{max-width:700px;margin:30px auto;background-color:#fff;border-radius:8px;box-shadow:0 2px 10px #0000001a;padding:24px}.page-header[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:24px;padding-bottom:16px;border-bottom:1px solid #e0e0e0}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0 0 0 16px;font-size:1.6em;font-weight:500;color:#3f51b5;flex-grow:1}.spinner-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:200px;padding:40px 0}.form-wrapper[_ngcontent-%COMP%], .card-wrapper[_ngcontent-%COMP%]{margin-top:20px}.not-found-message[_ngcontent-%COMP%]{text-align:center;font-style:italic;color:#757575;padding:30px}"]})};var sr={users:[],isLoading:!1,isSubmitting:!1,error:null};var lr=dt(sr,P(Z,t=>g(f({},t),{isLoading:!0,error:null})),P(Le,(t,{users:e})=>g(f({},t),{users:e,isLoading:!1})),P($e,(t,{error:e})=>g(f({},t),{users:[],isLoading:!1,error:e})),P(J,t=>g(f({},t),{isSubmitting:!0,error:null})),P(pe,(t,{user:e})=>g(f({},t),{users:[...t.users,e],isSubmitting:!1})),P(Be,(t,{error:e})=>g(f({},t),{isSubmitting:!1,error:e})),P(Ve,t=>g(f({},t),{error:null})),P(X,t=>g(f({},t),{isLoading:!0,error:null})),P(Re,(t,{userId:e})=>g(f({},t),{users:t.users.filter(r=>r.id!==e),isLoading:!1})),P(Ne,(t,{error:e})=>g(f({},t),{isLoading:!1,error:e})));var We=class t{actions$=c(ut);userService=c(ie);snackBar=c(W);router=c(B);loadUsers$=me(()=>this.actions$.pipe(ce(Z),M(()=>console.log("UserEffects: loadUsers action dispatched")),Ze(()=>this.userService.getUsers().pipe(q(e=>(console.log("UserEffects: Users received from service",e),Le({users:e}))),x(e=>{let r=e.message||"Failed to load users from effect.";return console.error("UserEffects: Error loading users",e),this.snackBar.open(r,"Close",{duration:7e3,panelClass:["error-snackbar"]}),V($e({error:r}))})))));createUser$=me(()=>this.actions$.pipe(ce(J),M(e=>console.log("UserEffects: createUser action dispatched with user:",e.user)),Ze(e=>this.userService.createUser(e.user).pipe(q(r=>(console.log("UserEffects: User created via service",r),pe({user:r}))),x(r=>{let i=r.message||"Failed to create user.";return console.error("UserEffects: Error creating user",r),V(Be({error:i}))})))));createUserSuccess$=me(()=>this.actions$.pipe(ce(pe),M(e=>{console.log("UserEffects: createUserSuccess action, navigating for user:",e.user),this.snackBar.open(`User "${e.user.username}" created successfully!`,"OK",{duration:3e3,verticalPosition:"top",panelClass:["success-snackbar"]}),this.router.navigate(["/users"])})),{dispatch:!1});deleteUser$=me(()=>this.actions$.pipe(ce(X),ge(e=>this.userService.deleteUser(e.userId).pipe(M(()=>{this.snackBar.open("User deleted successfully!","OK",{duration:3e3,panelClass:["success-snackbar"],verticalPosition:"top"})}),q(()=>Re({userId:e.userId})),x(r=>{let i=r.message||"An unexpected error occurred.";return this.snackBar.open(i,"Close",{duration:5e3,panelClass:["error-snackbar"],verticalPosition:"top"}),V(Ne({error:i}))})))));static \u0275fac=function(r){return new(r||t)};static \u0275prov=he({token:t,factory:t.\u0275fac})};var mr=[pt({name:"users",reducer:lr}),ft(We)];var In=[{path:"",providers:[...mr],children:[{path:"",component:Qe,title:"User List"},{path:"create",component:Ke,title:"Create New User"},{path:"edit/:id",component:fe,title:"Edit User"},{path:":id",component:fe,title:"User Details"}]}];export{In as USERS_ROUTES};
