import{b as D}from"./chunk-OTLI2ABD.js";import{a as y}from"./chunk-F6TTIMDB.js";import{Ba as M,Ha as R,Ia as I,Nc as k,a as o,b as p,f as b,ga as v,kc as m,la as u,lc as l}from"./chunk-ZAXDZG2U.js";function A(e){let t=m(()=>e());return B(t)?new Proxy(e,{get(n,r){return r in t?(R(n[r])||Object.defineProperty(n,r,{value:l(()=>n()[r]),configurable:!0}),A(n[r])):n[r]}}):e}var L=[WeakSet,WeakMap,Promise,Date,Error,RegExp,ArrayBuffer,DataView,Function];function B(e){if(e===null||typeof e!="object"||H(e))return!1;let t=Object.getPrototypeOf(e);if(t===Object.prototype)return!0;for(;t&&t!==Object.prototype;){if(L.includes(t.constructor))return!1;t=Object.getPrototypeOf(t)}return t===Object.prototype}function H(e){return typeof e?.[Symbol.iterator]=="function"}var F=new WeakMap,i=Symbol("STATE_SOURCE");function d(e,...t){e[i].update(n=>t.reduce((r,f)=>o(o({},r),typeof f=="function"?f(r):f),n)),z(e)}function _(e){return e[i]()}function q(e){return F.get(e[i])||[]}function z(e){let t=q(e);for(let n of t){let r=m(()=>_(e));n(r)}}function P(...e){let t=[...e],n=typeof t[0]=="function"?{}:t.shift(),r=t;return(()=>{class s{constructor(){let c=r.reduce((g,O)=>O(g),V()),{stateSignals:h,props:T,methods:W,hooks:K}=c,S=o(o(o({},h),T),W);this[i]=c[i];for(let g of Reflect.ownKeys(S))this[g]=S[g];let{onInit:j,onDestroy:w}=K;j&&j(),w&&u(M).onDestroy(w)}static \u0275fac=function(h){return new(h||s)};static \u0275prov=v({token:s,factory:s.\u0275fac,providedIn:n.providedIn||null})}return s})()}function V(){return{[i]:I({}),stateSignals:{},props:{},methods:{},hooks:{}}}function $(e){return t=>{let n=e(o(o(o({[i]:t[i]},t.stateSignals),t.props),t.methods));return Reflect.ownKeys(n),p(o({},t),{props:o(o({},t.props),n)})}}function C(e){return $(e)}function x(e){return t=>{let n=e(o(o(o({[i]:t[i]},t.stateSignals),t.props),t.methods));return Reflect.ownKeys(n),p(o({},t),{methods:o(o({},t.methods),n)})}}function U(e){return t=>{let n=typeof e=="function"?e():e,r=Reflect.ownKeys(n);t[i].update(s=>o(o({},s),n));let f=r.reduce((s,a)=>{let c=l(()=>t[i]()[a]);return p(o({},s),{[a]:A(c)})},{});return p(o({},t),{stateSignals:o(o({},t.stateSignals),f)})}}var E={isLoading:!1,error:null},at=P({providedIn:"root"},U(E),C((e,t=u(y))=>({currentUser:l(()=>t.currentUser()),isAuthenticated:l(()=>t.isAuthenticated())})),x((e,t=u(k),n=u(y),r=u(D))=>({login(s){return b(this,null,function*(){d(e,{isLoading:!0,error:null});try{let a=yield n.loginPromise(s);console.log("authResponse",a),r.open(`Bienvenido de nuevo, ${a.user.username}!`,"OK",{duration:3e3,verticalPosition:"top",panelClass:["success-snackbar"]}),n.getCurrentUserFromBackend().subscribe(),t.navigate(["orders-delivered"])}catch(a){let c=a.message||"Login failed. Please try again.";d(e,{error:c}),r.open(c,"Retry",{duration:5e3,verticalPosition:"top",panelClass:["error-snackbar"]})}finally{d(e,{isLoading:!1})}})},logout(){n.logout(),d(e,E),r.open("Se ha cerrado la sesi\xF3n.","OK",{duration:3e3,verticalPosition:"top"})},clearError(){d(e,{error:null})}})));export{at as a};
