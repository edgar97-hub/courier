import{a as Ot}from"./chunk-UHIREOIJ.js";import{a as be,b as Ee,c as Pe,d as De}from"./chunk-6HWJN4XJ.js";import{a as ct,b as dt,c as pt,d as ft,g as Ce,h as ht}from"./chunk-HGPHA7DX.js";import"./chunk-CL5SDS67.js";import{a as vt,b as Mt,c as Ct,d as yt,e as _t,f as xt,g as St,h as bt,i as Et,j as Pt,k as Dt,l as wt,m as Ae,n as Se,o as It,p as Tt}from"./chunk-AHO7UDPR.js";import"./chunk-MS4AQ6UA.js";import{d as xe,e as Ft}from"./chunk-7I3QWZBN.js";import{a as ye,b as _e}from"./chunk-XC4JK7T6.js";import{a as pe,b as fe,c as ut,d as gt,e as ue,f as ge,g as he,h as ve}from"./chunk-MJOVE2YB.js";import{d as Me}from"./chunk-XTLFEAFI.js";import"./chunk-MW2V4VAY.js";import{a as st}from"./chunk-GEP52VOZ.js";import"./chunk-CSWUMH3X.js";import{d as me,e as le}from"./chunk-A2GZCIHE.js";import{a as de}from"./chunk-YSXPYM2V.js";import"./chunk-7RWCIHFI.js";import{C as oe,F as re,G as mt,b as W,d as R,f as X,g as Z,l as at,m as ot,o as ee,r as te,v as ie,x as ne,y as ae,z as rt}from"./chunk-I57H2NTY.js";import"./chunk-7SNYFGVH.js";import"./chunk-NTJKNPMM.js";import{a as Ze,b as et,d as tt,g as it,i as nt}from"./chunk-ABVOVIA5.js";import{a as K,b as J}from"./chunk-42JOKCMC.js";import{a as Xe}from"./chunk-QOYZNJPJ.js";import{a as lt,b as L,e as A}from"./chunk-JRHRK62N.js";import"./chunk-J25GVFCX.js";import{$b as u,Ac as Je,Bb as x,Cb as P,Cc as N,Dd as se,Ed as ce,Gc as Re,Hc as Le,Ib as ke,Ic as We,J as Te,Jb as Be,Kb as Ne,Nb as D,Ob as a,Pb as w,Q as Oe,Qb as d,S as H,Ta as m,Vc as q,Xa as M,Xb as Q,Yb as Ye,a as O,aa as U,ab as k,ac as qe,b as $e,bc as g,gb as p,h as He,ha as Ue,kb as s,l as Ge,la as Qe,ma as G,t as ze,tb as n,tc as Y,u as F,ub as i,uc as B,va as y,vb as C,w as Ie,wa as _,wb as b,wc as Ke,xb as E,yc as T,zb as I}from"./chunk-NTZTTLCP.js";var j=class o{constructor(t){this.http=t}apiUrl=`${q.apiUrl}/cash-management`;authService=G(Xe);getAuthHeaders(){let t=this.authService.getAccessToken();return t?new Re({"Content-Type":"application/json",codrr_token:t}):new Re({"Content-Type":"application/json"})}getAllCashMovements(t,e=1,r=10,l,c){let h=this.getAuthHeaders();if(!this.authService.getAccessToken())return F(()=>new Error("Not authenticated to fetch cash movements."));let f=new Le;if(t)for(let v in t)t.hasOwnProperty(v)&&t[v]&&(f=f.append(v,t[v]));return f=f.append("page_number",e.toString()),f=f.append("page_size",r.toString()),l&&(f=f.append("orderBy",l)),c&&(f=f.append("orderDirection",c)),this.http.get(`${this.apiUrl}/movements`,{params:f,headers:h})}getCashMovementSummary(t){let e=this.getAuthHeaders();if(!this.authService.getAccessToken())return F(()=>new Error("Not authenticated to fetch cash movement summary."));let r=new Le;if(t)for(let l in t)t.hasOwnProperty(l)&&t[l]&&(r=r.append(l,t[l]));return this.http.get(`${this.apiUrl}/detailed-summary`,{params:r,headers:e})}createManualMovement(t){let e=this.getAuthHeaders();return this.authService.getAccessToken()?this.http.post(`${this.apiUrl}/manual-movement`,t,{headers:e}):F(()=>new Error("Not authenticated to create cash movement."))}updateCashMovement(t,e){let r=this.getAuthHeaders();return this.authService.getAccessToken()?this.http.put(`${this.apiUrl}/${t}`,e,{headers:r}):F(()=>new Error("Not authenticated to update cash movement."))}deleteCashMovement(t){let e=this.getAuthHeaders();return this.authService.getAccessToken()?this.http.delete(`${this.apiUrl}/${t}`,{headers:e}):F(()=>new Error("Not authenticated to delete cash movement."))}generatePdf(t){let e=this.getAuthHeaders().set("Accept","application/pdf");return this.authService.getAccessToken()?this.http.get(`${this.apiUrl}/${t}/pdf/ticket`,{headers:e,responseType:"blob"}):F(()=>new Error("Not authenticated to generate PDF."))}static \u0275fac=function(e){return new(e||o)(Qe(We))};static \u0275prov=Ue({token:o,factory:o.\u0275fac,providedIn:"root"})};function Qt(o,t){o&1&&(n(0,"mat-error"),a(1,"La fecha es requerida"),i())}function Yt(o,t){o&1&&(n(0,"mat-error"),a(1,"El monto es requerido"),i())}function qt(o,t){o&1&&(n(0,"mat-error"),a(1,"El monto debe ser mayor o igual a 0"),i())}function Kt(o,t){o&1&&(n(0,"mat-error"),a(1,"El tipo de movimiento es requerido"),i())}function Jt(o,t){if(o&1&&(n(0,"mat-option",19),a(1),i()),o&2){let e=t.$implicit;s("value",e),m(),w(e)}}function Wt(o,t){o&1&&(n(0,"mat-error"),a(1,"La forma de pago es requerida"),i())}function Xt(o,t){o&1&&C(0,"mat-spinner",20)}function Zt(o,t){o&1&&(n(0,"span"),a(1,"Guardar"),i())}var z=class o{constructor(t,e,r,l,c){this.fb=t;this.dialogRef=e;this.cashManagementService=r;this.snackBar=l;this.data=c;this.movementForm=this.fb.group({date:[new Date,R.required],amount:[null,[R.required,R.min(0)]],typeMovement:["",R.required],paymentsMethod:["",R.required],description:[""]})}movementForm;isLoading=!1;minDate=null;paymentMethods=["Efectivo","Yape/Transferencia BCP","Plin/Transferencia INTERBANK","POS"];ngOnInit(){if(this.data){let t=null;if(this.data.date){let e=this.data.date.split("-");t=new Date(parseInt(e[0]),parseInt(e[1])-1,parseInt(e[2]))}this.movementForm.patchValue($e(O({},this.data),{date:t}))}}onSave(){if(this.movementForm.valid&&!this.isLoading){this.isLoading=!0;let t=O({},this.movementForm.value);(this.data&&this.data.id?this.cashManagementService.updateCashMovement(this.data.id,t):this.cashManagementService.createManualMovement(t)).pipe(H(()=>this.isLoading=!1)).subscribe({next:r=>{this.snackBar.open("Movimiento registrado exitosamente","Cerrar",{duration:3e3}),this.dialogRef.close(!0)},error:r=>{this.snackBar.open("Error al registrar movimiento: "+r.message,"Cerrar",{duration:3e3}),console.error("Error creating cash movement:",r)}})}}onCancel(){this.dialogRef.close(!1)}static \u0275fac=function(e){return new(e||o)(M(ie),M(pe),M(j),M(de),M(fe))};static \u0275cmp=k({type:o,selectors:[["app-cash-movement-form"]],features:[Q([ht(),T])],decls:43,vars:14,consts:[["picker",""],["mat-dialog-title","",1,"page-header",2,"font-weight","700 !important"],[1,"cash-movement-dialog-content",3,"formGroup"],[1,"wrapper-form-field"],["appearance","outline",1,"cash-movement-form-field"],["matInput","","formControlName","date",3,"matDatepicker","min"],["matSuffix","",3,"for"],[4,"ngIf"],["matInput","","type","number","formControlName","amount","placeholder","Ej: 100.50"],["formControlName","typeMovement"],["value","INGRESO"],["value","EGRESO"],["formControlName","paymentsMethod"],[3,"value",4,"ngFor","ngForOf"],["matInput","","formControlName","description","placeholder","Ej: Compra de insumos","rows","3"],["align","end",1,"cash-movement-dialog-actions"],["mat-button","",1,"btn-corp-secondary",3,"click","disabled"],["mat-raised-button","","color","primary",1,"btn-corp-primary",3,"click","disabled"],["diameter","20",4,"ngIf"],[3,"value"],["diameter","20"]],template:function(e,r){if(e&1){let l=I();n(0,"h1",1),a(1,` Formulario de Movimiento de Caja
`),i(),n(2,"mat-dialog-content",2)(3,"div",3)(4,"mat-form-field",4)(5,"mat-label"),a(6,"Fecha"),i(),C(7,"input",5)(8,"mat-datepicker-toggle",6)(9,"mat-datepicker",null,0),p(11,Qt,2,0,"mat-error",7),i(),n(12,"mat-form-field",4)(13,"mat-label"),a(14,"Monto"),i(),C(15,"input",8),p(16,Yt,2,0,"mat-error",7)(17,qt,2,0,"mat-error",7),i(),n(18,"mat-form-field",4)(19,"mat-label"),a(20,"Tipo de Movimiento"),i(),n(21,"mat-select",9)(22,"mat-option",10),a(23,"Ingreso"),i(),n(24,"mat-option",11),a(25,"Egreso"),i()(),p(26,Kt,2,0,"mat-error",7),i(),n(27,"mat-form-field",4)(28,"mat-label"),a(29,"Forma de Pago"),i(),n(30,"mat-select",12),p(31,Jt,2,2,"mat-option",13),i(),p(32,Wt,2,0,"mat-error",7),i(),n(33,"mat-form-field",4)(34,"mat-label"),a(35,"Descripci\xF3n / Motivo"),i(),C(36,"textarea",14),i()()(),n(37,"mat-dialog-actions",15)(38,"button",16),x("click",function(){return y(l),_(r.onCancel())}),a(39," Cancelar "),i(),n(40,"button",17),x("click",function(){return y(l),_(r.onSave())}),p(41,Xt,1,0,"mat-spinner",18)(42,Zt,2,0,"span",7),i()()}if(e&2){let l,c,h,f,v,V=D(10);m(2),s("formGroup",r.movementForm),m(5),s("matDatepicker",V)("min",r.minDate),m(),s("for",V),m(3),s("ngIf",(l=r.movementForm.get("date"))==null?null:l.hasError("required")),m(5),s("ngIf",(c=r.movementForm.get("amount"))==null?null:c.hasError("required")),m(),s("ngIf",(h=r.movementForm.get("amount"))==null?null:h.hasError("min")),m(9),s("ngIf",(f=r.movementForm.get("typeMovement"))==null?null:f.hasError("required")),m(5),s("ngForOf",r.paymentMethods),m(),s("ngIf",(v=r.movementForm.get("paymentsMethod"))==null?null:v.hasError("required")),m(6),s("disabled",r.isLoading),m(2),s("disabled",r.movementForm.invalid||r.isLoading),m(),s("ngIf",r.isLoading),m(),s("ngIf",!r.isLoading)}},dependencies:[N,Y,B,ne,W,ot,X,Z,ee,te,le,me,re,ae,rt,oe,A,L,_e,ye,Me,De,be,Ee,Pe,Ce,ve,ue,he,ge,mt,J,K],styles:[".cash-movement-dialog-content[_ngcontent-%COMP%]{padding:.75rem;overflow-y:auto;max-height:50vh}.wrapper-form-field[_ngcontent-%COMP%]{padding:20px}.cash-movement-form-field[_ngcontent-%COMP%]{margin-bottom:.5rem}.cash-movement-dialog-actions[_ngcontent-%COMP%]{padding:.75rem 1rem;border-top:1px solid #eee;background-color:#f9f9f9}.cash-movement-action-button[_ngcontent-%COMP%]{padding:.5rem 1rem;font-size:.8rem;border-radius:.25rem;transition:all .2s ease-in-out}.cash-movement-action-button[_ngcontent-%COMP%]:hover{transform:translateY(-1px);box-shadow:0 1px 2px #0000001a}.cash-movement-action-button[color=primary][_ngcontent-%COMP%]{background-color:#007bff;color:#fff}.cash-movement-action-button[color=accent][_ngcontent-%COMP%]{background-color:#6c757d;color:#fff}@media (max-width: 768px){.cash-movement-dialog-content[_ngcontent-%COMP%]{padding:.5rem}.cash-movement-dialog-actions[_ngcontent-%COMP%]{padding:.5rem;flex-direction:column;gap:.4rem}.cash-movement-action-button[_ngcontent-%COMP%]{width:100%}}"]})};function ti(o,t){if(o&1&&(n(0,"mat-icon",6),a(1),i()),o&2){let e=P();s("color",e.data.iconColor||"primary"),m(),w(e.data.icon)}}var we=class o{constructor(t,e){this.dialogRef=t;this.data=e}static \u0275fac=function(e){return new(e||o)(M(pe),M(fe))};static \u0275cmp=k({type:o,selectors:[["app-confirm-dialog"]],decls:12,vars:8,consts:[[1,"confirm-dialog-container"],["class","dialog-icon",3,"color",4,"ngIf"],["mat-dialog-title",""],[2,"display","flex","flex-direction","row","flex-wrap","nowrap","border","0px solid black"],["mat-stroked-button","",1,"btn-corp-secondary",3,"mat-dialog-close"],["mat-raised-button","",1,"btn-corp-primary",3,"color","mat-dialog-close"],[1,"dialog-icon",3,"color"]],template:function(e,r){e&1&&(n(0,"div",0),p(1,ti,2,2,"mat-icon",1),n(2,"h2",2),a(3),i(),n(4,"mat-dialog-content")(5,"p"),a(6),i()(),n(7,"mat-dialog-actions",3)(8,"button",4),a(9),i(),n(10,"button",5),a(11),i()()()),e&2&&(m(),s("ngIf",r.data.icon),m(2),w(r.data.title),m(3),w(r.data.message),m(2),s("mat-dialog-close",!1),m(),d(" ",r.data.cancelButtonText," "),m(),s("color",r.data.confirmButtonColor)("mat-dialog-close",!0),m(),d(" ",r.data.confirmButtonText," "))},dependencies:[N,B,ve,gt,ue,he,ge,A,L,ce,se],styles:[".confirm-dialog-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:24px;text-align:center;border:2px solid var(--mat-dialog-container-border-color, #ccc);border-radius:8px}.dialog-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px;margin-bottom:16px}mat-dialog-title[_ngcontent-%COMP%]{font-size:1.5em;font-weight:700;margin-bottom:16px;color:var(--mat-dialog-title-color, inherit)}mat-dialog-content[_ngcontent-%COMP%]{margin-bottom:24px}"]})};var ii=()=>[5,10,20,50];function ni(o,t){o&1&&(n(0,"div",48),C(1,"mat-spinner",49),i())}function ai(o,t){if(o&1&&(n(0,"div",50)(1,"div",51)(2,"div",52)(3,"div",53),a(4,"Tipo"),i(),n(5,"div",53),a(6,"Efectivo"),i(),n(7,"div",53),a(8,"Yape / Transferencia BCP"),i(),n(9,"div",53),a(10," Plin / Transferencia INTERBANK "),i(),n(11,"div",53),a(12,"POS"),i()(),n(13,"div",54)(14,"div",55),a(15,"Ingreso"),i(),n(16,"div",55),a(17),u(18,"currency"),i(),n(19,"div",55),a(20),u(21,"currency"),i(),n(22,"div",55),a(23),u(24,"currency"),i(),n(25,"div",55),a(26),u(27,"currency"),i()(),n(28,"div",54)(29,"div",55),a(30,"Egreso"),i(),n(31,"div",55),a(32),u(33,"currency"),i(),n(34,"div",55),a(35),u(36,"currency"),i(),n(37,"div",55),a(38),u(39,"currency"),i(),n(40,"div",55),a(41),u(42,"currency"),i()(),n(43,"div",54)(44,"div",55),a(45,"Saldo"),i(),n(46,"div",55),a(47),u(48,"currency"),i(),n(49,"div",55),a(50),u(51,"currency"),i(),n(52,"div",55),a(53),u(54,"currency"),i(),n(55,"div",55),a(56),u(57,"currency"),i()(),n(58,"div",56)(59,"div",57),a(60,"Ingreso Caja"),i(),n(61,"div",58),a(62),u(63,"currency"),i()(),n(64,"div",56)(65,"div",57),a(66,"Egreso Caja"),i(),n(67,"div",58),a(68),u(69,"currency"),i()(),n(70,"div",56)(71,"div",57),a(72,"Total en Caja"),i(),n(73,"div",58),a(74),u(75,"currency"),i()()()()),o&2){let e=t.ngIf;m(17),d(" ",g(18,15,e.Efectivo.income,"S/ ")," "),m(3),d(" ",g(21,18,e["Yape/Transferencia BCP"].income,"S/ ")," "),m(3),d(" ",g(24,21,e["Plin/Transferencia INTERBANK"].income,"S/ ")," "),m(3),d(" ",g(27,24,e.POS.income,"S/ ")," "),m(6),d(" ",g(33,27,e.Efectivo.expense,"S/ ")," "),m(3),d(" ",g(36,30,e["Yape/Transferencia BCP"].expense,"S/ ")," "),m(3),d(" ",g(39,33,e["Plin/Transferencia INTERBANK"].expense,"S/ ")," "),m(3),d(" ",g(42,36,e.POS.expense,"S/ ")," "),m(6),d(" ",g(48,39,e.Efectivo.balance,"S/ ")," "),m(3),d(" ",g(51,42,e["Yape/Transferencia BCP"].balance,"S/ ")," "),m(3),d(" ",g(54,45,e["Plin/Transferencia INTERBANK"].balance,"S/ ")," "),m(3),d(" ",g(57,48,e.POS.balance,"S/ ")," "),m(6),d(" ",g(63,51,e.totalCashIncome,"S/ ")," "),m(6),d(" ",g(69,54,e.totalCashExpense,"S/ ")," "),m(6),d(" ",g(75,57,e.totalCashBalance,"S/ ")," ")}}function oi(o,t){if(o&1&&(n(0,"mat-option",59),a(1),i()),o&2){let e=t.$implicit;s("value",e),m(),w(e)}}function ri(o,t){o&1&&(n(0,"div",48),C(1,"mat-spinner",49),i())}function mi(o,t){o&1&&(n(0,"th",60),a(1," N\xB0 "),i())}function li(o,t){if(o&1&&(n(0,"td",61),a(1),i()),o&2){let e=t.$implicit;m(),d(" ",e.code," ")}}function si(o,t){o&1&&(n(0,"th",60),a(1," Fecha "),i())}function ci(o,t){if(o&1&&(n(0,"td",61),a(1),u(2,"date"),i()),o&2){let e=t.$implicit;m(),d(" ",g(2,1,e.date,"dd/MM/yyyy")," ")}}function di(o,t){o&1&&(n(0,"th",60),a(1," Tipo "),i())}function pi(o,t){if(o&1&&(n(0,"td",61),a(1),i()),o&2){let e=t.$implicit;m(),d(" ",e.typeMovement," ")}}function fi(o,t){o&1&&(n(0,"th",60),a(1," Monto "),i())}function ui(o,t){if(o&1&&(n(0,"td",61),a(1),u(2,"currency"),i()),o&2){let e=t.$implicit;m(),d(" ",g(2,1,e.amount,"S/ ")," ")}}function gi(o,t){o&1&&(n(0,"th",60),a(1," Forma de Pago "),i())}function hi(o,t){if(o&1&&(n(0,"td",61),a(1),i()),o&2){let e=t.$implicit;m(),d(" ",e.paymentsMethod," ")}}function vi(o,t){o&1&&(n(0,"th",60),a(1," Descripci\xF3n "),i())}function Mi(o,t){if(o&1&&(n(0,"td",61),a(1),i()),o&2){let e=t.$implicit;m(),d(" ",e.description," ")}}function Ci(o,t){o&1&&(n(0,"th",60),a(1," Usuario "),i())}function yi(o,t){if(o&1&&(n(0,"td",61),a(1),i()),o&2){let e=t.$implicit;m(),d(" ",e.user==null?null:e.user.username," ")}}function _i(o,t){o&1&&(n(0,"th",62),a(1," Acciones "),i())}function xi(o,t){if(o&1){let e=I();n(0,"button",66),x("click",function(){y(e);let l=P().$implicit,c=P();return _(c.editMovement(l))}),n(1,"mat-icon"),a(2,"edit"),i(),n(3,"span"),a(4,"Editar"),i()()}}function Si(o,t){if(o&1){let e=I();n(0,"button",66),x("click",function(){y(e);let l=P().$implicit,c=P();return _(c.deleteMovement(l.id))}),n(1,"mat-icon"),a(2,"delete"),i(),n(3,"span"),a(4,"Eliminar"),i()()}}function bi(o,t){if(o&1){let e=I();n(0,"td",63)(1,"button",64)(2,"mat-icon"),a(3,"more_vert"),i()(),n(4,"mat-menu",null,4),p(6,xi,5,0,"button",65),n(7,"button",66),x("click",function(){let l=y(e).$implicit,c=P();return _(c.generatePdf(l.id))}),n(8,"mat-icon"),a(9,"picture_as_pdf"),i(),n(10,"span"),a(11,"Imprimir ticket"),i()(),p(12,Si,5,0,"button",65),i()()}if(o&2){let e=D(5),r=P();m(),s("matMenuTriggerFor",e),m(5),s("ngIf",!r.isReceptionist()),m(6),s("ngIf",!r.isReceptionist())}}function Ei(o,t){o&1&&C(0,"tr",67)}function Pi(o,t){o&1&&C(0,"tr",68)}function Di(o,t){o&1&&(n(0,"tr",69)(1,"td",70),a(2," No hay movimientos de caja que coincidan con los filtros. "),i()())}var Fe=class o{constructor(t,e,r,l,c){this.fb=t;this.cashManagementService=e;this.dialog=r;this.snackBar=l;this.excelExportService=c;let h=new Date;this.filterForm=this.fb.group({startDate:[h],endDate:[h],typeMovement:[""],paymentsMethod:[""],userId:[""]}),this.summaryFilterForm=this.fb.group({startDate:[h],endDate:[h]})}appStore=G(st);filterForm;summaryFilterForm;displayedColumns=["code","date","typeMovement","amount","paymentsMethod","description","user","actions"];paymentMethods=["Efectivo","Yape/Transferencia BCP","Plin/Transferencia INTERBANK","POS"];cashMovements=new Ae([]);summary$=ze({Efectivo:{income:0,expense:0,balance:0},"Yape/Transferencia BCP":{income:0,expense:0,balance:0},"Plin/Transferencia INTERBANK":{income:0,expense:0,balance:0},POS:{income:0,expense:0,balance:0},totalCashIncome:0,totalCashExpense:0,totalCashBalance:0});totalItems=0;pageSize=10;pageNumber=1;datePipe=G(T);isLoadingResults=!1;isLoadingSummary=!1;paginator;sort;destroy$=new Ge;ngOnInit(){this.fetchCashMovements(this.filterForm.value),this.fetchCashMovementSummary(this.summaryFilterForm.value),this.filterForm.valueChanges.pipe(U(this.destroy$),Te(400),Oe((t,e)=>JSON.stringify(t)===JSON.stringify(e))).subscribe(t=>{this.fetchCashMovements(t)}),this.summaryFilterForm.valueChanges.pipe(U(this.destroy$),Te(400),Oe((t,e)=>JSON.stringify(t)===JSON.stringify(e))).subscribe(t=>{this.fetchCashMovementSummary(t)})}ngAfterViewInit(){this.cashMovements.sort=this.sort,this.sort.sortChange.pipe(U(this.destroy$)).subscribe(()=>{this.pageNumber=1,this.applyFilters()})}fetchCashMovements(t,e,r){let l=O({},t);l.startDate&&(l.startDate=this.datePipe.transform(l.startDate,"yyyy-MM-dd")||""),l.endDate&&(l.endDate=this.datePipe.transform(l.endDate,"yyyy-MM-dd")||""),this.isLoadingResults=!0,this.cashManagementService.getAllCashMovements(l,this.pageNumber,this.pageSize,e,r).pipe(H(()=>this.isLoadingResults=!1)).subscribe(c=>{this.cashMovements=new Ae(c.movements),this.totalItems=c.total,this.cashMovements.sort=this.sort})}fetchCashMovementSummary(t){let e=O({},t);e.startDate&&(e.startDate=this.datePipe.transform(e.startDate,"yyyy-MM-dd")||""),e.endDate&&(e.endDate=this.datePipe.transform(e.endDate,"yyyy-MM-dd")||""),this.isLoadingSummary=!0,this.summary$=this.cashManagementService.getCashMovementSummary(e).pipe(H(()=>this.isLoadingSummary=!1))}applyFilters(){this.fetchCashMovements(this.filterForm.value,this.sort?.active,this.sort?.direction)}applySummaryFilters(){this.fetchCashMovementSummary(this.summaryFilterForm.value)}onPageChange(t){this.pageNumber=t.pageIndex+1,this.pageSize=t.pageSize,this.applyFilters()}openAddMovementDialog(){this.dialog.open(z,{width:"400px"}).afterClosed().subscribe(e=>{e&&this.applyFilters()})}editMovement(t){this.dialog.open(z,{width:"400px",data:t}).afterClosed().subscribe(r=>{r&&this.applyFilters()})}deleteMovement(t){let e={title:"Confirmar Eliminaci\xF3n",message:"\xBFEst\xE1s seguro de que quieres eliminar este movimiento de caja? Esta acci\xF3n no se puede deshacer.",confirmButtonText:"Eliminar",cancelButtonText:"Cancelar",confirmButtonColor:"warn"};this.dialog.open(we,{width:"350px",data:e}).afterClosed().subscribe(l=>{l&&this.cashManagementService.deleteCashMovement(t).subscribe({next:()=>{this.snackBar.open("Movimiento eliminado exitosamente","Cerrar",{duration:3e3}),this.applyFilters()},error:c=>{this.snackBar.open("Error al eliminar movimiento: "+c.message,"Cerrar",{duration:3e3}),console.error("Error deleting cash movement:",c)}})})}generatePdf(t){let e=q.apiUrl+"/cash-management/"+t+"/pdf/ticket";window.open(e,"_blank")}exportCashMovementsToExcel(){return He(this,null,function*(){let t=this.filterForm.value,e=this.summaryFilterForm.value;t.startDate&&(t.startDate=this.datePipe.transform(t.startDate,"yyyy-MM-dd")||""),t.endDate&&(t.endDate=this.datePipe.transform(t.endDate,"yyyy-MM-dd")||""),e.startDate&&(e.startDate=this.datePipe.transform(e.startDate,"yyyy-MM-dd")||""),e.endDate&&(e.endDate=this.datePipe.transform(e.endDate,"yyyy-MM-dd")||"");let r=this.cashManagementService.getAllCashMovements(t,1,999999),c=(yield Ie(r))?.movements||[],h=this.cashManagementService.getCashMovementSummary(e),f=yield Ie(h),v=[],V=[];v.push({label:"Fecha Inicio",value:this.datePipe.transform(e.startDate,"dd/MM/yyyy")}),v.push({label:"Fecha Fin",value:this.datePipe.transform(e.endDate,"dd/MM/yyyy")}),f&&(["Efectivo","Yape/Transferencia BCP","Plin/Transferencia INTERBANK","POS"].forEach(Ve=>{let $=f[Ve];$&&typeof $=="object"&&v.push({Tipo:Ve,Ingreso:$.income.toFixed(2),Egreso:$.expense.toFixed(2),Saldo:$.balance.toFixed(2)})}),v.push({label:"Total Ingresos",value:parseFloat(f.totalCashIncome.toFixed(2))}),v.push({label:"Total Egresos",value:parseFloat(f.totalCashExpense.toFixed(2))}),v.push({label:"Saldo Total",value:parseFloat(f.totalCashBalance.toFixed(2))})),c.forEach(S=>{V.push({"N\xB0":S.code,Fecha:this.datePipe.transform(S.date,"dd/MM/yyyy"),Tipo:S.typeMovement,Monto:parseFloat(S.amount.toFixed(2)),"Forma de Pago":S.paymentsMethod,Descripci\u00F3n:S.description,Usuario:S.user?.username||S.user?.email})});let At=`movimientos_caja_${this.datePipe.transform(new Date,"yyyyMMdd_HHmmss")}`;this.excelExportService.exportCashMovementSummaryAndDetailsToExcel(v,V,At,"Movimientos de Caja",this.datePipe.transform(t.startDate,"dd/MM/yyyy")||"",this.datePipe.transform(t.endDate,"dd/MM/yyyy")||"")})}isReceptionist(){return this.appStore.currentUser()?.role==="RECEPCIONISTA"}static \u0275fac=function(e){return new(e||o)(M(ie),M(j),M(ut),M(de),M(Ot))};static \u0275cmp=k({type:o,selectors:[["app-cash-management-list-page"]],viewQuery:function(e,r){if(e&1&&(ke(xe,5),ke(Se,5)),e&2){let l;Be(l=Ne())&&(r.paginator=l.first),Be(l=Ne())&&(r.sort=l.first)}},features:[Q([T])],decls:116,vars:23,consts:[["summaryStartDatePicker",""],["summaryEndDatePicker",""],["startDatePicker",""],["endDatePicker",""],["actionsMenu","matMenu"],[1,"page-container"],[2,"display","flex","padding","10px"],[1,"mat-card-header"],[1,"mat-card-title",2,"padding","10px !important","padding-left","0px !important"],["mat-raised-button","","color","primary",1,"btn-corp-primary","btn-excel",3,"click"],[1,"mat-card","summary-section"],[1,"mat-card-title"],[1,"filter-form",3,"formGroup"],["appearance","outline",1,"w-full"],["matInput","","formControlName","startDate",3,"matDatepicker"],["matSuffix","",3,"for"],["matInput","","formControlName","endDate",3,"matDatepicker"],[1,"form-actions",2,"padding-bottom","10px !important"],["mat-raised-button","","color","primary",1,"btn-corp-primary",3,"click"],["class","loading-overlay",4,"ngIf"],["class","summary-table-container",4,"ngIf"],[1,"mat-card"],["formControlName","typeMovement"],["value",""],["value","INGRESO"],["value","EGRESO"],["formControlName","paymentsMethod"],[3,"value",4,"ngFor","ngForOf"],[1,"form-actions"],["mat-raised-button","","color","accent",1,"btn-corp-primary",3,"click"],[1,""],["mat-table","","matSort","",1,"mat-table",3,"dataSource"],["matColumnDef","code"],["mat-header-cell","","mat-sort-header","","class","mat-header-cell",4,"matHeaderCellDef"],["mat-cell","","class","mat-cell",4,"matCellDef"],["matColumnDef","date"],["matColumnDef","typeMovement"],["matColumnDef","amount"],["matColumnDef","paymentsMethod"],["matColumnDef","description"],["matColumnDef","user"],["matColumnDef","actions"],["mat-header-cell","","class","mat-header-cell",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["showFirstLastButtons","",3,"page","length","pageSize","pageSizeOptions"],[1,"loading-overlay"],["diameter","30"],[1,"summary-table-container"],[1,"summary-table"],[1,"summary-header"],[1,"summary-cell","header-cell"],[1,"summary-row"],[1,"summary-cell"],[1,"summary-row","total-row"],[1,"summary-cell","total-label"],[1,"summary-cell","total-value"],[3,"value"],["mat-header-cell","","mat-sort-header","",1,"mat-header-cell"],["mat-cell","",1,"mat-cell"],["mat-header-cell","",1,"mat-header-cell"],["mat-cell",""],["mat-icon-button","","aria-label","Acciones",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click",4,"ngIf"],["mat-menu-item","",3,"click"],["mat-header-row",""],["mat-row",""],[1,"mat-row"],["colspan","7",1,"mat-cell"]],template:function(e,r){if(e&1){let l=I();n(0,"div",5)(1,"div",6)(2,"mat-card-header",7)(3,"mat-card-title",8),a(4,"Gesti\xF3n de Caja"),i()(),n(5,"button",9),x("click",function(){return y(l),_(r.exportCashMovementsToExcel())}),n(6,"mat-icon"),a(7,"cloud_download"),i(),a(8," Exportar a Excel "),i()(),n(9,"mat-card",10)(10,"mat-card-header",7)(11,"mat-card-title",11),a(12,"Resumen de Saldos"),i()(),n(13,"mat-card-content")(14,"form",12)(15,"mat-form-field",13)(16,"mat-label"),a(17,"Fecha Inicio Resumen"),i(),C(18,"input",14)(19,"mat-datepicker-toggle",15)(20,"mat-datepicker",null,0),i(),n(22,"mat-form-field",13)(23,"mat-label"),a(24,"Fecha Fin Resumen"),i(),C(25,"input",16)(26,"mat-datepicker-toggle",15)(27,"mat-datepicker",null,1),i()(),n(29,"div",17)(30,"button",18),x("click",function(){return y(l),_(r.applySummaryFilters())}),n(31,"mat-icon"),a(32,"filter_list"),i(),a(33," Aplicar Filtros Resumen "),i()(),p(34,ni,2,0,"div",19)(35,ai,76,60,"div",20),u(36,"async"),i()(),n(37,"mat-card",21)(38,"mat-card-header",7)(39,"mat-card-title",11),a(40,"Detalle de movimientos"),i()(),n(41,"mat-card",21)(42,"mat-card-content")(43,"form",12)(44,"mat-form-field",13)(45,"mat-label"),a(46,"Fecha Inicio"),i(),C(47,"input",14)(48,"mat-datepicker-toggle",15)(49,"mat-datepicker",null,2),i(),n(51,"mat-form-field",13)(52,"mat-label"),a(53,"Fecha Fin"),i(),C(54,"input",16)(55,"mat-datepicker-toggle",15)(56,"mat-datepicker",null,3),i(),n(58,"mat-form-field",13)(59,"mat-label"),a(60,"Tipo de Movimiento"),i(),n(61,"mat-select",22)(62,"mat-option",23),a(63,"Todos"),i(),n(64,"mat-option",24),a(65,"Ingreso"),i(),n(66,"mat-option",25),a(67,"Egreso"),i()()(),n(68,"mat-form-field",13)(69,"mat-label"),a(70,"Forma de Pago"),i(),n(71,"mat-select",26)(72,"mat-option",23),a(73,"Todos"),i(),p(74,oi,2,2,"mat-option",27),i()()(),n(75,"div",28)(76,"button",18),x("click",function(){return y(l),_(r.applyFilters())}),n(77,"mat-icon"),a(78,"filter_list"),i(),a(79," Aplicar Filtros "),i(),n(80,"button",29),x("click",function(){return y(l),_(r.openAddMovementDialog())}),n(81,"mat-icon"),a(82,"add"),i(),a(83," Registrar Movimiento "),i()()()(),n(84,"mat-card-content"),p(85,ri,2,0,"div",19),n(86,"div",30)(87,"table",31),b(88,32),p(89,mi,2,0,"th",33)(90,li,2,1,"td",34),E(),b(91,35),p(92,si,2,0,"th",33)(93,ci,3,4,"td",34),E(),b(94,36),p(95,di,2,0,"th",33)(96,pi,2,1,"td",34),E(),b(97,37),p(98,fi,2,0,"th",33)(99,ui,3,4,"td",34),E(),b(100,38),p(101,gi,2,0,"th",33)(102,hi,2,1,"td",34),E(),b(103,39),p(104,vi,2,0,"th",33)(105,Mi,2,1,"td",34),E(),b(106,40),p(107,Ci,2,0,"th",33)(108,yi,2,1,"td",34),E(),b(109,41),p(110,_i,2,0,"th",42)(111,bi,13,3,"td",43),E(),p(112,Ei,1,0,"tr",44)(113,Pi,1,0,"tr",45)(114,Di,3,0,"tr",46),i(),n(115,"mat-paginator",47),x("page",function(h){return y(l),_(r.onPageChange(h))}),i()()()()()}if(e&2){let l=D(21),c=D(28),h=D(50),f=D(57);m(14),s("formGroup",r.summaryFilterForm),m(4),s("matDatepicker",l),m(),s("for",l),m(6),s("matDatepicker",c),m(),s("for",c),m(8),s("ngIf",r.isLoadingSummary),m(),s("ngIf",qe(36,20,r.summary$)),m(8),s("formGroup",r.filterForm),m(4),s("matDatepicker",h),m(),s("for",h),m(6),s("matDatepicker",f),m(),s("for",f),m(19),s("ngForOf",r.paymentMethods),m(11),s("ngIf",r.isLoadingResults),m(2),s("dataSource",r.cashMovements),m(25),s("matHeaderRowDef",r.displayedColumns),m(),s("matRowDefColumns",r.displayedColumns),m(2),s("length",r.totalItems)("pageSize",r.pageSize)("pageSizeOptions",Ye(22,ii))}},dependencies:[N,Y,B,Ke,Je,T,nt,Ze,tt,it,et,wt,vt,Ct,St,yt,Mt,bt,_t,xt,Et,Pt,Dt,Ft,xe,Tt,Se,It,le,me,re,ae,oe,A,L,lt,ce,se,_e,ye,Me,De,be,Ee,Pe,Ce,ne,at,W,X,Z,ee,te,J,K,ft,dt,ct,pt],styles:[".page-container[_ngcontent-%COMP%]{background-color:#f9fafb;min-height:100vh}@media (max-width: 640px){.btn-excel[_ngcontent-%COMP%]{padding:25px!important}}.mat-card[_ngcontent-%COMP%]{box-shadow:0 1px 2px #0000000d;border-radius:.2rem}.mat-card-header[_ngcontent-%COMP%]{padding:0rem .6rem;border-bottom:1px solid #e5e7eb}.mat-card-title[_ngcontent-%COMP%]{color:#1f2937;font-weight:900;font-size:1.4rem;padding:7px 7px 11px!important}.filter-form[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:.4rem}.mat-form-field[_ngcontent-%COMP%]{width:100%;margin-bottom:0;font-size:.75rem}.form-actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:flex-end;gap:.3rem;margin-top:0!important;font-weight:700!important}@media (min-width: 640px){.form-actions[_ngcontent-%COMP%]{flex-direction:row}}.action-button[_ngcontent-%COMP%]{width:100%;padding:.3rem .6rem;font-size:.7rem;font-weight:600;border-radius:.15rem;transition:all .2s ease-in-out}@media (min-width: 640px){.action-button[_ngcontent-%COMP%]{width:auto}}.action-button[_ngcontent-%COMP%]:hover{transform:translateY(-1px);box-shadow:0 1px 2px #00000014}.summary-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(100px,1fr));gap:.4rem;text-align:center}.summary-card[_ngcontent-%COMP%]{padding:.1rem!important;background-color:#fff;border:1px solid #e5e7eb;border-radius:.2rem;box-shadow:0 1px 2px #00000005}.summary-card[_ngcontent-%COMP%]   .mat-card-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center}.summary-label[_ngcontent-%COMP%]{color:#4b5563;font-weight:700}.summary-value[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:700;margin-top:.05rem}.income-card[_ngcontent-%COMP%]{background-color:#e6ffe6;border-color:#6c6}.income-card[_ngcontent-%COMP%]   .summary-value[_ngcontent-%COMP%]{color:#28a745}.expense-card[_ngcontent-%COMP%]{background-color:#ffe6e6;border-color:#f66}.expense-card[_ngcontent-%COMP%]   .summary-value[_ngcontent-%COMP%]{color:#dc3545}.balance-card[_ngcontent-%COMP%]{background-color:#e6f7ff;border-color:#66b3ff}.balance-card[_ngcontent-%COMP%]   .summary-value.text-green-700[_ngcontent-%COMP%]{color:#28a745}.balance-card[_ngcontent-%COMP%]   .summary-value.text-red-700[_ngcontent-%COMP%]{color:#dc3545}.summary-table-container[_ngcontent-%COMP%]{width:100%;overflow-x:auto}.summary-table[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr repeat(4,minmax(100px,1fr));border:1px solid #817e7e;border-radius:4px;overflow:hidden;font-size:.85rem;min-width:600px}.summary-header[_ngcontent-%COMP%], .summary-row[_ngcontent-%COMP%]{display:contents}.summary-cell[_ngcontent-%COMP%]{padding:10px 15px;border:1px solid #848383;text-align:right;display:flex;align-items:center;justify-content:flex-end;border-bottom:0px;border-left:0px;color:#18191a;font-weight:500}.summary-cell[_ngcontent-%COMP%]:first-child{border-bottom:0px;text-align:left;justify-content:flex-start;font-weight:700;background-color:#f9f9f9}.header-cell[_ngcontent-%COMP%]{background-color:#012147;color:#fff;font-weight:700;text-align:center;justify-content:center}.header-cell[_ngcontent-%COMP%]:first-child{background-color:#012147;color:#fff;text-align:left;justify-content:flex-start}.total-row[_ngcontent-%COMP%]   .summary-cell[_ngcontent-%COMP%]{background-color:#f0f0f0;font-weight:700}.total-row[_ngcontent-%COMP%]   .summary-cell.total-label[_ngcontent-%COMP%]{text-align:right;justify-content:flex-end;grid-column:span 4}.total-row[_ngcontent-%COMP%]   .summary-cell.total-value[_ngcontent-%COMP%]{text-align:right;justify-content:flex-end}.mat-no-data-row[_ngcontent-%COMP%]   .mat-cell[_ngcontent-%COMP%]{text-align:center;padding-top:.4rem;padding-bottom:.4rem;color:#494b4e;font-style:italic}@media (max-width: 768px){.mat-table[_ngcontent-%COMP%]{display:block;overflow-x:auto;-webkit-overflow-scrolling:touch}}.total-row-content[_ngcontent-%COMP%]{display:flex;justify-content:space-between;width:100%}.total-row-label[_ngcontent-%COMP%], .total-row-value[_ngcontent-%COMP%]{font-weight:700}"]})};var Qn=[{path:"",component:Fe}];export{Qn as CASH_MANAGEMENT_ROUTES};
