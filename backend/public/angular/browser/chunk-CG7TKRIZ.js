import{a as Ot}from"./chunk-Q26YYUTK.js";import{a as Se,b as be,c as Ee,d as Pe}from"./chunk-6HWJN4XJ.js";import{a as ct,b as pt,c as dt,d as ft,g as Me,h as ht}from"./chunk-HGPHA7DX.js";import"./chunk-CL5SDS67.js";import{a as vt,b as Mt,c as Ct,d as _t,e as xt,f as yt,g as St,h as bt,i as Et,j as Pt,k as Dt,l as wt,m as Re,n as ye,o as Tt,p as Ft}from"./chunk-AHO7UDPR.js";import"./chunk-MS4AQ6UA.js";import{d as xe,e as It}from"./chunk-7I3QWZBN.js";import{a as Ce,b as _e}from"./chunk-XC4JK7T6.js";import{a as pe,b as de,c as ut,d as gt,e as fe,f as ue,g as ge,h as he}from"./chunk-MJOVE2YB.js";import{d as ve}from"./chunk-XTLFEAFI.js";import"./chunk-MW2V4VAY.js";import{a as st}from"./chunk-GEP52VOZ.js";import"./chunk-CSWUMH3X.js";import{d as re,e as me}from"./chunk-A2GZCIHE.js";import{a as ce}from"./chunk-YSXPYM2V.js";import"./chunk-7RWCIHFI.js";import{C as ae,F as oe,G as mt,b as J,d as N,f as W,g as X,l as at,m as ot,o as Z,r as ee,v as te,x as ne,y as ie,z as rt}from"./chunk-I57H2NTY.js";import"./chunk-7SNYFGVH.js";import"./chunk-NTJKNPMM.js";import{a as Ze,b as et,d as tt,g as nt,i as it}from"./chunk-ABVOVIA5.js";import{a as q,b as K}from"./chunk-42JOKCMC.js";import{a as Xe}from"./chunk-QOYZNJPJ.js";import{a as lt,b as R,e as A}from"./chunk-JRHRK62N.js";import"./chunk-J25GVFCX.js";import{$b as u,Ac as Je,Bb as x,Cb as P,Cc as B,Dd as le,Ed as se,Gc as Be,Hc as Ne,Ib as Fe,Ic as We,J as Ge,Jb as Oe,Kb as ke,Nb as O,Ob as o,Pb as D,Q as ze,Qb as p,S as $,Ta as m,Vc as Y,Xa as v,Xb as U,Yb as Ye,a as V,aa as Te,ab as F,ac as qe,b as je,bc as g,gb as d,h as Ve,ha as Ue,kb as s,l as $e,la as Qe,ma as H,t as He,tb as n,tc as Q,u as w,ub as t,uc as k,va as C,vb as M,w as Ie,wa as _,wb as b,wc as Ke,xb as E,yc as T,zb as I}from"./chunk-NTZTTLCP.js";var L=class a{constructor(e){this.http=e}apiUrl=`${Y.apiUrl}/cash-management`;authService=H(Xe);getAuthHeaders(){let e=this.authService.getAccessToken();return e?new Be({"Content-Type":"application/json",codrr_token:e}):new Be({"Content-Type":"application/json"})}getAllCashMovements(e,i=1,r=10,l,c){let h=this.getAuthHeaders();if(!this.authService.getAccessToken())return w(()=>new Error("Not authenticated to fetch cash movements."));let f=new Ne;if(e)for(let y in e)e.hasOwnProperty(y)&&e[y]&&(f=f.append(y,e[y]));return f=f.append("page_number",i.toString()),f=f.append("page_size",r.toString()),l&&(f=f.append("orderBy",l)),c&&(f=f.append("orderDirection",c)),this.http.get(`${this.apiUrl}/movements`,{params:f,headers:h})}getCashMovementSummary(e){let i=this.getAuthHeaders();if(!this.authService.getAccessToken())return w(()=>new Error("Not authenticated to fetch cash movement summary."));let r=new Ne;if(e)for(let l in e)e.hasOwnProperty(l)&&e[l]&&(r=r.append(l,e[l]));return this.http.get(`${this.apiUrl}/detailed-summary`,{params:r,headers:i})}createManualMovement(e){let i=this.getAuthHeaders();return this.authService.getAccessToken()?this.http.post(`${this.apiUrl}/manual-movement`,e,{headers:i}):w(()=>new Error("Not authenticated to create cash movement."))}updateCashMovement(e,i){let r=this.getAuthHeaders();return this.authService.getAccessToken()?this.http.put(`${this.apiUrl}/${e}`,i,{headers:r}):w(()=>new Error("Not authenticated to update cash movement."))}deleteCashMovement(e){let i=this.getAuthHeaders();return this.authService.getAccessToken()?this.http.delete(`${this.apiUrl}/${e}`,{headers:i}):w(()=>new Error("Not authenticated to delete cash movement."))}generatePdf(e){let i=this.getAuthHeaders().set("Accept","application/pdf");return this.authService.getAccessToken()?this.http.get(`${this.apiUrl}/${e}/pdf/ticket`,{headers:i,responseType:"blob"}):w(()=>new Error("Not authenticated to generate PDF."))}static \u0275fac=function(i){return new(i||a)(Qe(We))};static \u0275prov=Ue({token:a,factory:a.\u0275fac,providedIn:"root"})};function Ut(a,e){a&1&&(n(0,"mat-error"),o(1,"La fecha es requerida"),t())}function Qt(a,e){a&1&&(n(0,"mat-error"),o(1,"El monto es requerido"),t())}function Yt(a,e){a&1&&(n(0,"mat-error"),o(1,"El monto debe ser mayor o igual a 0"),t())}function qt(a,e){a&1&&(n(0,"mat-error"),o(1,"El tipo de movimiento es requerido"),t())}function Kt(a,e){if(a&1&&(n(0,"mat-option",19),o(1),t()),a&2){let i=e.$implicit;s("value",i),m(),D(i)}}function Jt(a,e){a&1&&(n(0,"mat-error"),o(1,"La forma de pago es requerida"),t())}function Wt(a,e){a&1&&M(0,"mat-spinner",20)}function Xt(a,e){a&1&&(n(0,"span"),o(1,"Guardar"),t())}var G=class a{constructor(e,i,r,l,c){this.fb=e;this.dialogRef=i;this.cashManagementService=r;this.snackBar=l;this.data=c;this.movementForm=this.fb.group({date:[new Date,N.required],amount:[null,[N.required,N.min(0)]],typeMovement:["",N.required],paymentsMethod:["",N.required],description:[""]})}movementForm;isLoading=!1;minDate=null;paymentMethods=["Efectivo","Yape/Transferencia BCP","Plin/Transferencia INTERBANK","POS"];ngOnInit(){if(this.data){let e=null;if(this.data.date){let i=this.data.date.split("-");e=new Date(parseInt(i[0]),parseInt(i[1])-1,parseInt(i[2]))}this.movementForm.patchValue(je(V({},this.data),{date:e}))}}onSave(){if(this.movementForm.valid&&!this.isLoading){this.isLoading=!0;let e=V({},this.movementForm.value);(this.data&&this.data.id?this.cashManagementService.updateCashMovement(this.data.id,e):this.cashManagementService.createManualMovement(e)).pipe($(()=>this.isLoading=!1)).subscribe({next:r=>{this.snackBar.open("Movimiento registrado exitosamente","Cerrar",{duration:3e3}),this.dialogRef.close(!0)},error:r=>{this.snackBar.open("Error al registrar movimiento: "+r.message,"Cerrar",{duration:3e3}),console.error("Error creating cash movement:",r)}})}}onCancel(){this.dialogRef.close(!1)}static \u0275fac=function(i){return new(i||a)(v(te),v(pe),v(L),v(ce),v(de))};static \u0275cmp=F({type:a,selectors:[["app-cash-movement-form"]],features:[U([ht(),T])],decls:43,vars:14,consts:[["picker",""],["mat-dialog-title","",1,"page-header",2,"font-weight","700 !important"],[1,"cash-movement-dialog-content",3,"formGroup"],[1,"wrapper-form-field"],["appearance","outline",1,"cash-movement-form-field"],["matInput","","formControlName","date",3,"matDatepicker","min"],["matSuffix","",3,"for"],[4,"ngIf"],["matInput","","type","number","formControlName","amount","placeholder","Ej: 100.50"],["formControlName","typeMovement"],["value","INGRESO"],["value","EGRESO"],["formControlName","paymentsMethod"],[3,"value",4,"ngFor","ngForOf"],["matInput","","formControlName","description","placeholder","Ej: Compra de insumos","rows","3"],["align","end",1,"cash-movement-dialog-actions"],["mat-button","",1,"btn-corp-secondary",3,"click","disabled"],["mat-raised-button","","color","primary",1,"btn-corp-primary",3,"click","disabled"],["diameter","20",4,"ngIf"],[3,"value"],["diameter","20"]],template:function(i,r){if(i&1){let l=I();n(0,"h1",1),o(1,` Formulario de Movimiento de Caja
`),t(),n(2,"mat-dialog-content",2)(3,"div",3)(4,"mat-form-field",4)(5,"mat-label"),o(6,"Fecha"),t(),M(7,"input",5)(8,"mat-datepicker-toggle",6)(9,"mat-datepicker",null,0),d(11,Ut,2,0,"mat-error",7),t(),n(12,"mat-form-field",4)(13,"mat-label"),o(14,"Monto"),t(),M(15,"input",8),d(16,Qt,2,0,"mat-error",7)(17,Yt,2,0,"mat-error",7),t(),n(18,"mat-form-field",4)(19,"mat-label"),o(20,"Tipo de Movimiento"),t(),n(21,"mat-select",9)(22,"mat-option",10),o(23,"Ingreso"),t(),n(24,"mat-option",11),o(25,"Egreso"),t()(),d(26,qt,2,0,"mat-error",7),t(),n(27,"mat-form-field",4)(28,"mat-label"),o(29,"Forma de Pago"),t(),n(30,"mat-select",12),d(31,Kt,2,2,"mat-option",13),t(),d(32,Jt,2,0,"mat-error",7),t(),n(33,"mat-form-field",4)(34,"mat-label"),o(35,"Descripci\xF3n / Motivo"),t(),M(36,"textarea",14),t()()(),n(37,"mat-dialog-actions",15)(38,"button",16),x("click",function(){return C(l),_(r.onCancel())}),o(39," Cancelar "),t(),n(40,"button",17),x("click",function(){return C(l),_(r.onSave())}),d(41,Wt,1,0,"mat-spinner",18)(42,Xt,2,0,"span",7),t()()}if(i&2){let l,c,h,f,y,z=O(10);m(2),s("formGroup",r.movementForm),m(5),s("matDatepicker",z)("min",r.minDate),m(),s("for",z),m(3),s("ngIf",(l=r.movementForm.get("date"))==null?null:l.hasError("required")),m(5),s("ngIf",(c=r.movementForm.get("amount"))==null?null:c.hasError("required")),m(),s("ngIf",(h=r.movementForm.get("amount"))==null?null:h.hasError("min")),m(9),s("ngIf",(f=r.movementForm.get("typeMovement"))==null?null:f.hasError("required")),m(5),s("ngForOf",r.paymentMethods),m(),s("ngIf",(y=r.movementForm.get("paymentsMethod"))==null?null:y.hasError("required")),m(6),s("disabled",r.isLoading),m(2),s("disabled",r.movementForm.invalid||r.isLoading),m(),s("ngIf",r.isLoading),m(),s("ngIf",!r.isLoading)}},dependencies:[B,Q,k,ne,J,ot,W,X,Z,ee,me,re,oe,ie,rt,ae,A,R,_e,Ce,ve,Pe,Se,be,Ee,Me,he,fe,ge,ue,mt,K,q],styles:[".cash-movement-dialog-content[_ngcontent-%COMP%]{padding:.75rem;overflow-y:auto;max-height:50vh}.wrapper-form-field[_ngcontent-%COMP%]{padding:20px}.cash-movement-form-field[_ngcontent-%COMP%]{margin-bottom:.5rem}.cash-movement-dialog-actions[_ngcontent-%COMP%]{padding:.75rem 1rem;border-top:1px solid #eee;background-color:#f9f9f9}.cash-movement-action-button[_ngcontent-%COMP%]{padding:.5rem 1rem;font-size:.8rem;border-radius:.25rem;transition:all .2s ease-in-out}.cash-movement-action-button[_ngcontent-%COMP%]:hover{transform:translateY(-1px);box-shadow:0 1px 2px #0000001a}.cash-movement-action-button[color=primary][_ngcontent-%COMP%]{background-color:#007bff;color:#fff}.cash-movement-action-button[color=accent][_ngcontent-%COMP%]{background-color:#6c757d;color:#fff}@media (max-width: 768px){.cash-movement-dialog-content[_ngcontent-%COMP%]{padding:.5rem}.cash-movement-dialog-actions[_ngcontent-%COMP%]{padding:.5rem;flex-direction:column;gap:.4rem}.cash-movement-action-button[_ngcontent-%COMP%]{width:100%}}"]})};function en(a,e){if(a&1&&(n(0,"mat-icon",6),o(1),t()),a&2){let i=P();s("color",i.data.iconColor||"primary"),m(),D(i.data.icon)}}var De=class a{constructor(e,i){this.dialogRef=e;this.data=i}static \u0275fac=function(i){return new(i||a)(v(pe),v(de))};static \u0275cmp=F({type:a,selectors:[["app-confirm-dialog"]],decls:12,vars:8,consts:[[1,"confirm-dialog-container"],["class","dialog-icon",3,"color",4,"ngIf"],["mat-dialog-title",""],[2,"display","flex","flex-direction","row","flex-wrap","nowrap","border","0px solid black"],["mat-stroked-button","",1,"btn-corp-secondary",3,"mat-dialog-close"],["mat-raised-button","",1,"btn-corp-primary",3,"color","mat-dialog-close"],[1,"dialog-icon",3,"color"]],template:function(i,r){i&1&&(n(0,"div",0),d(1,en,2,2,"mat-icon",1),n(2,"h2",2),o(3),t(),n(4,"mat-dialog-content")(5,"p"),o(6),t()(),n(7,"mat-dialog-actions",3)(8,"button",4),o(9),t(),n(10,"button",5),o(11),t()()()),i&2&&(m(),s("ngIf",r.data.icon),m(2),D(r.data.title),m(3),D(r.data.message),m(2),s("mat-dialog-close",!1),m(),p(" ",r.data.cancelButtonText," "),m(),s("color",r.data.confirmButtonColor)("mat-dialog-close",!0),m(),p(" ",r.data.confirmButtonText," "))},dependencies:[B,k,he,gt,fe,ge,ue,A,R,se,le],styles:[".confirm-dialog-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:24px;text-align:center;border:2px solid var(--mat-dialog-container-border-color, #ccc);border-radius:8px}.dialog-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px;margin-bottom:16px}mat-dialog-title[_ngcontent-%COMP%]{font-size:1.5em;font-weight:700;margin-bottom:16px;color:var(--mat-dialog-title-color, inherit)}mat-dialog-content[_ngcontent-%COMP%]{margin-bottom:24px}"]})};var tn=()=>[5,10,20,50];function nn(a,e){if(a&1&&(n(0,"mat-option",43),o(1),t()),a&2){let i=e.$implicit;s("value",i),m(),D(i)}}function an(a,e){a&1&&(n(0,"div",44),M(1,"mat-spinner",45),t())}function on(a,e){if(a&1&&(n(0,"div",46)(1,"div",47)(2,"div",48)(3,"div",49),o(4,"Tipo"),t(),n(5,"div",49),o(6,"Efectivo"),t(),n(7,"div",49),o(8,"Yape / Transferencia BCP"),t(),n(9,"div",49),o(10," Plin / Transferencia INTERBANK "),t(),n(11,"div",49),o(12,"POS"),t()(),n(13,"div",50)(14,"div",51),o(15,"Ingreso"),t(),n(16,"div",51),o(17),u(18,"currency"),t(),n(19,"div",51),o(20),u(21,"currency"),t(),n(22,"div",51),o(23),u(24,"currency"),t(),n(25,"div",51),o(26),u(27,"currency"),t()(),n(28,"div",50)(29,"div",51),o(30,"Egreso"),t(),n(31,"div",51),o(32),u(33,"currency"),t(),n(34,"div",51),o(35),u(36,"currency"),t(),n(37,"div",51),o(38),u(39,"currency"),t(),n(40,"div",51),o(41),u(42,"currency"),t()(),n(43,"div",50)(44,"div",51),o(45,"Saldo"),t(),n(46,"div",51),o(47),u(48,"currency"),t(),n(49,"div",51),o(50),u(51,"currency"),t(),n(52,"div",51),o(53),u(54,"currency"),t(),n(55,"div",51),o(56),u(57,"currency"),t()(),n(58,"div",52)(59,"div",53),o(60,"Ingreso Caja"),t(),n(61,"div",54),o(62),u(63,"currency"),t()(),n(64,"div",52)(65,"div",53),o(66,"Egreso Caja"),t(),n(67,"div",54),o(68),u(69,"currency"),t()(),n(70,"div",52)(71,"div",53),o(72,"Total en Caja"),t(),n(73,"div",54),o(74),u(75,"currency"),t()()()()),a&2){let i=e.ngIf;m(17),p(" ",g(18,15,i.Efectivo.income,"S/ ")," "),m(3),p(" ",g(21,18,i["Yape/Transferencia BCP"].income,"S/ ")," "),m(3),p(" ",g(24,21,i["Plin/Transferencia INTERBANK"].income,"S/ ")," "),m(3),p(" ",g(27,24,i.POS.income,"S/ ")," "),m(6),p(" ",g(33,27,i.Efectivo.expense,"S/ ")," "),m(3),p(" ",g(36,30,i["Yape/Transferencia BCP"].expense,"S/ ")," "),m(3),p(" ",g(39,33,i["Plin/Transferencia INTERBANK"].expense,"S/ ")," "),m(3),p(" ",g(42,36,i.POS.expense,"S/ ")," "),m(6),p(" ",g(48,39,i.Efectivo.balance,"S/ ")," "),m(3),p(" ",g(51,42,i["Yape/Transferencia BCP"].balance,"S/ ")," "),m(3),p(" ",g(54,45,i["Plin/Transferencia INTERBANK"].balance,"S/ ")," "),m(3),p(" ",g(57,48,i.POS.balance,"S/ ")," "),m(6),p(" ",g(63,51,i.totalCashIncome,"S/ ")," "),m(6),p(" ",g(69,54,i.totalCashExpense,"S/ ")," "),m(6),p(" ",g(75,57,i.totalCashBalance,"S/ ")," ")}}function rn(a,e){a&1&&(n(0,"div",44),M(1,"mat-spinner",45),t())}function mn(a,e){a&1&&(n(0,"th",55),o(1," N\xB0 "),t())}function ln(a,e){if(a&1&&(n(0,"td",56),o(1),t()),a&2){let i=e.$implicit;m(),p(" ",i.code," ")}}function sn(a,e){a&1&&(n(0,"th",55),o(1," Fecha "),t())}function cn(a,e){if(a&1&&(n(0,"td",56),o(1),u(2,"date"),t()),a&2){let i=e.$implicit;m(),p(" ",g(2,1,i.date,"dd/MM/yyyy")," ")}}function pn(a,e){a&1&&(n(0,"th",55),o(1," Tipo "),t())}function dn(a,e){if(a&1&&(n(0,"td",56),o(1),t()),a&2){let i=e.$implicit;m(),p(" ",i.typeMovement," ")}}function fn(a,e){a&1&&(n(0,"th",55),o(1," Monto "),t())}function un(a,e){if(a&1&&(n(0,"td",56),o(1),u(2,"currency"),t()),a&2){let i=e.$implicit;m(),p(" ",g(2,1,i.amount,"S/ ")," ")}}function gn(a,e){a&1&&(n(0,"th",55),o(1," Forma de Pago "),t())}function hn(a,e){if(a&1&&(n(0,"td",56),o(1),t()),a&2){let i=e.$implicit;m(),p(" ",i.paymentsMethod," ")}}function vn(a,e){a&1&&(n(0,"th",55),o(1," Descripci\xF3n "),t())}function Mn(a,e){if(a&1&&(n(0,"td",56),o(1),t()),a&2){let i=e.$implicit;m(),p(" ",i.description," ")}}function Cn(a,e){a&1&&(n(0,"th",55),o(1," Usuario "),t())}function _n(a,e){if(a&1&&(n(0,"td",56),o(1),t()),a&2){let i=e.$implicit;m(),p(" ",i.user==null?null:i.user.username," ")}}function xn(a,e){a&1&&(n(0,"th",57),o(1," Acciones "),t())}function yn(a,e){if(a&1){let i=I();n(0,"button",61),x("click",function(){C(i);let l=P().$implicit,c=P();return _(c.editMovement(l))}),n(1,"mat-icon"),o(2,"edit"),t(),n(3,"span"),o(4,"Editar"),t()()}}function Sn(a,e){if(a&1){let i=I();n(0,"button",61),x("click",function(){C(i);let l=P().$implicit,c=P();return _(c.deleteMovement(l.id))}),n(1,"mat-icon"),o(2,"delete"),t(),n(3,"span"),o(4,"Eliminar"),t()()}}function bn(a,e){if(a&1){let i=I();n(0,"td",58)(1,"button",59)(2,"mat-icon"),o(3,"more_vert"),t()(),n(4,"mat-menu",null,2),d(6,yn,5,0,"button",60),n(7,"button",61),x("click",function(){let l=C(i).$implicit,c=P();return _(c.generatePdf(l.id))}),n(8,"mat-icon"),o(9,"picture_as_pdf"),t(),n(10,"span"),o(11,"Imprimir ticket"),t()(),d(12,Sn,5,0,"button",60),t()()}if(a&2){let i=O(5),r=P();m(),s("matMenuTriggerFor",i),m(5),s("ngIf",!r.isReceptionist()),m(6),s("ngIf",!r.isReceptionist())}}function En(a,e){a&1&&M(0,"tr",62)}function Pn(a,e){a&1&&M(0,"tr",63)}function Dn(a,e){a&1&&(n(0,"tr",64)(1,"td",65),o(2," No hay movimientos de caja que coincidan con los filtros. "),t()())}var we=class a{constructor(e,i,r,l,c){this.fb=e;this.cashManagementService=i;this.dialog=r;this.snackBar=l;this.excelExportService=c;let h=new Date;this.filterForm=this.fb.group({startDate:[h],endDate:[h],typeMovement:[""],paymentsMethod:[""],userId:[""]})}appStore=H(st);filterForm;displayedColumns=["code","date","typeMovement","amount","paymentsMethod","description","user","actions"];paymentMethods=["Efectivo","Yape/Transferencia BCP","Plin/Transferencia INTERBANK","POS"];cashMovements=new Re([]);summary$=He({Efectivo:{income:0,expense:0,balance:0},"Yape/Transferencia BCP":{income:0,expense:0,balance:0},"Plin/Transferencia INTERBANK":{income:0,expense:0,balance:0},POS:{income:0,expense:0,balance:0},totalCashIncome:0,totalCashExpense:0,totalCashBalance:0});totalItems=0;pageSize=10;pageNumber=1;datePipe=H(T);isLoadingResults=!1;isLoadingSummary=!1;paginator;sort;destroy$=new $e;ngOnInit(){this.fetchCashMovementsAndSummary(this.filterForm.value),this.filterForm.valueChanges.pipe(Te(this.destroy$),Ge(400),ze((e,i)=>JSON.stringify(e)===JSON.stringify(i))).subscribe(e=>{this.fetchCashMovementsAndSummary(e)})}ngAfterViewInit(){this.cashMovements.sort=this.sort,this.sort.sortChange.pipe(Te(this.destroy$)).subscribe(()=>{this.pageNumber=1,this.applyFilters()})}fetchCashMovementsAndSummary(e,i,r){let l=V({},e);l.startDate&&(l.startDate=this.datePipe.transform(l.startDate,"yyyy-MM-dd")||""),l.endDate&&(l.endDate=this.datePipe.transform(l.endDate,"yyyy-MM-dd")||""),this.isLoadingResults=!0,this.cashManagementService.getAllCashMovements(l,this.pageNumber,this.pageSize,i,r).pipe($(()=>this.isLoadingResults=!1)).subscribe(c=>{this.cashMovements=new Re(c.movements),this.totalItems=c.total,this.cashMovements.sort=this.sort}),this.isLoadingSummary=!0,this.summary$=this.cashManagementService.getCashMovementSummary(l).pipe($(()=>this.isLoadingSummary=!1))}applyFilters(){this.fetchCashMovementsAndSummary(this.filterForm.value,this.sort?.active,this.sort?.direction)}onPageChange(e){this.pageNumber=e.pageIndex+1,this.pageSize=e.pageSize,this.applyFilters()}openAddMovementDialog(){this.dialog.open(G,{width:"400px"}).afterClosed().subscribe(i=>{i&&this.applyFilters()})}editMovement(e){this.dialog.open(G,{width:"400px",data:e}).afterClosed().subscribe(r=>{r&&this.applyFilters()})}deleteMovement(e){let i={title:"Confirmar Eliminaci\xF3n",message:"\xBFEst\xE1s seguro de que quieres eliminar este movimiento de caja? Esta acci\xF3n no se puede deshacer.",confirmButtonText:"Eliminar",cancelButtonText:"Cancelar",confirmButtonColor:"warn"};this.dialog.open(De,{width:"350px",data:i}).afterClosed().subscribe(l=>{l&&this.cashManagementService.deleteCashMovement(e).subscribe({next:()=>{this.snackBar.open("Movimiento eliminado exitosamente","Cerrar",{duration:3e3}),this.applyFilters()},error:c=>{this.snackBar.open("Error al eliminar movimiento: "+c.message,"Cerrar",{duration:3e3}),console.error("Error deleting cash movement:",c)}})})}generatePdf(e){let i=Y.apiUrl+"/cash-management/"+e+"/pdf/ticket";window.open(i,"_blank")}exportCashMovementsToExcel(){return Ve(this,null,function*(){let e=this.filterForm.value;e.startDate&&(e.startDate=this.datePipe.transform(e.startDate,"yyyy-MM-dd")||""),e.endDate&&(e.endDate=this.datePipe.transform(e.endDate,"yyyy-MM-dd")||"");let i=this.cashManagementService.getAllCashMovements(e,1,999999),l=(yield Ie(i))?.movements||[],c=this.cashManagementService.getCashMovementSummary(e),h=yield Ie(c),f=[],y=[];f.push({label:"Fecha Inicio",value:this.datePipe.transform(e.startDate,"dd/MM/yyyy")}),f.push({label:"Fecha Fin",value:this.datePipe.transform(e.endDate,"dd/MM/yyyy")}),h&&(["Efectivo","Yape/Transferencia BCP","Plin/Transferencia INTERBANK","POS"].forEach(Le=>{let j=h[Le];j&&typeof j=="object"&&f.push({Tipo:Le,Ingreso:j.income.toFixed(2),Egreso:j.expense.toFixed(2),Saldo:j.balance.toFixed(2)})}),f.push({label:"Total Ingresos",value:parseFloat(h.totalCashIncome.toFixed(2))}),f.push({label:"Total Egresos",value:parseFloat(h.totalCashExpense.toFixed(2))}),f.push({label:"Saldo Total",value:parseFloat(h.totalCashBalance.toFixed(2))})),l.forEach(S=>{y.push({"N\xB0":S.code,Fecha:this.datePipe.transform(S.date,"dd/MM/yyyy"),Tipo:S.typeMovement,Monto:parseFloat(S.amount.toFixed(2)),"Forma de Pago":S.paymentsMethod,Descripci\u00F3n:S.description,Usuario:S.user?.username||S.user?.email})});let z=`movimientos_caja_${this.datePipe.transform(new Date,"yyyyMMdd_HHmmss")}`;this.excelExportService.exportCashMovementSummaryAndDetailsToExcel(f,y,z,"Movimientos de Caja")})}isReceptionist(){return this.appStore.currentUser()?.role==="RECEPCIONISTA"}static \u0275fac=function(i){return new(i||a)(v(te),v(L),v(ut),v(ce),v(Ot))};static \u0275cmp=F({type:a,selectors:[["app-cash-management-list-page"]],viewQuery:function(i,r){if(i&1&&(Fe(xe,5),Fe(ye,5)),i&2){let l;Oe(l=ke())&&(r.paginator=l.first),Oe(l=ke())&&(r.sort=l.first)}},features:[U([T])],decls:95,vars:18,consts:[["startDatePicker",""],["endDatePicker",""],["actionsMenu","matMenu"],[1,"page-container"],[1,"mat-card"],[1,"mat-card-header"],[1,"mat-card-title",2,"padding","10px !important"],[1,"filter-form",3,"formGroup"],["appearance","outline",1,"w-full"],["matInput","","formControlName","startDate",3,"matDatepicker"],["matSuffix","",3,"for"],["matInput","","formControlName","endDate",3,"matDatepicker"],["formControlName","typeMovement"],["value",""],["value","INGRESO"],["value","EGRESO"],["formControlName","paymentsMethod"],[3,"value",4,"ngFor","ngForOf"],[1,"form-actions"],["mat-raised-button","","color","primary",1,"btn-corp-primary",3,"click"],["mat-raised-button","","color","accent",1,"btn-corp-primary",3,"click"],[1,"mat-card","summary-section"],[1,"mat-card-title"],["class","loading-overlay",4,"ngIf"],["class","summary-table-container",4,"ngIf"],[1,""],["mat-table","","matSort","",1,"mat-table",3,"dataSource"],["matColumnDef","code"],["mat-header-cell","","mat-sort-header","","class","mat-header-cell",4,"matHeaderCellDef"],["mat-cell","","class","mat-cell",4,"matCellDef"],["matColumnDef","date"],["matColumnDef","typeMovement"],["matColumnDef","amount"],["matColumnDef","paymentsMethod"],["matColumnDef","description"],["matColumnDef","user"],["matColumnDef","actions"],["mat-header-cell","","class","mat-header-cell",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["showFirstLastButtons","",3,"page","length","pageSize","pageSizeOptions"],[3,"value"],[1,"loading-overlay"],["diameter","30"],[1,"summary-table-container"],[1,"summary-table"],[1,"summary-header"],[1,"summary-cell","header-cell"],[1,"summary-row"],[1,"summary-cell"],[1,"summary-row","total-row"],[1,"summary-cell","total-label"],[1,"summary-cell","total-value"],["mat-header-cell","","mat-sort-header","",1,"mat-header-cell"],["mat-cell","",1,"mat-cell"],["mat-header-cell","",1,"mat-header-cell"],["mat-cell",""],["mat-icon-button","","aria-label","Acciones",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click",4,"ngIf"],["mat-menu-item","",3,"click"],["mat-header-row",""],["mat-row",""],[1,"mat-row"],["colspan","7",1,"mat-cell"]],template:function(i,r){if(i&1){let l=I();n(0,"div",3)(1,"mat-card",4)(2,"mat-card-header",5)(3,"mat-card-title",6),o(4,"Gesti\xF3n de Caja"),t()(),n(5,"mat-card-content")(6,"form",7)(7,"mat-form-field",8)(8,"mat-label"),o(9,"Fecha Inicio"),t(),M(10,"input",9)(11,"mat-datepicker-toggle",10)(12,"mat-datepicker",null,0),t(),n(14,"mat-form-field",8)(15,"mat-label"),o(16,"Fecha Fin"),t(),M(17,"input",11)(18,"mat-datepicker-toggle",10)(19,"mat-datepicker",null,1),t(),n(21,"mat-form-field",8)(22,"mat-label"),o(23,"Tipo de Movimiento"),t(),n(24,"mat-select",12)(25,"mat-option",13),o(26,"Todos"),t(),n(27,"mat-option",14),o(28,"Ingreso"),t(),n(29,"mat-option",15),o(30,"Egreso"),t()()(),n(31,"mat-form-field",8)(32,"mat-label"),o(33,"Forma de Pago"),t(),n(34,"mat-select",16)(35,"mat-option",13),o(36,"Todos"),t(),d(37,nn,2,2,"mat-option",17),t()()(),n(38,"div",18)(39,"button",19),x("click",function(){return C(l),_(r.applyFilters())}),n(40,"mat-icon"),o(41,"filter_list"),t(),o(42," Aplicar Filtros "),t(),n(43,"button",20),x("click",function(){return C(l),_(r.openAddMovementDialog())}),n(44,"mat-icon"),o(45,"add"),t(),o(46," Registrar Movimiento "),t(),n(47,"button",19),x("click",function(){return C(l),_(r.exportCashMovementsToExcel())}),n(48,"mat-icon"),o(49,"cloud_download"),t(),o(50," Exportar a Excel "),t()()()(),n(51,"mat-card",21)(52,"mat-card-header",5)(53,"mat-card-title",22),o(54,"Resumen de Saldos"),t()(),n(55,"mat-card-content"),d(56,an,2,0,"div",23)(57,on,76,60,"div",24),u(58,"async"),t()(),n(59,"mat-card",4)(60,"mat-card-header",5)(61,"mat-card-title",22),o(62,"Detalle de movimientos"),t()(),n(63,"mat-card-content"),d(64,rn,2,0,"div",23),n(65,"div",25)(66,"table",26),b(67,27),d(68,mn,2,0,"th",28)(69,ln,2,1,"td",29),E(),b(70,30),d(71,sn,2,0,"th",28)(72,cn,3,4,"td",29),E(),b(73,31),d(74,pn,2,0,"th",28)(75,dn,2,1,"td",29),E(),b(76,32),d(77,fn,2,0,"th",28)(78,un,3,4,"td",29),E(),b(79,33),d(80,gn,2,0,"th",28)(81,hn,2,1,"td",29),E(),b(82,34),d(83,vn,2,0,"th",28)(84,Mn,2,1,"td",29),E(),b(85,35),d(86,Cn,2,0,"th",28)(87,_n,2,1,"td",29),E(),b(88,36),d(89,xn,2,0,"th",37)(90,bn,13,3,"td",38),E(),d(91,En,1,0,"tr",39)(92,Pn,1,0,"tr",40)(93,Dn,3,0,"tr",41),t(),n(94,"mat-paginator",42),x("page",function(h){return C(l),_(r.onPageChange(h))}),t()()()()()}if(i&2){let l=O(13),c=O(20);m(6),s("formGroup",r.filterForm),m(4),s("matDatepicker",l),m(),s("for",l),m(6),s("matDatepicker",c),m(),s("for",c),m(19),s("ngForOf",r.paymentMethods),m(19),s("ngIf",r.isLoadingSummary),m(),s("ngIf",qe(58,15,r.summary$)),m(7),s("ngIf",r.isLoadingResults),m(2),s("dataSource",r.cashMovements),m(25),s("matHeaderRowDef",r.displayedColumns),m(),s("matRowDefColumns",r.displayedColumns),m(2),s("length",r.totalItems)("pageSize",r.pageSize)("pageSizeOptions",Ye(17,tn))}},dependencies:[B,Q,k,Ke,Je,T,it,Ze,tt,nt,et,wt,vt,Ct,St,_t,Mt,bt,xt,yt,Et,Pt,Dt,It,xe,Ft,ye,Tt,me,re,oe,ie,ae,A,R,lt,se,le,_e,Ce,ve,Pe,Se,be,Ee,Me,ne,at,J,W,X,Z,ee,K,q,ft,pt,ct,dt],styles:[".page-container[_ngcontent-%COMP%]{background-color:#f9fafb;min-height:100vh}.mat-card[_ngcontent-%COMP%]{box-shadow:0 1px 2px #0000000d;border-radius:.2rem}.mat-card-header[_ngcontent-%COMP%]{padding:0rem .6rem;border-bottom:1px solid #e5e7eb}.mat-card-title[_ngcontent-%COMP%]{color:#1f2937;font-weight:900;font-size:1.4rem;padding:7px 7px 11px!important}.filter-form[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:.4rem}.mat-form-field[_ngcontent-%COMP%]{width:100%;margin-bottom:0;font-size:.75rem}.form-actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:flex-end;gap:.3rem;margin-top:0!important;font-weight:700!important}@media (min-width: 640px){.form-actions[_ngcontent-%COMP%]{flex-direction:row}}.action-button[_ngcontent-%COMP%]{width:100%;padding:.3rem .6rem;font-size:.7rem;font-weight:600;border-radius:.15rem;transition:all .2s ease-in-out}@media (min-width: 640px){.action-button[_ngcontent-%COMP%]{width:auto}}.action-button[_ngcontent-%COMP%]:hover{transform:translateY(-1px);box-shadow:0 1px 2px #00000014}.summary-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(100px,1fr));gap:.4rem;text-align:center}.summary-card[_ngcontent-%COMP%]{padding:.1rem!important;background-color:#fff;border:1px solid #e5e7eb;border-radius:.2rem;box-shadow:0 1px 2px #00000005}.summary-card[_ngcontent-%COMP%]   .mat-card-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center}.summary-label[_ngcontent-%COMP%]{color:#4b5563;font-weight:700}.summary-value[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:700;margin-top:.05rem}.income-card[_ngcontent-%COMP%]{background-color:#e6ffe6;border-color:#6c6}.income-card[_ngcontent-%COMP%]   .summary-value[_ngcontent-%COMP%]{color:#28a745}.expense-card[_ngcontent-%COMP%]{background-color:#ffe6e6;border-color:#f66}.expense-card[_ngcontent-%COMP%]   .summary-value[_ngcontent-%COMP%]{color:#dc3545}.balance-card[_ngcontent-%COMP%]{background-color:#e6f7ff;border-color:#66b3ff}.balance-card[_ngcontent-%COMP%]   .summary-value.text-green-700[_ngcontent-%COMP%]{color:#28a745}.balance-card[_ngcontent-%COMP%]   .summary-value.text-red-700[_ngcontent-%COMP%]{color:#dc3545}.summary-table-container[_ngcontent-%COMP%]{width:100%;overflow-x:auto}.summary-table[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr repeat(4,minmax(100px,1fr));border:1px solid #817e7e;border-radius:4px;overflow:hidden;font-size:.85rem;min-width:600px}.summary-header[_ngcontent-%COMP%], .summary-row[_ngcontent-%COMP%]{display:contents}.summary-cell[_ngcontent-%COMP%]{padding:10px 15px;border:1px solid #848383;text-align:right;display:flex;align-items:center;justify-content:flex-end;border-bottom:0px;border-left:0px;color:#18191a;font-weight:500}.summary-cell[_ngcontent-%COMP%]:first-child{border-bottom:0px;text-align:left;justify-content:flex-start;font-weight:700;background-color:#f9f9f9}.header-cell[_ngcontent-%COMP%]{background-color:#012147;color:#fff;font-weight:700;text-align:center;justify-content:center}.header-cell[_ngcontent-%COMP%]:first-child{background-color:#012147;color:#fff;text-align:left;justify-content:flex-start}.total-row[_ngcontent-%COMP%]   .summary-cell[_ngcontent-%COMP%]{background-color:#f0f0f0;font-weight:700}.total-row[_ngcontent-%COMP%]   .summary-cell.total-label[_ngcontent-%COMP%]{text-align:right;justify-content:flex-end;grid-column:span 4}.total-row[_ngcontent-%COMP%]   .summary-cell.total-value[_ngcontent-%COMP%]{text-align:right;justify-content:flex-end}.mat-no-data-row[_ngcontent-%COMP%]   .mat-cell[_ngcontent-%COMP%]{text-align:center;padding-top:.4rem;padding-bottom:.4rem;color:#494b4e;font-style:italic}@media (max-width: 768px){.mat-table[_ngcontent-%COMP%]{display:block;overflow-x:auto;-webkit-overflow-scrolling:touch}}.total-row-content[_ngcontent-%COMP%]{display:flex;justify-content:space-between;width:100%}.total-row-label[_ngcontent-%COMP%], .total-row-value[_ngcontent-%COMP%]{font-weight:700}"]})};var Ui=[{path:"",component:we}];export{Ui as CASH_MANAGEMENT_ROUTES};
