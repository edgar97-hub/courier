import{a as Ae,b as Le,c as Ve}from"./chunk-VGP2GCDA.js";import"./chunk-F5X5MWHG.js";import{a as et,b as it}from"./chunk-PO6EGR72.js";import{b as dt,c as pt}from"./chunk-UQIIK7B7.js";import{a as be,b as ve,c as De,d as Se,e as we,f as Me,g as Te,h as Ee,i as xe,j as ye,k as Pe,l as Oe,m as Fe,p as ut,q as Ie,r as gt,s as ke,t as Ne}from"./chunk-BHRBLRE5.js";import{a as ct,b as mt}from"./chunk-XZT5CDXQ.js";import{a as ge,b as fe,e as he,j as Ce,n as _e}from"./chunk-47H6S35A.js";import"./chunk-Y6XL547V.js";import"./chunk-4Q5ZI4FH.js";import{a as X,b as Jt,d as Z,f as Xt,g as Zt,h as tt}from"./chunk-DKGJOR6J.js";import{C as nt,D as ot,J as at,K as st,b as te,d as w,f as ee,g as ie,l as re,m as ne,o as oe,p as ae,q as se,r as le,s as ce,u as me,v as rt,w as de,y as pe,z as ue}from"./chunk-KZG7UARR.js";import{a as H,b as F}from"./chunk-EYS5YO4C.js";import"./chunk-WXNUOF5Q.js";import{a as Yt}from"./chunk-DLKYVSML.js";import{m as B,o as lt,r as O}from"./chunk-UISUTDCV.js";import{$ as k,$a as y,Ab as f,Bb as _,Ca as x,Dc as wt,Ec as Gt,Fb as vt,Fc as Qt,G as D,Gb as Dt,H as Ft,Hb as St,Jc as Kt,Kb as j,Lb as s,Lc as Y,M as It,Mb as v,Nb as Q,O as kt,Ob as jt,Qc as J,Rc as Wt,Sa as l,Vb as zt,Wa as Vt,Yb as V,Z as Nt,Zb as K,_ as At,a as U,ac as qt,b as yt,ba as E,c as Pt,fb as g,ga as Lt,ib as $t,j as R,jb as m,k as Ot,la as C,ob as N,pb as Bt,qb as Ht,r as M,rb as Rt,rc as $,s as T,sb as n,ta as G,tb as o,tc as W,ua as p,ub as b,v as bt,va as u,vb as A,wb as L,xc as Ut,yb as S,zc as P}from"./chunk-SAZU6VCU.js";var Re=()=>[5,10,20,50];function je(r,t){r&1&&(n(0,"div",23),b(1,"mat-progress-spinner",24),o())}function ze(r,t){r&1&&(n(0,"th",25),s(1,"N\xB0"),o())}function qe(r,t){if(r&1&&(n(0,"td",26),s(1),o()),r&2){let e=t.$implicit;l(),v(e.code||"N/A")}}function Ue(r,t){r&1&&(n(0,"th",27),s(1," Nombre Distrito "),o())}function Ge(r,t){if(r&1&&(n(0,"td",26),s(1),o()),r&2){let e=t.$implicit;l(),v(e.name)}}function Qe(r,t){r&1&&(n(0,"th",28),s(1," Rango Peso (kg) "),o())}function Ke(r,t){if(r&1&&(n(0,"td",26),s(1),o()),r&2){let e=t.$implicit;l(),jt(" ",e.weight_from," - ",e.weight_to," ")}}function We(r,t){r&1&&(n(0,"th",29),s(1," Precio Tarifa "),o())}function Ye(r,t){if(r&1&&(n(0,"td",30),s(1),V(2,"currency"),o()),r&2){let e=t.$implicit;l(),Q(" ",qt(2,1,e.price,"PEN","S/ ","1.2-2")," ")}}function Je(r,t){r&1&&(n(0,"th",31),s(1," Est\xE1ndar "),o())}function Xe(r,t){if(r&1&&(n(0,"td",32),b(1,"mat-checkbox",33),o()),r&2){let e=t.$implicit;l(),m("checked",e.isStandard)}}function Ze(r,t){r&1&&(n(0,"th",34),s(1," Acciones "),o())}function ti(r,t){if(r&1){let e=S();n(0,"td",35)(1,"button",36),f("click",function(){let a=p(e).$implicit,c=_();return u(c.onEdit(a))}),n(2,"mat-icon"),s(3,"edit"),o()(),n(4,"button",37),f("click",function(){let a=p(e).$implicit,c=_();return u(c.onDelete(a))}),n(5,"mat-icon"),s(6,"delete_outline"),o()()()}}function ei(r,t){r&1&&b(0,"tr",38)}function ii(r,t){r&1&&b(0,"tr",39)}function ri(r,t){if(r&1&&(n(0,"tr",40)(1,"td",41),s(2," No se encontraron distritos que coincidan con la b\xFAsqueda. "),o()()),r&2){let e=_();l(),$t("colspan",e.displayedColumns.length)}}var ft=class r{districts=[];isLoading=!1;totalCount=0;pageSize=10;pageIndex=0;pageChanged=new x;sortChanged=new x;editDistrict=new x;deleteDistrict=new x;displayedColumns=["code","name","weight_range","price","isStandard","actions"];dataSource=new Fe;paginator;sort;ngOnChanges(t){t.districts&&this.districts&&(this.dataSource.data=this.districts)}ngAfterViewInit(){this.sort&&this.sort.sortChange.subscribe(t=>{this.paginator&&(this.paginator.pageIndex=0),this.sortChanged.emit(t)})}onEdit(t){this.editDistrict.emit(t)}onDelete(t){this.deleteDistrict.emit(t)}handlePageEvent(t){this.pageChanged.emit(t)}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=y({type:r,selectors:[["app-district-table"]],viewQuery:function(e,i){if(e&1&&(vt(ut,5),vt(gt,5)),e&2){let a;Dt(a=St())&&(i.paginator=a.first),Dt(a=St())&&(i.sort=a.first)}},inputs:{districts:"districts",isLoading:"isLoading",totalCount:"totalCount",pageSize:"pageSize",pageIndex:"pageIndex"},outputs:{pageChanged:"pageChanged",sortChanged:"sortChanged",editDistrict:"editDistrict",deleteDistrict:"deleteDistrict"},features:[G],decls:25,vars:10,consts:[[1,"table-container","mat-elevation-z4"],["class","spinner-overlay",4,"ngIf"],["mat-table","","matSort","","aria-label","Lista de Distritos y Tarifas",1,"districts-table",3,"matSortChange","dataSource"],["matColumnDef","code"],["mat-header-cell","","mat-sort-header","code",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","name"],["mat-header-cell","","mat-sort-header","name",4,"matHeaderCellDef"],["matColumnDef","weight_range"],["mat-header-cell","","mat-sort-header","weight_from",4,"matHeaderCellDef"],["matColumnDef","price"],["mat-header-cell","","mat-sort-header","price","class","align-right",4,"matHeaderCellDef"],["mat-cell","","class","align-right amount-cell",4,"matCellDef"],["matColumnDef","isStandard"],["mat-header-cell","","mat-sort-header","isStandard","class","align-center",4,"matHeaderCellDef"],["mat-cell","","class","align-center",4,"matCellDef"],["matColumnDef","actions"],["mat-header-cell","","class","actions-column-header",4,"matHeaderCellDef"],["mat-cell","","class","actions-cell",4,"matCellDef"],["mat-header-row","","class","header-row-sticky",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","","class","data-row",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["showFirstLastButtons","","aria-label","Seleccione p\xE1gina de distritos",3,"page","length","pageSize","pageIndex","pageSizeOptions"],[1,"spinner-overlay"],["mode","indeterminate","diameter","50"],["mat-header-cell","","mat-sort-header","code"],["mat-cell",""],["mat-header-cell","","mat-sort-header","name"],["mat-header-cell","","mat-sort-header","weight_from"],["mat-header-cell","","mat-sort-header","price",1,"align-right"],["mat-cell","",1,"align-right","amount-cell"],["mat-header-cell","","mat-sort-header","isStandard",1,"align-center"],["mat-cell","",1,"align-center"],["disabled","true","color","primary",3,"checked"],["mat-header-cell","",1,"actions-column-header"],["mat-cell","",1,"actions-cell"],["mat-icon-button","","color","primary","matTooltip","Editar Distrito/Tarifa",3,"click"],["mat-icon-button","","color","warn","matTooltip","Eliminar Distrito/Tarifa",3,"click"],["mat-header-row","",1,"header-row-sticky"],["mat-row","",1,"data-row"],[1,"mat-row"],[1,"no-data-cell"]],template:function(e,i){e&1&&(n(0,"div",0),g(1,je,2,0,"div",1),n(2,"table",2),f("matSortChange",function(c){return i.sortChanged.emit(c)}),A(3,3),g(4,ze,2,0,"th",4)(5,qe,2,1,"td",5),L(),A(6,6),g(7,Ue,2,0,"th",7)(8,Ge,2,1,"td",5),L(),A(9,8),g(10,Qe,2,0,"th",9)(11,Ke,2,2,"td",5),L(),A(12,10),g(13,We,2,0,"th",11)(14,Ye,3,6,"td",12),L(),A(15,13),g(16,Je,2,0,"th",14)(17,Xe,2,1,"td",15),L(),A(18,16),g(19,Ze,2,0,"th",17)(20,ti,7,0,"td",18),L(),g(21,ei,1,0,"tr",19)(22,ii,1,0,"tr",20)(23,ri,3,1,"tr",21),o(),n(24,"mat-paginator",22),f("page",function(c){return i.handlePageEvent(c)}),o()()),e&2&&(l(),m("ngIf",i.isLoading),l(),m("dataSource",i.dataSource),l(19),m("matHeaderRowDef",i.displayedColumns)("matHeaderRowDefSticky",!0),l(),m("matRowDefColumns",i.displayedColumns),l(2),m("length",i.totalCount)("pageSize",i.pageSize)("pageIndex",i.pageIndex)("pageSizeOptions",zt(9,Re)))},dependencies:[P,$,Ut,Oe,be,De,Te,Se,ve,Ee,we,Me,xe,ye,Pe,Ie,ut,Ne,gt,ke,it,et,O,B,F,H,fe,ge,mt,ct],styles:["[_nghost-%COMP%]{display:block}.table-container[_ngcontent-%COMP%]{position:relative;overflow:auto;border-radius:10px;background-color:#fff;margin-top:20px;box-shadow:0 3px 15px #00000012;transition:box-shadow .3s ease}.table-container[_ngcontent-%COMP%]:hover{box-shadow:0 5px 20px #0000001a}.spinner-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background-color:#fffc;display:flex;justify-content:center;align-items:center;z-index:100;border-radius:10px}.districts-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}th.mat-header-cell[_ngcontent-%COMP%]{font-weight:600;color:#37474f;background-color:#f8f9fa;padding:12px 16px;border-bottom:1px solid #dee2e6;font-size:.85rem;letter-spacing:.5px}td.mat-cell[_ngcontent-%COMP%]{padding:10px 16px;border-bottom:1px solid #f1f3f5;color:#495057;font-size:.9rem}.header-row-sticky[_ngcontent-%COMP%]{position:sticky;top:0;z-index:10;background-color:#f8f9fa}.data-row[_ngcontent-%COMP%]{transition:background-color .2s ease}.data-row[_ngcontent-%COMP%]:hover{background-color:#eef2f7}.align-right[_ngcontent-%COMP%]{text-align:right;justify-content:flex-end}.align-center[_ngcontent-%COMP%]{text-align:center;justify-content:center}.amount-cell[_ngcontent-%COMP%]{font-weight:500}.actions-column-header[_ngcontent-%COMP%]{text-align:center!important;width:120px}.actions-cell[_ngcontent-%COMP%]{text-align:center;white-space:nowrap}.actions-cell[_ngcontent-%COMP%]   button.mat-icon-button[_ngcontent-%COMP%]{margin:0 3px}.no-data-cell[_ngcontent-%COMP%]{text-align:center;padding:40px;font-style:italic;color:#6c757d;font-size:1rem}.mat-mdc-paginator[_ngcontent-%COMP%]{background-color:#f8f9fa;border-bottom-left-radius:10px;border-bottom-right-radius:10px;color:#495057;border-top:1px solid #dee2e6}"]})};var I=class r{apiUrl=Wt.apiUrl+"/districts";http=C(Qt);authService=C(Yt);districtNamesSubject=new Ot([]);districtNames$=this.districtNamesSubject.asObservable();loadedDistrictNames=!1;constructor(){this.loadDistrictNamesForAutocomplete().subscribe()}getAuthHeaders(){let t=this.authService.getAccessToken();return t?new wt({"Content-Type":"application/json",codrr_token:t}):new wt({"Content-Type":"application/json"})}getDistricts(t=1,e=10,i="name",a="asc",c){let d=this.getAuthHeaders();if(!this.authService.getAccessToken())return T(()=>new Error("Not authenticated to fetch users."));let h=new Gt().set("page_number",parseInt(t.toString())||1).set("page_size",e.toString()).set("sort_field",i).set("sort_directionr",a);return c&&(h=h.set("search",c)),this.http.get(this.apiUrl,{params:h,headers:d}).pipe(E(q=>console.log("Fetched districts:",q)),D(this.handleError))}getDistrictById(t){let e=this.getAuthHeaders();return this.authService.getAccessToken()?this.http.get(`${this.apiUrl}/${t}`,{headers:e}).pipe(E(i=>{console.log("SERVICE: HTTP GET successful, received district:",i)}),It(300),D(i=>(console.error("SERVICE: HTTP GET failed:",i),this.handleError(i)))):T(()=>new Error("Not authenticated to fetch users."))}createDistrict(t){let e=this.getAuthHeaders();return this.authService.getAccessToken()?this.http.post(this.apiUrl+"/register",t,{headers:e}).pipe(E(i=>{console.log("Created district:",i),this.addDistrictNameToAutocomplete(i.name)}),D(this.handleError)):T(()=>new Error("Not authenticated to fetch users."))}updateDistrict(t,e){let q=e,{id:i,createdAt:a,updatedAt:c}=q,d=Pt(q,["id","createdAt","updatedAt"]),h=this.getAuthHeaders();return this.authService.getAccessToken()?this.http.put(`${this.apiUrl}/edit/${t}`,d,{headers:h}).pipe(E(xt=>{console.log("Updated district:",xt),this.addDistrictNameToAutocomplete(xt.name)}),D(this.handleError)):T(()=>new Error("Not authenticated to fetch users."))}deleteDistrict(t){let e=this.getAuthHeaders();return this.authService.getAccessToken()?this.http.delete(`${this.apiUrl}/delete/${t}`,{headers:e}).pipe(E(()=>console.log(`Deleted district with id: ${t}`)),D(this.handleError)):T(()=>new Error("Not authenticated to fetch users."))}loadDistrictNamesForAutocomplete(){if(this.loadedDistrictNames&&this.districtNamesSubject.value.length>0)return this.districtNames$;let t=this.getAuthHeaders();return this.authService.getAccessToken()?(console.log("DistrictService: Loading district names for autocomplete..."),this.http.get(`${this.apiUrl}?limit=1000`,{headers:t}).pipe(bt(e=>{let i=e?.items.map(c=>c.name),a=[...new Set(i)].sort();return this.districtNamesSubject.next(a),this.loadedDistrictNames=!0,console.log("DistrictService: Loaded unique names:",a),a}),D(e=>(console.error("Error loading district names for autocomplete",e),this.loadedDistrictNames=!1,M([]))))):T(()=>new Error("Not authenticated to fetch users."))}addDistrictNameToAutocomplete(t){let e=this.districtNamesSubject.value;if(t&&!e.includes(t)){let i=[...e,t].sort();this.districtNamesSubject.next(i)}}filterDistrictNames(t){let e=t.toLowerCase();return this.districtNames$.pipe(bt(i=>i.filter(a=>a.toLowerCase().includes(e))))}handleError(t){console.error("API Error:",t);let e="An error occurred. Please try again later.";return t.error instanceof ErrorEvent?e=`Client-side error: ${t.error.message}`:t.status===404?e="The requested resource was not found.":t.status===400&&t.error?.message?Array.isArray(t.error.message)?e=t.error.message.join(", "):e=t.error.message:t.status===500&&(e="A server error occurred. Please contact support."),T(()=>new Error(e))}static \u0275fac=function(e){return new(e||r)};static \u0275prov=Lt({token:r,factory:r.\u0275fac,providedIn:"root"})};function si(r,t){if(r&1){let e=S();n(0,"button",12),f("click",function(){p(e);let a=_(),c=j(15);return u(a.clearSearch(c))}),n(1,"mat-icon"),s(2,"close"),o()()}}function li(r,t){r&1&&(n(0,"mat-icon",13),s(1,"search"),o())}var Ct=class r{districtService=C(I);router=C(Y);snackBar=C(dt);dialog=C(he);districts=[];totalDistricts=0;isLoading=!1;destroy$=new R;currentPageIndex=0;currentPageSize=10;currentSortField="name";currentSortDirection="asc";currentSearchTerm="";searchSubject=new R;ngOnInit(){this.loadDistricts(),this.searchSubject.pipe(Ft(500),kt(),k(this.destroy$)).subscribe(t=>{this.currentSearchTerm=t,this.currentPageIndex=0,this.loadDistricts()})}loadDistricts(){this.isLoading=!0,this.districtService.getDistricts(this.currentPageIndex,this.currentPageSize,this.currentSortField,this.currentSortDirection,this.currentSearchTerm).pipe(k(this.destroy$)).subscribe({next:t=>{this.districts=t.items,this.totalDistricts=t.total_count,this.isLoading=!1},error:t=>{this.isLoading=!1,this.snackBar.open(`Error cargando distritos: ${t.message||"Intente de nuevo"}`,"Cerrar",{duration:5e3,panelClass:["error-snackbar"]})}})}onSearchTermChange(t){let e=t.target.value;this.searchSubject.next(e)}clearSearch(t){t.value="",this.searchSubject.next("")}onPageChanged(t){this.currentPageIndex=t.pageIndex,this.currentPageSize=t.pageSize,this.loadDistricts()}onSortChanged(t){this.currentSortField=t.active,this.currentSortDirection=t.direction,this.currentPageIndex=0,this.loadDistricts()}navigateToCreate(){this.router.navigate(["/districts/create"])}navigateToEdit(t){this.router.navigate(["/districts/edit",t.id])}confirmAndDeleteDistrict(t){confirm(`\xBFEst\xE1 seguro de que desea eliminar el distrito/tarifa "${t.name}" (C\xF3digo: ${t.code||t.id})?`)&&this.deleteDistrict(t)}deleteDistrict(t){this.isLoading=!0,this.districtService.deleteDistrict(t.id).pipe(k(this.destroy$)).subscribe({next:()=>{this.snackBar.open(`Distrito "${t.name}" eliminado correctamente.`,"OK",{duration:3e3,panelClass:["success-snackbar"]}),this.currentPageIndex=0,this.loadDistricts()},error:e=>{this.isLoading=!1,this.snackBar.open(`Error al eliminar distrito: ${e.message||"Intente de nuevo"}`,"Cerrar",{duration:5e3,panelClass:["error-snackbar"]})}})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=y({type:r,selectors:[["app-district-list-page"]],decls:19,vars:7,consts:[["searchInput",""],["fxLayout","column","fxLayoutGap","24px",1,"page-container"],["fxLayout","row","fxLayoutAlign","space-between center",1,"page-header"],[1,"page-title"],["mat-flat-button","","color","primary",1,"create-button",3,"click"],["appearance","outlined",1,"filter-card"],["fxLayout","row","fxLayoutAlign","start center"],["appearance","outline","fxFlex","",1,"search-field"],["matInput","","placeholder","Ej: Carabayllo, Lince, 101...",3,"keyup"],["mat-icon-button","","matSuffix","","aria-label","Limpiar b\xFAsqueda",3,"click",4,"ngIf"],["matSuffix","",4,"ngIf"],[3,"pageChanged","sortChanged","editDistrict","deleteDistrict","districts","isLoading","totalCount","pageSize","pageIndex"],["mat-icon-button","","matSuffix","","aria-label","Limpiar b\xFAsqueda",3,"click"],["matSuffix",""]],template:function(e,i){if(e&1){let a=S();n(0,"div",1)(1,"div",2)(2,"h1",3),s(3,"Gesti\xF3n de Distritos y Tarifas"),o(),n(4,"button",4),f("click",function(){return p(a),u(i.navigateToCreate())}),n(5,"mat-icon"),s(6,"add_circle_outline"),o(),n(7,"span"),s(8,"Nuevo Distrito/Tarifa"),o()()(),n(9,"mat-card",5)(10,"mat-card-content",6)(11,"mat-form-field",7)(12,"mat-label"),s(13,"Buscar por nombre o c\xF3digo"),o(),n(14,"input",8,0),f("keyup",function(d){return p(a),u(i.onSearchTermChange(d))}),o(),g(16,si,3,0,"button",9)(17,li,2,0,"mat-icon",10),o()()(),n(18,"app-district-table",11),f("pageChanged",function(d){return p(a),u(i.onPageChanged(d))})("sortChanged",function(d){return p(a),u(i.onSortChanged(d))})("editDistrict",function(d){return p(a),u(i.navigateToEdit(d))})("deleteDistrict",function(d){return p(a),u(i.confirmAndDeleteDistrict(d))}),o()()}if(e&2){let a=j(15);l(16),m("ngIf",a.value),l(),m("ngIf",!a.value),l(),m("districts",i.districts)("isLoading",i.isLoading)("totalCount",i.totalDistricts)("pageSize",i.currentPageSize)("pageIndex",i.currentPageIndex)}},dependencies:[P,$,J,ft,O,lt,B,F,H,pt,Ce,ot,nt,rt,ue,st,at,tt,X,Z],styles:["[_nghost-%COMP%]{display:block}.page-container[_ngcontent-%COMP%]{padding:28px 32px;background-color:var(--sys-background, #f4f6f8);color:var(--sys-on-background, #2c3e50);min-height:calc(100vh - 64px);box-sizing:border-box}.page-header[_ngcontent-%COMP%]{margin-bottom:28px;padding-bottom:20px;border-bottom:1px solid var(--sys-outline-variant, #e0e0e6)}.page-header[_ngcontent-%COMP%]   .page-title[_ngcontent-%COMP%]{margin:0;font-size:2em;font-weight:600;color:var(--sys-primary, #303f9f);letter-spacing:-.5px}.page-header[_ngcontent-%COMP%]   .create-button[_ngcontent-%COMP%]{font-weight:500}.page-header[_ngcontent-%COMP%]   .create-button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px}.filter-card[_ngcontent-%COMP%]{margin-bottom:28px;background-color:var(--sys-surface-container-low, #ffffff);border:1px solid var(--sys-outline-variant, transparent);border-radius:8px}.filter-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]{padding:16px 20px!important}.search-field[_ngcontent-%COMP%]{width:100%}"]})};function ci(r,t){if(r&1&&(n(0,"mat-option",7),s(1),o()),r&2){let e=t.$implicit;m("value",e),l(),v(e)}}function mi(r,t){r&1&&(n(0,"mat-error"),s(1,"El nombre del distrito es obligatorio."),o())}function di(r,t){r&1&&(n(0,"mat-error"),s(1,"Peso Desde es obligatorio."),o())}function pi(r,t){r&1&&(n(0,"mat-error"),s(1,"Debe ser mayor o igual a 0."),o())}function ui(r,t){if(r&1&&(n(0,"mat-error"),s(1),o()),r&2){let e=_();l(),v(e.weightFromCtrl==null||e.weightFromCtrl.errors==null?null:e.weightFromCtrl.errors.weightOrder)}}function gi(r,t){if(r&1&&(n(0,"mat-error"),s(1),o()),r&2){let e=_();l(),v(e.weightFromCtrl==null||e.weightFromCtrl.errors==null?null:e.weightFromCtrl.errors.weightOrder)}}function fi(r,t){if(r&1&&(n(0,"mat-error"),s(1),o()),r&2){let e=_();l(),v(e.weightToCtrl==null||e.weightToCtrl.errors==null?null:e.weightToCtrl.errors.weightOrder)}}var _t=class r{constructor(t){this.fb=t}districtToEdit=null;isLoading=!1;formSubmit=new x;formCancel=new x;districtForm;districtService=C(I);filteredDistrictNames$=M([]);ngOnInit(){this.initForm(),this.setupNameAutocomplete()}ngOnChanges(t){t.districtToEdit&&this.districtToEdit&&this.districtForm?this.districtForm.patchValue({code:this.districtToEdit.code||null,name:this.districtToEdit.name,weight_from:this.districtToEdit.weight_from,weight_to:this.districtToEdit.weight_to,price:this.districtToEdit.price,isStandard:this.districtToEdit.isStandard}):t.districtToEdit&&!this.districtToEdit&&this.districtForm&&this.districtForm.reset({isStandard:!1})}initForm(){this.districtForm=this.fb.group({code:[null],name:["",w.required],weight_from:[0,[w.required,w.min(0),this.weightRangeCrossValidator]],weight_to:[0,[w.required,w.min(0),this.weightRangeCrossValidator]],price:[0,[w.required,w.min(0)]],isStandard:[!1,w.required]}),this.districtToEdit&&this.districtForm.patchValue(this.districtToEdit)}weightRangeCrossValidator=t=>{let e=t.get("weight_from"),i=t.get("weight_to");if(!e||!i||!e.value||!i.value)return null;let a=parseFloat(e.value),c=parseFloat(i.value),d=null;if(e.hasError("weightOrder")){let h=U({},e.errors);delete h.weightOrder,e.setErrors(Object.keys(h).length>0?h:null,{emitEvent:!1})}if(i.hasError("weightOrder")){let h=U({},i.errors);delete h.weightOrder,i.setErrors(Object.keys(h).length>0?h:null,{emitEvent:!1})}if(a>c&&c!==0){let h=e.errors||{};e.setErrors(yt(U({},h),{weightOrder:"Desde no puede ser mayor que Hasta"})),d={weightRangeInvalid:!0}}return d};setupNameAutocomplete(){this.districtForm.get("name")&&(this.filteredDistrictNames$=this.districtForm.get("name").valueChanges.pipe(Nt(""),At(t=>typeof t=="string"&&t.length>0?this.districtService.filterDistrictNames(t):this.districtService.districtNames$)))}onDistrictNameSelected(t){}onSubmit(){if(this.districtForm.valid){let t=this.districtForm.value,e={name:t.name,weight_from:parseFloat(t.weight_from),weight_to:parseFloat(t.weight_to),price:parseFloat(t.price),isStandard:t.isStandard};t.code!==null&&t.code!==void 0&&t.code!==""&&(e.code=parseInt(t.code,10)),this.formSubmit.emit(e)}else this.districtForm.markAllAsTouched()}onCancelClick(){this.formCancel.emit()}get nameCtrl(){return this.districtForm.get("name")}get weightFromCtrl(){return this.districtForm.get("weight_from")}get weightToCtrl(){return this.districtForm.get("weight_to")}get priceCtrl(){return this.districtForm.get("price")}static \u0275fac=function(e){return new(e||r)(Vt(ce))};static \u0275cmp=y({type:r,selectors:[["app-district-form"]],inputs:{districtToEdit:"districtToEdit",isLoading:"isLoading"},outputs:{formSubmit:"formSubmit",formCancel:"formCancel"},features:[G],decls:45,vars:13,consts:[["autoDistrictName","matAutocomplete"],["novalidate","",1,"district-form-container",3,"ngSubmit","formGroup"],["appearance","outlined"],[1,"form-row"],["appearance","outline",1,"full-width-field"],["matInput","","formControlName","name","required","","placeholder","Ej: Carabayllo",3,"matAutocomplete"],[3,"optionSelected"],[3,"value"],["appearance","outline",1,"form-field"],["matInput","","formControlName","weight_from","type","number","min","0","step","0.01","required","","placeholder","0.00"],["matInput","","formControlName","weight_to","type","number","min","0","step","0.01","required","","placeholder","0.00"],["matInput","","formControlName","price","type","number","min","0","step","0.01","required","","placeholder","0.00"],["matTextPrefix",""],["formControlName","isStandard","color","primary",1,"standard-checkbox"],["align","end"],["mat-stroked-button","","type","button",3,"click"],["mat-flat-button","","color","primary","type","submit",3,"disabled"]],template:function(e,i){if(e&1){let a=S();n(0,"form",1),f("ngSubmit",function(){return p(a),u(i.onSubmit())}),n(1,"mat-card",2)(2,"mat-card-header")(3,"mat-card-title"),s(4),o()(),n(5,"mat-card-content")(6,"div",3)(7,"mat-form-field",4)(8,"mat-label"),s(9,"Nombre del Distrito"),o(),b(10,"input",5),n(11,"mat-autocomplete",6,0),f("optionSelected",function(d){return p(a),u(i.onDistrictNameSelected(d))}),Ht(13,ci,2,2,"mat-option",7,Bt),V(15,"async"),o(),g(16,mi,2,0,"mat-error"),o()(),n(17,"div",3)(18,"mat-form-field",8)(19,"mat-label"),s(20,"Peso Desde (kg)"),o(),b(21,"input",9),g(22,di,2,0,"mat-error")(23,pi,2,0,"mat-error")(24,ui,2,1,"mat-error"),o(),n(25,"mat-form-field",8)(26,"mat-label"),s(27,"Peso Hasta (kg)"),o(),b(28,"input",10),g(29,gi,2,1,"mat-error"),o()(),n(30,"mat-form-field",4)(31,"mat-label"),s(32,"Precio Tarifa (S/)"),o(),b(33,"input",11),n(34,"span",12),s(35,"S/\xA0"),o(),g(36,fi,2,1,"mat-error"),o(),n(37,"div",3)(38,"mat-checkbox",13),s(39," \xBFEs tarifa est\xE1ndar para este distrito? "),o()()(),n(40,"mat-card-actions",14)(41,"button",15),f("click",function(){return p(a),u(i.onCancelClick())}),s(42," Cancelar "),o(),n(43,"button",16),s(44),o()()()()}if(e&2){let a=j(12);m("formGroup",i.districtForm),l(4),v(i.districtToEdit?"Editar Distrito/Tarifa":"Crear Nuevo Distrito/Tarifa"),l(6),m("matAutocomplete",a),l(3),Rt(K(15,11,i.filteredDistrictNames$)),l(3),N(i.nameCtrl!=null&&i.nameCtrl.hasError("required")&&(i.nameCtrl!=null&&i.nameCtrl.touched||i.nameCtrl!=null&&i.nameCtrl.dirty)?16:-1),l(6),N(i.weightFromCtrl!=null&&i.weightFromCtrl.hasError("required")&&(i.weightFromCtrl!=null&&i.weightFromCtrl.touched||i.weightFromCtrl!=null&&i.weightFromCtrl.dirty)?22:-1),l(),N(i.weightFromCtrl!=null&&i.weightFromCtrl.hasError("min")&&(i.weightFromCtrl!=null&&i.weightFromCtrl.touched||i.weightFromCtrl!=null&&i.weightFromCtrl.dirty)?23:-1),l(),N(i.weightFromCtrl!=null&&i.weightFromCtrl.hasError("weightOrder")&&(i.weightFromCtrl!=null&&i.weightFromCtrl.touched||i.weightFromCtrl!=null&&i.weightFromCtrl.dirty)?24:-1),l(5),N(i.weightFromCtrl!=null&&i.weightFromCtrl.hasError("weightOrder")&&(i.weightFromCtrl!=null&&i.weightFromCtrl.touched||i.weightFromCtrl!=null&&i.weightFromCtrl.dirty)?29:-1),l(7),N(i.weightToCtrl!=null&&i.weightToCtrl.hasError("weightOrder")&&(i.weightToCtrl!=null&&i.weightToCtrl.touched||i.weightToCtrl!=null&&i.weightToCtrl.dirty)?36:-1),l(7),m("disabled",i.isLoading||i.districtForm.invalid),l(),Q(" ",i.isLoading?"Guardando...":i.districtToEdit?"Actualizar":"Crear"," ")}},dependencies:[P,W,me,re,te,ne,ee,ie,le,se,oe,ae,ot,nt,rt,de,pe,st,at,O,lt,mt,ct,Ve,Ae,_e,Le,F,tt,X,Xt,Z,Zt,Jt],styles:[".district-form-container[_ngcontent-%COMP%]{padding:10px 0}mat-card[_ngcontent-%COMP%]{border-radius:8px}mat-card-header[_ngcontent-%COMP%]{padding-bottom:16px;margin-bottom:20px}mat-card-header[_ngcontent-%COMP%]   mat-card-title[_ngcontent-%COMP%]{font-size:1.4em;font-weight:500}mat-card-content[_ngcontent-%COMP%]{padding-top:0}.form-row[_ngcontent-%COMP%]{display:flex;gap:20px;margin-bottom:0}.form-field[_ngcontent-%COMP%], .full-width-field[_ngcontent-%COMP%]{margin-bottom:16px}.form-field[_ngcontent-%COMP%]{flex:1}.full-width-field[_ngcontent-%COMP%]{width:100%}.standard-checkbox[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:20px}mat-card-actions[_ngcontent-%COMP%]{padding:16px 0 0;margin-top:24px}mat-card-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{font-weight:500}"]})};function hi(r,t){r&1&&(n(0,"div",5),b(1,"mat-progress-spinner",6),n(2,"p"),s(3,"Cargando datos del distrito..."),o()())}function Ci(r,t){if(r&1){let e=S();n(0,"app-district-form",7),V(1,"async"),f("formSubmit",function(a){p(e);let c=_();return u(c.handleSubmit(a))})("formCancel",function(){p(e);let a=_();return u(a.handleCancel())}),o()}if(r&2){let e=_();m("districtToEdit",e.districtId?K(1,2,e.districtToEdit$):null)("isLoading",e.isSaving)}}var z=class r{route=C(Kt);router=C(Y);districtService=C(I);snackBar=C(dt);districtToEdit$=M(null);isLoading=!1;isSaving=!1;pageTitle="Crear Nuevo Distrito/Tarifa";districtId=null;destroy$=new R;ngOnInit(){this.districtId=this.route.snapshot.paramMap.get("id"),console.log("DistrictFormPage - ngOnInit - districtId from route:",this.districtId),this.districtId?(this.pageTitle="Editar Distrito/Tarifa",this.isLoading=!0,this.districtToEdit$=this.districtService.getDistrictById(this.districtId).pipe(k(this.destroy$),E(t=>{console.log("COMPONENT: Received district data in tap():",t),t||(this.snackBar.open("No se encontraron datos para el distrito.","Cerrar",{duration:5e3,panelClass:["error-snackbar"]}),this.router.navigate(["/districts"])),this.isLoading=!1}),D(t=>(this.isLoading=!1,this.snackBar.open(`Error cargando distrito: ${t.message||"Intente de nuevo"}`,"Cerrar",{duration:5e3,panelClass:["error-snackbar"]}),this.router.navigate(["/districts"]),M(null)))),this.districtToEdit$.subscribe({next:t=>console.log("COMPONENT (MANUAL SUB): Data received:",t),error:t=>console.error("COMPONENT (MANUAL SUB): Error received:",t),complete:()=>console.log("COMPONENT (MANUAL SUB): Observable completed.")})):(this.pageTitle="Crear Nuevo Distrito/Tarifa",this.districtToEdit$=M(null),this.isLoading=!1)}handleSubmit(t){this.isSaving=!0;let e;this.districtId?e=this.districtService.updateDistrict(this.districtId,t):e=this.districtService.createDistrict(t),e.pipe(k(this.destroy$)).subscribe({next:i=>{this.isSaving=!1;let a=this.districtId?"actualizado":"creado";this.snackBar.open(`${a} correctamente.`,"OK",{duration:3e3,panelClass:["success-snackbar"]}),this.router.navigate(["/districts"])},error:i=>{this.isSaving=!1,this.snackBar.open(`Error al guardar distrito: ${i.message||"Intente de nuevo"}`,"Cerrar",{duration:5e3,panelClass:["error-snackbar"]})}})}handleCancel(){this.router.navigate(["/districts"])}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=y({type:r,selectors:[["app-district-form-page"]],decls:9,vars:3,consts:[[1,"page-container","form-page-container"],[1,"page-header"],["mat-icon-button","","matTooltip","Volver a la Lista","aria-label","Volver a la lista de distritos",3,"click"],["class","loading-indicator",4,"ngIf"],[3,"districtToEdit","isLoading","formSubmit","formCancel",4,"ngIf"],[1,"loading-indicator"],["mode","indeterminate","diameter","40"],[3,"formSubmit","formCancel","districtToEdit","isLoading"]],template:function(e,i){e&1&&(n(0,"div",0)(1,"div",1)(2,"button",2),f("click",function(){return i.handleCancel()}),n(3,"mat-icon"),s(4,"arrow_back"),o()(),n(5,"h1"),s(6),o()(),g(7,hi,4,0,"div",3)(8,Ci,2,4,"app-district-form",4),o()),e&2&&(l(6),v(i.pageTitle),l(),m("ngIf",i.isLoading),l(),m("ngIf",!i.isLoading))},dependencies:[P,$,W,J,_t,pt,it,et,F,H,O,B],styles:[".page-container[_ngcontent-%COMP%]{padding:24px;background-color:#f9fafb}.form-page-container[_ngcontent-%COMP%]{max-width:750px;margin:20px auto;background-color:#fff;border-radius:8px;padding:24px 30px}.page-header[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:24px;padding-bottom:16px}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0 0 0 12px;font-size:1.6em;font-weight:500}.loading-indicator[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px}.loading-indicator[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:10px}"]})};var bn=[{path:"",component:Ct,title:"Distritos y Tarifas"},{path:"create",component:z,title:"Nuevo Distrito/Tarifa"},{path:"edit/:id",component:z,title:"Editar Distrito/Tarifa"}];export{bn as DISTRICTS_ROUTES};
