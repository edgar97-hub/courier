import{a as wt}from"./chunk-S27FNEFC.js";import{a as It}from"./chunk-GJEYWMJR.js";import"./chunk-INNR5TUR.js";import{a as nt,b as it,c as at,d as rt}from"./chunk-ZKSEBIMY.js";import{a as ft,b as ht,c as gt,d as vt,e as Mt,f as Ct,g as yt,h as _t,i as xt,j as St,k as bt,l as Et,m as we,n as he,o as Dt,p as Ft}from"./chunk-PM3VLQI7.js";import"./chunk-MS4AQ6UA.js";import{d as fe,e as Pt}from"./chunk-URZB77TE.js";import{a as de,b as ue}from"./chunk-WNVFSXTV.js";import{a as ot,b as mt,c as lt,e as st,f as ct,g as pt,h as dt}from"./chunk-GXNIZWNA.js";import"./chunk-74KGK7YW.js";import{a as tt}from"./chunk-K72O7MSM.js";import{a as ge,b as ve,c as Me,d as Ce}from"./chunk-WF66USBX.js";import{c as pe,d as ut}from"./chunk-PKHWH5C3.js";import"./chunk-3PSRRXT4.js";import{d as ce}from"./chunk-UAHG2GVE.js";import"./chunk-FR3NO5YB.js";import"./chunk-2JNWSY3M.js";import{d as re,e as oe}from"./chunk-6IG52UKJ.js";import{a as se}from"./chunk-3IGH7FBX.js";import"./chunk-7RWCIHFI.js";import{A as ne,B as Je,E as ie,H as ae,I as We,b as K,d as T,f as J,g as W,l as qe,m as Ke,o as X,r as Z,w as ee,y as te}from"./chunk-2ONXJ7S3.js";import"./chunk-BWBG2IHT.js";import"./chunk-U3COC3EF.js";import{a as Ge,b as ze,d as Ue,g as Qe,i as Ye}from"./chunk-K4QNRRQ5.js";import{a as Y,b as q}from"./chunk-ASKMK2H5.js";import{a as He}from"./chunk-XRPHOQB2.js";import{a as Xe,b as me,e as le}from"./chunk-2H2YZZAU.js";import"./chunk-NUMYIFQH.js";import{Ac as I,Bb as F,Cc as Ve,Db as x,Eb as w,Ec as U,Gd as Ze,Hd as et,J as xe,Jc as De,Kb as be,Kc as Fe,Lb as Ee,Lc as $e,Mb as Pe,Pb as P,Q as Se,Qb as a,Rb as $,S as R,Sb as d,Va as m,Yc as Q,Za as _,Zb as H,_b as Le,a as O,b as Oe,ba as j,bc as f,cb as V,cc as Ae,dc as h,h as Te,ia as Be,ib as u,l as ke,ma as Re,mb as s,na as L,t as Ne,u as D,vb as i,vc as G,w as _e,wa as C,wb as n,wc as z,xa as y,xb as M,yb as b,yc as je,zb as E}from"./chunk-YUSEJVZ2.js";var k=class r{constructor(e){this.http=e}apiUrl=`${Q.apiUrl}/cash-management`;authService=L(He);getAuthHeaders(){let e=this.authService.getAccessToken();return e?new De({"Content-Type":"application/json",codrr_token:e}):new De({"Content-Type":"application/json"})}getAllCashMovements(e,t=1,o=10,l,c){let g=this.getAuthHeaders();if(!this.authService.getAccessToken())return D(()=>new Error("Not authenticated to fetch cash movements."));let p=new Fe;if(e)for(let v in e)e.hasOwnProperty(v)&&e[v]&&(p=p.append(v,e[v]));return p=p.append("page_number",t.toString()),p=p.append("page_size",o.toString()),l&&(p=p.append("orderBy",l)),c&&(p=p.append("orderDirection",c)),this.http.get(`${this.apiUrl}/movements`,{params:p,headers:g})}getCashMovementSummary(e){let t=this.getAuthHeaders();if(!this.authService.getAccessToken())return D(()=>new Error("Not authenticated to fetch cash movement summary."));let o=new Fe;if(e)for(let l in e)e.hasOwnProperty(l)&&e[l]&&(o=o.append(l,e[l]));return this.http.get(`${this.apiUrl}/detailed-summary`,{params:o,headers:t})}createManualMovement(e){let t=this.getAuthHeaders();return this.authService.getAccessToken()?this.http.post(`${this.apiUrl}/manual-movement`,e,{headers:t}):D(()=>new Error("Not authenticated to create cash movement."))}updateCashMovement(e,t){let o=this.getAuthHeaders();return this.authService.getAccessToken()?this.http.put(`${this.apiUrl}/${e}`,t,{headers:o}):D(()=>new Error("Not authenticated to update cash movement."))}deleteCashMovement(e){let t=this.getAuthHeaders();return this.authService.getAccessToken()?this.http.delete(`${this.apiUrl}/${e}`,{headers:t}):D(()=>new Error("Not authenticated to delete cash movement."))}generatePdf(e){let t=this.getAuthHeaders().set("Accept","application/pdf");return this.authService.getAccessToken()?this.http.get(`${this.apiUrl}/${e}/pdf/ticket`,{headers:t,responseType:"blob"}):D(()=>new Error("Not authenticated to generate PDF."))}static \u0275fac=function(t){return new(t||r)(Re($e))};static \u0275prov=Be({token:r,factory:r.\u0275fac,providedIn:"root"})};function Ut(r,e){r&1&&(i(0,"mat-error"),a(1,"La fecha es requerida"),n())}function Qt(r,e){r&1&&(i(0,"mat-error"),a(1,"El monto es requerido"),n())}function Yt(r,e){r&1&&(i(0,"mat-error"),a(1,"El monto debe ser mayor o igual a 0"),n())}function qt(r,e){r&1&&(i(0,"mat-error"),a(1,"El tipo de movimiento es requerido"),n())}function Kt(r,e){if(r&1&&(i(0,"mat-option",19),a(1),n()),r&2){let t=e.$implicit;s("value",t),m(),$(t)}}function Jt(r,e){r&1&&(i(0,"mat-error"),a(1,"La forma de pago es requerida"),n())}function Wt(r,e){r&1&&M(0,"mat-spinner",20)}function Xt(r,e){r&1&&(i(0,"span"),a(1,"Guardar"),n())}var A=class r{constructor(e,t,o,l,c){this.fb=e;this.dialogRef=t;this.cashManagementService=o;this.snackBar=l;this.data=c;this.movementForm=this.fb.group({date:[new Date,T.required],amount:[null,[T.required,T.min(0)]],typeMovement:["",T.required],paymentsMethod:["",T.required],description:[""]})}movementForm;isLoading=!1;minDate=null;paymentMethods=["Efectivo","Yape/Transferencia BCP","Plin/Transferencia INTERBANK","POS"];ngOnInit(){if(this.data){let e=null;if(this.data.date){let t=this.data.date.split("-");e=new Date(parseInt(t[0]),parseInt(t[1])-1,parseInt(t[2]))}this.movementForm.patchValue(Oe(O({},this.data),{date:e}))}}onSave(){if(this.movementForm.valid&&!this.isLoading){this.isLoading=!0;let e=O({},this.movementForm.value);(this.data&&this.data.id?this.cashManagementService.updateCashMovement(this.data.id,e):this.cashManagementService.createManualMovement(e)).pipe(R(()=>this.isLoading=!1)).subscribe({next:o=>{this.snackBar.open("Movimiento registrado exitosamente","Cerrar",{duration:3e3}),this.dialogRef.close(!0)},error:o=>{this.snackBar.open("Error al registrar movimiento: "+o.message,"Cerrar",{duration:3e3}),console.error("Error creating cash movement:",o)}})}}onCancel(){this.dialogRef.close(!1)}static \u0275fac=function(t){return new(t||r)(_(ee),_(ot),_(k),_(se),_(mt))};static \u0275cmp=V({type:r,selectors:[["app-cash-movement-form"]],features:[H([ut(),I])],decls:43,vars:14,consts:[["picker",""],["mat-dialog-title","",1,"page-header",2,"font-weight","700 !important"],[1,"cash-movement-dialog-content",3,"formGroup"],[1,"wrapper-form-field"],["appearance","outline",1,"cash-movement-form-field"],["matInput","","formControlName","date",3,"matDatepicker","min"],["matSuffix","",3,"for"],[4,"ngIf"],["matInput","","type","number","formControlName","amount","placeholder","Ej: 100.50"],["formControlName","typeMovement"],["value","INGRESO"],["value","EGRESO"],["formControlName","paymentsMethod"],[3,"value",4,"ngFor","ngForOf"],["matInput","","formControlName","description","placeholder","Ej: Compra de insumos","rows","3"],["align","end",1,"cash-movement-dialog-actions"],["mat-button","",1,"btn-corp-secondary",3,"click","disabled"],["mat-raised-button","","color","primary",1,"btn-corp-primary",3,"click","disabled"],["diameter","20",4,"ngIf"],[3,"value"],["diameter","20"]],template:function(t,o){if(t&1){let l=F();i(0,"h1",1),a(1,` Formulario de Movimiento de Caja
`),n(),i(2,"mat-dialog-content",2)(3,"div",3)(4,"mat-form-field",4)(5,"mat-label"),a(6,"Fecha"),n(),M(7,"input",5)(8,"mat-datepicker-toggle",6)(9,"mat-datepicker",null,0),u(11,Ut,2,0,"mat-error",7),n(),i(12,"mat-form-field",4)(13,"mat-label"),a(14,"Monto"),n(),M(15,"input",8),u(16,Qt,2,0,"mat-error",7)(17,Yt,2,0,"mat-error",7),n(),i(18,"mat-form-field",4)(19,"mat-label"),a(20,"Tipo de Movimiento"),n(),i(21,"mat-select",9)(22,"mat-option",10),a(23,"Ingreso"),n(),i(24,"mat-option",11),a(25,"Egreso"),n()(),u(26,qt,2,0,"mat-error",7),n(),i(27,"mat-form-field",4)(28,"mat-label"),a(29,"Forma de Pago"),n(),i(30,"mat-select",12),u(31,Kt,2,2,"mat-option",13),n(),u(32,Jt,2,0,"mat-error",7),n(),i(33,"mat-form-field",4)(34,"mat-label"),a(35,"Descripci\xF3n / Motivo"),n(),M(36,"textarea",14),n()()(),i(37,"mat-dialog-actions",15)(38,"button",16),x("click",function(){return C(l),y(o.onCancel())}),a(39," Cancelar "),n(),i(40,"button",17),x("click",function(){return C(l),y(o.onSave())}),u(41,Wt,1,0,"mat-spinner",18)(42,Xt,2,0,"span",7),n()()}if(t&2){let l,c,g,p,v,N=P(10);m(2),s("formGroup",o.movementForm),m(5),s("matDatepicker",N)("min",o.minDate),m(),s("for",N),m(3),s("ngIf",(l=o.movementForm.get("date"))==null?null:l.hasError("required")),m(5),s("ngIf",(c=o.movementForm.get("amount"))==null?null:c.hasError("required")),m(),s("ngIf",(g=o.movementForm.get("amount"))==null?null:g.hasError("min")),m(9),s("ngIf",(p=o.movementForm.get("typeMovement"))==null?null:p.hasError("required")),m(5),s("ngForOf",o.paymentMethods),m(),s("ngIf",(v=o.movementForm.get("paymentsMethod"))==null?null:v.hasError("required")),m(6),s("disabled",o.isLoading),m(2),s("disabled",o.movementForm.invalid||o.isLoading),m(),s("ngIf",o.isLoading),m(),s("ngIf",!o.isLoading)}},dependencies:[U,G,z,te,K,Ke,J,W,X,Z,oe,re,ae,ne,Je,ie,le,me,ue,de,ce,Ce,ge,ve,Me,pe,dt,st,pt,ct,We,q,Y],styles:[".cash-movement-dialog-content[_ngcontent-%COMP%]{padding:.75rem;overflow-y:auto;max-height:50vh}.wrapper-form-field[_ngcontent-%COMP%]{padding:20px}.cash-movement-form-field[_ngcontent-%COMP%]{margin-bottom:.5rem}.cash-movement-dialog-actions[_ngcontent-%COMP%]{padding:.75rem 1rem;border-top:1px solid #eee;background-color:#f9f9f9}.cash-movement-action-button[_ngcontent-%COMP%]{padding:.5rem 1rem;font-size:.8rem;border-radius:.25rem;transition:all .2s ease-in-out}.cash-movement-action-button[_ngcontent-%COMP%]:hover{transform:translateY(-1px);box-shadow:0 1px 2px #0000001a}.cash-movement-action-button[color=primary][_ngcontent-%COMP%]{background-color:#007bff;color:#fff}.cash-movement-action-button[color=accent][_ngcontent-%COMP%]{background-color:#6c757d;color:#fff}@media (max-width: 768px){.cash-movement-dialog-content[_ngcontent-%COMP%]{padding:.5rem}.cash-movement-dialog-actions[_ngcontent-%COMP%]{padding:.5rem;flex-direction:column;gap:.4rem}.cash-movement-action-button[_ngcontent-%COMP%]{width:100%}}"]})};var Zt=()=>[5,10,20,50];function en(r,e){r&1&&(i(0,"div",49),M(1,"mat-spinner",50),n())}function tn(r,e){if(r&1&&(i(0,"div",51)(1,"div",52)(2,"div",53)(3,"div",54),a(4,"Tipo"),n(),i(5,"div",54),a(6,"Efectivo"),n(),i(7,"div",54),a(8,"Yape / Transferencia BCP"),n(),i(9,"div",54),a(10," Plin / Transferencia INTERBANK "),n(),i(11,"div",54),a(12,"POS"),n()(),i(13,"div",55)(14,"div",56),a(15,"Ingreso"),n(),i(16,"div",56),a(17),f(18,"currency"),n(),i(19,"div",56),a(20),f(21,"currency"),n(),i(22,"div",56),a(23),f(24,"currency"),n(),i(25,"div",56),a(26),f(27,"currency"),n()(),i(28,"div",55)(29,"div",56),a(30,"Egreso"),n(),i(31,"div",56),a(32),f(33,"currency"),n(),i(34,"div",56),a(35),f(36,"currency"),n(),i(37,"div",56),a(38),f(39,"currency"),n(),i(40,"div",56),a(41),f(42,"currency"),n()(),i(43,"div",55)(44,"div",56),a(45,"Saldo"),n(),i(46,"div",56),a(47),f(48,"currency"),n(),i(49,"div",56),a(50),f(51,"currency"),n(),i(52,"div",56),a(53),f(54,"currency"),n(),i(55,"div",56),a(56),f(57,"currency"),n()(),i(58,"div",57)(59,"div",58),a(60,"Ingreso Caja"),n(),i(61,"div",59),a(62),f(63,"currency"),n()(),i(64,"div",57)(65,"div",58),a(66,"Egreso Caja"),n(),i(67,"div",59),a(68),f(69,"currency"),n()(),i(70,"div",57)(71,"div",58),a(72,"Total en Caja"),n(),i(73,"div",59),a(74),f(75,"currency"),n()()()()),r&2){let t=e.ngIf;m(17),d(" ",h(18,15,t.Efectivo.income,"S/ ")," "),m(3),d(" ",h(21,18,t["Yape/Transferencia BCP"].income,"S/ ")," "),m(3),d(" ",h(24,21,t["Plin/Transferencia INTERBANK"].income,"S/ ")," "),m(3),d(" ",h(27,24,t.POS.income,"S/ ")," "),m(6),d(" ",h(33,27,t.Efectivo.expense,"S/ ")," "),m(3),d(" ",h(36,30,t["Yape/Transferencia BCP"].expense,"S/ ")," "),m(3),d(" ",h(39,33,t["Plin/Transferencia INTERBANK"].expense,"S/ ")," "),m(3),d(" ",h(42,36,t.POS.expense,"S/ ")," "),m(6),d(" ",h(48,39,t.Efectivo.balance,"S/ ")," "),m(3),d(" ",h(51,42,t["Yape/Transferencia BCP"].balance,"S/ ")," "),m(3),d(" ",h(54,45,t["Plin/Transferencia INTERBANK"].balance,"S/ ")," "),m(3),d(" ",h(57,48,t.POS.balance,"S/ ")," "),m(6),d(" ",h(63,51,t.totalCashIncome,"S/ ")," "),m(6),d(" ",h(69,54,t.totalCashExpense,"S/ ")," "),m(6),d(" ",h(75,57,t.totalCashBalance,"S/ ")," ")}}function nn(r,e){if(r&1&&(i(0,"mat-option",60),a(1),n()),r&2){let t=e.$implicit;s("value",t),m(),$(t)}}function an(r,e){r&1&&(i(0,"div",49),M(1,"mat-spinner",50),n())}function rn(r,e){r&1&&(i(0,"th",61),a(1," N\xB0 "),n())}function on(r,e){if(r&1&&(i(0,"td",62),a(1),n()),r&2){let t=e.$implicit;m(),d(" ",t.code," ")}}function mn(r,e){r&1&&(i(0,"th",61),a(1," Fecha "),n())}function ln(r,e){if(r&1&&(i(0,"td",62),a(1),f(2,"date"),n()),r&2){let t=e.$implicit;m(),d(" ",h(2,1,t.date,"dd/MM/yyyy")," ")}}function sn(r,e){r&1&&(i(0,"th",61),a(1," Tipo "),n())}function cn(r,e){if(r&1&&(i(0,"td",62),a(1),n()),r&2){let t=e.$implicit;m(),d(" ",t.typeMovement," ")}}function pn(r,e){r&1&&(i(0,"th",61),a(1," Monto "),n())}function dn(r,e){if(r&1&&(i(0,"td",62),a(1),f(2,"currency"),n()),r&2){let t=e.$implicit;m(),d(" ",h(2,1,t.amount,"S/ ")," ")}}function un(r,e){r&1&&(i(0,"th",61),a(1," Forma de Pago "),n())}function fn(r,e){if(r&1&&(i(0,"td",62),a(1),n()),r&2){let t=e.$implicit;m(),d(" ",t.paymentsMethod," ")}}function hn(r,e){r&1&&(i(0,"th",61),a(1," Descripci\xF3n "),n())}function gn(r,e){if(r&1&&(i(0,"td",62),a(1),n()),r&2){let t=e.$implicit;m(),d(" ",t.description," ")}}function vn(r,e){r&1&&(i(0,"th",61),a(1," Usuario "),n())}function Mn(r,e){if(r&1&&(i(0,"td",62),a(1),n()),r&2){let t=e.$implicit;m(),d(" ",t.user==null?null:t.user.username," ")}}function Cn(r,e){r&1&&(i(0,"th",63),a(1," Acciones "),n())}function yn(r,e){if(r&1){let t=F();i(0,"button",67),x("click",function(){C(t);let l=w().$implicit,c=w();return y(c.editMovement(l))}),i(1,"mat-icon"),a(2,"edit"),n(),i(3,"span"),a(4,"Editar"),n()()}}function _n(r,e){if(r&1){let t=F();i(0,"button",67),x("click",function(){C(t);let l=w().$implicit,c=w();return y(c.deleteMovement(l.id))}),i(1,"mat-icon"),a(2,"delete"),n(),i(3,"span"),a(4,"Eliminar"),n()()}}function xn(r,e){if(r&1){let t=F();i(0,"td",64)(1,"button",65)(2,"mat-icon"),a(3,"more_vert"),n()(),i(4,"mat-menu",null,4),u(6,yn,5,0,"button",66),i(7,"button",67),x("click",function(){let l=C(t).$implicit,c=w();return y(c.generatePdf(l.id))}),i(8,"mat-icon"),a(9,"picture_as_pdf"),n(),i(10,"span"),a(11,"Imprimir ticket"),n()(),u(12,_n,5,0,"button",66),n()()}if(r&2){let t=P(5),o=w();m(),s("matMenuTriggerFor",t),m(5),s("ngIf",o.isReceptionistOrAdmin()),m(6),s("ngIf",!o.isReceptionist())}}function Sn(r,e){r&1&&M(0,"tr",68)}function bn(r,e){r&1&&M(0,"tr",69)}function En(r,e){r&1&&(i(0,"tr",70)(1,"td",71),a(2," No hay movimientos de caja que coincidan con los filtros. "),n()())}var ye=class r{constructor(e,t,o,l,c){this.fb=e;this.cashManagementService=t;this.dialog=o;this.snackBar=l;this.excelExportService=c;let g=new Date;this.filterForm=this.fb.group({startDate:[g],endDate:[g],typeMovement:[""],paymentsMethod:[""],userId:[""],search:[""]}),this.summaryFilterForm=this.fb.group({startDate:[g],endDate:[g]})}appStore=L(tt);filterForm;summaryFilterForm;displayedColumns=["code","date","typeMovement","amount","paymentsMethod","description","user","actions"];paymentMethods=["Efectivo","Yape/Transferencia BCP","Plin/Transferencia INTERBANK","POS"];cashMovements=new we([]);summary$=Ne({Efectivo:{income:0,expense:0,balance:0},"Yape/Transferencia BCP":{income:0,expense:0,balance:0},"Plin/Transferencia INTERBANK":{income:0,expense:0,balance:0},POS:{income:0,expense:0,balance:0},totalCashIncome:0,totalCashExpense:0,totalCashBalance:0});totalItems=0;pageSize=10;pageNumber=1;datePipe=L(I);isLoadingResults=!1;isLoadingSummary=!1;paginator;sort;destroy$=new ke;ngOnInit(){this.fetchCashMovements(this.filterForm.value),this.fetchCashMovementSummary(this.summaryFilterForm.value),this.filterForm.valueChanges.pipe(j(this.destroy$),xe(400),Se((e,t)=>JSON.stringify(e)===JSON.stringify(t))).subscribe(e=>{this.fetchCashMovements(e)}),this.summaryFilterForm.valueChanges.pipe(j(this.destroy$),xe(400),Se((e,t)=>JSON.stringify(e)===JSON.stringify(t))).subscribe(e=>{this.fetchCashMovementSummary(e)})}ngAfterViewInit(){this.cashMovements.sort=this.sort,this.sort.sortChange.pipe(j(this.destroy$)).subscribe(()=>{this.pageNumber=1,this.applyFilters()})}fetchCashMovements(e,t,o){let l=O({},e);l.startDate&&(l.startDate=this.datePipe.transform(l.startDate,"yyyy-MM-dd")||""),l.endDate&&(l.endDate=this.datePipe.transform(l.endDate,"yyyy-MM-dd")||""),l.search&&(l.search=l.search.trim()),this.isLoadingResults=!0,this.cashManagementService.getAllCashMovements(l,this.pageNumber,this.pageSize,t,o).pipe(R(()=>this.isLoadingResults=!1)).subscribe(c=>{this.cashMovements=new we(c.movements),this.totalItems=c.total,this.cashMovements.sort=this.sort})}fetchCashMovementSummary(e){let t=O({},e);t.startDate&&(t.startDate=this.datePipe.transform(t.startDate,"yyyy-MM-dd")||""),t.endDate&&(t.endDate=this.datePipe.transform(t.endDate,"yyyy-MM-dd")||""),this.isLoadingSummary=!0,this.summary$=this.cashManagementService.getCashMovementSummary(t).pipe(R(()=>this.isLoadingSummary=!1))}applyFilters(){this.fetchCashMovements(this.filterForm.value,this.sort?.active,this.sort?.direction)}applySummaryFilters(){this.fetchCashMovementSummary(this.summaryFilterForm.value)}onPageChange(e){this.pageNumber=e.pageIndex+1,this.pageSize=e.pageSize,this.applyFilters()}openAddMovementDialog(){this.dialog.open(A,{width:"400px"}).afterClosed().subscribe(t=>{t&&this.applyFilters()})}editMovement(e){this.dialog.open(A,{width:"400px",data:e}).afterClosed().subscribe(o=>{o&&this.applyFilters()})}deleteMovement(e){let t={title:"Confirmar Eliminaci\xF3n",message:"\xBFEst\xE1s seguro de que quieres eliminar este movimiento de caja? Esta acci\xF3n no se puede deshacer.",confirmButtonText:"Eliminar",cancelButtonText:"Cancelar",confirmButtonColor:"warn"};this.dialog.open(It,{width:"350px",data:t}).afterClosed().subscribe(l=>{l&&this.cashManagementService.deleteCashMovement(e).subscribe({next:()=>{this.snackBar.open("Movimiento eliminado exitosamente","Cerrar",{duration:3e3}),this.applyFilters()},error:c=>{this.snackBar.open("Error al eliminar movimiento: "+c.message,"Cerrar",{duration:3e3}),console.error("Error deleting cash movement:",c)}})})}generatePdf(e){let t=Q.apiUrl+"/cash-management/"+e+"/pdf/ticket";window.open(t,"_blank")}exportCashMovementsToExcel(){return Te(this,null,function*(){let e=this.filterForm.value,t=this.summaryFilterForm.value;e.startDate&&(e.startDate=this.datePipe.transform(e.startDate,"yyyy-MM-dd")||""),e.endDate&&(e.endDate=this.datePipe.transform(e.endDate,"yyyy-MM-dd")||""),t.startDate&&(t.startDate=this.datePipe.transform(t.startDate,"yyyy-MM-dd")||""),t.endDate&&(t.endDate=this.datePipe.transform(t.endDate,"yyyy-MM-dd")||"");let o=this.cashManagementService.getAllCashMovements(e,1,999999),c=(yield _e(o))?.movements||[],g=this.cashManagementService.getCashMovementSummary(t),p=yield _e(g),v=[],N=[];v.push({label:"Fecha Inicio",value:this.datePipe.transform(t.startDate,"dd/MM/yyyy")}),v.push({label:"Fecha Fin",value:this.datePipe.transform(t.endDate,"dd/MM/yyyy")}),p&&(["Efectivo","Yape/Transferencia BCP","Plin/Transferencia INTERBANK","POS"].forEach(Ie=>{let B=p[Ie];B&&typeof B=="object"&&v.push({Tipo:Ie,Ingreso:B.income.toFixed(2),Egreso:B.expense.toFixed(2),Saldo:B.balance.toFixed(2)})}),v.push({label:"Total Ingresos",value:parseFloat(p.totalCashIncome.toFixed(2))}),v.push({label:"Total Egresos",value:parseFloat(p.totalCashExpense.toFixed(2))}),v.push({label:"Saldo Total",value:parseFloat(p.totalCashBalance.toFixed(2))})),c.forEach(S=>{N.push({"N\xB0":S.code,Fecha:this.datePipe.transform(S.date,"dd/MM/yyyy"),Tipo:S.typeMovement,Monto:parseFloat(S.amount.toFixed(2)),"Forma de Pago":S.paymentsMethod,Descripci\u00F3n:S.description,Usuario:S.user?.username||S.user?.email})});let kt=`movimientos_caja_${this.datePipe.transform(new Date,"yyyyMMdd_HHmmss")}`;this.excelExportService.exportCashMovementSummaryAndDetailsToExcel(v,N,kt,"Movimientos de Caja",this.datePipe.transform(e.startDate,"dd/MM/yyyy")||"",this.datePipe.transform(e.endDate,"dd/MM/yyyy")||"")})}isReceptionist(){return this.appStore.currentUser()?.role==="RECEPCIONISTA"}isReceptionistOrAdmin(){let e=this.appStore.currentUser()?.role;return e==="RECEPCIONISTA"||e==="ADMINISTRADOR"}static \u0275fac=function(t){return new(t||r)(_(ee),_(k),_(lt),_(se),_(wt))};static \u0275cmp=V({type:r,selectors:[["app-cash-management-list-page"]],viewQuery:function(t,o){if(t&1&&(be(fe,5),be(he,5)),t&2){let l;Ee(l=Pe())&&(o.paginator=l.first),Ee(l=Pe())&&(o.sort=l.first)}},features:[H([I])],decls:120,vars:23,consts:[["summaryStartDatePicker",""],["summaryEndDatePicker",""],["startDatePicker",""],["endDatePicker",""],["actionsMenu","matMenu"],[1,"page-container"],[2,"display","flex","padding","10px"],[1,"mat-card-header"],[1,"mat-card-title",2,"padding","10px !important","padding-left","0px !important"],["mat-raised-button","","color","primary",1,"btn-corp-primary","btn-excel",3,"click"],[1,"mat-card","summary-section"],[1,"mat-card-title"],[1,"filter-form",3,"formGroup"],["appearance","outline",1,"w-full"],["matInput","","formControlName","startDate",3,"matDatepicker"],["matSuffix","",3,"for"],["matInput","","formControlName","endDate",3,"matDatepicker"],[1,"form-actions",2,"padding-bottom","10px !important"],["mat-raised-button","","color","primary",1,"btn-corp-primary",3,"click"],["class","loading-overlay",4,"ngIf"],["class","summary-table-container",4,"ngIf"],[1,"mat-card"],["formControlName","typeMovement"],["value",""],["value","INGRESO"],["value","EGRESO"],["formControlName","paymentsMethod"],[3,"value",4,"ngFor","ngForOf"],["matInput","","formControlName","search","placeholder","Buscar..."],[1,"form-actions"],["mat-raised-button","","color","accent",1,"btn-corp-primary",3,"click"],[1,""],["mat-table","","matSort","",1,"mat-table",3,"dataSource"],["matColumnDef","code"],["mat-header-cell","","mat-sort-header","","class","mat-header-cell",4,"matHeaderCellDef"],["mat-cell","","class","mat-cell",4,"matCellDef"],["matColumnDef","date"],["matColumnDef","typeMovement"],["matColumnDef","amount"],["matColumnDef","paymentsMethod"],["matColumnDef","description"],["matColumnDef","user"],["matColumnDef","actions"],["mat-header-cell","","class","mat-header-cell",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["showFirstLastButtons","",3,"page","length","pageSize","pageSizeOptions"],[1,"loading-overlay"],["diameter","30"],[1,"summary-table-container"],[1,"summary-table"],[1,"summary-header"],[1,"summary-cell","header-cell"],[1,"summary-row"],[1,"summary-cell"],[1,"summary-row","total-row"],[1,"summary-cell","total-label"],[1,"summary-cell","total-value"],[3,"value"],["mat-header-cell","","mat-sort-header","",1,"mat-header-cell"],["mat-cell","",1,"mat-cell"],["mat-header-cell","",1,"mat-header-cell"],["mat-cell",""],["mat-icon-button","","aria-label","Acciones",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click",4,"ngIf"],["mat-menu-item","",3,"click"],["mat-header-row",""],["mat-row",""],[1,"mat-row"],["colspan","7",1,"mat-cell"]],template:function(t,o){if(t&1){let l=F();i(0,"div",5)(1,"div",6)(2,"mat-card-header",7)(3,"mat-card-title",8),a(4,"Gesti\xF3n de Caja"),n()(),i(5,"button",9),x("click",function(){return C(l),y(o.exportCashMovementsToExcel())}),i(6,"mat-icon"),a(7,"cloud_download"),n(),a(8," Exportar a Excel "),n()(),i(9,"mat-card",10)(10,"mat-card-header",7)(11,"mat-card-title",11),a(12,"Resumen de Saldos"),n()(),i(13,"mat-card-content")(14,"form",12)(15,"mat-form-field",13)(16,"mat-label"),a(17,"Fecha Inicio Resumen"),n(),M(18,"input",14)(19,"mat-datepicker-toggle",15)(20,"mat-datepicker",null,0),n(),i(22,"mat-form-field",13)(23,"mat-label"),a(24,"Fecha Fin Resumen"),n(),M(25,"input",16)(26,"mat-datepicker-toggle",15)(27,"mat-datepicker",null,1),n()(),i(29,"div",17)(30,"button",18),x("click",function(){return C(l),y(o.applySummaryFilters())}),i(31,"mat-icon"),a(32,"filter_list"),n(),a(33," Aplicar Filtros Resumen "),n()(),u(34,en,2,0,"div",19)(35,tn,76,60,"div",20),f(36,"async"),n()(),i(37,"mat-card",21)(38,"mat-card-header",7)(39,"mat-card-title",11),a(40,"Detalle de movimientos"),n()(),i(41,"mat-card",21)(42,"mat-card-content")(43,"form",12)(44,"mat-form-field",13)(45,"mat-label"),a(46,"Fecha Inicio"),n(),M(47,"input",14)(48,"mat-datepicker-toggle",15)(49,"mat-datepicker",null,2),n(),i(51,"mat-form-field",13)(52,"mat-label"),a(53,"Fecha Fin"),n(),M(54,"input",16)(55,"mat-datepicker-toggle",15)(56,"mat-datepicker",null,3),n(),i(58,"mat-form-field",13)(59,"mat-label"),a(60,"Tipo de Movimiento"),n(),i(61,"mat-select",22)(62,"mat-option",23),a(63,"Todos"),n(),i(64,"mat-option",24),a(65,"Ingreso"),n(),i(66,"mat-option",25),a(67,"Egreso"),n()()(),i(68,"mat-form-field",13)(69,"mat-label"),a(70,"Forma de Pago"),n(),i(71,"mat-select",26)(72,"mat-option",23),a(73,"Todos"),n(),u(74,nn,2,2,"mat-option",27),n()(),i(75,"mat-form-field",13)(76,"mat-label"),a(77,"Buscar"),n(),M(78,"input",28),n()(),i(79,"div",29)(80,"button",18),x("click",function(){return C(l),y(o.applyFilters())}),i(81,"mat-icon"),a(82,"filter_list"),n(),a(83," Aplicar Filtros "),n(),i(84,"button",30),x("click",function(){return C(l),y(o.openAddMovementDialog())}),i(85,"mat-icon"),a(86,"add"),n(),a(87," Registrar Movimiento "),n()()()(),i(88,"mat-card-content"),u(89,an,2,0,"div",19),i(90,"div",31)(91,"table",32),b(92,33),u(93,rn,2,0,"th",34)(94,on,2,1,"td",35),E(),b(95,36),u(96,mn,2,0,"th",34)(97,ln,3,4,"td",35),E(),b(98,37),u(99,sn,2,0,"th",34)(100,cn,2,1,"td",35),E(),b(101,38),u(102,pn,2,0,"th",34)(103,dn,3,4,"td",35),E(),b(104,39),u(105,un,2,0,"th",34)(106,fn,2,1,"td",35),E(),b(107,40),u(108,hn,2,0,"th",34)(109,gn,2,1,"td",35),E(),b(110,41),u(111,vn,2,0,"th",34)(112,Mn,2,1,"td",35),E(),b(113,42),u(114,Cn,2,0,"th",43)(115,xn,13,3,"td",44),E(),u(116,Sn,1,0,"tr",45)(117,bn,1,0,"tr",46)(118,En,3,0,"tr",47),n(),i(119,"mat-paginator",48),x("page",function(g){return C(l),y(o.onPageChange(g))}),n()()()()()}if(t&2){let l=P(21),c=P(28),g=P(50),p=P(57);m(14),s("formGroup",o.summaryFilterForm),m(4),s("matDatepicker",l),m(),s("for",l),m(6),s("matDatepicker",c),m(),s("for",c),m(8),s("ngIf",o.isLoadingSummary),m(),s("ngIf",Ae(36,20,o.summary$)),m(8),s("formGroup",o.filterForm),m(4),s("matDatepicker",g),m(),s("for",g),m(6),s("matDatepicker",p),m(),s("for",p),m(19),s("ngForOf",o.paymentMethods),m(15),s("ngIf",o.isLoadingResults),m(2),s("dataSource",o.cashMovements),m(25),s("matHeaderRowDef",o.displayedColumns),m(),s("matRowDefColumns",o.displayedColumns),m(2),s("length",o.totalItems)("pageSize",o.pageSize)("pageSizeOptions",Le(22,Zt))}},dependencies:[U,G,z,je,Ve,I,Ye,Ge,Ue,Qe,ze,Et,ft,gt,yt,vt,ht,_t,Mt,Ct,xt,St,bt,Pt,fe,Ft,he,Dt,oe,re,ae,ne,ie,le,me,Xe,et,Ze,ue,de,ce,Ce,ge,ve,Me,pe,te,qe,K,J,W,X,Z,q,Y,rt,it,nt,at],styles:[".page-container[_ngcontent-%COMP%]{background-color:#f9fafb;min-height:100vh}@media (max-width: 640px){.btn-excel[_ngcontent-%COMP%]{padding:25px!important}}.mat-card[_ngcontent-%COMP%]{box-shadow:0 1px 2px #0000000d;border-radius:.2rem}.mat-card-header[_ngcontent-%COMP%]{padding:0rem .6rem;border-bottom:1px solid #e5e7eb}.mat-card-title[_ngcontent-%COMP%]{color:#1f2937;font-weight:900;font-size:1.4rem;padding:7px 7px 11px!important}.filter-form[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:.4rem}.mat-form-field[_ngcontent-%COMP%]{width:100%;margin-bottom:0;font-size:.75rem}.form-actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;gap:.3rem;margin-top:0!important;font-weight:700!important}.filter-form[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}.search-form[_ngcontent-%COMP%]{width:100%}@media (min-width: 640px){.form-actions[_ngcontent-%COMP%]{flex-direction:row}.search-form[_ngcontent-%COMP%]{width:70%}}.action-button[_ngcontent-%COMP%]{width:100%;padding:.3rem .6rem;font-size:.7rem;font-weight:600;border-radius:.15rem;transition:all .2s ease-in-out}@media (min-width: 640px){.action-button[_ngcontent-%COMP%]{width:auto}}.action-button[_ngcontent-%COMP%]:hover{transform:translateY(-1px);box-shadow:0 1px 2px #00000014}.summary-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(100px,1fr));gap:.4rem;text-align:center}.summary-card[_ngcontent-%COMP%]{padding:.1rem!important;background-color:#fff;border:1px solid #e5e7eb;border-radius:.2rem;box-shadow:0 1px 2px #00000005}.summary-card[_ngcontent-%COMP%]   .mat-card-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center}.summary-label[_ngcontent-%COMP%]{color:#4b5563;font-weight:700}.summary-value[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:700;margin-top:.05rem}.income-card[_ngcontent-%COMP%]{background-color:#e6ffe6;border-color:#6c6}.income-card[_ngcontent-%COMP%]   .summary-value[_ngcontent-%COMP%]{color:#28a745}.expense-card[_ngcontent-%COMP%]{background-color:#ffe6e6;border-color:#f66}.expense-card[_ngcontent-%COMP%]   .summary-value[_ngcontent-%COMP%]{color:#dc3545}.balance-card[_ngcontent-%COMP%]{background-color:#e6f7ff;border-color:#66b3ff}.balance-card[_ngcontent-%COMP%]   .summary-value.text-green-700[_ngcontent-%COMP%]{color:#28a745}.balance-card[_ngcontent-%COMP%]   .summary-value.text-red-700[_ngcontent-%COMP%]{color:#dc3545}.summary-table-container[_ngcontent-%COMP%]{width:100%;overflow-x:auto}.summary-table[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr repeat(4,minmax(100px,1fr));border:1px solid #817e7e;border-radius:4px;overflow:hidden;font-size:.85rem;min-width:600px}.summary-header[_ngcontent-%COMP%], .summary-row[_ngcontent-%COMP%]{display:contents}.summary-cell[_ngcontent-%COMP%]{padding:10px 15px;border:1px solid #848383;text-align:right;display:flex;align-items:center;justify-content:flex-end;border-bottom:0px;border-left:0px;color:#18191a;font-weight:500}.summary-cell[_ngcontent-%COMP%]:first-child{border-bottom:0px;text-align:left;justify-content:flex-start;font-weight:700;background-color:#f9f9f9}.header-cell[_ngcontent-%COMP%]{background-color:#012147;color:#fff;font-weight:700;text-align:center;justify-content:center}.header-cell[_ngcontent-%COMP%]:first-child{background-color:#012147;color:#fff;text-align:left;justify-content:flex-start}.total-row[_ngcontent-%COMP%]   .summary-cell[_ngcontent-%COMP%]{background-color:#f0f0f0;font-weight:700}.total-row[_ngcontent-%COMP%]   .summary-cell.total-label[_ngcontent-%COMP%]{text-align:right;justify-content:flex-end;grid-column:span 4}.total-row[_ngcontent-%COMP%]   .summary-cell.total-value[_ngcontent-%COMP%]{text-align:right;justify-content:flex-end}.mat-no-data-row[_ngcontent-%COMP%]   .mat-cell[_ngcontent-%COMP%]{text-align:center;padding-top:.4rem;padding-bottom:.4rem;color:#494b4e;font-style:italic}@media (max-width: 768px){.mat-table[_ngcontent-%COMP%]{display:block;overflow-x:auto;-webkit-overflow-scrolling:touch}}.total-row-content[_ngcontent-%COMP%]{display:flex;justify-content:space-between;width:100%}.total-row-label[_ngcontent-%COMP%], .total-row-value[_ngcontent-%COMP%]{font-weight:700}"]})};var Ai=[{path:"",component:ye}];export{Ai as CASH_MANAGEMENT_ROUTES};
