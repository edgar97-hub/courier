import{a as pe,b as de}from"./chunk-QSNR5F4X.js";import{a as N,b as G}from"./chunk-PZCJVKX2.js";import{b as me,c as ce}from"./chunk-FBL4ZQT7.js";import{a as Y,b as Z,e as ee,h as te,i as ie,n as ne,o as re}from"./chunk-MYNWWTJH.js";import{a as R,d as D,f as B,h as A}from"./chunk-BGY2FCVT.js";import{b as j,d as z,f as $,g as q,l as H,o as J,p as K,r as Q,s as W,u as X}from"./chunk-3KYPZUCO.js";import{a as le,b as se}from"./chunk-DTY45AJM.js";import{j as oe,m as ae}from"./chunk-VBCWU2N4.js";import{$ as h,$a as U,$b as w,Ab as g,Bb as u,Kb as v,Lb as o,Mb as k,Nb as f,Q as S,R as b,Ra as F,Sa as s,a as I,b as y,f as T,fb as x,j as M,jb as m,la as C,pc as O,sb as r,tb as n,ua as p,ub as _,va as d,vb as P,wb as E,wc as V,yb as L}from"./chunk-AXAGG6HT.js";function ue(l,t){l&1&&(r(0,"div",10),_(1,"mat-progress-spinner",11),n())}function _e(l,t){l&1&&(r(0,"mat-error"),o(1," Se requiere el nombre de la empresa. "),n())}function fe(l,t){if(l&1&&(P(0),o(1," Archivo actual: "),r(2,"a",41),o(3),n(),E()),l&2){let e=u(2);s(2),m("href",e.currentExcelImportTemplateUrl,F),s(),k(e.currentExcelImportTemplateUrl.split("/").pop()||"View Terms")}}function he(l,t){l&1&&(r(0,"span",42),o(1,"A\xFAn no se ha cargado ning\xFAn archivo."),n())}function xe(l,t){l&1&&(r(0,"p",29),o(1," Sube un archivo "),n())}function ve(l,t){if(l&1&&(r(0,"p",29),o(1),n()),l&2){let e=u(2);s(),f(" Selected: ",e.selectedExcelImportTemplateFile.name," ")}}function be(l,t){if(l&1&&(P(0),o(1," Archivo actual: "),r(2,"a",41),o(3),n(),E()),l&2){let e=u(2);s(2),m("href",e.currentTermsUrl,F),s(),k(e.currentTermsUrl.split("/").pop()||"View Terms")}}function Fe(l,t){l&1&&(r(0,"span",42),o(1,"A\xFAn no se ha cargado ning\xFAn PDF de T\xE9rminos y Condiciones."),n())}function Ce(l,t){l&1&&(r(0,"p",29),o(1," Sube un archivo PDF con tus t\xE9rminos y condiciones. "),n())}function Ie(l,t){if(l&1&&(r(0,"p",29),o(1),n()),l&2){let e=u(2);s(),f(" Selected: ",e.selectedTermsFile.name," ")}}function Se(l,t){if(l&1){let e=L();r(0,"mat-card",12)(1,"mat-card-content")(2,"form",13),g("ngSubmit",function(){p(e);let i=u();return d(i.onSaveSettings())}),r(3,"h2"),o(4,"Nombre del negocio"),n(),r(5,"mat-form-field",14)(6,"mat-label"),o(7,"Nombre de la empresa"),n(),_(8,"input",15),r(9,"mat-icon",16),o(10,"storefront"),n(),x(11,_e,2,0,"mat-error",17),n(),r(12,"mat-form-field",14)(13,"mat-label"),o(14,"Direcc\xF3n"),n(),_(15,"input",18),n(),r(16,"div",19)(17,"mat-form-field",20)(18,"mat-label"),o(19,"Telefono"),n(),_(20,"input",21),r(21,"mat-icon",16),o(22,"phone"),n()()(),r(23,"mat-form-field",14)(24,"mat-label"),o(25,"Enlace del mapa de cobertura"),n(),_(26,"input",22),n(),r(27,"h2"),o(28,"Marca y aspectos legales"),n(),r(29,"div",23)(30,"p",24),o(31,"Logotipo de empresa"),n(),r(32,"div",25),_(33,"img",26),n(),r(34,"input",27,0),g("change",function(i){p(e);let c=u();return d(c.onLogoFileSelected(i))}),n(),r(36,"button",28),g("click",function(){p(e);let i=v(35);return d(i.click())}),r(37,"mat-icon"),o(38,"cloud_upload"),n(),o(39),n(),r(40,"p",29),o(41,"Recomendado: PNG, JPG, SVG. Max 2MB."),n()(),r(42,"div",23)(43,"p",24),o(44,"Imagen de fondo"),n(),r(45,"div",25),_(46,"img",30),n(),r(47,"input",27,1),g("change",function(i){p(e);let c=u();return d(c.onLogoFileSelected3(i))}),n(),r(49,"button",28),g("click",function(){p(e);let i=v(48);return d(i.click())}),r(50,"mat-icon"),o(51,"cloud_upload"),n(),o(52),n(),r(53,"p",29),o(54,"Recomendado: PNG, JPG, SVG. Max 2MB."),n()(),r(55,"div",23)(56,"p",24),o(57,"imagen de las tarifas"),n(),r(58,"div",25),_(59,"img",31),n(),r(60,"input",27,2),g("change",function(i){p(e);let c=u();return d(c.onLogoFileSelected4(i))}),n(),r(62,"button",28),g("click",function(){p(e);let i=v(61);return d(i.click())}),r(63,"mat-icon"),o(64,"cloud_upload"),n(),o(65),n(),r(66,"p",29),o(67,"Recomendado: PNG, JPG, SVG. Max 2MB."),n()(),r(68,"div",32)(69,"p",24),o(70," Plantilla de Excel para importaci\xF3n "),n(),r(71,"div",33),x(72,fe,4,2,"ng-container",34)(73,he,2,0,"ng-template",null,3,w),n(),r(75,"input",35,4),g("change",function(i){p(e);let c=u();return d(c.onLogoFileSelected5(i))}),n(),r(77,"button",28),g("click",function(){p(e);let i=v(76);return d(i.click())}),r(78,"mat-icon"),o(79,"cloud_upload"),n(),o(80),n(),x(81,xe,2,0,"p",36)(82,ve,2,1,"p",36),n(),r(83,"div",32)(84,"p",24),o(85," T\xE9rminos y condiciones (PDF) "),n(),r(86,"div",33),x(87,be,4,2,"ng-container",34)(88,Fe,2,0,"ng-template",null,3,w),n(),r(90,"input",37,5),g("change",function(i){p(e);let c=u();return d(c.onTermsFileSelected(i))}),n(),r(92,"button",28),g("click",function(){p(e);let i=v(91);return d(i.click())}),r(93,"mat-icon"),o(94,"cloud_upload"),n(),o(95),n(),x(96,Ce,2,0,"p",36)(97,Ie,2,1,"p",36),n(),r(98,"mat-card-actions",38)(99,"button",39),g("click",function(){p(e);let i=u();return d(i.onDiscardChanges())}),o(100," Descartar cambios "),n(),r(101,"button",40)(102,"mat-icon"),o(103,"save"),n(),o(104),n()()()()()}if(l&2){let e,a=v(74),i=u();s(2),m("formGroup",i.settingsForm),s(9),m("ngIf",(e=i.settingsForm.get("business_name"))==null?null:e.hasError("required")),s(22),m("src",i.logoPreviewUrl,F),s(6),f(" ",i.selectedLogoFile?"Change Logo ("+i.selectedLogoFile.name+")":"Subir nuevo logotipo"," "),s(7),m("src",i.backgroundImagePreviewUrl,F),s(6),f(" ",i.selectedBackgroundImageFile?"Change imagen ("+i.selectedBackgroundImageFile.name+")":"Subir nueva imagen"," "),s(7),m("src",i.ratesImagePreviewUrl,F),s(6),f(" ",i.selectedRatesImageFile?"Change imagen ("+i.selectedRatesImageFile.name+")":"Subir nueva imagen"," "),s(7),m("ngIf",i.currentExcelImportTemplateUrl)("ngIfElse",a),s(8),f(" ",i.selectedExcelImportTemplateFile?"Cambiar archivo ("+i.selectedExcelImportTemplateFile.name+")":"Subir nuevo archivo"," "),s(),m("ngIf",!i.selectedExcelImportTemplateFile),s(),m("ngIf",i.selectedExcelImportTemplateFile),s(5),m("ngIf",i.currentTermsUrl)("ngIfElse",a),s(8),f(" ",i.selectedTermsFile?"Change PDF ("+i.selectedTermsFile.name+")":"Subir nuevo PDF"," "),s(),m("ngIf",!i.selectedTermsFile),s(),m("ngIf",i.selectedTermsFile),s(2),m("disabled",i.isSaving||!i.settingsForm.dirty),s(2),m("disabled",i.isSaving||i.settingsForm.invalid||!i.settingsForm.dirty),s(3),f(" ",i.isSaving?"Guardando...":"Guardar configuracion"," ")}}var ge=class l{fb=C(W);settingsService=C(de);snackBar=C(me);settingsForm;isLoadingInitialData=!0;isSaving=!1;currentLogoUrl=null;selectedLogoFile=null;logoPreviewUrl=null;currentBackgroundImageUrl=null;selectedBackgroundImageFile=null;backgroundImagePreviewUrl=null;currentRatesImageUrl=null;selectedRatesImageFile=null;ratesImagePreviewUrl=null;currentExcelImportTemplateUrl=null;selectedExcelImportTemplateFile=null;currentTermsUrl=null;selectedTermsFile=null;destroy$=new M;ngOnInit(){this.buildForm(pe),this.loadCurrentSettings()}buildForm(t){this.settingsForm=this.fb.group({id:[t.id],business_name:[t.business_name,z.required],address:[t.address],phone_number:[t.phone_number],logo_url:[t.logo_url],terms_conditions_url:[t.terms_conditions_url],background_image_url:[t.background_image_url],rates_image_url:[t.rates_image_url],coverage_map_url:[t.coverage_map_url]}),this.currentLogoUrl=t.logo_url,this.logoPreviewUrl=t.logo_url,this.currentBackgroundImageUrl=t.background_image_url,this.backgroundImagePreviewUrl=t.background_image_url,this.currentRatesImageUrl=t.rates_image_url,this.ratesImagePreviewUrl=t.rates_image_url,this.currentExcelImportTemplateUrl=t.excel_import_template_url,this.currentTermsUrl=t.terms_conditions_url}loadCurrentSettings(){this.isLoadingInitialData=!0,this.settingsService.loadSettings().pipe(h(this.destroy$),S(()=>this.isLoadingInitialData=!1)).subscribe({next:t=>{t.length&&(this.settingsForm.patchValue(y(I({},t),{id:t[0].id,business_name:t[0].business_name,address:t[0].address,phone_number:t[0].phone_number,logo_url:t[0].logo_url,terms_conditions_url:t[0].terms_conditions_url,background_image_url:t[0].background_image_url,rates_image_url:t[0].rates_image_url,coverage_map_url:t[0].coverage_map_url})),this.currentLogoUrl=t[0].logo_url,this.logoPreviewUrl=t[0].logo_url,this.currentBackgroundImageUrl=t[0].background_image_url,this.backgroundImagePreviewUrl=t[0].background_image_url,this.currentRatesImageUrl=t[0].rates_image_url,this.ratesImagePreviewUrl=t[0].rates_image_url,this.currentExcelImportTemplateUrl=t[0].excel_import_template_url,this.currentTermsUrl=t[0].terms_conditions_url)},error:t=>{this.snackBar.open("No se pudo cargar la configuraci\xF3n actual. Int\xE9ntalo de nuevo.","Close",{duration:5e3,panelClass:["error-snackbar"],verticalPosition:"top"})}})}onLogoFileSelected(t){let a=t.target.files;if(a&&a.length>0){this.selectedLogoFile=a[0];let i=new FileReader;i.onload=c=>{this.logoPreviewUrl=c.target.result},i.readAsDataURL(this.selectedLogoFile),this.settingsForm.get("logo_url")?.markAsDirty()}else this.selectedLogoFile=null,this.logoPreviewUrl=this.currentLogoUrl}onLogoFileSelected3(t){let a=t.target.files;if(a&&a.length>0){this.selectedBackgroundImageFile=a[0];let i=new FileReader;i.onload=c=>{this.backgroundImagePreviewUrl=c.target.result},i.readAsDataURL(this.selectedBackgroundImageFile),this.settingsForm.get("background_image_url")?.markAsDirty()}else this.selectedBackgroundImageFile=null,this.backgroundImagePreviewUrl=this.currentBackgroundImageUrl}onLogoFileSelected4(t){let a=t.target.files;if(a&&a.length>0){this.selectedRatesImageFile=a[0];let i=new FileReader;i.onload=c=>{this.ratesImagePreviewUrl=c.target.result},i.readAsDataURL(this.selectedRatesImageFile),this.settingsForm.get("rates_image_url")?.markAsDirty()}else this.selectedRatesImageFile=null,this.ratesImagePreviewUrl=this.currentRatesImageUrl}onLogoFileSelected5(t){let a=t.target.files;a&&a.length>0?(this.selectedExcelImportTemplateFile=a[0],this.settingsForm.get("terms_conditions_url")?.markAsDirty()):this.selectedExcelImportTemplateFile=null}onTermsFileSelected(t){let a=t.target.files;a&&a.length>0?(this.selectedTermsFile=a[0],this.settingsForm.get("terms_conditions_url")?.markAsDirty(),console.log("Terms PDF selected:",this.selectedTermsFile.name)):this.selectedTermsFile=null}onSaveSettings(){return T(this,null,function*(){if(this.settingsForm.invalid){this.snackBar.open("Por favor corrija cualquier error en el formulario.","Close",{duration:3e3,panelClass:["error-snackbar"]}),this.settingsForm.markAllAsTouched();return}this.isSaving=!0;let t=I({},this.settingsForm.value);if(this.selectedLogoFile)try{let e=yield this.settingsService.uploadFile(this.selectedLogoFile).pipe(b(),h(this.destroy$)).toPromise();if(e?.file_url)t.logo_url=e.file_url;else throw new Error("Logo URL not returned from upload.")}catch(e){console.error("Logo upload failed:",e),this.snackBar.open("Error al cargar el logotipo. No se guardaron los ajustes.","Close",{duration:4e3,panelClass:["error-snackbar"],verticalPosition:"top"}),this.isSaving=!1;return}if(this.selectedBackgroundImageFile)try{let e=yield this.settingsService.uploadFile(this.selectedBackgroundImageFile).pipe(b(),h(this.destroy$)).toPromise();if(e?.file_url)t.background_image_url=e.file_url;else throw new Error("Logo URL not returned from upload.")}catch(e){console.error("Logo upload failed:",e),this.snackBar.open("Error al cargar el logotipo. No se guardaron los ajustes.","Close",{duration:4e3,panelClass:["error-snackbar"],verticalPosition:"top"}),this.isSaving=!1;return}if(this.selectedRatesImageFile)try{let e=yield this.settingsService.uploadFile(this.selectedRatesImageFile).pipe(b(),h(this.destroy$)).toPromise();if(e?.file_url)t.rates_image_url=e.file_url;else throw new Error("Logo URL not returned from upload.")}catch(e){console.error("Logo upload failed:",e),this.snackBar.open("Error al cargar el logotipo. No se guardaron los ajustes.","Close",{duration:4e3,panelClass:["error-snackbar"],verticalPosition:"top"}),this.isSaving=!1;return}if(this.selectedExcelImportTemplateFile)try{let e=yield this.settingsService.uploadFile(this.selectedExcelImportTemplateFile).pipe(b(),h(this.destroy$)).toPromise();if(e?.file_url)t.excel_import_template_url=e.file_url;else throw new Error("Logo URL not returned from upload.")}catch(e){console.error("Logo upload failed:",e),this.snackBar.open("Error al cargar el logotipo. No se guardaron los ajustes.","Close",{duration:4e3,panelClass:["error-snackbar"],verticalPosition:"top"}),this.isSaving=!1;return}if(this.selectedTermsFile)try{let e=yield this.settingsService.uploadFile(this.selectedTermsFile).pipe(b(),h(this.destroy$)).toPromise();if(e?.file_url)t.terms_conditions_url=e.file_url;else throw new Error("Terms & Conditions URL not returned from PDF upload.")}catch(e){console.error("Terms PDF upload failed:",e),this.snackBar.open("Terms & Conditions PDF upload failed. Settings not saved.","Close",{duration:4e3,panelClass:["error-snackbar"],verticalPosition:"top"}),this.isSaving=!1;return}this.settingsService.saveSettings(t).pipe(h(this.destroy$),S(()=>this.isSaving=!1)).subscribe({next:e=>{this.snackBar.open("\xA1Configuraci\xF3n guardada exitosamente!","OK",{duration:3e3,verticalPosition:"top",panelClass:["success-snackbar"]}),this.settingsForm.patchValue(e),this.settingsForm.markAsPristine(),this.currentLogoUrl=e.logo_url,this.logoPreviewUrl=e.logo_url,this.selectedLogoFile=null,this.currentBackgroundImageUrl=e.background_image_url,this.backgroundImagePreviewUrl=e.background_image_url,this.selectedBackgroundImageFile=null,this.currentRatesImageUrl=e.rates_image_url,this.ratesImagePreviewUrl=e.rates_image_url,this.selectedRatesImageFile=null,this.currentExcelImportTemplateUrl=e.excel_import_template_url,this.selectedExcelImportTemplateFile=null,this.currentTermsUrl=e.terms_conditions_url,this.selectedTermsFile=null},error:e=>{this.snackBar.open("No se pudo guardar la configuraci\xF3n. Int\xE9ntalo de nuevo.","Retry",{duration:5e3,verticalPosition:"top",panelClass:["error-snackbar"]})}})})}onDiscardChanges(){this.loadCurrentSettings(),this.selectedLogoFile=null,this.selectedTermsFile=null,this.settingsForm.markAsPristine(),this.snackBar.open("Changes discarded.","OK",{duration:2e3,verticalPosition:"top"})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(e){return new(e||l)};static \u0275cmp=U({type:l,selectors:[["app-settings-page"]],decls:6,vars:2,consts:[["logoUploadInput",""],["logoUploadInput3",""],["logoUploadInput4",""],["noTermsFile",""],["termsUploadInput2",""],["termsUploadInput",""],[1,"page-container","settings-container"],[1,"page-header"],["class","spinner-overlay",4,"ngIf"],["class","settings-card",4,"ngIf"],[1,"spinner-overlay"],["mode","indeterminate","diameter","60"],[1,"settings-card"],[3,"ngSubmit","formGroup"],["appearance","outline",1,"full-width"],["matInput","","formControlName","business_name","required",""],["matSuffix",""],[4,"ngIf"],["matInput","","formControlName","address"],[1,"form-row"],["appearance","outline",1,"flex-field"],["matInput","","formControlName","phone_number"],["matInput","","formControlName","coverage_map_url"],[1,"logo-section","file-upload-section"],[1,"mat-body-1","section-subtitle"],[1,"logo-preview-container"],["alt","Vista previa del logotipo",1,"logo-preview",3,"src"],["type","file","accept","image/png, image/jpeg, image/svg+xml",2,"display","none",3,"change"],["mat-stroked-button","","type","button",1,"upload-button",3,"click"],[1,"mat-caption","hint"],["alt","Vista previa del imagen de fondo",1,"logo-preview",3,"src"],["alt","Vista previa del imagen de las tarifas",1,"logo-preview",3,"src"],[1,"terms-pdf-section","file-upload-section"],[1,"current-file-info"],[4,"ngIf","ngIfElse"],["type","file",2,"display","none",3,"change"],["class","mat-caption hint",4,"ngIf"],["type","file","accept","application/pdf",2,"display","none",3,"change"],["align","end",1,"form-actions"],["mat-stroked-button","","type","button",3,"click","disabled"],["mat-flat-button","","color","primary","type","submit",3,"disabled"],["target","_blank",1,"file-link",3,"href"],[1,"no-file-text"]],template:function(e,a){e&1&&(r(0,"div",6)(1,"div",7)(2,"h1"),o(3,"Configuraci\xF3n de la aplicaci\xF3n"),n()(),x(4,ue,2,0,"div",8)(5,Se,105,21,"mat-card",9),n()),e&2&&(s(4),m("ngIf",a.isLoadingInitialData),s(),m("ngIf",!a.isLoadingInitialData&&a.settingsForm))},dependencies:[V,O,X,H,j,$,q,Q,J,K,A,R,B,D,ie,te,Y,Z,ee,re,ne,ae,oe,se,le,ce,G,N],styles:[".page-container[_ngcontent-%COMP%]{padding:24px}.settings-container[_ngcontent-%COMP%]{max-width:800px;margin:0 auto}.page-header[_ngcontent-%COMP%]{margin-bottom:24px}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:2em;font-weight:500;color:var(--mat-toolbar-standard-title-text-color, #333)}.spinner-overlay[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;position:fixed;top:0;left:0;width:100%;height:100%;background-color:#ffffffb3;z-index:1000}h2[_ngcontent-%COMP%]{font-size:1.5em;margin-top:24px;margin-bottom:16px;padding-bottom:8px;border-bottom:1px solid rgba(0,0,0,.12);color:var(--mat-card-title-text-color, #333);font-weight:400}h2[_ngcontent-%COMP%]:first-of-type{margin-top:0}.full-width[_ngcontent-%COMP%]{width:100%;margin-bottom:20px}.form-row[_ngcontent-%COMP%]{display:flex;gap:20px;margin-bottom:20px}.form-row[_ngcontent-%COMP%]   .flex-field[_ngcontent-%COMP%]{flex:1}.logo-section[_ngcontent-%COMP%]{margin-bottom:24px;padding:16px;border:1px solid #e0e0e0;border-radius:4px;background-color:#fafafa}.logo-section[_ngcontent-%COMP%]   .mat-body-1[_ngcontent-%COMP%]{font-weight:500;margin-bottom:12px}.logo-preview-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;margin-bottom:16px;min-height:120px}.logo-preview[_ngcontent-%COMP%]{max-width:200px;max-height:100px;object-fit:contain;border:1px solid #ccc;border-radius:4px;background-color:#fff;padding:5px}.hint[_ngcontent-%COMP%]{display:block;text-align:center;color:#757575}.form-actions[_ngcontent-%COMP%]{margin-top:32px;padding-top:24px;border-top:1px solid rgba(0,0,0,.12)}.file-upload-section[_ngcontent-%COMP%]{margin-bottom:24px;padding:16px;border:1px solid #e0e0e0;border-radius:8px;background-color:#f9f9f9}.file-upload-section[_ngcontent-%COMP%]   .section-subtitle[_ngcontent-%COMP%]{font-weight:500;margin-bottom:12px;font-size:1.1em;color:#424242}.logo-preview-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;margin-bottom:16px;min-height:120px;background-color:#f0f0f0;border-radius:4px}.logo-preview[_ngcontent-%COMP%]{max-width:200px;max-height:100px;object-fit:contain;border:1px dashed #ccc;padding:5px}.terms-pdf-section[_ngcontent-%COMP%]   .current-file-info[_ngcontent-%COMP%]{margin-bottom:12px;font-size:.9em}.terms-pdf-section[_ngcontent-%COMP%]   .current-file-info[_ngcontent-%COMP%]   .file-link[_ngcontent-%COMP%]{color:var(--mat-primary-default, #3f51b5);text-decoration:none;font-weight:500}.terms-pdf-section[_ngcontent-%COMP%]   .current-file-info[_ngcontent-%COMP%]   .file-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.terms-pdf-section[_ngcontent-%COMP%]   .current-file-info[_ngcontent-%COMP%]   .no-file-text[_ngcontent-%COMP%]{font-style:italic;color:#757575}.upload-button[_ngcontent-%COMP%]{display:block;margin:0 auto 8px}.hint[_ngcontent-%COMP%]{display:block;text-align:center;color:#757575;font-size:.85em}"]})};export{ge as SettingsPageComponent};
