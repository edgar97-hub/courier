import{a as gr,b as fr}from"./chunk-FXYE65H4.js";import{a as cr}from"./chunk-TICF6Q7F.js";import{a as pr}from"./chunk-JXSQJBTT.js";import{a as sr,b as dr,c as mr}from"./chunk-XC2RTFDJ.js";import"./chunk-GMV5DR2V.js";import{a as Jt,b as ei,c as ti}from"./chunk-H7P4GO3Q.js";import{b as ur,c as _r}from"./chunk-INNR5TUR.js";import{i as Zi}from"./chunk-OMPPSW6K.js";import{a as Ft,b as At,c as Rt,d as Nt}from"./chunk-ZKSEBIMY.js";import"./chunk-GDDGCRCE.js";import{a as Yi,b as Ji,c as er}from"./chunk-MZOTBTYR.js";import"./chunk-F5X5MWHG.js";import{a as zt,b as Ut,c as Gt,d as $t,e as qt,f as jt,g as Ht,h as Wt,i as Qt,j as Kt,k as tr,l as Xt,m as ir,n as Yt,o as or,p as ar}from"./chunk-PM3VLQI7.js";import"./chunk-MS4AQ6UA.js";import{a as rr,b as _t,d as Zt,e as nr}from"./chunk-3W245IEO.js";import{a as He,c as Te}from"./chunk-AJDFE6XY.js";import{a as Ki,b as Xi}from"./chunk-CZEPZVE5.js";import{a as ue,b as _e,c as Vt,e as fe,f as he,g as Ce,h as le}from"./chunk-GXNIZWNA.js";import"./chunk-74KGK7YW.js";import{a as ut}from"./chunk-K72O7MSM.js";import{b as lr}from"./chunk-VQMPHLXF.js";import{a as ft,b as ht,c as Ct,d as vt}from"./chunk-WF66USBX.js";import{c as Lt,d as Bt}from"./chunk-PKHWH5C3.js";import"./chunk-4UMFQSK3.js";import"./chunk-3PSRRXT4.js";import{a as Pe,b as ke}from"./chunk-5PZ25QHJ.js";import{d as Ie}from"./chunk-UAHG2GVE.js";import"./chunk-FR3NO5YB.js";import"./chunk-2JNWSY3M.js";import{a as qe,b as Wi,d as te,e as ie}from"./chunk-6IG52UKJ.js";import{a as je,b as gt}from"./chunk-3IGH7FBX.js";import"./chunk-7RWCIHFI.js";import{A as j,B as ee,C as Tt,D as pt,E as $e,H,I as W,b as Z,d as x,f as $,g as Y,h as qi,j as ze,k as ji,l as Ee,m as Ue,n as mt,o as J,r as oe,t as ct,u as Ge,w as ae,x as Hi,y as q}from"./chunk-2ONXJ7S3.js";import"./chunk-BWBG2IHT.js";import"./chunk-U3COC3EF.js";import{a as Bi,b as zi,d as Ui,g as Gi,i as $i}from"./chunk-K4QNRRQ5.js";import{a as pe,b as ge}from"./chunk-ASKMK2H5.js";import{a as Li}from"./chunk-XRPHOQB2.js";import{a as we,b as A,d as Qi,e as E}from"./chunk-2H2YZZAU.js";import"./chunk-NUMYIFQH.js";import{$ as Ye,$b as Ni,Ac as X,Bb as D,Bc as dt,Cc as Se,Db as _,Ea as N,Eb as v,Ec as S,Gd as re,Hd as T,I as F,J as Ze,Jc as xi,Ka as ye,Kb as Re,Kc as Je,Lb as Ne,Lc as Vi,Mb as Ve,O as hi,Pb as B,Q as De,Qb as a,Rb as w,S as ki,Sb as g,Sc as kt,Ta as Ti,Ub as Ri,Va as l,Vb as Ci,Wb as vi,Xb as bi,Xc as It,Yc as Fe,Za as V,Zb as ot,_b as yt,a as me,aa as bt,b as rt,ba as L,bc as f,c as Si,cb as O,cc as k,da as Oe,dc as I,fc as ce,gc as at,h as nt,ia as wt,ib as c,j as Ei,jc as Pt,l as ne,lb as Fi,m as wi,mb as d,na as b,nb as Ai,rb as P,t as xe,tb as xt,u as U,ub as Ot,uc as lt,va as Ii,vb as o,vc as Le,w as Pi,wa as h,wb as n,wc as G,x as Xe,xa as C,xb as u,yb as y,yc as Be,zb as M,zc as st}from"./chunk-YUSEJVZ2.js";var se=class r{apiUrlOrders=Fe.apiUrl+"/orders";apiUrlDistricts=Fe.apiUrl+"/districts";apiUrlUsers=Fe.apiUrl+"/users";apiUrlSettings=Fe.apiUrl+"/settings";http=b(Vi);authService=b(Li);constructor(){}getAuthHeaders(){let e=this.authService.getAccessToken();return e?new xi({"Content-Type":"application/json",codrr_token:e}):new xi({"Content-Type":"application/json"})}getOrders(e,t=1,i=10,s="id",m="desc"){let p=new Je().set("page_number",t.toString()).set("page_size",i.toString()).set("sort_field",s).set("sort_direction",m);e&&(e.start_date&&(p=p.set("start_date",e.start_date)),e.end_date&&(p=p.set("end_date",e.end_date)),e.status&&(p=p.set("status",e.status)),e.search_term&&e.search_term.trim()!==""&&(p=p.set("search_term",e.search_term.trim())),e.myOrders&&(p=p.set("my_orders","true")));let K=this.getAuthHeaders();return this.authService.getAccessToken()?this.http.get(this.apiUrlOrders,{params:p,headers:K}).pipe(Xe(z=>z),F(this.handleError)):U(()=>new Error("Not authenticated to fetch users."))}getRegisteredOrders(e,t=1,i=10,s="id",m="desc"){let p=new Je().set("page_number",t.toString()).set("page_size",i.toString()).set("sort_field",s).set("sort_direction",m);e&&(e.registration_date_start&&(p=p.set("start_date",e.registration_date_start)),e.registration_date_end&&(p=p.set("end_date",e.registration_date_end)),e.status&&(p=p.set("status",e.status)),e.search_term&&e.search_term.trim()!==""&&(p=p.set("search_term",e.search_term.trim())));let K=this.getAuthHeaders();return this.authService.getAccessToken()?this.http.get(this.apiUrlOrders+"/registered-orders",{params:p,headers:K}).pipe(Xe(z=>z),F(this.handleError)):U(()=>new Error("Not authenticated to fetch users."))}getOrders2(e,t="id",i="desc"){let s=new Je().set("sort_field",t).set("sort_direction",i);e&&(e.start_date&&(s=s.set("start_date",e.start_date)),e.end_date&&(s=s.set("end_date",e.end_date)),e.status&&(s=s.set("status",e.status)),e.search_term&&e.search_term.trim()!==""&&(s=s.set("search_term",e.search_term.trim())));let m=this.getAuthHeaders();return this.authService.getAccessToken()?this.http.get(this.apiUrlOrders+"/filtered-orders",{params:s,headers:m}).pipe(Xe(p=>p.items),F(this.handleError)):U(()=>new Error("Not authenticated to fetch users."))}getOrderStatuses(){return new Ei(e=>{e.next(["REGISTRADO","RECOGIDO","EN ALMACEN","EN TRANSITO","ENTREGADO","CANCELADO","RECHAZADO EN PUNTO","REPROGRAMADO","ANULADO"]),e.complete()})}getDeliveryDistricts(){let e=this.getAuthHeaders();return this.authService.getAccessToken()?this.http.get(`${this.apiUrlDistricts}/all`,{headers:e}).pipe(F(this.handleError)):U(()=>new Error("Not authenticated to fetch users."))}updateOrderStatus(e,t,i,s,m,p){let K=this.getAuthHeaders();if(!this.authService.getAccessToken())return U(()=>new Error("Not authenticated to fetch users."));let z={orderId:e,reason:i,newStatus:t,action:"CAMBIO DE ESTADO"};return s&&(z.product_delivery_photo_url=s),m&&(z.payment_method_for_shipping_cost=m),p&&(z.payment_method_for_collection=p),this.http.post(`${this.apiUrlOrders}/update-order-status`,{payload:z},{headers:K}).pipe(F(this.handleError))}getMaxPackageDimensions(){let e=this.getAuthHeaders();return this.authService.getAccessToken()?this.http.get(`${this.apiUrlSettings}/all`,{headers:e}).pipe(Oe(t=>console.log("OrderService: API response for max dimensions:",t)),Xe(t=>{if(console.log("apiResponse",t),t.length){let i="Est\xE1ndar : "+t[0].standard_measurements_length+"cmx"+t[0].standard_measurements_width+"cmx"+t[0].standard_measurements_height+"cm "+t[0].standard_measurements_weight+"kg",s="Las entregas en motorizado permiten paquetes de hasta "+t[0].maximum_measurements_length+" cm x "+t[0].maximum_measurements_width+" cm x  "+t[0].maximum_measurements_height+" cm y "+t[0].maximum_measurements_weight+" kg. Si se exceden estas medidas o peso, se cobrar\xE1 una tarifa distinta porque la entrega ser\xE1 en una van.";return{max_length_cm:t[0].maximum_measurements_length,max_width_cm:t[0].maximum_measurements_width,max_height_cm:t[0].maximum_measurements_height,max_weight_kg:t[0].maximum_measurements_weight,sta_length_cm:t[0].standard_measurements_length,sta_width_cm:t[0].standard_measurements_width,sta_height_cm:t[0].standard_measurements_height,sta_weight_kg:t[0].standard_measurements_weight,volumetric_factor:t[0].volumetric_factor,standard_package_info:i,info_text:s}}return{max_length_cm:0,max_width_cm:0,max_height_cm:0,max_weight_kg:0,sta_length_cm:0,sta_width_cm:0,sta_height_cm:0,sta_weight_kg:0,volumetric_factor:0,standard_package_info:"",info_text:""}}),F(t=>(console.error("OrderService: API error fetching max package dimensions. Details:",t.message),xe({max_length_cm:30,max_width_cm:25,max_height_cm:45,max_weight_kg:5,standard_package_info:"Est\xE1ndar : 30cmx15cmx20cm 1.5kg",info_text:"Las entregas en motorizado permiten paquetes de hasta 25\u202Fcm x 30\u202Fcm x 45\u202Fcm y 5\u202Fkg. Si se exceden estas medidas o peso, se cobrar\xE1 una tarifa distinta porque la entrega ser\xE1 en una van."}).pipe(hi(200))))):U(()=>new Error("Not authenticated to fetch users."))}calculateShippingCost(e){console.log("packageData",e),console.log("OrderService: Calculating shipping cost (simulated) for",e);let t=8;return e.package_size_type==="custom"&&(t=10,(e.package_weight_kg||0)>2&&(t+=5),((e.package_length_cm||0)>30||(e.package_width_cm||0)>25||(e.package_height_cm||0)>20)&&(t+=4)),e.delivery_district_id==="D003"&&(t+=2),xe({shipping_cost:t}).pipe(hi(500))}createBatchOrders(e){let t=this.getAuthHeaders();return this.authService.getAccessToken()?this.http.post(`${this.apiUrlOrders}/batch-create`,e,{headers:t}).pipe(F(this.handleError)):U(()=>new Error("Not authenticated to fetch users."))}importOrdersFromParsedJson(e){console.log("OrderService: Sending parsed JSON to backend for import",e);let t=this.getAuthHeaders();return this.authService.getAccessToken()?this.http.post(`${this.apiUrlOrders}/import-batch-json`,e,{headers:t}).pipe(F(this.handleImportError)):U(()=>new Error("Not authenticated to fetch users."))}getAvailableDrivers(e){let t=this.getAuthHeaders();if(!this.authService.getAccessToken())return U(()=>new Error("Not authenticated to fetch users."));let i=new Je().set("search_term",e).set("role","MOTORIZADO");return this.http.get(`${this.apiUrlUsers}/filtered`,{params:i,headers:t}).pipe(F(this.handleError))}getCompanies(e){let t=this.getAuthHeaders();if(!this.authService.getAccessToken())return U(()=>new Error("Not authenticated to fetch users."));let i=new Je().set("search_term",e).set("role","EMPRESA");return this.http.get(`${this.apiUrlUsers}/filtered`,{params:i,headers:t}).pipe(F(this.handleError))}getDistricts(e){let t=this.getAuthHeaders();if(!this.authService.getAccessToken())return U(()=>new Error("Not authenticated to fetch users."));let i=new Je().set("search_term",e);return this.http.get(`${this.apiUrlDistricts}/filtered`,{params:i,headers:t}).pipe(F(this.handleError))}assignDriverToOrder(e,t){let i=this.getAuthHeaders();return this.authService.getAccessToken()?this.http.put(`${this.apiUrlOrders}/assign-driver-to-order/`+e,{motorizedId:t},{headers:i}).pipe(F(this.handleError)):U(()=>new Error("Not authenticated to fetch users."))}rescheduleOrder(e,t,i){let s=this.getAuthHeaders();return this.authService.getAccessToken()?this.http.put(`${this.apiUrlOrders}/reschedule-order/`+e,{newDate:t,reason:i},{headers:s}).pipe(F(this.handleError)):U(()=>new Error("Not authenticated to fetch users."))}updateOrderAmountToCollect(e,t,i){let s=this.getAuthHeaders();if(!this.authService.getAccessToken())return U(()=>new Error("Not authenticated to fetch users."));let m={orderId:e,newValue:t,notes:i,action:"MODIFICACI\xD3N DEL MONTO A COBRAR"};return this.http.post(`${this.apiUrlOrders}/update-order-status`,{payload:m},{headers:s}).pipe(F(this.handleError))}updateOrderShippingCost(e,t,i){let s=this.getAuthHeaders();if(!this.authService.getAccessToken())return U(()=>new Error("Not authenticated to fetch users."));let m={orderId:e,newValue:t,notes:i,action:"MODIFICACI\xD3N DEL COSTO DE ENV\xCDO"};return this.http.post(`${this.apiUrlOrders}/update-order-status`,{payload:m},{headers:s}).pipe(F(this.handleError))}handleImportError(e){console.error("API Import Error:",e);let t={success:!1,message:"Error de comunicaci\xF3n con el servidor durante la importaci\xF3n.",errors:[{row:0,message:`Error: ${e.status} - ${e.statusText||"Error desconocido"}`}]};return e.error&&typeof e.error=="object"&&"message"in e.error&&(t=me(me({},t),e.error)),U(()=>t)}handleError(e){let t="An unknown error occurred!";return e.error instanceof ErrorEvent?t=`Error: ${e.error.message}`:(t=`Error Code: ${e.status}
Message: ${e.message||e.error?.message||"Server error"}`,e.status===0&&(t="Could not connect to the server. Please check your network or if the server is running.")),console.error("API Error in OrderService:",e),U(()=>new Error(t))}static \u0275fac=function(t){return new(t||r)};static \u0275prov=wt({token:r,factory:r.\u0275fac,providedIn:"root"})};function xr(r,e){if(r&1&&(o(0,"mat-option",8),a(1),n()),r&2){let t=e.$implicit;d("value",t),l(),g(" ",t," ")}}var ii=class r{filtersChanged=new N;filterForm;orderStatuses$;orderService=b(se);fb=b(ae);datePipe=b(X);destroy$=new ne;constructor(){let e=new Date,t=new Date(e.getFullYear(),e.getMonth(),1),i=new Date(e.getFullYear(),e.getMonth()+1,0);this.filterForm=this.fb.group({registration_date_start:[t],registration_date_end:[i],status:[null],search_term:[""]}),this.orderStatuses$=this.orderService.getOrderStatuses()}ngOnInit(){this.filterForm.valueChanges.pipe(L(this.destroy$),Ze(400),De((e,t)=>JSON.stringify(e)===JSON.stringify(t))).subscribe(()=>{this.applyFilters()})}applyFilters(){let e=this.filterForm.value,t={registration_date_start:e.registration_date_start?this.datePipe.transform(e.registration_date_start,"yyyy-MM-dd"):null,registration_date_end:e.registration_date_end?this.datePipe.transform(e.registration_date_end,"yyyy-MM-dd"):null,status:e.status||null,search_term:e.search_term?.trim()||null};console.log("OrderFiltersComponent: Emitting filters",t),this.filtersChanged.emit(t)}clearFilters(){this.filterForm.reset({registration_date_start:null,registration_date_end:null,status:null,search_term:""})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=O({type:r,selectors:[["app-order-filters"]],outputs:{filtersChanged:"filtersChanged"},features:[ot([Bt(),X])],decls:36,vars:9,consts:[["registrationStartDatePicker",""],["registrationEndDatePicker",""],[1,"filters-container",3,"formGroup"],["appearance","outline"],["matInput","","formControlName","registration_date_start","placeholder","mm/dd/yyyy",3,"matDatepicker"],["matSuffix","",3,"for"],["matInput","","formControlName","registration_date_end","placeholder","mm/dd/yyyy",3,"matDatepicker"],["formControlName","status","placeholder","Seleccione estado..."],[3,"value"],[3,"value",4,"ngFor","ngForOf"],[1,"filter-actions"],["appearance","outline",2,"margin-top","15px"],["matInput","","formControlName","search_term","placeholder","Buscar..."],["mat-flat-button","","type","button",1,"btn-corp-primary",3,"click"],["mat-stroked-button","","type","button",1,"btn-corp-secondary",3,"click"]],template:function(t,i){if(t&1){let s=D();o(0,"form",2)(1,"mat-form-field",3)(2,"mat-label"),a(3,"Fecha de registro inicio"),n(),u(4,"input",4)(5,"mat-datepicker-toggle",5)(6,"mat-datepicker",null,0),n(),o(8,"mat-form-field",3)(9,"mat-label"),a(10,"Fecha de registro fin"),n(),u(11,"input",6)(12,"mat-datepicker-toggle",5)(13,"mat-datepicker",null,1),n(),o(15,"mat-form-field",3)(16,"mat-label"),a(17,"Estado"),n(),o(18,"mat-select",7)(19,"mat-option",8),a(20,"Todos"),n(),c(21,xr,2,2,"mat-option",9),f(22,"async"),n()(),o(23,"div",10)(24,"mat-form-field",11)(25,"mat-label"),a(26,"Buscar"),n(),u(27,"input",12),n(),o(28,"button",13),_("click",function(){return h(s),C(i.applyFilters())}),o(29,"mat-icon"),a(30,"search"),n(),a(31," Buscar "),n(),o(32,"button",14),_("click",function(){return h(s),C(i.clearFilters())}),o(33,"mat-icon"),a(34,"clear_all"),n(),a(35," Limpiar "),n()()()}if(t&2){let s=B(7),m=B(14);d("formGroup",i.filterForm),l(4),d("matDatepicker",s),l(),d("for",s),l(6),d("matDatepicker",m),l(),d("for",m),l(7),d("value",null),l(2),d("ngForOf",k(22,7,i.orderStatuses$))}},dependencies:[S,Le,Be,q,Ee,Z,$,Y,J,oe,W,H,j,$e,ie,te,vt,ft,ht,Ct,Lt,Te,He,Ie,E,A,T,re],styles:[".filters-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:10px;align-items:flex-start;padding:6px;background-color:var(--sys-surface-container-low);border-radius:8px;box-shadow:0 1px 3px #00000014}mat-form-field[_ngcontent-%COMP%]{min-width:200px;flex-grow:1}.filter-actions[_ngcontent-%COMP%]{display:flex;gap:10px;align-items:center!important;justify-content:center!important;min-width:100%}@media (max-width: 768px){.filters-container[_ngcontent-%COMP%]{flex-direction:column}mat-form-field[_ngcontent-%COMP%]{width:100%;min-width:unset}}@media (max-width: 768px) and (max-width: 480px){mat-form-field[_ngcontent-%COMP%]{width:100%}.filter-actions[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch!important}}"]})};var it=(R=>(R.REGISTRADO="REGISTRADO",R.RECOGIDO="RECOGIDO",R.EN_ALMACEN="EN ALMACEN",R.EN_TRANSITO="EN TRANSITO",R.ENTREGADO="ENTREGADO",R.CANCELADO="CANCELADO",R.RECHAZADO="RECHAZADO EN PUNTO",R.ANULADO="ANULADO",R.REPROGRAMADO="REPROGRAMADO",R))(it||{});var Or=["videoPlayer"],yr=["canvasElement"],Cr=()=>({standalone:!0});function Mr(r,e){if(r&1&&(o(0,"mat-option",20),a(1),f(2,"titlecase"),n()),r&2){let t=e.$implicit;d("value",t),l(),g(" ",k(2,2,t)," ")}}function Dr(r,e){r&1&&(o(0,"mat-error"),a(1,"Debe seleccionar un nuevo estado."),n())}function Sr(r,e){r&1&&(o(0,"mat-hint",24),a(1," Es importante detallar el motivo de este estado. "),n())}function Er(r,e){r&1&&(o(0,"mat-error"),a(1," El motivo es obligatorio. "),n())}function wr(r,e){if(r&1){let t=D();o(0,"mat-form-field",21)(1,"mat-label"),a(2,"Motivo / Observaci\xF3n"),n(),o(3,"textarea",22),bi("ngModelChange",function(s){h(t);let m=v();return vi(m.reason,s)||(m.reason=s),C(s)}),n(),c(4,Sr,2,0,"mat-hint",23)(5,Er,2,0,"mat-error",14),n()}if(r&2){let t=v();l(3),Ci("ngModel",t.reason),d("ngModelOptions",yt(4,Cr)),l(),d("ngIf",t.isReasonMandatory(t.selectedStatus)),l(),d("ngIf",t.formSubmitted&&t.isReasonMandatory(t.selectedStatus)&&(!t.reason||t.reason.trim()===""))}}function Pr(r,e){if(r&1){let t=D();o(0,"div",37)(1,"p",42),a(2,"Vista Previa:"),n(),u(3,"img",43),o(4,"button",44),_("click",function(){h(t);let s=v(2);return C(s.removeImage())}),o(5,"mat-icon"),a(6,"delete_forever"),n()()()}if(r&2){let t=v(2);l(3),d("src",t.imagePreviewUrl,Ti)}}function kr(r,e){r&1&&(o(0,"div",38),u(1,"mat-progress-spinner",45),o(2,"span"),a(3,"Subiendo imagen..."),n()())}function Ir(r,e){if(r&1&&(o(0,"mat-option",20),a(1),n()),r&2){let t=e.$implicit;d("value",t),l(),w(t)}}function Tr(r,e){r&1&&(o(0,"mat-error"),a(1,"Seleccione m\xE9todo de pago para costo de env\xEDo."),n())}function Fr(r,e){if(r&1&&(o(0,"mat-option",20),a(1),n()),r&2){let t=e.$implicit;d("value",t),l(),w(t)}}function Ar(r,e){r&1&&(o(0,"mat-error"),a(1,"Seleccione m\xE9todo de pago para el monto a cobrar."),n())}function Rr(r,e){if(r&1){let t=D();o(0,"div",16),u(1,"mat-divider"),o(2,"h4"),a(3,"Prueba de Entrega y Pagos"),n(),o(4,"div",25)(5,"label",26),a(6,"Foto de Prueba de Entrega:"),n(),o(7,"div",27)(8,"button",28),_("click",function(){h(t);let s=v();return C(s.startCamera())}),o(9,"mat-icon"),a(10,"photo_camera"),n(),a(11," Acceder a C\xE1mara "),n(),o(12,"button",29),_("click",function(){h(t);let s=v();return C(s.triggerFileUpload())}),o(13,"mat-icon"),a(14,"attach_file"),n(),a(15," Subir Archivo "),n()(),o(16,"input",30,0),_("change",function(s){h(t);let m=v();return C(m.onFileSelected(s))}),n(),o(18,"div",31),u(19,"video",32,1),o(21,"div",33)(22,"button",34),_("click",function(){h(t);let s=v();return C(s.takePhoto())}),o(23,"mat-icon"),a(24,"camera"),n(),a(25," Tomar Foto "),n(),o(26,"button",35),_("click",function(){h(t);let s=v();return C(s.stopCamera())}),o(27,"mat-icon"),a(28,"videocam_off"),n()()()(),u(29,"canvas",36,2),c(31,Pr,7,1,"div",37)(32,kr,4,0,"div",38),n(),o(33,"mat-form-field",39)(34,"mat-label"),a(35),f(36,"number"),n(),o(37,"mat-select",40),c(38,Ir,2,2,"mat-option",13),n(),c(39,Tr,2,0,"mat-error"),n(),o(40,"mat-form-field",39)(41,"mat-label"),a(42),f(43,"number"),n(),o(44,"mat-select",41),c(45,Fr,2,2,"mat-option",13),n(),c(46,Ar,2,0,"mat-error"),n()()}if(r&2){let t=v();l(8),d("disabled",t.showCamera),l(11),Ai("display",t.showCamera?"block":"none"),l(3),d("disabled",!t.stream),l(9),P(t.imagePreviewUrl?31:-1),l(),P(t.isUploadingImage?32:-1),l(3),g("M\xE9todo Pago Costo Env\xEDo (S/ ",I(36,12,t.data.order.shipping_cost,"1.2-2"),")"),l(3),d("ngForOf",t.paymentMethodsCostoEnvio),l(),P(t.formSubmitted&&(t.scpmCtrl!=null&&t.scpmCtrl.hasError("required"))?39:-1),l(3),g("M\xE9todo Pago Cobro (S/ ",I(43,15,t.data.order.amount_to_collect_at_delivery,"1.2-2"),")"),l(3),d("ngForOf",t.paymentMethods),l(),P(t.formSubmitted&&(t.cpmCtrl!=null&&t.cpmCtrl.hasError("required"))?46:-1)}}var ni=class r{constructor(e,t){this.dialogRef=e;this.data=t;this.deliveryDetailsForm=this.fb.group({shippingCostPaymentMethod:[null],collectionPaymentMethod:[null]})}selectedStatus;reason="";showReasonField=!1;deliveryDetailsForm;videoPlayer;canvasElement;imagePreviewUrl=null;selectedImageFile=null;isUploadingImage=!1;uploadedImageUrl=null;showCamera=!1;stream=null;photoTaken=!1;cameraError=null;formSubmitted=!1;paymentMethods=["Efectivo","Pago directo"];paymentMethodsCostoEnvio=["Efectivo (Pago a COURIER)","Pago directo (Pago a COURIER)","Pago directo (Pago a EMPRESA)"];showDeliveryDetails=!1;OrderStatusEnum=it;fb=b(ae);imageUploadService=b(cr);snackBar=b(je);cdr=b(Pt);destroy$=new ne;ngOnInit(){}startCamera(){return nt(this,null,function*(){this.cameraError=null,this.removeImage();try{navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?(this.stream=yield navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"},audio:!1}),this.videoPlayer&&this.videoPlayer.nativeElement&&(this.videoPlayer.nativeElement.srcObject=this.stream,this.videoPlayer.nativeElement.play().catch(e=>console.error("Error playing video:",alert(e))),this.showCamera=!0,this.photoTaken=!1),this.showCamera=!0,this.photoTaken=!1):(this.cameraError="Tu navegador no soporta el acceso a la c\xE1mara.",this.snackBar.open(this.cameraError,"Cerrar",{duration:5e3}))}catch(e){console.error("Error al acceder a la c\xE1mara:",e),e.name==="NotAllowedError"||e.name==="PermissionDeniedError"?this.cameraError="Permiso de c\xE1mara denegado. Por favor, habilita el acceso en tu navegador.":e.name==="NotFoundError"||e.name==="DevicesNotFoundError"?this.cameraError="No se encontr\xF3 una c\xE1mara compatible.":this.cameraError="Error al iniciar la c\xE1mara. Intenta de nuevo o sube un archivo.",this.snackBar.open(this.cameraError,"Cerrar",{duration:7e3}),this.showCamera=!1}this.cdr.detectChanges()})}takePhoto(){if(!this.stream||!this.videoPlayer||!this.canvasElement)return;let e=this.videoPlayer.nativeElement,t=this.canvasElement.nativeElement,i=t.getContext("2d");i&&(t.width=e.videoWidth,t.height=e.videoHeight,i.drawImage(e,0,0,t.width,t.height),this.imagePreviewUrl=t.toDataURL("image/jpeg"),this.photoTaken=!0,this.selectedImageFile=null,this.uploadedImageUrl=null,this.stopCamera())}stopCamera(){this.stream&&(this.stream.getTracks().forEach(e=>e.stop()),this.stream=null),this.showCamera=!1,this.cdr.detectChanges()}onFileSelected(e){this.stopCamera(),this.photoTaken=!1;let i=e.currentTarget.files;if(i&&i[0]){this.selectedImageFile=i[0];let s=new FileReader;s.onload=m=>{this.imagePreviewUrl=m.target.result,this.uploadedImageUrl=null,this.cdr.detectChanges()},s.readAsDataURL(this.selectedImageFile)}else this.selectedImageFile=null,this.imagePreviewUrl=null}triggerFileUpload(){this.stopCamera(),document.getElementById("proofOfDeliveryImageUpload")?.click()}removeImage(){this.stopCamera(),this.selectedImageFile=null,this.imagePreviewUrl=null,this.uploadedImageUrl=null,this.photoTaken=!1;let e=document.getElementById("proofOfDeliveryImageUpload");e&&(e.value="")}onStatusChange(e){this.selectedStatus=e.value,this.checkIfReasonIsNeeded(this.selectedStatus),this.checkIfDeliveryDetailsNeeded(this.selectedStatus)}checkIfReasonIsNeeded(e){if(!e){this.showReasonField=!1;return}this.showReasonField=this.isReasonMandatory(e)}isReasonMandatory(e){let t=e||this.selectedStatus;return t?["CANCELADO","REPROGRAMADO","RECHAZADO EN PUNTO","ANULADO"].includes(t):!1}checkIfDeliveryDetailsNeeded(e){e==="ENTREGADO"?(this.showDeliveryDetails=!0,this.deliveryDetailsForm.get("shippingCostPaymentMethod")?.setValidators([x.required]),this.deliveryDetailsForm.get("shippingCostPaymentMethod")?.updateValueAndValidity(),this.deliveryDetailsForm.get("collectionPaymentMethod")?.updateValueAndValidity()):(this.showDeliveryDetails=!1,this.deliveryDetailsForm.get("shippingCostPaymentMethod")?.clearValidators(),this.deliveryDetailsForm.get("shippingCostPaymentMethod")?.updateValueAndValidity(),this.deliveryDetailsForm.get("collectionPaymentMethod")?.clearValidators(),this.deliveryDetailsForm.get("collectionPaymentMethod")?.updateValueAndValidity(),this.deliveryDetailsForm.reset(),this.imagePreviewUrl=null,this.selectedImageFile=null,this.uploadedImageUrl=null)}isConfirmDisabled(){return!!(!this.selectedStatus||this.isReasonMandatory(this.selectedStatus)&&(!this.reason||this.reason.trim()==="")||this.selectedStatus==="ENTREGADO"&&(!this.deliveryDetailsForm.valid||!this.imagePreviewUrl))}onConfirm(){return nt(this,null,function*(){if(this.formSubmitted=!0,this.isConfirmDisabled()){this.selectedStatus==="ENTREGADO"&&this.deliveryDetailsForm.markAllAsTouched();return}let e=this.uploadedImageUrl;if(this.selectedStatus==="ENTREGADO"&&(this.photoTaken||this.selectedImageFile)&&!this.uploadedImageUrl){this.isUploadingImage=!0;try{let t=null;if(this.photoTaken&&this.imagePreviewUrl&&typeof this.imagePreviewUrl=="string"?t=yield(yield fetch(this.imagePreviewUrl)).blob():this.selectedImageFile&&(t=this.selectedImageFile),t){let i=t instanceof File?t:new File([t],"proof_of_delivery.jpg",{type:t.type}),s=yield this.imageUploadService.uploadFile(i).toPromise();e=s?.file_url||null,console.log("uploadResponse",s),this.uploadedImageUrl=e}else this.uploadedImageUrl||console.warn("No image data to upload, but proceeding as ENTREGADO without image proof.")}catch(t){console.error("Error uploading/processing image:",t),this.snackBar.open("Error al procesar la imagen de prueba.","Cerrar",{duration:3e3,panelClass:["error-snackbar"]}),this.isUploadingImage=!1;return}finally{this.isUploadingImage=!1}}this.dialogRef.close({newStatus:this.selectedStatus,reason:this.showReasonField&&this.reason?this.reason.trim():void 0,proofOfDeliveryImageUrl:e,shippingCostPaymentMethod:this.showDeliveryDetails?this.deliveryDetailsForm.value.shippingCostPaymentMethod:null,collectionPaymentMethod:this.showDeliveryDetails?this.deliveryDetailsForm.value.collectionPaymentMethod:null})})}onCancel(){this.dialogRef.close()}get scpmCtrl(){return this.deliveryDetailsForm.get("shippingCostPaymentMethod")}get cpmCtrl(){return this.deliveryDetailsForm.get("collectionPaymentMethod")}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}getStatusClass(e){return e?`status-${e.toLowerCase().replace(/[\s_]+/g,"-")}`:"status-desconocido"}static \u0275fac=function(t){return new(t||r)(V(ue),V(_e))};static \u0275cmp=O({type:r,selectors:[["app-change-status-dialog"]],viewQuery:function(t,i){if(t&1&&(Re(Or,5),Re(yr,5)),t&2){let s;Ne(s=Ve())&&(i.videoPlayer=s.first),Ne(s=Ve())&&(i.canvasElement=s.first)}},decls:27,vars:15,consts:[["fileUpload",""],["videoPlayer",""],["canvasElement",""],[1,"dialog-container"],[1,"dialog-header"],["mat-dialog-title",""],[1,"order-code-chip"],[3,"ngSubmit","formGroup"],[1,"dialog-content"],[1,"current-status-container"],[1,"status-badge",3,"ngClass"],["appearance","outline",1,"full-width","select-status-field"],["name","newStatus","required","",3,"ngModelChange","selectionChange","ngModel","ngModelOptions"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["appearance","outline","class","full-width reason-field",4,"ngIf"],[1,"delivery-details-section"],["align","end",1,"dialog-actions"],["mat-stroked-button","","type","button",1,"cancel-button","btn-corp-secondary",3,"click"],["mat-flat-button","","type","submit",1,"confirm-button","btn-corp-primary",3,"disabled"],[3,"value"],["appearance","outline",1,"full-width","reason-field"],["matInput","","name","reason","rows","3","cdkTextareaAutosize","","cdkAutosizeMinRows","2","cdkAutosizeMaxRows","3","placeholder","Describa el motivo del cambio de estado...",3,"ngModelChange","ngModel","ngModelOptions"],["align","start",4,"ngIf"],["align","start"],[1,"image-upload-container"],[1,"image-upload-label"],[2,"display","flex !important","flex-direction","row !important","justify-content","center !important","align-items","center !important","flex-wrap","wrap","gap","15px","width","100% !important","border","0px solid black","margin-bottom","10px"],["mat-flat-button","","type","button",1,"camera-button","btn-corp-primary",3,"click","disabled"],["mat-flat-button","","type","button",1,"upload-button","btn-corp-primary",3,"click"],["type","file","hidden","","id","proofOfDeliveryImageUpload","accept","image/*",3,"change"],[1,"camera-view"],["autoplay","","playsinline","",1,"video-preview"],[2,"display","flex","gap","3","justify-content","center","align-items","center"],["mat-fab","","extended","",1,"take-photo-button","btn-corp-primary",3,"click","disabled"],["mat-icon-button","","matTooltip","Cerrar c\xE1mara",1,"stop-camera-button",3,"click"],[2,"display","none"],[1,"image-preview-wrapper"],[1,"upload-spinner"],["appearance","outline",1,"full-width","payment-method-field"],["formControlName","shippingCostPaymentMethod","name","shippingCostPaymentMethod"],["formControlName","collectionPaymentMethod","name","collectionPaymentMethod"],[1,"preview-label"],["alt","Vista previa de la imagen",1,"image-preview",3,"src"],["mat-icon-button","","type","button","matTooltip","Quitar imagen / Tomar otra",1,"remove-image-button",3,"click"],["mode","indeterminate","diameter","24"]],template:function(t,i){t&1&&(o(0,"div",3)(1,"div",4)(2,"h2",5),a(3,"Cambiar Estado del Pedido"),n(),o(4,"span",6),a(5),n()(),o(6,"form",7),_("ngSubmit",function(){return i.onConfirm()}),o(7,"mat-dialog-content",8)(8,"div",9)(9,"span"),a(10,"Estado Actual:"),n(),o(11,"span",10),a(12),f(13,"titlecase"),n()(),o(14,"mat-form-field",11)(15,"mat-label"),a(16,"Seleccionar Nuevo Estado"),n(),o(17,"mat-select",12),bi("ngModelChange",function(m){return vi(i.selectedStatus,m)||(i.selectedStatus=m),m}),_("selectionChange",function(m){return i.onStatusChange(m)}),c(18,Mr,3,4,"mat-option",13),n(),c(19,Dr,2,0,"mat-error",14),n(),c(20,wr,6,5,"mat-form-field",15)(21,Rr,47,18,"div",16),n(),o(22,"mat-dialog-actions",17)(23,"button",18),_("click",function(){return i.onCancel()}),a(24," Cancelar "),n(),o(25,"button",19),a(26),n()()()()),t&2&&(l(5),g("Pedido N\xB0: ",i.data.order.code||i.data.order.id,""),l(),d("formGroup",i.deliveryDetailsForm),l(5),d("ngClass",i.getStatusClass(i.data.order.status)),l(),g(" ",k(13,12,i.data.order.status)," "),l(5),Ci("ngModel",i.selectedStatus),d("ngModelOptions",yt(14,Cr)),l(),d("ngForOf",i.data.availableStatuses),l(),d("ngIf",i.formSubmitted&&!i.selectedStatus),l(),d("ngIf",i.showReasonField),l(),P(i.showDeliveryDetails?21:-1),l(4),d("disabled",i.isConfirmDisabled()||i.isUploadingImage||i.showCamera&&!i.photoTaken&&!i.imagePreviewUrl),l(),g(" ",i.isUploadingImage?"Subiendo...":"Confirmar Cambio"," "))},dependencies:[S,lt,Le,G,dt,st,Hi,Ee,Z,$,Y,Ge,ji,q,J,oe,le,fe,Ce,he,W,H,j,Tt,ee,Te,He,Ie,ie,te,qe,E,A,we,Qi,Wi,T,re,ge,pe,ke,Pe],styles:[".dialog-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;max-height:80vh}.dialog-header[_ngcontent-%COMP%]{padding:20px 24px 0;border-bottom:1px solid var(--sys-outline-variant);margin-bottom:20px}.dialog-header[_ngcontent-%COMP%]   h2.mat-mdc-dialog-title[_ngcontent-%COMP%]{margin-bottom:4px;font-size:1.5em;font-weight:500;color:var(--sys-on-surface)}.order-code-chip[_ngcontent-%COMP%]{display:inline-block;font-size:.85em;color:var(--sys-on-surface-variant);background-color:var(--sys-surface-container-low);padding:4px 10px;border-radius:16px;margin-bottom:16px;font-family:Consolas,Monaco,monospace}.dialog-content[_ngcontent-%COMP%]{padding:0 24px 20px;overflow-y:auto;flex-grow:1}.current-status-container[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:24px;font-size:1em;color:var(--sys-on-surface-variant)}.current-status-container[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:first-child{margin-right:8px}.status-badge[_ngcontent-%COMP%]{padding:5px 12px;border-radius:16px;font-size:.8rem;font-weight:600;text-transform:uppercase;letter-spacing:.5px;display:inline-flex;align-items:center;line-height:1;color:var(--sys-on-surface)}.status-registrado[_ngcontent-%COMP%]{background-color:var(--status-registrado-bg);color:var(--status-registrado-color)}.status-recogido[_ngcontent-%COMP%]{background-color:var(--status-recogido-bg);color:var(--status-recogido-color)}.status-en-almacen[_ngcontent-%COMP%]{background-color:var(--status-en-almacen-bg);color:var(--status-en-almacen-color)}.status-en-transito[_ngcontent-%COMP%]{background-color:var(--status-en-transito-bg);color:var(--status-en-transito-color)}.status-entregado[_ngcontent-%COMP%]{background-color:var(--status-entregado-bg);color:var(--status-entregado-color)}.status-no-entregado[_ngcontent-%COMP%]{background-color:var(--status-no-entregado-bg);color:var(--status-no-entregado-color)}.status-cancelado[_ngcontent-%COMP%]{background-color:var(--status-cancelado-bg);color:var(--status-cancelado-color)}.status-rechazado-en-punto[_ngcontent-%COMP%]{background-color:var(--status-rechazado-bg);color:var(--status-rechazado-color)}.status-reprogramado[_ngcontent-%COMP%]{background-color:var(--status-reprogramado-bg);color:var(--status-reprogramado-color)}.full-width[_ngcontent-%COMP%]{width:100%}.select-status-field[_ngcontent-%COMP%]{margin-bottom:20px}.reason-field[_ngcontent-%COMP%]{margin-top:10px}.reason-field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{min-height:60px}.dialog-actions[_ngcontent-%COMP%]{padding:16px 24px;gap:10px}.dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-child{margin-left:0}@media (max-width: 480px){.dialog-actions[_ngcontent-%COMP%]{gap:10px;flex-direction:row-reverse}}[_nghost-%COMP%]     .mat-mdc-form-field-subscript-wrapper{min-height:1.25em;height:auto}.delivery-details-section[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;justify-content:center;margin-top:20px;padding-top:20px;border-top:1px solid rgba(0,0,0,.12)}.delivery-details-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:1.1em;font-weight:500;margin-bottom:16px;color:#444}.image-upload-container[_ngcontent-%COMP%]{margin-bottom:10px}.image-upload-container[_ngcontent-%COMP%]   .image-upload-label[_ngcontent-%COMP%]{text-align:center;width:100%;display:block;font-size:.9em;color:#555;margin-bottom:8px;font-weight:500}.image-upload-container[_ngcontent-%COMP%]   .upload-button[_ngcontent-%COMP%]{padding:15px!important}.image-preview-wrapper[_ngcontent-%COMP%]{position:relative;display:inline-block;border:1px solid #ddd;padding:5px;border-radius:4px;background-color:#f9f9f9;margin-top:10px}.image-preview-wrapper[_ngcontent-%COMP%]   .image-preview[_ngcontent-%COMP%]{display:block;max-width:100%;max-height:200px;border-radius:3px}.image-preview-wrapper[_ngcontent-%COMP%]   .remove-image-button[_ngcontent-%COMP%]{position:absolute;top:-10px;right:-10px;background-color:#fffc;line-height:normal;padding:0;width:28px;height:28px}.image-preview-wrapper[_ngcontent-%COMP%]   .remove-image-button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px}.upload-spinner[_ngcontent-%COMP%]{display:flex;align-items:center;font-size:.9em;color:#555;margin-top:10px}.upload-spinner[_ngcontent-%COMP%]   mat-progress-spinner[_ngcontent-%COMP%]{margin-right:8px}.payment-method-field[_ngcontent-%COMP%]{margin-top:16px}.close-button-header[_ngcontent-%COMP%]{min-width:auto;padding:0;line-height:normal;color:#757575}.camera-view[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;gap:5px}.video-preview[_ngcontent-%COMP%]{width:100%;height:300px}"]})};function Nr(r,e){if(r&1&&(o(0,"mat-grid-tile")(1,"div",9)(2,"mat-icon",10),a(3,"account_circle"),n(),o(4,"div")(5,"div",11),a(6,"Usuario Creador"),n(),o(7,"div",12),a(8),f(9,"default"),n()()()()),r&2){let t=v();l(8),g(" ",I(9,1,t.data.order.user==null?null:t.data.order.user.username,"N/A")," ")}}function Vr(r,e){if(r&1&&(o(0,"mat-grid-tile")(1,"div",9)(2,"mat-icon",10),a(3,"account_circle"),n(),o(4,"div")(5,"div",11),a(6,"Motorizado"),n(),o(7,"div",12),a(8),f(9,"default"),n()()()()),r&2){let t=v();l(8),g(" ",I(9,1,t.data.order.assigned_driver==null?null:t.data.order.assigned_driver.username,"N/A")," ")}}function Lr(r,e){if(r&1&&(o(0,"mat-grid-tile")(1,"div",9)(2,"mat-icon",10),a(3,"explore"),n(),o(4,"div")(5,"div",11),a(6,"Coordenadas"),n(),o(7,"div",12),a(8),n()()()()),r&2){let t=v();l(8),g(" ",t.data.order.delivery_coordinates," ")}}function Br(r,e){r&1&&u(0,"mat-divider")}function zr(r,e){if(r&1&&(o(0,"mat-grid-tile")(1,"div",9)(2,"mat-icon",10),a(3,"aspect_ratio"),n(),o(4,"div")(5,"div",11),a(6,"Tama\xF1o Paquete"),n(),o(7,"div",12),a(8),f(9,"titlecase"),n()()()()),r&2){let t=v();l(8),g(" ",k(9,1,t.data.order.package_size_type)," ")}}function Ur(r,e){if(r&1&&(o(0,"mat-grid-tile")(1,"div",9)(2,"mat-icon",10),a(3,"fitness_center"),n(),o(4,"div")(5,"div",11),a(6,"Peso (kg)"),n(),o(7,"div",12),a(8),f(9,"number"),n()()()()),r&2){let t=v();l(8),g(" ",I(9,1,t.data.order.package_weight_kg,"1.1-2")," kg ")}}function Gr(r,e){if(r&1&&(o(0,"mat-grid-tile")(1,"div",9)(2,"mat-icon",10),a(3,"width_normal"),n(),o(4,"div")(5,"div",11),a(6,"Dimensiones (cm)"),n(),o(7,"div",12),a(8),n()()()()),r&2){let t=v();l(8),Ri(" An: ",t.data.order.package_width_cm," x L: ",t.data.order.package_length_cm," x Al: ",t.data.order.package_height_cm," ")}}function $r(r,e){if(r&1&&(o(0,"mat-grid-tile")(1,"div",9)(2,"mat-icon",10),a(3,"credit_card"),n(),o(4,"div")(5,"div",11),a(6,"M\xE9todo de Cobro"),n(),o(7,"div",12),a(8),f(9,"titlecase"),n()()()()),r&2){let t=v();l(8),g(" ",k(9,1,t.data.order.payment_method_for_collection)," ")}}function qr(r,e){if(r&1&&(o(0,"div",24)(1,"div",25)(2,"mat-icon"),a(3,"speaker_notes"),n(),a(4," Observaciones Cliente/Pedido: "),n(),o(5,"p",26),a(6),n()()),r&2){let t=v(2);l(6),w(t.data.order.observations)}}function jr(r,e){r&1&&u(0,"mat-divider")}function Hr(r,e){if(r&1&&(o(0,"div",24)(1,"div",25)(2,"mat-icon"),a(3,"warehouse"),n(),a(4," Tipo de Transferencia a Almac\xE9n: "),n(),o(5,"p",26),a(6),f(7,"titlecase"),n()()),r&2){let t=v(2);l(6),g(" ",k(7,1,t.data.order.type_order_transfer_to_warehouse)," ")}}function Wr(r,e){if(r&1&&(o(0,"mat-card",5)(1,"mat-card-header",6)(2,"mat-card-title"),a(3,"Observaciones y Log\xEDstica"),n()(),o(4,"mat-card-content"),c(5,qr,7,1,"div",23)(6,jr,1,0,"mat-divider",13)(7,Hr,8,3,"div",23),n()()),r&2){let t=v();l(5),d("ngIf",t.data.order.observations),l(),d("ngIf",t.data.order.observations&&t.data.order.type_order_transfer_to_warehouse),l(),d("ngIf",t.data.order.type_order_transfer_to_warehouse)}}var ai=class r{constructor(e,t){this.dialogRef=e;this.data=t;console.log("data",t)}OrderStatusEnum=it;getStatusBadgeClass(e){return e?`status-${e.toString().toLowerCase().replace(/[\s_]+/g,"-")}`:"status-desconocido"}onClose(){this.dialogRef.close()}openMaps(e){e&&window.open(`https://www.google.com/maps/search/?api=1&query=${e}`,"_blank")}callPhone(e){e&&(window.location.href=`tel:${e}`)}printOrder(){console.log("Imprimiendo pedido (simulado):",this.data.order.code),this.dialogRef.close("print")}static \u0275fac=function(t){return new(t||r)(V(ue),V(_e))};static \u0275cmp=O({type:r,selectors:[["app-order-detail-dialog"]],decls:142,vars:66,consts:[["cdkDrag","","cdkDragRootElement",".cdk-overlay-pane","cdkDragHandle",".dialog-header-draggable",1,"dialog-container"],[1,"dialog-header","dialog-header-draggable"],["mat-dialog-title",""],[1,"order-code-chip"],["tabindex","-1",1,"dialog-content"],["appearance","outlined",1,"info-card"],[1,"compact-card-header"],[1,"status-badge-dialog",3,"ngClass"],["cols","2","rowHeight","80px"],[1,"detail-item"],[1,"detail-icon"],[1,"detail-label"],[1,"detail-value"],[4,"ngIf"],["cols","2","rowHeight","90px"],[1,"detail-item",3,"click"],[1,"detail-value","link-like"],[3,"colspan"],[1,"item-description"],[1,"detail-value","bold-value"],["appearance","outlined","class","info-card",4,"ngIf"],["align","end",1,"dialog-actions"],["mat-flat-button","",1,"btn-corp-primary",3,"click"],["class","detail-block",4,"ngIf"],[1,"detail-block"],[1,"detail-label-block"],[1,"detail-value-block"]],template:function(t,i){t&1&&(o(0,"div",0)(1,"div",1)(2,"h2",2),a(3,"Detalles del Pedido"),n(),o(4,"span",3),a(5),n()(),o(6,"mat-dialog-content",4)(7,"mat-card",5)(8,"mat-card-header",6)(9,"mat-card-title"),a(10,"Informaci\xF3n General"),n(),o(11,"span",7),a(12),f(13,"titlecase"),n()(),o(14,"mat-card-content")(15,"mat-grid-list",8)(16,"mat-grid-tile")(17,"div",9)(18,"mat-icon",10),a(19,"local_shipping"),n(),o(20,"div")(21,"div",11),a(22,"Tipo de Env\xEDo"),n(),o(23,"div",12),a(24),f(25,"titlecase"),f(26,"default"),n()()()(),o(27,"mat-grid-tile")(28,"div",9)(29,"mat-icon",10),a(30,"calendar_today"),n(),o(31,"div")(32,"div",11),a(33,"Fecha Registro"),n(),o(34,"div",12),a(35),f(36,"date"),f(37,"default"),n()()()(),o(38,"mat-grid-tile")(39,"div",9)(40,"mat-icon",10),a(41,"event_available"),n(),o(42,"div")(43,"div",11),a(44,"Fecha Entrega Prog."),n(),o(45,"div",12),a(46),f(47,"date"),f(48,"default"),n()()()(),c(49,Nr,10,4,"mat-grid-tile",13)(50,Vr,10,4,"mat-grid-tile",13),n()()(),o(51,"mat-card",5)(52,"mat-card-header",6)(53,"mat-card-title"),a(54,"Destinatario y Entrega"),n()(),o(55,"mat-card-content")(56,"mat-grid-list",14)(57,"mat-grid-tile")(58,"div",9)(59,"mat-icon",10),a(60,"person_pin"),n(),o(61,"div")(62,"div",11),a(63,"Nombre Destinatario"),n(),o(64,"div",12),a(65),f(66,"default"),n()()()(),o(67,"mat-grid-tile")(68,"div",15),_("click",function(){return i.callPhone(i.data.order.recipient_phone)}),o(69,"mat-icon",10),a(70,"phone_iphone"),n(),o(71,"div")(72,"div",11),a(73,"Tel\xE9fono Destinatario"),n(),o(74,"div",16),a(75),n()()()(),o(76,"mat-grid-tile",17)(77,"div",9)(78,"mat-icon",10),a(79,"location_on"),n(),o(80,"div")(81,"div",11),a(82,"Direcci\xF3n de Entrega"),n(),o(83,"div",12),a(84),f(85,"default"),n()()()(),o(86,"mat-grid-tile")(87,"div",9)(88,"mat-icon",10),a(89,"map"),n(),o(90,"div")(91,"div",11),a(92,"Distrito"),n(),o(93,"div",12),a(94),f(95,"titlecase"),f(96,"default"),n()()()(),c(97,Lr,9,1,"mat-grid-tile",13),n()()(),o(98,"mat-card",5)(99,"mat-card-header",6)(100,"mat-card-title"),a(101,"Detalles del Paquete"),n()(),o(102,"mat-card-content")(103,"p",18),a(104),f(105,"default"),n(),c(106,Br,1,0,"mat-divider",13),o(107,"mat-grid-list",8),c(108,zr,10,3,"mat-grid-tile",13)(109,Ur,10,4,"mat-grid-tile",13)(110,Gr,9,3,"mat-grid-tile",13),n()()(),o(111,"mat-card",5)(112,"mat-card-header",6)(113,"mat-card-title"),a(114,"Informaci\xF3n Financiera"),n()(),o(115,"mat-card-content")(116,"mat-grid-list",8)(117,"mat-grid-tile")(118,"div",9)(119,"mat-icon",10),a(120,"payments"),n(),o(121,"div")(122,"div",11),a(123,"Monto a Cobrar Entrega"),n(),o(124,"div",19),a(125),f(126,"currency"),n()()()(),o(127,"mat-grid-tile")(128,"div",9)(129,"mat-icon",10),a(130,"local_atm"),n(),o(131,"div")(132,"div",11),a(133,"Costo de Env\xEDo"),n(),o(134,"div",19),a(135),f(136,"currency"),n()()()(),c(137,$r,10,3,"mat-grid-tile",13),n()()(),c(138,Wr,8,3,"mat-card",20),n(),o(139,"mat-dialog-actions",21)(140,"button",22),_("click",function(){return i.onClose()}),a(141,"Cerrar"),n()()()),t&2&&(l(5),g("N\xB0: ",i.data.order.code||i.data.order.id,""),l(6),d("ngClass",i.getStatusBadgeClass(i.data.order.status)),l(),g(" ",k(13,23,i.data.order.status)," "),l(12),g(" ",I(26,27,k(25,25,i.data.order.shipment_type),"N/A")," "),l(11),g(" ",I(37,33,I(36,30,i.data.order.createdAt,"dd/MM/yy HH:mm"),"N/A")," "),l(11),g(" ",I(48,39,I(47,36,i.data.order.delivery_date,"dd/MM/yyyy"),"No especificada")," "),l(3),d("ngIf",i.data.order.user==null?null:i.data.order.user.username),l(),d("ngIf",i.data.order.assigned_driver==null?null:i.data.order.assigned_driver.username),l(15),g(" ",I(66,42,i.data.order.recipient_name,"N/A")," "),l(10),g(" ",i.data.order.recipient_phone||"N/A"," "),l(),d("colspan",2),l(8),g(" ",I(85,45,i.data.order.delivery_address,"N/A")," "),l(10),g(" ",I(96,50,k(95,48,i.data.order.delivery_district_name),"N/A")," "),l(3),d("ngIf",i.data.order.delivery_coordinates),l(7),g(" ",I(105,53,i.data.order.item_description,"Sin descripci\xF3n del contenido.")," "),l(2),d("ngIf",i.data.order.package_size_type||i.data.order.package_weight_kg),l(2),d("ngIf",i.data.order.package_size_type),l(),d("ngIf",i.data.order.package_weight_kg),l(),d("ngIf",i.data.order.package_width_cm),l(15),g(" ",ce(126,56,i.data.order.amount_to_collect_at_delivery||0,"PEN","S/ ","1.2-2")," "),l(10),g(" ",ce(136,61,i.data.order.shipping_cost||0,"PEN","S/ ","1.2-2")," "),l(2),d("ngIf",i.data.order.payment_method_for_collection),l(),d("ngIf",i.data.order.observations||i.data.order.type_order_transfer_to_warehouse))},dependencies:[S,lt,G,dt,st,Se,X,le,fe,Ce,he,E,A,T,re,ke,Pe,$i,Bi,Ui,Gi,zi,er,Ji,Yi,_t,pr],styles:["[_nghost-%COMP%]{display:block}.dialog-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;max-height:calc(100vh - 80px)}.dialog-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:16px 24px;border-bottom:1px solid #e0e0e0;background-color:#f5f5f5}.dialog-header-draggable[_ngcontent-%COMP%]{cursor:move}h2.mat-mdc-dialog-title[_ngcontent-%COMP%]{margin:0;font-size:1.35em;font-weight:500;color:#455a64}.order-code-chip[_ngcontent-%COMP%]{font-size:.9em;color:#3f51b5;font-weight:500;margin-left:16px;flex-grow:1}.close-button[_ngcontent-%COMP%]{min-width:auto;padding:0;line-height:normal;color:#757575}.dialog-content[_ngcontent-%COMP%]{padding:20px 24px 24px;overflow-y:auto;flex-grow:1;background-color:#fff}.info-card[_ngcontent-%COMP%]{margin-bottom:24px;border:1px solid #eeeeee!important;box-shadow:none!important;border-radius:8px}.info-card[_ngcontent-%COMP%]:last-child{margin-bottom:0}.info-card[_ngcontent-%COMP%]   mat-card-header.compact-card-header[_ngcontent-%COMP%]{padding:12px 16px;display:flex;align-items:center;justify-content:space-between;background-color:#fafafa;border-bottom:1px solid #eeeeee}.info-card[_ngcontent-%COMP%]   mat-card-title[_ngcontent-%COMP%]{font-size:1.1em;font-weight:500;color:#546e7a;margin:0}.info-card[_ngcontent-%COMP%]   .status-badge-dialog[_ngcontent-%COMP%]{padding:4px 10px;border-radius:12px;font-size:.7rem;font-weight:600;text-transform:uppercase;color:#fff;line-height:1.2}.info-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]{padding:16px;font-size:.9rem}mat-grid-list[_ngcontent-%COMP%]{padding:0}@media (max-width: 600px){mat-grid-list[_ngcontent-%COMP%]{cols:1!important}}mat-grid-tile[_ngcontent-%COMP%]     .mat-figure{align-items:flex-start;padding:8px}.detail-item[_ngcontent-%COMP%]{display:flex;align-items:center;width:100%;gap:10px}.detail-item[_ngcontent-%COMP%]   .detail-icon[_ngcontent-%COMP%]{color:#90a4ae;font-size:20px}.detail-item[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:flex;flex-direction:column;line-height:1.4}.interactive-detail-item[_ngcontent-%COMP%]{cursor:pointer}.interactive-detail-item[_ngcontent-%COMP%]:hover   .detail-value[_ngcontent-%COMP%]{color:#3f51b5;text-decoration:underline}.link-like[_ngcontent-%COMP%]{color:#5c6bc0;font-weight:500}.detail-label[_ngcontent-%COMP%]{font-size:.75em;color:#616161;margin-bottom:2px;font-weight:500;text-transform:uppercase;letter-spacing:.5px}.detail-value[_ngcontent-%COMP%]{color:#212121;word-break:break-word}.bold-value[_ngcontent-%COMP%]{font-weight:600;font-size:1.05em}.item-description[_ngcontent-%COMP%]{font-style:italic;color:#555;margin-bottom:12px;padding-bottom:12px;border-bottom:1px dashed #e0e0e0;font-size:.9em}.detail-block[_ngcontent-%COMP%]{margin-bottom:16px}.detail-block[_ngcontent-%COMP%]   .detail-label-block[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-size:.9em;font-weight:500;color:#607d8b;margin-bottom:6px}.detail-block[_ngcontent-%COMP%]   .detail-label-block[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px}.detail-block[_ngcontent-%COMP%]   .detail-value-block[_ngcontent-%COMP%]{font-size:.9em;color:#424242;padding-left:26px;white-space:pre-wrap}.dialog-actions[_ngcontent-%COMP%]{padding:16px 24px;border-top:1px solid #e0e0e0;background-color:#fafafa}.dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-left:8px}.dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-child{margin-left:0}.status-registrado[_ngcontent-%COMP%]{background-color:#6610f2;color:#fff}.status-recogido[_ngcontent-%COMP%]{background-color:#fd7e14;color:#fff}.status-en-almacen[_ngcontent-%COMP%]{background-color:#0d6efd;color:#fff}.status-en-transito[_ngcontent-%COMP%]{background-color:#0c1a77;color:#d0c8c8}.status-entregado[_ngcontent-%COMP%]{background-color:#198754;color:#fff}.status-anulado[_ngcontent-%COMP%]{background-color:#dc3545;color:#fff}.status-cancelado[_ngcontent-%COMP%]{background-color:#6c757d;color:#fff}.status-rechazado-en-punto[_ngcontent-%COMP%]{background-color:#ff6b6b;color:#fff}.status-reprogramado[_ngcontent-%COMP%]{background-color:#adb5bd;color:#212529}.status-desconocido[_ngcontent-%COMP%]{background-color:#9e9e9e;color:#fff}"]})};var Kr=(r,e)=>e.uid;function Xr(r,e){if(r&1&&(o(0,"div",23)(1,"p"),a(2," Actualmente asignado a: "),o(3,"strong"),a(4),n()()()),r&2){let t=e.ngIf;l(4),w(t)}}function Zr(r,e){r&1&&(o(0,"p",24),a(1," Este pedido a\xFAn no tiene un motorizado asignado. "),n())}function Yr(r,e){if(r&1){let t=D();o(0,"button",25),_("click",function(){h(t);let s=v();return C(s.clearSelection())}),o(1,"mat-icon"),a(2,"close"),n()()}}function Jr(r,e){r&1&&(o(0,"mat-icon",26),a(1,"person_search"),n())}function en(r,e){r&1&&u(0,"mat-progress-spinner",27)}function tn(r,e){if(r&1&&(o(0,"mat-option",16)(1,"div",28)(2,"mat-icon",29),a(3,"two_wheeler"),n(),o(4,"span"),a(5),n()()()),r&2){let t=e.$implicit;d("value",t),l(5),w(t.username)}}function rn(r,e){r&1&&(o(0,"mat-option",17),a(1,"No se encontraron motorizados."),n())}function nn(r,e){r&1&&(o(0,"mat-error"),a(1," Debe seleccionar un motorizado. "),n())}function on(r,e){if(r&1&&(o(0,"p",30),a(1," Motorizado seleccionado: "),o(2,"strong"),a(3),n()()),r&2){let t=v();l(3),w(t.selectedDriver.username)}}var li=class r{constructor(e,t){this.dialogRef=e;this.data=t;this.assignDriverForm=this.fb.group({}),this.filteredDrivers$=this.driverSearchCtrl.valueChanges.pipe(Ye(""),Ze(300),De(),bt(i=>(this.isLoadingDrivers=!0,console.log("searchTerm",i),this.orderService.getAvailableDrivers(i||"").pipe(Oe(()=>this.isLoadingDrivers=!1),F(()=>(this.isLoadingDrivers=!1,xe([])))))),L(this.destroy$))}assignDriverForm;drivers$=xe([]);isLoadingDrivers=!1;selectedDriver=null;driverSearchCtrl=new ze("");filteredDrivers$;destroy$=new ne;orderService=b(se);fb=b(ae);ngOnInit(){this.data.currentDriverId&&this.data.order.assigned_driver&&(this.selectedDriver=this.data.order.assigned_driver,this.driverSearchCtrl.setValue(this.data.order.assigned_driver.username||"",{emitEvent:!1}))}displayDriverName(e){return e&&e.name?e.name:""}onDriverSelected(e){this.selectedDriver=e.option.value,console.log("Driver selected:",this.selectedDriver)}onConfirm(){this.selectedDriver?this.dialogRef.close({selectedDriver:this.selectedDriver}):console.warn("No driver selected")}onCancel(){this.dialogRef.close()}clearSelection(){this.selectedDriver=null,this.driverSearchCtrl.setValue("")}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(t){return new(t||r)(V(ue),V(_e))};static \u0275cmp=O({type:r,selectors:[["app-assign-driver-dialog"]],decls:35,vars:19,consts:[["noDriverAssigned",""],["autoDriver","matAutocomplete"],["cdkDrag","","cdkDragRootElement",".cdk-overlay-pane","cdkDragHandle",".dialog-header-draggable",1,"dialog-container"],[1,"dialog-header","dialog-header-draggable"],["mat-dialog-title",""],[1,"order-code-chip"],[1,"dialog-content"],["class","current-assignment",4,"ngIf","ngIfElse"],[1,"content-divider"],["novalidate","",3,"formGroup"],["appearance","outline",1,"full-width","driver-search-field"],["type","text","placeholder","Escriba el nombre del motorizado...","aria-label","Motorizado","matInput","",3,"formControl","matAutocomplete"],["matSuffix","","mat-icon-button","","aria-label","Limpiar",3,"click",4,"ngIf"],["matSuffix","",4,"ngIf"],["matSuffix","","mode","indeterminate","diameter","20",4,"ngIf"],[3,"optionSelected","displayWith"],[3,"value"],["disabled",""],[4,"ngIf"],["class","selected-driver-info",4,"ngIf"],["align","end",1,"dialog-actions"],["mat-stroked-button","",1,"cancel-button","btn-corp-secondary",3,"click"],["mat-flat-button","",1,"confirm-button","btn-corp-primary",3,"click","disabled"],[1,"current-assignment"],[1,"no-driver-message"],["matSuffix","","mat-icon-button","","aria-label","Limpiar",3,"click"],["matSuffix",""],["matSuffix","","mode","indeterminate","diameter","20"],[1,"driver-option"],[1,"driver-option-icon"],[1,"selected-driver-info"]],template:function(t,i){if(t&1){let s=D();o(0,"div",2)(1,"div",3)(2,"h2",4),a(3,"Asignar / Cambiar Motorizado"),n(),o(4,"span",5),a(5),n()(),o(6,"mat-dialog-content",6)(7,"section"),c(8,Xr,5,1,"div",7)(9,Zr,2,0,"ng-template",null,0,at),n(),u(11,"mat-divider",8),o(12,"section")(13,"form",9)(14,"mat-form-field",10)(15,"mat-label"),a(16,"Buscar y Seleccionar Motorizado"),n(),u(17,"input",11),c(18,Yr,3,0,"button",12)(19,Jr,2,0,"mat-icon",13)(20,en,1,0,"mat-progress-spinner",14),o(21,"mat-autocomplete",15,1),_("optionSelected",function(p){return h(s),C(i.onDriverSelected(p))}),xt(23,tn,6,2,"mat-option",16,Kr),f(25,"async"),c(26,rn,2,0,"mat-option",17),f(27,"async"),n(),c(28,nn,2,0,"mat-error",18),n()()(),c(29,on,4,1,"p",19),n(),o(30,"mat-dialog-actions",20)(31,"button",21),_("click",function(){return h(s),C(i.onCancel())}),a(32," Cancelar "),n(),o(33,"button",22),_("click",function(){return h(s),C(i.onConfirm())}),a(34),n()()()}if(t&2){let s,m=B(10),p=B(22);l(5),g("Pedido N\xB0: ",i.data.order.code||i.data.order.id,""),l(3),d("ngIf",i.data.order.assigned_driver==null?null:i.data.order.assigned_driver.username)("ngIfElse",m),l(5),d("formGroup",i.assignDriverForm),l(4),d("formControl",i.driverSearchCtrl)("matAutocomplete",p),l(),d("ngIf",i.driverSearchCtrl.value&&!i.isLoadingDrivers),l(),d("ngIf",!i.driverSearchCtrl.value&&!i.isLoadingDrivers),l(),d("ngIf",i.isLoadingDrivers),l(),d("displayWith",i.displayDriverName),l(2),Ot(k(25,15,i.filteredDrivers$)),l(3),P(((s=k(27,17,i.filteredDrivers$))==null?null:s.length)===0&&!i.isLoadingDrivers&&i.driverSearchCtrl.value?26:-1),l(2),d("ngIf",i.assignDriverForm.hasError("required","driverId")&&i.selectedDriver===null),l(),d("ngIf",i.selectedDriver),l(4),d("disabled",!i.selectedDriver||i.isLoadingDrivers),l(),g(" ",i.data.currentDriverId?"Reasignar":"Asignar"," Motorizado ")}},dependencies:[S,G,Be,q,Ee,Z,$,Y,mt,J,le,fe,Ce,he,W,H,j,ee,$e,Te,Ie,ti,Jt,ei,ie,te,E,A,we,T,re,ge,pe,Zi,Pe],styles:["[_nghost-%COMP%]{display:block}.dialog-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;max-height:95vh;max-width:90%;padding:16px;box-shadow:0 4px 16px #0000001a}.dialog-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:16px 24px;margin-bottom:16px;border-bottom:1px solid var(--app-border-color);background-color:var(--app-background-dialog-header)}.dialog-header-draggable[_ngcontent-%COMP%]{cursor:move}h2.mat-mdc-dialog-title[_ngcontent-%COMP%]{margin:0;font-size:1.3em;font-weight:500;color:var(--app-blue-grey-700)}.order-code-chip[_ngcontent-%COMP%]{font-size:.85em;color:var(--app-indigo-500);font-weight:500;margin-left:12px;flex-grow:1}.close-button[_ngcontent-%COMP%]{min-width:auto;padding:0;line-height:normal;color:var(--app-gray-600)}.dialog-content[_ngcontent-%COMP%]{padding:20px 24px 24px;overflow-y:auto;flex-grow:1}.dialog-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:0;margin-bottom:8px;color:var(--app-text-default);font-size:.95em}.dialog-content[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-weight:500;color:var(--app-text-default)}.current-assignment[_ngcontent-%COMP%]{margin-bottom:16px;padding:10px;background-color:var(--app-blue-50);border-radius:4px;border-left:4px solid var(--app-blue-500)}.no-driver-message[_ngcontent-%COMP%]{font-style:italic;color:var(--app-orange-700);margin-bottom:16px}.content-divider[_ngcontent-%COMP%]{margin:16px 0;border-top-color:var(--app-border-color)}.full-width[_ngcontent-%COMP%]{width:100%}.driver-search-field[_ngcontent-%COMP%]{margin-bottom:8px}.driver-select-container[_ngcontent-%COMP%]{position:relative;min-height:90px}.spinner-container-small[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;padding:10px;color:var(--app-text-secondary);font-size:.9em}.spinner-container-small[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-left:8px}.mat-mdc-autocomplete-panel[_ngcontent-%COMP%]{max-height:250px!important}.driver-option[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}.driver-option[_ngcontent-%COMP%]   .driver-option-icon[_ngcontent-%COMP%]{color:var(--app-blue-grey-400)}.driver-option[_ngcontent-%COMP%]   .driver-status[_ngcontent-%COMP%]{font-size:.8em;font-style:italic;color:var(--app-orange-700);margin-left:auto}.selected-driver-info[_ngcontent-%COMP%]{margin-top:16px;margin-bottom:16px;padding:8px;background-color:var(--app-green-50);border-left:3px solid var(--app-green-500);border-radius:4px;font-size:.9em}.dialog-actions[_ngcontent-%COMP%]{padding:16px 24px;border-top:1px solid var(--app-border-color);background-color:var(--sys-surface-container-low);display:flex;flex-direction:row;justify-content:flex-end;gap:8px}.dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-left:0!important}@media (max-width: 480px){.dialog-actions[_ngcontent-%COMP%]{gap:10px;flex-direction:row-reverse}}.hidden[_ngcontent-%COMP%]{visibility:hidden;height:0;overflow:hidden}"]})};function an(r,e){if(r&1&&(o(0,"strong"),a(1),f(2,"date"),n()),r&2){let t=v();l(),g(" ",I(2,1,t.data.order.delivery_date,"dd/MM/yyyy")," ")}}function ln(r,e){r&1&&(o(0,"span"),a(1,"No programada"),n())}function sn(r,e){r&1&&(o(0,"mat-error"),a(1,"Debe seleccionar una nueva fecha de entrega."),n())}function dn(r,e){r&1&&(o(0,"mat-error"),a(1,"El motivo no debe exceder los 250 caracteres."),n())}var si=class r{constructor(e,t){this.dialogRef=e;this.data=t;this.minDateForReschedule=this.data.minDate||new Date,this.data.minDate||this.minDateForReschedule.setDate(this.minDateForReschedule.getDate()+1),this.rescheduleForm=this.fb.group({newDeliveryDate:[this.data.order.delivery_date?new Date(this.data.order.delivery_date):null,x.required],reason:["",x.maxLength(250)]})}rescheduleForm;minDateForReschedule;formSubmitted=!1;fb=b(ae);ngOnInit(){}get newDeliveryDateCtrl(){return this.rescheduleForm.get("newDeliveryDate")}get reasonCtrl(){return this.rescheduleForm.get("reason")}onConfirm(){this.formSubmitted=!0,this.rescheduleForm.valid?this.dialogRef.close({newDeliveryDate:this.newDeliveryDateCtrl?.value,reason:this.reasonCtrl?.value?.trim()||void 0}):this.rescheduleForm.markAllAsTouched()}onCancel(){this.dialogRef.close()}static \u0275fac=function(t){return new(t||r)(V(ue),V(_e))};static \u0275cmp=O({type:r,selectors:[["app-reschedule-order-dialog"]],features:[ot([])],decls:36,vars:11,consts:[["noCurrentDate",""],["picker",""],["cdkDrag","","cdkDragRootElement",".cdk-overlay-pane","cdkDragHandle",".dialog-header-draggable",1,"dialog-container"],[1,"dialog-header","dialog-header-draggable"],["mat-dialog-title",""],[1,"order-code-chip"],[3,"ngSubmit","formGroup"],[1,"dialog-content"],[4,"ngIf","ngIfElse"],[1,"content-divider"],["appearance","outline",1,"full-width","date-picker-field"],["matInput","","formControlName","newDeliveryDate","placeholder","Seleccione una fecha","readonly","","required","",3,"matDatepicker","min"],["matSuffix","",3,"for"],["appearance","outline",1,"full-width","reason-field"],["matInput","","formControlName","reason","rows","3","cdkTextareaAutosize","","cdkAutosizeMinRows","2","cdkAutosizeMaxRows","5","placeholder","Ej: Cliente solicit\xF3 cambio, Ruta congestionada..."],["align","end",1,"dialog-actions"],["mat-stroked-button","","type","button",1,"cancel-button","btn-corp-secondary",3,"click"],["mat-flat-button","","type","submit",1,"confirm-button","btn-corp-primary",3,"disabled"]],template:function(t,i){if(t&1){let s=D();o(0,"div",2)(1,"div",3)(2,"h2",4),a(3,"Reprogramar Pedido"),n(),o(4,"span",5),a(5),n()(),o(6,"form",6),_("ngSubmit",function(){return h(s),C(i.onConfirm())}),o(7,"mat-dialog-content",7)(8,"p"),a(9," Cliente: "),o(10,"strong"),a(11),n()(),o(12,"p"),a(13," Fecha de Entrega Actual: "),c(14,an,3,4,"strong",8)(15,ln,2,0,"ng-template",null,0,at),n(),u(17,"mat-divider",9),o(18,"mat-form-field",10)(19,"mat-label"),a(20,"Nueva Fecha de Entrega"),n(),u(21,"input",11)(22,"mat-datepicker-toggle",12)(23,"mat-datepicker",null,1),c(25,sn,2,0,"mat-error"),n(),o(26,"mat-form-field",13)(27,"mat-label"),a(28,"Motivo de Reprogramaci\xF3n (Opcional)"),n(),u(29,"textarea",14),c(30,dn,2,0,"mat-error"),n()(),o(31,"mat-dialog-actions",15)(32,"button",16),_("click",function(){return h(s),C(i.onCancel())}),a(33," Cancelar "),n(),o(34,"button",17),a(35," Confirmar Reprogramaci\xF3n "),n()()()()}if(t&2){let s=B(16),m=B(24);l(5),g("Pedido N\xB0: ",i.data.order.code||i.data.order.id,""),l(),d("formGroup",i.rescheduleForm),l(5),w(i.data.order.recipient_name),l(3),d("ngIf",i.data.order.delivery_date)("ngIfElse",s),l(7),d("matDatepicker",m)("min",i.minDateForReschedule),l(),d("for",m),l(3),P(i.newDeliveryDateCtrl!=null&&i.newDeliveryDateCtrl.hasError("required")&&(i.newDeliveryDateCtrl!=null&&i.newDeliveryDateCtrl.touched||i.newDeliveryDateCtrl!=null&&i.newDeliveryDateCtrl.dirty||i.formSubmitted)?25:-1),l(5),P(i.reasonCtrl!=null&&i.reasonCtrl.hasError("maxlength")?30:-1),l(4),d("disabled",i.rescheduleForm.invalid)}},dependencies:[S,G,X,q,Ee,Z,$,Y,Ge,J,oe,le,fe,Ce,he,W,H,j,ee,$e,ie,te,qe,E,A,T,vt,ft,ht,Ct,Lt,ke,Pe],styles:["[_nghost-%COMP%]{display:block}.dialog-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;max-height:85vh;width:480px;max-width:90vw}.dialog-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:16px 24px}.dialog-header-draggable[_ngcontent-%COMP%]{cursor:move}h2.mat-mdc-dialog-title[_ngcontent-%COMP%]{margin:0;font-size:1.3em;font-weight:500}.order-code-chip[_ngcontent-%COMP%]{font-size:.85em;font-weight:500;margin-left:12px;flex-grow:1}.close-button[_ngcontent-%COMP%]{min-width:auto;padding:0;line-height:normal}.dialog-content[_ngcontent-%COMP%]{padding:20px 24px 10px;overflow-y:auto;flex-grow:1}.dialog-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:0;margin-bottom:8px;font-size:.95em}.dialog-content[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-weight:500}.content-divider[_ngcontent-%COMP%]{margin:16px 0 20px}.full-width[_ngcontent-%COMP%]{width:100%}.date-picker-field[_ngcontent-%COMP%]{margin-bottom:20px}.reason-field[_ngcontent-%COMP%]{margin-top:10px}.reason-field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{min-height:50px}.dialog-actions[_ngcontent-%COMP%]{padding:16px 24px;gap:10px}.dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-child{margin-left:0}@media (max-width: 480px){.dialog-actions[_ngcontent-%COMP%]{gap:10px;flex-direction:row-reverse}}"]})};function mn(r,e){r&1&&(o(0,"mat-error"),a(1,"El nuevo costo es obligatorio."),n())}function cn(r,e){r&1&&(o(0,"mat-error"),a(1,"El costo no puede ser negativo."),n())}function pn(r,e){r&1&&(o(0,"mat-error"),a(1,"El motivo es obligatorio."),n())}function gn(r,e){r&1&&(o(0,"mat-error"),a(1,"El motivo debe tener al menos 5 caracteres."),n())}var di=class r{constructor(e,t,i){this.fb=e;this.dialogRef=t;this.data=i}editCostForm;isLoading=!1;ngOnInit(){this.editCostForm=this.fb.group({shipping_cost:[this.data.currentAmount,[x.required,x.min(0)]],observation:["",[x.required,x.minLength(5)]]})}get shippingCostCtrl(){return this.editCostForm.get("shipping_cost")}get observationCtrl(){return this.editCostForm.get("observation")}onConfirm(){this.editCostForm.valid?this.dialogRef.close({newAmount:parseFloat(this.shippingCostCtrl?.value),observation:this.observationCtrl?.value.trim()}):this.editCostForm.markAllAsTouched()}onCancel(){this.dialogRef.close()}static \u0275fac=function(t){return new(t||r)(V(ae),V(ue),V(_e))};static \u0275cmp=O({type:r,selectors:[["app-edit-shipping-cost-dialog"]],decls:31,vars:14,consts:[[1,"dialog-container"],[1,"dialog-header"],["mat-dialog-title",""],[1,"order-code-chip"],[1,"dialog-content",3,"formGroup"],[1,"current-cost-info"],["appearance","outline",1,"full-width"],["matInput","","formControlName","shipping_cost","type","number","min","0","step","0.01","required","","placeholder","0.00"],["matTextPrefix",""],["appearance","outline",1,"full-width","reason-field"],["matInput","","formControlName","observation","rows","2","cdkTextareaAutosize","","cdkAutosizeMinRows","2","cdkAutosizeMaxRows","4","required","","placeholder","Explique brevemente por qu\xE9 se est\xE1 modificando..."],["align","end",1,"dialog-actions"],["mat-stroked-button","",1,"cancel-button","btn-corp-secondary",3,"click"],["mat-flat-button","","color","primary",1,"confirm-button","btn-corp-primary",3,"click","disabled"]],template:function(t,i){t&1&&(o(0,"div",0)(1,"div",1)(2,"h2",2),a(3,"Modificar Monto a Cobrar"),n(),o(4,"span",3),a(5),n()(),o(6,"mat-dialog-content",4)(7,"p",5),a(8," Monto a Cobrar Actual: "),o(9,"strong"),a(10),f(11,"currency"),n()(),o(12,"mat-form-field",6)(13,"mat-label"),a(14,"Nuevo monto a cobrar (S/)"),n(),u(15,"input",7),o(16,"span",8),a(17,"S/"),n(),c(18,mn,2,0,"mat-error")(19,cn,2,0,"mat-error"),n(),o(20,"mat-form-field",9)(21,"mat-label"),a(22,"Motivo del Ajuste"),n(),u(23,"textarea",10),c(24,pn,2,0,"mat-error")(25,gn,2,0,"mat-error"),n()(),o(26,"mat-dialog-actions",11)(27,"button",12),_("click",function(){return i.onCancel()}),a(28," Cancelar "),n(),o(29,"button",13),_("click",function(){return i.onConfirm()}),a(30),n()()()),t&2&&(l(5),g("Pedido N\xB0: ",i.data.orderCode,""),l(),d("formGroup",i.editCostForm),l(4),w(ce(11,9,i.data.currentAmount,"PEN","S/ ","1.2-2")),l(8),P(i.shippingCostCtrl!=null&&i.shippingCostCtrl.hasError("required")&&(i.shippingCostCtrl!=null&&i.shippingCostCtrl.touched)?18:-1),l(),P(i.shippingCostCtrl!=null&&i.shippingCostCtrl.hasError("min")&&(i.shippingCostCtrl!=null&&i.shippingCostCtrl.touched)?19:-1),l(5),P(i.observationCtrl!=null&&i.observationCtrl.hasError("required")&&(i.observationCtrl!=null&&i.observationCtrl.touched)?24:-1),l(),P(i.observationCtrl!=null&&i.observationCtrl.hasError("minlength")&&(i.observationCtrl!=null&&i.observationCtrl.touched)?25:-1),l(4),d("disabled",i.editCostForm.invalid||i.isLoading),l(),g(" ",i.isLoading?"Guardando...":"Guardar Cambios"," "))},dependencies:[S,Se,q,Z,Ue,$,Y,Ge,ct,J,oe,le,fe,Ce,he,W,H,j,ee,pt,ie,te,qe,E,A,T],styles:['.dialog-container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.dialog-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:20px 24px 16px;border-bottom:1px solid #eee;background-color:#f9f9f9}.dialog-header[_ngcontent-%COMP%]   .header-icon[_ngcontent-%COMP%]{color:"";font-size:28px;height:28px;width:28px}.dialog-header[_ngcontent-%COMP%]   h2.mat-mdc-dialog-title[_ngcontent-%COMP%]{margin:0;font-size:1.3em;font-weight:500;color:"";flex-grow:1}.order-code-chip[_ngcontent-%COMP%]{font-size:.85em;color:#555;background-color:#f0f0f0;padding:4px 10px;border-radius:16px}.dialog-content[_ngcontent-%COMP%]{padding:24px;min-width:400px}.current-cost-info[_ngcontent-%COMP%]{margin-bottom:24px;font-size:1em;color:#444;padding:10px;background-color:#eceff1;border-radius:4px}.current-cost-info[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-weight:600;color:#263238}.full-width[_ngcontent-%COMP%]{width:100%}.reason-field[_ngcontent-%COMP%]{margin-top:20px}.reason-field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{min-height:70px}.dialog-actions[_ngcontent-%COMP%]{padding:16px 24px;border-top:1px solid #eee;background-color:#f9f9f9}.dialog-actions[_ngcontent-%COMP%]   .cancel-button[_ngcontent-%COMP%]{margin-right:8px}']})};function un(r,e){r&1&&(o(0,"mat-error"),a(1,"El nuevo costo es obligatorio."),n())}function _n(r,e){r&1&&(o(0,"mat-error"),a(1,"El costo no puede ser negativo."),n())}function fn(r,e){r&1&&(o(0,"mat-error"),a(1,"El motivo es obligatorio."),n())}function hn(r,e){r&1&&(o(0,"mat-error"),a(1,"El motivo debe tener al menos 5 caracteres."),n())}var mi=class r{constructor(e,t,i){this.fb=e;this.dialogRef=t;this.data=i}editCostForm;isLoading=!1;ngOnInit(){this.editCostForm=this.fb.group({shipping_cost:[this.data.currentShippingCost,[x.required,x.min(0)]],observation_shipping_cost_modification:["",[x.required,x.minLength(5)]]})}get shippingCostCtrl(){return this.editCostForm.get("shipping_cost")}get observationCtrl(){return this.editCostForm.get("observation_shipping_cost_modification")}onConfirm(){this.editCostForm.valid?this.dialogRef.close({newShippingCost:parseFloat(this.shippingCostCtrl?.value),observation:this.observationCtrl?.value.trim()}):this.editCostForm.markAllAsTouched()}onCancel(){this.dialogRef.close()}static \u0275fac=function(t){return new(t||r)(V(ae),V(ue),V(_e))};static \u0275cmp=O({type:r,selectors:[["app-edit-shipping-cost-dialog"]],decls:31,vars:14,consts:[[1,"dialog-container"],[1,"dialog-header"],["mat-dialog-title",""],[1,"order-code-chip"],[1,"dialog-content",3,"formGroup"],[1,"current-cost-info"],["appearance","outline",1,"full-width"],["matInput","","formControlName","shipping_cost","type","number","min","0","step","0.01","required","","placeholder","0.00"],["matTextPrefix",""],["appearance","outline",1,"full-width","reason-field"],["matInput","","formControlName","observation_shipping_cost_modification","rows","2","cdkTextareaAutosize","","cdkAutosizeMinRows","2","cdkAutosizeMaxRows","4","required","","placeholder","Explique brevemente por qu\xE9 se est\xE1 modificando el costo..."],["align","end",1,"dialog-actions"],["mat-stroked-button","",1,"cancel-button","btn-corp-secondary",3,"click"],["mat-flat-button","","color","primary",1,"confirm-button","btn-corp-primary",3,"click","disabled"]],template:function(t,i){t&1&&(o(0,"div",0)(1,"div",1)(2,"h2",2),a(3,"Modificar Costo de Env\xEDo"),n(),o(4,"span",3),a(5),n()(),o(6,"mat-dialog-content",4)(7,"p",5),a(8," Costo de Env\xEDo Actual: "),o(9,"strong"),a(10),f(11,"currency"),n()(),o(12,"mat-form-field",6)(13,"mat-label"),a(14,"Nuevo Costo de Env\xEDo (S/)"),n(),u(15,"input",7),o(16,"span",8),a(17,"S/\xA0"),n(),c(18,un,2,0,"mat-error")(19,_n,2,0,"mat-error"),n(),o(20,"mat-form-field",9)(21,"mat-label"),a(22,"Motivo del Ajuste de Costo"),n(),u(23,"textarea",10),c(24,fn,2,0,"mat-error")(25,hn,2,0,"mat-error"),n()(),o(26,"mat-dialog-actions",11)(27,"button",12),_("click",function(){return i.onCancel()}),a(28," Cancelar "),n(),o(29,"button",13),_("click",function(){return i.onConfirm()}),a(30),n()()()),t&2&&(l(5),g("Pedido N\xB0: ",i.data.orderCode,""),l(),d("formGroup",i.editCostForm),l(4),w(ce(11,9,i.data.currentShippingCost,"PEN","S/ ","1.2-2")),l(8),P(i.shippingCostCtrl!=null&&i.shippingCostCtrl.hasError("required")&&(i.shippingCostCtrl!=null&&i.shippingCostCtrl.touched)?18:-1),l(),P(i.shippingCostCtrl!=null&&i.shippingCostCtrl.hasError("min")&&(i.shippingCostCtrl!=null&&i.shippingCostCtrl.touched)?19:-1),l(5),P(i.observationCtrl!=null&&i.observationCtrl.hasError("required")&&(i.observationCtrl!=null&&i.observationCtrl.touched)?24:-1),l(),P(i.observationCtrl!=null&&i.observationCtrl.hasError("minlength")&&(i.observationCtrl!=null&&i.observationCtrl.touched)?25:-1),l(4),d("disabled",i.editCostForm.invalid||i.isLoading),l(),g(" ",i.isLoading?"Guardando...":"Guardar Cambios"," "))},dependencies:[S,Se,q,Z,Ue,$,Y,Ge,ct,J,oe,le,fe,Ce,he,W,H,j,ee,pt,ie,te,qe,E,A,T],styles:['.dialog-container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.dialog-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:20px 24px 16px;border-bottom:1px solid #eee;background-color:#f9f9f9}.dialog-header[_ngcontent-%COMP%]   .header-icon[_ngcontent-%COMP%]{color:"";font-size:28px;height:28px;width:28px}.dialog-header[_ngcontent-%COMP%]   h2.mat-mdc-dialog-title[_ngcontent-%COMP%]{margin:0;font-size:1.3em;font-weight:500;color:"";flex-grow:1}.order-code-chip[_ngcontent-%COMP%]{font-size:.85em;color:#555;background-color:#f0f0f0;padding:4px 10px;border-radius:16px}.dialog-content[_ngcontent-%COMP%]{padding:24px;min-width:400px}.current-cost-info[_ngcontent-%COMP%]{margin-bottom:24px;font-size:1em;color:#444;padding:10px;background-color:#eceff1;border-radius:4px}.current-cost-info[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-weight:600;color:#263238}.full-width[_ngcontent-%COMP%]{width:100%}.reason-field[_ngcontent-%COMP%]{margin-top:20px}.reason-field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{min-height:70px}.dialog-actions[_ngcontent-%COMP%]{padding:16px 24px;border-top:1px solid #eee;background-color:#f9f9f9}.dialog-actions[_ngcontent-%COMP%]   .cancel-button[_ngcontent-%COMP%]{margin-right:8px}']})};var bn=()=>[10,25,50,100],xn=r=>({"highlight-row":!1,"row-cancelled-strikethrough":r});function On(r,e){r&1&&(o(0,"div",47),u(1,"mat-progress-spinner",48),n())}function yn(r,e){r&1&&(o(0,"th",49),a(1," N\xB0 "),n())}function Mn(r,e){if(r&1&&(o(0,"td",50),a(1),n()),r&2){let t=e.$implicit;l(),g(" ",t.code," ")}}function Dn(r,e){r&1&&(o(0,"th",51),a(1," Empresa "),n())}function Sn(r,e){if(r&1&&(o(0,"td",52),a(1),n()),r&2){let t=e.$implicit;l(),g(" ",t.company==null?null:t.company.username," ")}}function En(r,e){r&1&&(o(0,"th",53),a(1," Tipo "),n())}function wn(r,e){if(r&1&&(o(0,"td",54),a(1),n()),r&2){let t=e.$implicit;l(),g(" ",t.shipment_type," ")}}function Pn(r,e){r&1&&(o(0,"th",55),a(1," Destinatario "),n())}function kn(r,e){if(r&1&&(o(0,"td",56),a(1),n()),r&2){let t=e.$implicit;l(),g(" ",t.recipient_name," ")}}function In(r,e){r&1&&(o(0,"th",57),a(1," Tel\xE9fono "),n())}function Tn(r,e){if(r&1&&(o(0,"td",58),a(1),n()),r&2){let t=e.$implicit;l(),g(" ",t.recipient_phone," ")}}function Fn(r,e){r&1&&(o(0,"th",59),a(1," Estado "),n())}function An(r,e){if(r&1&&(o(0,"td",60)(1,"span",61),a(2),n()()),r&2){let t=e.$implicit,i=v();l(),d("ngClass",i.getStatusClass(t.status)),l(),g(" ",t.status," ")}}function Rn(r,e){r&1&&(o(0,"th",62),a(1," Distrito "),n())}function Nn(r,e){r&1&&(o(0,"span",65),a(1,"Express"),n())}function Vn(r,e){if(r&1&&(o(0,"td",63),a(1),c(2,Nn,2,0,"span",64),n()),r&2){let t=e.$implicit;l(),g(" ",t.delivery_district_name," "),l(),d("ngIf",t.isExpress)}}function Ln(r,e){r&1&&(o(0,"th",66),a(1," Direcci\xF3n "),n())}function Bn(r,e){if(r&1&&(o(0,"td",67),a(1),n()),r&2){let t=e.$implicit;l(),g(" ",t.delivery_address," ")}}function zn(r,e){r&1&&(o(0,"th",68),a(1," F. Registro "),n())}function Un(r,e){if(r&1&&(o(0,"td",69),a(1),f(2,"date"),n()),r&2){let t=e.$implicit;l(),g(" ",t.createdAt?I(2,1,t.createdAt,"dd/MM/yy"):"-"," ")}}function Gn(r,e){r&1&&(o(0,"th",70),a(1," Motorizado "),n())}function $n(r,e){if(r&1&&(o(0,"td",71),a(1),n()),r&2){let t=e.$implicit;l(),g(" ",t.assigned_driver==null?null:t.assigned_driver.username," ")}}function qn(r,e){r&1&&(o(0,"th",72),a(1," Cobrar "),n())}function jn(r,e){if(r&1&&(o(0,"td",73),a(1),f(2,"currency"),n()),r&2){let t=e.$implicit;l(),g(" ",ce(2,1,t.amount_to_collect_at_delivery,"PEN","","1.2-2")," ")}}function Hn(r,e){r&1&&(o(0,"th",74),a(1," Tracking "),n())}function Wn(r,e){if(r&1&&(o(0,"td",75),a(1),n()),r&2){let t=e.$implicit;l(),g(" ",t.tracking_code," ")}}function Qn(r,e){r&1&&(o(0,"th",76),a(1," Acciones "),n())}function Kn(r,e){if(r&1){let t=D();o(0,"td",77)(1,"button",78)(2,"mat-icon",79),a(3,"more_vert"),n()(),o(4,"mat-menu",80,0)(6,"button",81),_("click",function(){let s=h(t).$implicit,m=v();return C(m.onViewOrderDetails(s))}),o(7,"mat-icon"),a(8,"visibility"),n(),o(9,"span"),a(10,"Ver Detalles Completos"),n()(),o(11,"button",81),_("click",function(){let s=h(t).$implicit,m=v();return C(m.onViewPdfA4(s))}),o(12,"mat-icon"),a(13,"picture_as_pdf"),n(),o(14,"span"),a(15,"PDF Rotulado"),n()(),o(16,"button",81),_("click",function(){let s=h(t).$implicit,m=v();return C(m.onViewPdfTicket80mm(s))}),o(17,"mat-icon"),a(18,"picture_as_pdf"),n(),o(19,"span"),a(20,"PDF formato ticket"),n()(),o(21,"button",81),_("click",function(){let s=h(t).$implicit,m=v();return C(m.onSeguimiento(s))}),o(22,"mat-icon"),a(23,"timeline"),n(),o(24,"span"),a(25,"Seguimiento"),n()()()()}if(r&2){let t=B(5);l(),d("matMenuTriggerFor",t)}}function Xn(r,e){r&1&&u(0,"tr",82)}function Zn(r,e){if(r&1&&u(0,"tr",83),r&2){let t=e.$implicit,i=v();d("ngClass",Ni(1,xn,t.status===i.OrderStatus.ANULADO))}}function Yn(r,e){if(r&1&&(o(0,"tr",84)(1,"td",85),a(2," No se encontraron pedidos que coincidan con los filtros. "),n()()),r&2){let t=v();l(),Fi("colspan",t.displayedColumns.length)}}var ci=class r{appStore=b(ut);orders=[];isLoading=!1;totalCount=0;pageSize=10;pageIndex=0;pageChanged=new N;sortChanged=new N;statusChanged=new N;motorizedChanged=new N;rescheduleChanged=new N;viewPdfClicked=new N;viewDetailsClicked=new N;amountToCollectChanged=new N;shippingCostChanged=new N;displayedColumns=["code","company","shipment_type","recipient_name","recipient_phone","status","delivery_district_name","delivery_address","createdAt","motorizado","amount_to_collect_at_delivery","tracking_code","actions"];dataSource=new ir;paginator;sort;dialog=b(Vt);snackBar=b(je);OrderStatus=it;constructor(){}ngOnChanges(e){e.orders&&this.orders&&(this.dataSource.data=this.orders)}ngAfterViewInit(){}onViewPdfA4(e){let t=Fe.apiUrl+"/orders/"+e.id+"/pdf-rotulo";window.open(t,"_blank")}onViewPdfA4Landscape(e){let t=Fe.apiUrl+"/orders/"+e.id+"/pdf-a4-landscape";window.open(t,"_blank")}onViewPdfTicket80mm(e){let t=Fe.apiUrl+"/orders/"+e.id+"/pdf-ticket-80mm";window.open(t,"_blank")}onSeguimiento(e){window.open("/tracking?code="+e.tracking_code,"_blank")}changeOrderStatus(e,t){console.log(`Changing status of order ${e.code} to ${t}`),this.statusChanged.emit({orderId:e.id,newStatus:t})}getStatusClass(e){return e?`status-${e.toLowerCase().replace(/[\s_]+/g,"-")}`:"status-desconocido"}openChangeStatusModal(e){let t=this.getAvailableStatuses(e);if(t.length===0){this.snackBar.open("No hay cambios de estado disponibles para este pedido.","OK",{duration:3e3});return}this.dialog.open(ni,{width:"450px",data:{order:e,availableStatuses:t},disableClose:!0}).afterClosed().subscribe(s=>{if(s&&s.newStatus){console.log("Dialog result:",s);let m={newStatus:s.newStatus,reason:s.reason||"",proofOfDeliveryImageUrl:"",shippingCostPaymentMethod:"",collectionPaymentMethod:""};s.newStatus==="ENTREGADO"&&(s.proofOfDeliveryImageUrl&&(m.proofOfDeliveryImageUrl=s.proofOfDeliveryImageUrl),s.shippingCostPaymentMethod&&(m.shippingCostPaymentMethod=s.shippingCostPaymentMethod),s.collectionPaymentMethod&&(m.collectionPaymentMethod=s.collectionPaymentMethod)),console.log("updatePayload",m),this.statusChanged.emit(me({orderId:e.id},m))}else console.log("Cambio de estado cancelado o sin selecci\xF3n.")})}getAvailableStatuses(e){let t=this.appStore.currentUser()?.role,i=["EN ALMACEN"];t==="MOTORIZADO"&&"REGISTRADO"&&(i=[]);let s=[];switch(t==="ADMINISTRADOR"&&(s=["ANULADO"]),e.status,"REGISTRADO",e.status){case"REGISTRADO":return["RECOGIDO",...i,"CANCELADO",...s];case"RECOGIDO":return["EN ALMACEN","CANCELADO",...s];case"EN ALMACEN":return["EN TRANSITO","CANCELADO",...s];case"EN TRANSITO":return["ENTREGADO","CANCELADO","RECHAZADO EN PUNTO","REPROGRAMADO",...s];case"REPROGRAMADO":return["EN TRANSITO","CANCELADO",...s];default:return[]}}onViewOrderDetails(e){this.viewDetailsClicked.emit(e),this.dialog.open(ai,{width:"750px",maxWidth:"90vw",maxHeight:"90vh",data:{order:e},panelClass:"order-detail-dialog-responsive",autoFocus:"dialog"})}onUploadProof(e){console.log("Upload proof for order:",e.code),this.snackBar.open('Funci\xF3n "Subir Prueba" no implementada.',"OK",{duration:2e3})}onReschedule(e){console.log("Reschedule order:",e.code),this.snackBar.open('Funci\xF3n "Reprogramar" no implementada.',"OK",{duration:2e3})}openAssignDriverModal(e){console.log(`Open modal to assign driver for order: ${e.code}`),this.dialog.open(li,{width:"550px",data:{order:e,currentDriverId:e.assigned_driver?.uid},disableClose:!0}).afterClosed().subscribe(i=>{i&&i.selectedDriver?(console.log("Driver selected from dialog:",e.id,i.selectedDriver),this.motorizedChanged.emit({orderId:e.id,motorizedId:i.selectedDriver.id})):console.log("Assign driver cancelled or no driver selected.")})}openRescheduleOrderModal(e){console.log(`Open modal to reschedule order: ${e.code}`);let t=new Date;t.setDate(t.getDate()),this.dialog.open(si,{width:"500px",data:{order:e,minDate:t},disableClose:!0}).afterClosed().subscribe(s=>{s&&s.newDeliveryDate?(console.log("Reschedule details from dialog:",s),this.rescheduleChanged.emit({orderId:e.id,newDate:s.newDeliveryDate,reason:s.reason})):console.log("Reschedule cancelled or no new date selected.")})}isAdminOrDriver(e){let t=this.appStore.currentUser()?.role;return t==="MOTORIZADO"&&(e.status==="REGISTRADO"||e.assigned_driver?.id===this.appStore.currentUser()?.id)||t==="ADMINISTRADOR"||t==="RECEPCIONISTA"}isAdminOrReceptionist(){let e=this.appStore.currentUser()?.role;return e==="ADMINISTRADOR"||e==="RECEPCIONISTA"}openEditAmountToCollectModal(e){if(!e.id){console.error("Order ID or current monto a cabrar is missing for editing.",e),this.snackBar.open("No se puede modificar el monto a cabrar: faltan datos del pedido.","Cerrar",{duration:3e3});return}this.dialog.open(di,{width:"500px",data:{orderCode:e.code,currentAmount:e.amount_to_collect_at_delivery},disableClose:!0}).afterClosed().subscribe(i=>{i?(console.log("Edit Shipping Cost Dialog result:",i),this.amountToCollectChanged.emit({orderId:e.id,newAmount:i.newAmount,observation:i.observation})):console.log("Edici\xF3n de costo de env\xEDo cancelada.")})}openEditShippingCostModal(e){if(!e.id||e.shipping_cost===void 0||e.shipping_cost===null){console.error("Order ID or current shipping cost is missing for editing.",e),this.snackBar.open("No se puede modificar el costo: faltan datos del pedido.","Cerrar",{duration:3e3});return}this.dialog.open(mi,{width:"500px",data:{orderCode:e.code||e.id.toString(),currentShippingCost:e.shipping_cost},disableClose:!0}).afterClosed().subscribe(i=>{i?(console.log("Edit Shipping Cost Dialog result:",i),this.shippingCostChanged.emit({orderId:e.id,newShippingCost:i.newShippingCost,observation:i.observation})):console.log("Edici\xF3n de costo de env\xEDo cancelada.")})}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=O({type:r,selectors:[["app-order-table"]],viewQuery:function(t,i){if(t&1&&(Re(Zt,5),Re(Yt,5)),t&2){let s;Ne(s=Ve())&&(i.paginator=s.first),Ne(s=Ve())&&(i.sort=s.first)}},inputs:{orders:"orders",isLoading:"isLoading",totalCount:"totalCount",pageSize:"pageSize",pageIndex:"pageIndex"},outputs:{pageChanged:"pageChanged",sortChanged:"sortChanged",statusChanged:"statusChanged",motorizedChanged:"motorizedChanged",rescheduleChanged:"rescheduleChanged",viewPdfClicked:"viewPdfClicked",viewDetailsClicked:"viewDetailsClicked",amountToCollectChanged:"amountToCollectChanged",shippingCostChanged:"shippingCostChanged"},features:[Ii],decls:46,vars:10,consts:[["orderActionMenu","matMenu"],[1,"table-wrapper","mat-elevation-z4"],["class","spinner-overlay",4,"ngIf"],["mat-table","","matSort","",1,"orders-table","compact-table-grid",3,"matSortChange","dataSource"],["matColumnDef","code"],["mat-header-cell","","mat-sort-header","","class","compact-table-header column-code",4,"matHeaderCellDef"],["mat-cell","","class","compact-table-cell compact-cell column-code",4,"matCellDef"],["matColumnDef","company"],["mat-header-cell","","mat-sort-header","","class","compact-table-header column-company",4,"matHeaderCellDef"],["mat-cell","","class","compact-table-cell column-company",4,"matCellDef"],["matColumnDef","shipment_type"],["mat-header-cell","","mat-sort-header","","class","compact-table-header column-shipment_type",4,"matHeaderCellDef"],["mat-cell","","class","compact-table-cell compact-cell column-shipment_type",4,"matCellDef"],["matColumnDef","recipient_name"],["mat-header-cell","","mat-sort-header","","class","compact-table-header column-recipient_name",4,"matHeaderCellDef"],["mat-cell","","class","compact-table-cell column-recipient_name",4,"matCellDef"],["matColumnDef","recipient_phone"],["mat-header-cell","","mat-sort-header","","class","compact-table-header column-recipient_phone",4,"matHeaderCellDef"],["mat-cell","","class","compact-table-cell compact-cell column-recipient_phone",4,"matCellDef"],["matColumnDef","status"],["mat-header-cell","","mat-sort-header","","class","compact-table-header status-column-header column-status",4,"matHeaderCellDef"],["mat-cell","","class","compact-table-cell column-status",4,"matCellDef"],["matColumnDef","delivery_district_name"],["mat-header-cell","","mat-sort-header","","class","compact-table-header column-delivery_district_name",4,"matHeaderCellDef"],["mat-cell","","class","compact-table-cell compact-cell column-delivery_district_name",4,"matCellDef"],["matColumnDef","delivery_address"],["mat-header-cell","","mat-sort-header","","class","compact-table-header column-delivery_address",4,"matHeaderCellDef"],["mat-cell","","class","compact-table-cell compact-cell column-delivery_address",4,"matCellDef"],["matColumnDef","createdAt"],["mat-header-cell","","mat-sort-header","","class","compact-table-header column-delivery_date",4,"matHeaderCellDef"],["mat-cell","","class","compact-table-cell compact-cell date-cell column-delivery_date",4,"matCellDef"],["matColumnDef","motorizado"],["mat-header-cell","","mat-sort-header","motorizado","class","compact-table-header column-motorizado",4,"matHeaderCellDef"],["mat-cell","","class","compact-table-cell compact-cell column-motorizado",4,"matCellDef"],["matColumnDef","amount_to_collect_at_delivery"],["mat-header-cell","","mat-sort-header","","class","compact-table-header align-right column-amount_to_collect_at_delivery",4,"matHeaderCellDef"],["mat-cell","","class","compact-table-cell align-right amount-cell compact-cell column-amount_to_collect_at_delivery",4,"matCellDef"],["matColumnDef","tracking_code"],["mat-header-cell","","mat-sort-header","","class","compact-table-header column-tracking_code",4,"matHeaderCellDef"],["mat-cell","","class","compact-table-cell compact-cell column-tracking_code",4,"matCellDef"],["matColumnDef","actions"],["mat-header-cell","","class","compact-table-header actions-column-header column-actions",4,"matHeaderCellDef"],["mat-cell","","class","compact-table-cell actions-cell column-actions",4,"matCellDef"],["mat-header-row","","class","header-row-sticky",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","","class","data-row",3,"ngClass",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["showFirstLastButtons","","aria-label","Seleccione p\xE1gina de pedidos",3,"page","length","pageSize","pageIndex","pageSizeOptions"],[1,"spinner-overlay"],["mode","indeterminate","diameter","60"],["mat-header-cell","","mat-sort-header","",1,"compact-table-header","column-code"],["mat-cell","",1,"compact-table-cell","compact-cell","column-code"],["mat-header-cell","","mat-sort-header","",1,"compact-table-header","column-company"],["mat-cell","",1,"compact-table-cell","column-company"],["mat-header-cell","","mat-sort-header","",1,"compact-table-header","column-shipment_type"],["mat-cell","",1,"compact-table-cell","compact-cell","column-shipment_type"],["mat-header-cell","","mat-sort-header","",1,"compact-table-header","column-recipient_name"],["mat-cell","",1,"compact-table-cell","column-recipient_name"],["mat-header-cell","","mat-sort-header","",1,"compact-table-header","column-recipient_phone"],["mat-cell","",1,"compact-table-cell","compact-cell","column-recipient_phone"],["mat-header-cell","","mat-sort-header","",1,"compact-table-header","status-column-header","column-status"],["mat-cell","",1,"compact-table-cell","column-status"],[1,"status-badge",3,"ngClass"],["mat-header-cell","","mat-sort-header","",1,"compact-table-header","column-delivery_district_name"],["mat-cell","",1,"compact-table-cell","compact-cell","column-delivery_district_name"],["class","express-badge",4,"ngIf"],[1,"express-badge"],["mat-header-cell","","mat-sort-header","",1,"compact-table-header","column-delivery_address"],["mat-cell","",1,"compact-table-cell","compact-cell","column-delivery_address"],["mat-header-cell","","mat-sort-header","",1,"compact-table-header","column-delivery_date"],["mat-cell","",1,"compact-table-cell","compact-cell","date-cell","column-delivery_date"],["mat-header-cell","","mat-sort-header","motorizado",1,"compact-table-header","column-motorizado"],["mat-cell","",1,"compact-table-cell","compact-cell","column-motorizado"],["mat-header-cell","","mat-sort-header","",1,"compact-table-header","align-right","column-amount_to_collect_at_delivery"],["mat-cell","",1,"compact-table-cell","align-right","amount-cell","compact-cell","column-amount_to_collect_at_delivery"],["mat-header-cell","","mat-sort-header","",1,"compact-table-header","column-tracking_code"],["mat-cell","",1,"compact-table-cell","compact-cell","column-tracking_code"],["mat-header-cell","",1,"compact-table-header","actions-column-header","column-actions"],["mat-cell","",1,"compact-table-cell","actions-cell","column-actions"],["mat-icon-button","","aria-label","M\xE1s acciones del pedido",1,"action-icon-neutral","compact-action-button",3,"matMenuTriggerFor"],[1,"compact-icon"],["xPosition","before"],["mat-menu-item","",3,"click"],["mat-header-row","",1,"header-row-sticky"],["mat-row","",1,"data-row",3,"ngClass"],[1,"mat-row"],[1,"no-data-cell"]],template:function(t,i){t&1&&(o(0,"div",1),c(1,On,2,0,"div",2),o(2,"table",3),_("matSortChange",function(m){return i.sortChanged.emit(m)}),y(3,4),c(4,yn,2,0,"th",5)(5,Mn,2,1,"td",6),M(),y(6,7),c(7,Dn,2,0,"th",8)(8,Sn,2,1,"td",9),M(),y(9,10),c(10,En,2,0,"th",11)(11,wn,2,1,"td",12),M(),y(12,13),c(13,Pn,2,0,"th",14)(14,kn,2,1,"td",15),M(),y(15,16),c(16,In,2,0,"th",17)(17,Tn,2,1,"td",18),M(),y(18,19),c(19,Fn,2,0,"th",20)(20,An,3,2,"td",21),M(),y(21,22),c(22,Rn,2,0,"th",23)(23,Vn,3,2,"td",24),M(),y(24,25),c(25,Ln,2,0,"th",26)(26,Bn,2,1,"td",27),M(),y(27,28),c(28,zn,2,0,"th",29)(29,Un,3,4,"td",30),M(),y(30,31),c(31,Gn,2,0,"th",32)(32,$n,2,1,"td",33),M(),y(33,34),c(34,qn,2,0,"th",35)(35,jn,3,6,"td",36),M(),y(36,37),c(37,Hn,2,0,"th",38)(38,Wn,2,1,"td",39),M(),y(39,40),c(40,Qn,2,0,"th",41)(41,Kn,26,1,"td",42),M(),c(42,Xn,1,0,"tr",43)(43,Zn,1,3,"tr",44)(44,Yn,3,1,"tr",45),n(),o(45,"mat-paginator",46),_("page",function(m){return i.pageChanged.emit(m)}),n()()),t&2&&(l(),d("ngIf",i.isLoading),l(),d("dataSource",i.dataSource),l(40),d("matHeaderRowDef",i.displayedColumns)("matHeaderRowDefSticky",!0),l(),d("matRowDefColumns",i.displayedColumns),l(2),d("length",i.totalCount)("pageSize",i.pageSize)("pageIndex",i.pageIndex)("pageSizeOptions",yt(9,bn)))},dependencies:[S,lt,G,Se,X,Xt,zt,Gt,Ht,$t,Ut,Wt,qt,jt,Qt,Kt,tr,nr,Zt,ar,Yt,or,ge,pe,E,we,T,re,_t,Nt,At,Ft,Rt,le,gt,ke],styles:["[_nghost-%COMP%]{display:block}.table-wrapper[_ngcontent-%COMP%]{position:relative;overflow:auto;background-color:var(--sys-surface);color:var(--sys-on-surface);margin-top:20px;box-shadow:0 4px 20px #00000014;transition:box-shadow .3s ease-in-out}.table-wrapper[_ngcontent-%COMP%]:hover{box-shadow:0 6px 25px #0000001f}.spinner-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background-color:rgba(var(--sys-surface),.85);display:flex;justify-content:center;align-items:center;z-index:100;border-radius:12px}.orders-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.compact-table-header[_ngcontent-%COMP%]{font-weight:600;color:var(--sys-on-surface-variant);background-color:var(--sys-surface-container-low);padding:0!important;border-bottom:1px solid var(--sys-outline-variant);text-transform:uppercase;font-size:.65rem;letter-spacing:.2px;white-space:nowrap;line-height:1.1}.compact-table-cell[_ngcontent-%COMP%]{padding:0!important;border-bottom:1px solid var(--sys-outline-variant);color:var(--sys-on-surface-variant);font-size:.75rem;line-height:1.1;border-right:1px solid #f5f5f5}.compact-table-cell[_ngcontent-%COMP%]:last-child{border-right:none}.header-row-sticky[_ngcontent-%COMP%]{position:sticky;top:0;z-index:10;background-color:var(--sys-surface-container-low)}.data-row[_ngcontent-%COMP%]{position:relative;transition:background-color .15s ease-in-out}.data-row[_ngcontent-%COMP%]:hover:not(.row-cancelled-strikethrough){background-color:#f8f9fa}.data-row.row-cancelled-strikethrough[_ngcontent-%COMP%]{color:#9e9e9e;opacity:.75}.data-row.row-cancelled-strikethrough[_ngcontent-%COMP%]:after{position:absolute;left:8px;right:8px;top:50%;height:1.5px;background-color:#d32f2f;transform:translateY(-50%);z-index:1;pointer-events:none}.highlight-row[_ngcontent-%COMP%]{background-color:var(--sys-primary-container)!important;font-weight:500}.actions-column-header[_ngcontent-%COMP%]{text-align:center!important}.actions-cell[_ngcontent-%COMP%]{text-align:center;white-space:nowrap}.actions-cell[_ngcontent-%COMP%]   button.mat-icon-button[_ngcontent-%COMP%]{margin:0 2px;color:var(--sys-on-surface-variant);transition:color .2s ease}.actions-cell[_ngcontent-%COMP%]   button.mat-icon-button[_ngcontent-%COMP%]:hover{color:var(--sys-primary)}.action-icon-delivered[_ngcontent-%COMP%]{color:#4caf50}.action-icon-delivered[_ngcontent-%COMP%]:hover{color:#388e3c}.action-icon-neutral[_ngcontent-%COMP%]{color:var(--sys-on-surface-variant)}.action-icon-neutral[_ngcontent-%COMP%]:hover{color:var(--sys-on-surface)}.compact-action-button[_ngcontent-%COMP%]{transform:scale(.8);margin:0!important}.compact-icon[_ngcontent-%COMP%]{font-size:18px!important;width:18px!important;height:18px!important;line-height:18px!important}.status-badge[_ngcontent-%COMP%]{padding:3px 8px;border-radius:12px;font-size:.65rem;font-weight:600;text-transform:uppercase;letter-spacing:.3px;display:inline-flex;align-items:center;line-height:1;white-space:nowrap}.status-registrado[_ngcontent-%COMP%]{background-color:#6610f2;color:#fff}.status-recogido[_ngcontent-%COMP%]{background-color:#fd7e14;color:#fff}.status-en-almacen[_ngcontent-%COMP%]{background-color:#0d6efd;color:#fff;white-space:nowrap}.status-en-transito[_ngcontent-%COMP%]{background-color:#0c1a77;color:#d0c8c8;white-space:nowrap}.status-entregado[_ngcontent-%COMP%]{background-color:#198754;color:#fff}.status-anulado[_ngcontent-%COMP%]{background-color:#dc3545;color:#fff;white-space:nowrap}.status-cancelado[_ngcontent-%COMP%]{background-color:#6c757d;color:#fff}.status-rechazado-en-punto[_ngcontent-%COMP%]{background-color:#ff6b6b;color:#fff;white-space:nowrap}.status-reprogramado[_ngcontent-%COMP%]{background-color:#adb5bd;color:#212529}.status-desconocido[_ngcontent-%COMP%]{background-color:#9e9e9e;color:#fff}.express-badge[_ngcontent-%COMP%]{background-color:#f97c06;color:#fff;border-radius:6px;margin-left:4px;padding:1px 4px;font-size:.6rem;font-weight:600;display:inline-block;line-height:1}.align-right[_ngcontent-%COMP%]{text-align:right;justify-content:flex-end}.amount-cell[_ngcontent-%COMP%]{font-weight:500}.no-data-cell[_ngcontent-%COMP%]{text-align:center;padding:0;font-style:italic;color:var(--sys-on-surface-variant);font-size:1rem}.truncate-text[_ngcontent-%COMP%]{max-width:120px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:inline-block;vertical-align:middle}.truncate-texts[_ngcontent-%COMP%]{max-width:100px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:inline-block;vertical-align:middle}.code-cell[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#3f51b5;text-decoration:none;font-weight:500}.code-cell[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}.date-cell[_ngcontent-%COMP%]{white-space:nowrap}.compact-table-grid[_ngcontent-%COMP%]{border-collapse:separate;border-spacing:0}.compact-table-grid[_ngcontent-%COMP%]   .compact-table-header[_ngcontent-%COMP%], .compact-table-grid[_ngcontent-%COMP%]   .compact-table-cell[_ngcontent-%COMP%]{border-right:1px solid var(--sys-outline-variant)}.compact-table-grid[_ngcontent-%COMP%]   .compact-table-header[_ngcontent-%COMP%]:last-child, .compact-table-grid[_ngcontent-%COMP%]   .compact-table-cell[_ngcontent-%COMP%]:last-child{border-right:none}.compact-cell[_ngcontent-%COMP%]{padding:0!important;font-size:.75rem!important;line-height:1.1}.orders-table.compact-table-grid[_ngcontent-%COMP%]   .compact-table-header[_ngcontent-%COMP%], .orders-table.compact-table-grid[_ngcontent-%COMP%]   .compact-table-cell[_ngcontent-%COMP%]{min-width:0}.orders-table.compact-table-grid[_ngcontent-%COMP%]   .column-code[_ngcontent-%COMP%]{width:55px}.orders-table.compact-table-grid[_ngcontent-%COMP%]   .column-company[_ngcontent-%COMP%]{width:90px}.orders-table.compact-table-grid[_ngcontent-%COMP%]   .column-recipient_name[_ngcontent-%COMP%]{width:120px!important}.orders-table.compact-table-grid[_ngcontent-%COMP%]   .column-shipment_type[_ngcontent-%COMP%]{width:50px}.orders-table.compact-table-grid[_ngcontent-%COMP%]   .column-status[_ngcontent-%COMP%]{width:70px}.orders-table.compact-table-grid[_ngcontent-%COMP%]   .column-recipient_phone[_ngcontent-%COMP%]{width:85px}.orders-table.compact-table-grid[_ngcontent-%COMP%]   .column-delivery_district_name[_ngcontent-%COMP%]{width:90px}.orders-table.compact-table-grid[_ngcontent-%COMP%]   .column-delivery_address[_ngcontent-%COMP%]{width:150px}.orders-table.compact-table-grid[_ngcontent-%COMP%]   .column-delivery_date[_ngcontent-%COMP%], .orders-table.compact-table-grid[_ngcontent-%COMP%]   .column-motorizado[_ngcontent-%COMP%]{width:90px}.orders-table.compact-table-grid[_ngcontent-%COMP%]   .column-amount_to_collect_at_delivery[_ngcontent-%COMP%]{width:75px}.orders-table.compact-table-grid[_ngcontent-%COMP%]   .column-tracking_code[_ngcontent-%COMP%]{width:110px}.orders-table.compact-table-grid[_ngcontent-%COMP%]   .column-actions[_ngcontent-%COMP%]{width:35px}.mat-mdc-paginator[_ngcontent-%COMP%]{background-color:var(--sys-surface-container-low);border-bottom-left-radius:12px;border-bottom-right-radius:12px;color:var(--sys-on-surface-variant);border-top:1px solid var(--sys-outline-variant);padding:8px 0}@media (max-width: 768px){.compact-table-header[_ngcontent-%COMP%], .compact-table-cell[_ngcontent-%COMP%]{padding:3px 4px;font-size:.6rem}.status-badge[_ngcontent-%COMP%]{padding:2px 4px;font-size:.55rem}.compact-cell[_ngcontent-%COMP%]{padding:3px 4px!important;font-size:.6rem!important}}"]})};var Jn="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-TFG-8",eo=".xlsx",pi=class r{constructor(){}exportAsExcelFile(e,t,i="Sheet1"){if(!e||e.length===0){console.warn("No data provided for Excel export.");return}let s=_r.json_to_sheet(e),m={Sheets:{[i]:s},SheetNames:[i]},p=ur(m,{bookType:"xlsx",type:"array"});this.saveAsExcelFile(p,t)}saveAsExcelFile(e,t){let i=new Blob([e],{type:Jn}),s=window.URL.createObjectURL(i),m=document.createElement("a");m.href=s,m.download=`${t}${eo}`,document.body.appendChild(m),m.click(),document.body.removeChild(m),window.URL.revokeObjectURL(s)}static \u0275fac=function(t){return new(t||r)};static \u0275prov=wt({token:r,factory:r.\u0275fac,providedIn:"root"})};var gi=class r{orderService=b(se);router=b(kt);snackBar=b(je);dialog=b(Vt);excelExportService=b(pi);datePipe=b(X);appStore=b(ut);orders=[];isLoading=!1;totalOrderCount=0;currentPageIndex=0;currentPageSize=10;currentSortField="createdAt";currentSortDirection="desc";showMyOrders=!1;now=new Date;firstDay=new Date(this.now.getFullYear(),this.now.getMonth(),1);lastDay=new Date(this.now.getFullYear(),this.now.getMonth()+1,0);filterCriteriaSubject=new wi({start_date:this.datePipe.transform(this.firstDay,"yyyy-MM-dd"),end_date:this.datePipe.transform(this.lastDay,"yyyy-MM-dd"),status:null});destroy$=new ne;constructor(){}ngOnInit(){this.filterCriteriaSubject.pipe(L(this.destroy$),Oe(()=>this.currentPageIndex=0)).subscribe(e=>{this.fetchOrders()})}isDriver(){return this.appStore.currentUser()?.role==="MOTORIZADO"}onToggleMyOrders(e){this.showMyOrders=e.checked;let t=this.filterCriteriaSubject.value;this.filterCriteriaSubject.next(rt(me({},t),{myOrders:this.showMyOrders}))}getAllFilteredOrdersForExport(){return nt(this,null,function*(){try{let e=this.filterCriteriaSubject.value;return(yield Pi(this.orderService.getOrders2(e,this.currentSortField,this.currentSortDirection).pipe(L(this.destroy$))))||[]}catch(e){return console.error("Error fetching all filtered orders for export:",e),this.snackBar.open("Failed to fetch data for export.","Close",{duration:3e3,panelClass:["error-snackbar"]}),[]}})}exportDataToExcel(){return nt(this,null,function*(){this.isLoading=!0,this.snackBar.open("Preparando la exportaci\xF3n a Excel, esto puede tardar un momento...","",{duration:0});try{let e=yield this.getAllFilteredOrdersForExport();if(e&&e.length>0){let t=e.map(i=>({"TIPO DE ENVIO":i.shipment_type,"NOMBRE DEL DESTINATARIO":i.recipient_name,"TELEFONO DESTINATARIO 9 DIGITOS":i.recipient_phone,DISTRITO:i.delivery_district_name,"DIRECCION DE ENTREGA":i.delivery_address,"FECHA DE REGISTRO":i.createdAt?this.datePipe.transform(i.createdAt,"dd/MM/yyyy"):"N/A","FECHA DE ENTREGA":i.delivery_date,"DETALLE DEL PRODUCTO":i.item_description,"COSTO DE ENVIO":i.shipping_cost,"MONTO A COBRAR":i.amount_to_collect_at_delivery,"FORMA DE PAGO":i.payment_method_for_collection,OBSERVACION:i.observations||""}));this.excelExportService.exportAsExcelFile(t,"Listado_Pedidos_Filtrados","Pedidos"),this.snackBar.dismiss(),this.snackBar.open("\xA1Archivo Excel exportado exitosamente!","OK",{duration:3500,panelClass:["success-snackbar"]})}else this.snackBar.dismiss(),this.snackBar.open("No hay datos disponibles para exportar con los filtros actuales.","OK",{duration:3e3})}catch(e){console.error("Error during Excel export process:",e),this.snackBar.dismiss(),this.snackBar.open("An error occurred during Excel export.","Close",{duration:3e3,panelClass:["error-snackbar"]})}finally{this.isLoading=!1}})}fetchOrders(){this.isLoading=!0;let e=this.filterCriteriaSubject.value,t=me({},e);this.showMyOrders?t.myOrders=!0:delete t.myOrders,this.orderService.getRegisteredOrders(t,this.currentPageIndex+1,this.currentPageSize,this.currentSortField,this.currentSortDirection).pipe(L(this.destroy$),F(i=>(this.snackBar.open(i.message||"Failed to load orders.","Close",{duration:5e3,panelClass:["error-snackbar"]}),this.isLoading=!1,[]))).subscribe(i=>{this.orders=i.items,this.totalOrderCount=i.total_count||0,this.isLoading=!1,console.log("Orders fetched:",i)})}openImportModal(){let e=this.dialog.open(fr,{width:"90%",maxWidth:"700px",autoFocus:!1,disableClose:!0});e.componentInstance.importCompleted.subscribe(t=>{t&&(console.log("Import completed, reloading orders..."),this.fetchOrders())}),e.afterClosed().subscribe(t=>{console.log("The import dialog was closed",t)})}handleStatusChanged(e){this.isLoading=!0,console.log("OrderListPage: Status change requested",e),this.orderService.updateOrderStatus(e.orderId,e.newStatus,e.reason||"",e.proofOfDeliveryImageUrl,e.shippingCostPaymentMethod,e.collectionPaymentMethod).subscribe({next:t=>{this.snackBar.open(`Estado del pedido ${t.code} actualizado a ${e.newStatus}.`,"OK",{duration:3e3,panelClass:["success-snackbar"]}),this.fetchOrders()},error:t=>{this.snackBar.open(`Error al actualizar estado: ${t.message||"Intente de nuevo"}`,"Cerrar",{duration:5e3,panelClass:["error-snackbar"]}),this.isLoading=!1},complete:()=>{this.isLoading=!1}})}handleMotorizedChanged(e){console.log("orderId",e.orderId),console.log("motorizedId",e.motorizedId),this.orderService.assignDriverToOrder(e.orderId,e.motorizedId).subscribe({next:t=>{this.snackBar.open(`Motorizado ${t.assigned_driver?.username} asignado al pedido ${t.code}.`,"OK",{duration:3e3,panelClass:["success-snackbar"]}),this.fetchOrders()},error:t=>{this.snackBar.open(`Error al asignar motorizado: ${t.message||"Intente de nuevo"}`,"Cerrar",{duration:5e3,panelClass:["error-snackbar"]})}})}handleRescheduleChanged(e){let t=new Date(e.newDate).toISOString();this.orderService.rescheduleOrder(e.orderId,t||"",e.reason).subscribe({next:i=>{this.snackBar.open(`Pedido ${i.code} reprogramado para ${this.datePipe.transform(i.delivery_date,"dd/MM/yyyy")}.`,"OK",{duration:3500,panelClass:["success-snackbar"]}),this.fetchOrders()},error:i=>{this.snackBar.open(`Error al reprogramar pedido: ${i.message||"Intente de nuevo"}`,"Cerrar",{duration:5e3,panelClass:["error-snackbar"]})}})}handleAmountToCollectChanged(e){this.isLoading=!0,console.log("OrderListPage: Shipping cost change requested",e),this.orderService.updateOrderAmountToCollect(e.orderId,e.newAmount,e.observation).subscribe({next:t=>{this.snackBar.open(`Monto a cobrar del pedido ${t.code} actualizado.`,"OK",{duration:3e3,panelClass:["success-snackbar"]}),this.fetchOrders()},error:t=>{this.snackBar.open(`Error al actualizar costo: ${t.message||"Intente de nuevo"}`,"Cerrar",{duration:5e3,panelClass:["error-snackbar"]}),this.isLoading=!1},complete:()=>{this.isLoading=!1}})}handleShippingCostChanged(e){this.isLoading=!0,console.log("OrderListPage: Shipping cost change requested",e),this.orderService.updateOrderShippingCost(e.orderId,e.newShippingCost,e.observation).subscribe({next:t=>{this.snackBar.open(`Costo de env\xEDo del pedido ${t.code} actualizado.`,"OK",{duration:3e3,panelClass:["success-snackbar"]}),this.fetchOrders()},error:t=>{this.snackBar.open(`Error al actualizar costo: ${t.message||"Intente de nuevo"}`,"Cerrar",{duration:5e3,panelClass:["error-snackbar"]}),this.isLoading=!1},complete:()=>{this.isLoading=!1}})}onFiltersChanged(e){console.log("OrderListPage: Filters changed",e),this.filterCriteriaSubject.next(e)}onPageChanged(e){console.log("OrderListPage: Page changed",e),this.currentPageIndex=e.pageIndex,this.currentPageSize=e.pageSize,this.fetchOrders()}onSortChanged(e){console.log("OrderListPage: Sort changed",e),this.currentSortField=e.active,this.currentSortDirection=e.direction,this.currentPageIndex=0,this.fetchOrders()}handleMassiveActions(e){console.log("Massive action selected:",e),this.snackBar.open(`Action: ${e} not implemented yet.`,"OK",{duration:3e3})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=O({type:r,selectors:[["app-order-list-page"]],decls:20,vars:6,consts:[["massiveActionsMenu","matMenu"],[1,"page-content-wrapper"],[1,"page-title-bar"],[1,"page-title"],[1,"breadcrumbs"],[3,"filtersChanged"],[1,"table-controls-bar"],[1,"records-info"],[1,"actions-group"],["mat-flat-button","",1,"btn-corp-primary","acciones-masivas",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],[3,"pageChanged","sortChanged","statusChanged","motorizedChanged","rescheduleChanged","amountToCollectChanged","shippingCostChanged","orders","isLoading","totalCount","pageSize","pageIndex"]],template:function(t,i){if(t&1){let s=D();o(0,"div",1)(1,"div",2)(2,"h1",3),a(3,"Pedidos Registrados"),n(),u(4,"div",4),n(),o(5,"app-order-filters",5),_("filtersChanged",function(p){return h(s),C(i.onFiltersChanged(p))}),n(),o(6,"div",6),u(7,"div",7),o(8,"div",8)(9,"button",9),a(10," Acciones Masivas "),o(11,"mat-icon"),a(12,"arrow_drop_down"),n()(),o(13,"mat-menu",null,0)(15,"button",10),_("click",function(){return h(s),C(i.exportDataToExcel())}),a(16," Exportar a Excel "),n(),o(17,"button",10),_("click",function(){return h(s),C(i.openImportModal())}),a(18," Importar desde Excel "),n()()()(),o(19,"app-order-table",11),_("pageChanged",function(p){return h(s),C(i.onPageChanged(p))})("sortChanged",function(p){return h(s),C(i.onSortChanged(p))})("statusChanged",function(p){return h(s),C(i.handleStatusChanged(p))})("motorizedChanged",function(p){return h(s),C(i.handleMotorizedChanged(p))})("rescheduleChanged",function(p){return h(s),C(i.handleRescheduleChanged(p))})("amountToCollectChanged",function(p){return h(s),C(i.handleAmountToCollectChanged(p))})("shippingCostChanged",function(p){return h(s),C(i.handleShippingCostChanged(p))}),n()()}if(t&2){let s=B(14);l(9),d("matMenuTriggerFor",s),l(10),d("orders",i.orders)("isLoading",i.isLoading)("totalCount",i.totalOrderCount)("pageSize",i.currentPageSize)("pageIndex",i.currentPageIndex)}},dependencies:[S,It,ii,ci,gt,E,A,T,re,Nt,At,Ft,Rt,lr],styles:[".page-content-wrapper[_ngcontent-%COMP%]{padding:20px 24px;background-color:var(--sys-surface-container-lowest);color:var(--sys-on-surface);min-height:calc(100vh - 64px)}.page-title-bar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:30px}.page-title[_ngcontent-%COMP%]{font-size:24px;font-weight:600;color:var(--sys-on-surface);margin:0}.breadcrumbs[_ngcontent-%COMP%]{font-size:14px;color:var(--sys-on-surface-variant)}.breadcrumbs[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--sys-primary);text-decoration:none}.breadcrumbs[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}.breadcrumbs[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-left:5px}.table-controls-bar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;background-color:var(--sys-surface-container-low);padding:8px 16px}.records-info[_ngcontent-%COMP%]{font-size:.9em;color:#555}.actions-group[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center}.orders-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr;gap:20px}.acciones-masivas[_ngcontent-%COMP%]{padding:25px!important}@media (min-width: 768px){.orders-grid[_ngcontent-%COMP%]{grid-template-columns:1fr 1fr}.acciones-masivas[_ngcontent-%COMP%]{padding:20px!important}}"]})};function to(r,e){r&1&&(o(0,"mat-error"),a(1,"Largo es requerido"),n())}function io(r,e){r&1&&(o(0,"mat-error"),a(1,"Valor debe ser positivo"),n())}function ro(r,e){r&1&&(o(0,"mat-error"),a(1,"Ancho es requerido"),n())}function no(r,e){r&1&&(o(0,"mat-error"),a(1,"Valor debe ser positivo"),n())}function oo(r,e){r&1&&(o(0,"mat-error"),a(1,"Alto es requerido"),n())}function ao(r,e){r&1&&(o(0,"mat-error"),a(1,"Valor debe ser positivo"),n())}function lo(r,e){r&1&&(o(0,"mat-error"),a(1,"Peso es requerido"),n())}function so(r,e){r&1&&(o(0,"mat-error"),a(1,"Valor debe ser positivo"),n())}function mo(r,e){r&1&&u(0,"mat-progress-spinner",18)}function co(r,e){if(r&1){let t=D();o(0,"div",8)(1,"mat-form-field",9)(2,"mat-label"),a(3,"Largo (cm)"),n(),u(4,"input",10),c(5,to,2,0,"mat-error",11)(6,io,2,0,"mat-error",11),n(),o(7,"mat-form-field",9)(8,"mat-label"),a(9,"Ancho (cm)"),n(),u(10,"input",12),c(11,ro,2,0,"mat-error",11)(12,no,2,0,"mat-error",11),n(),o(13,"mat-form-field",9)(14,"mat-label"),a(15,"Alto (cm)"),n(),u(16,"input",13),c(17,oo,2,0,"mat-error",11)(18,ao,2,0,"mat-error",11),n(),o(19,"mat-form-field",9)(20,"mat-label"),a(21,"Peso (kg)"),n(),u(22,"input",14),c(23,lo,2,0,"mat-error",11)(24,so,2,0,"mat-error",11),n(),o(25,"div",15)(26,"button",16),_("click",function(){h(t);let s=v();return C(s.onCalculateCustomCost())}),c(27,mo,1,0,"mat-progress-spinner",17),a(28),n()()()}if(r&2){let t,i,s,m,p,K,z,R,Q=v();l(5),d("ngIf",(t=Q.packageFormGroup.get("package_length_cm"))==null?null:t.hasError("required")),l(),d("ngIf",(i=Q.packageFormGroup.get("package_length_cm"))==null?null:i.hasError("min")),l(5),d("ngIf",(s=Q.packageFormGroup.get("package_width_cm"))==null?null:s.hasError("required")),l(),d("ngIf",(m=Q.packageFormGroup.get("package_width_cm"))==null?null:m.hasError("min")),l(5),d("ngIf",(p=Q.packageFormGroup.get("package_height_cm"))==null?null:p.hasError("required")),l(),d("ngIf",(K=Q.packageFormGroup.get("package_height_cm"))==null?null:K.hasError("min")),l(5),d("ngIf",(z=Q.packageFormGroup.get("package_weight_kg"))==null?null:z.hasError("required")),l(),d("ngIf",(R=Q.packageFormGroup.get("package_weight_kg"))==null?null:R.hasError("min")),l(2),d("disabled",Q.isCalculating()),l(),d("ngIf",Q.isCalculating()),l(),g(" ",Q.isCalculating()?"Calculando...":"CALCULAR"," ")}}function po(r,e){r&1&&(o(0,"div",19)(1,"p"),a(2," Si su paquete excede las medidas y pesos est\xE1ndar y no utiliza la calculadora de env\xEDo, se le cobrar\xE1 en funci\xF3n de esas medidas sin previo aviso. "),n()())}function go(r,e){if(r&1&&(o(0,"div",20)(1,"p"),a(2),n()()),r&2){let t=e.ngIf;l(2),w(t.info_text)}}var ui=class r{packageFormGroup;deliveryDistrictId=null;listaDeDistritos=[];shippingCostCalculated=new N;calculationLoading=new N;maxDimensions$;standardPackageLabel=ye("Est\xE1ndar");volumetric_factor=ye(0);isCalculating=ye(!1);orderService=b(se);destroy$=new ne;constructor(){this.maxDimensions$=this.orderService.getMaxPackageDimensions().pipe(Oe(e=>{e.standard_package_info&&e.volumetric_factor&&(this.standardPackageLabel.set(e.standard_package_info),this.volumetric_factor.set(e.volumetric_factor))}))}ngOnInit(){if(!this.packageFormGroup){console.error("PackageCalculatorComponent: packageFormGroup input is required.");return}this.packageFormGroup.get("package_size_type")?.valueChanges.pipe(L(this.destroy$),Ye(this.packageFormGroup.get("package_size_type")?.value)).subscribe(e=>{this.toggleCustomDimensionControls(e==="custom")})}toggleCustomDimensionControls(e){["package_width_cm","package_length_cm","package_height_cm","package_weight_kg"].forEach(i=>{let s=this.packageFormGroup.get(i);s&&(e?(s.enable(),s.setValidators([x.required,x.min(.1),x.max(999)])):(s.disable(),s.clearValidators(),s.updateValueAndValidity({emitEvent:!1})),s.updateValueAndValidity())})}calculateStandardShippingCost(){if(!this.deliveryDistrictId){console.warn("Cannot calculate standard shipping cost: deliveryDistrictId is missing."),this.shippingCostCalculated.emit(0);return}this.isCalculating.set(!0),this.calculationLoading.emit(!0),this.orderService.calculateShippingCost({delivery_district_id:this.deliveryDistrictId,package_size_type:"standard"}).pipe(L(this.destroy$)).subscribe({next:e=>{this.shippingCostCalculated.emit(e.shipping_cost),this.isCalculating.set(!1),this.calculationLoading.emit(!1)},error:e=>{console.error("Error calculating standard shipping cost:",e),this.shippingCostCalculated.emit(0),this.isCalculating.set(!1),this.calculationLoading.emit(!1)}})}onCalculateCustomCost(){if(this.packageFormGroup.get("package_size_type")?.value!=="custom")return;if(!this.deliveryDistrictId){alert("Por favor, seleccione un distrito de entrega primero.");return}let e=!0;if(["package_width_cm","package_length_cm","package_height_cm","package_weight_kg"].forEach(m=>{let p=this.packageFormGroup.get(m);p?.markAsTouched(),p?.invalid&&(e=!1)}),!e){console.log("Custom dimensions form is invalid");return}this.isCalculating.set(!0),this.calculationLoading.emit(!0);let i={delivery_district_id:this.deliveryDistrictId,package_size_type:"custom",package_width_cm:this.packageFormGroup.get("package_width_cm")?.value,package_length_cm:this.packageFormGroup.get("package_length_cm")?.value,package_height_cm:this.packageFormGroup.get("package_height_cm")?.value,package_weight_kg:this.packageFormGroup.get("package_weight_kg")?.value};if(this.maxDimensions$,i.package_width_cm&&i.package_length_cm&&i.package_height_cm&&i.package_weight_kg&&this.volumetric_factor()){let m=i.package_length_cm*i.package_width_cm*i.package_height_cm/this.volumetric_factor(),p=0,K=i.package_weight_kg;if(m>i.package_weight_kg&&(K=m),i.delivery_district_id){console.log("customData.delivery_district_id",i.delivery_district_id);let z=this.listaDeDistritos?.find(R=>R.id===i.delivery_district_id);if(console.log("this.listaDeDistritos",this.listaDeDistritos),console.log("districtFound",z),z){let Q=function(Ae,Et=[]){for(let Ke of Et)if(Ae>=Ke.weight_from&&Ae<=Ke.weight_to)return console.log("tarifa",Ke),Ke;return 0};var s=Q;let R=this.listaDeDistritos?.filter(Ae=>Ae.name==z?.name);console.log("filtrados",R),R&&(p=Q(K,R)?.price||0)}}console.log("peso_cobrado",K),console.log("precio",p),p===0&&alert("No hay ninguna tarifa asociada con el peso ("+K+") del distrito seleccionado."),this.shippingCostCalculated.emit(p),this.isCalculating.set(!1),this.calculationLoading.emit(!1)}else alert("las entradas no son validas")}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=O({type:r,selectors:[["app-package-calculator"]],inputs:{packageFormGroup:"packageFormGroup",deliveryDistrictId:"deliveryDistrictId",listaDeDistritos:"listaDeDistritos"},outputs:{shippingCostCalculated:"shippingCostCalculated",calculationLoading:"calculationLoading"},decls:12,vars:7,consts:[[1,"package-calculator-container",3,"formGroup"],[1,"section-subtitle"],["formControlName","package_size_type","aria-label","Seleccione el tipo de tama\xF1o del paquete"],["value","standard",1,"package-option"],["value","custom",1,"package-option"],["class","custom-dimensions-grid",4,"ngIf"],["class","warning-paquete-size",4,"ngIf"],["class","max-dimensions-info",4,"ngIf"],[1,"custom-dimensions-grid"],["appearance","outline"],["matInput","","type","number","formControlName","package_length_cm","placeholder","Ingrese el largo","appAutoSelect",""],[4,"ngIf"],["matInput","","type","number","formControlName","package_width_cm","placeholder","Ingrese el ancho","appAutoSelect",""],["matInput","","type","number","formControlName","package_height_cm","placeholder","Ingrese el alto","appAutoSelect",""],["matInput","","type","number","formControlName","package_weight_kg","placeholder","Ingrese el peso","appAutoSelect",""],[1,"calculate-button-container"],["mat-flat-button","","type","button",1,"btn-corp-primary",3,"click","disabled"],["mode","indeterminate","diameter","20","class","button-spinner",4,"ngIf"],["mode","indeterminate","diameter","20",1,"button-spinner"],[1,"warning-paquete-size"],[1,"max-dimensions-info"]],template:function(t,i){if(t&1&&(o(0,"div",0)(1,"h3",1),a(2,"Tama\xF1o del paquete"),n(),o(3,"mat-radio-group",2)(4,"mat-radio-button",3),a(5),n(),o(6,"mat-radio-button",4),a(7,"Otros tama\xF1os : Calcular"),n()(),c(8,co,29,11,"div",5)(9,po,3,0,"div",6)(10,go,3,1,"div",7),f(11,"async"),n()),t&2){let s,m;d("formGroup",i.packageFormGroup),l(5),w(i.standardPackageLabel()),l(3),d("ngIf",((s=i.packageFormGroup.get("package_size_type"))==null?null:s.value)==="custom"),l(),d("ngIf",((m=i.packageFormGroup.get("package_size_type"))==null?null:m.value)==="standard"),l(),d("ngIf",k(11,5,i.maxDimensions$))}},dependencies:[S,G,Be,q,Z,Ue,$,Y,J,oe,W,H,j,ee,ie,te,mr,sr,dr,E,A,ge,pe,gr],styles:[".package-calculator-container[_ngcontent-%COMP%]{margin-top:20px;padding:16px;border:1px solid #e0e0e0;border-radius:4px;background-color:#f9f9f9}.section-subtitle[_ngcontent-%COMP%]{font-size:1.1em;font-weight:500;margin-top:0;margin-bottom:16px}mat-radio-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px;margin-bottom:20px}.package-option[_ngcontent-%COMP%]{font-weight:400}.custom-dimensions-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:30px;margin-top:16px;align-items:start}.calculate-button-container[_ngcontent-%COMP%]{grid-column:1/-1;display:flex;justify-content:flex-start;margin-top:10px}.calculate-button-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:120px}.button-spinner[_ngcontent-%COMP%]{display:inline-block;vertical-align:middle;margin-right:8px}.max-dimensions-info[_ngcontent-%COMP%]{margin-top:0!important;font-size:16px;color:#575555;text-align:center;padding:8px;background-color:#efefef;border-radius:4px}.warning-paquete-size[_ngcontent-%COMP%]{font-size:17px;font-weight:700;margin:0;text-align:left;color:#d32f2f;display:flex;align-items:center;justify-content:flex-start}"]})};var vr=(r,e)=>e.id;function uo(r,e){if(r&1){let t=D();o(0,"button",42),_("click",function(){h(t);let s=v(2);return C(s.clearSelection())}),o(1,"mat-icon"),a(2,"close"),n()()}}function _o(r,e){r&1&&(o(0,"mat-icon",11),a(1,"person_search"),n())}function fo(r,e){r&1&&u(0,"mat-progress-spinner",43)}function ho(r,e){if(r&1&&(o(0,"mat-option",21)(1,"div",44)(2,"span"),a(3),n()()()),r&2){let t=e.$implicit;d("value",t),l(3),w(t.username)}}function Co(r,e){r&1&&(o(0,"mat-option",22),a(1,"No se encontraron motorizados."),n())}function vo(r,e){r&1&&(o(0,"mat-error"),a(1,"Requerido"),n())}function bo(r,e){if(r&1){let t=D();o(0,"mat-form-field",40)(1,"mat-label"),a(2,"Buscar y Seleccionar empresa"),n(),u(3,"input",41),c(4,uo,3,0,"button",17)(5,_o,2,0,"mat-icon",18)(6,fo,1,0,"mat-progress-spinner",19),o(7,"mat-autocomplete",20,2),_("optionSelected",function(s){h(t);let m=v();return C(m.onDriverSelected(s))}),xt(9,ho,4,2,"mat-option",21,vr),f(11,"async"),c(12,Co,2,0,"mat-option",22),f(13,"async"),n(),c(14,vo,2,0,"mat-error",12),n()}if(r&2){let t,i,s=B(8),m=v();l(3),d("formControl",m.driverSearchCtrl)("matAutocomplete",s),l(),d("ngIf",m.driverSearchCtrl.value&&!m.isLoadingDrivers),l(),d("ngIf",!m.driverSearchCtrl.value&&!m.isLoadingDrivers),l(),d("ngIf",m.isLoadingDrivers),l(),d("displayWith",m.displayDriverName),l(2),Ot(k(11,8,m.filteredDrivers$)),l(3),P(((t=k(13,10,m.filteredDrivers$))==null?null:t.length)===0&&!m.isLoadingDrivers&&m.driverSearchCtrl.value?12:-1),l(2),d("ngIf",(i=m.orderForm.get("company_id"))==null?null:i.hasError("required"))}}function xo(r,e){if(r&1&&(o(0,"mat-option",21),a(1),n()),r&2){let t=e.$implicit;d("value",t),l(),w(t)}}function Oo(r,e){r&1&&(o(0,"mat-error"),a(1,"Requerido"),n())}function yo(r,e){r&1&&(o(0,"mat-error"),a(1,"Requerido"),n())}function Mo(r,e){r&1&&(o(0,"mat-error"),a(1,"Tel\xE9fono inv\xE1lido"),n())}function Do(r,e){if(r&1){let t=D();o(0,"button",42),_("click",function(){h(t);let s=v();return C(s.clearDistrictSelection())}),o(1,"mat-icon"),a(2,"close"),n()()}}function So(r,e){r&1&&(o(0,"mat-icon",11),a(1,"person_search"),n())}function Eo(r,e){r&1&&u(0,"mat-progress-spinner",43)}function wo(r,e){if(r&1&&(o(0,"mat-option",21)(1,"div",44)(2,"span"),a(3),n()()()),r&2){let t=e.$implicit;d("value",t),l(3),w(t.name_and_price)}}function Po(r,e){r&1&&(o(0,"mat-option",22),a(1,"No se encontraron motorizados."),n())}function ko(r,e){r&1&&(o(0,"mat-error"),a(1,"Requerido"),n())}function Io(r,e){r&1&&(o(0,"mat-error"),a(1,"Requerido"),n())}function To(r,e){r&1&&(o(0,"mat-error"),a(1,"M\xEDnimo 6 caracteres"),n())}function Fo(r,e){r&1&&(o(0,"mat-error"),a(1,"Requerido"),n())}function Ao(r,e){r&1&&u(0,"mat-progress-spinner",45)}function Ro(r,e){r&1&&(o(0,"mat-error"),a(1,"Requerido"),n())}function No(r,e){r&1&&(o(0,"mat-error"),a(1,"Requerido"),n())}function Vo(r,e){r&1&&(o(0,"mat-error"),a(1,"Monto no puede ser negativo"),n())}function Lo(r,e){if(r&1&&(o(0,"mat-option",21),a(1),n()),r&2){let t=e.$implicit;d("value",t),l(),w(t)}}var St=class r{orderSubmit=new N;formValidityChanged=new N;orderForm;minDeliveryDate;shipmentTypes=["CONTRAENTREGA","SOLO ENTREGAR","CAMBIO","RECOJO"];paymentMethodsForCollection=["NO COBRAR","EFECTIVO","YAPE","PLIN","TRANSFERENCIA"];calculatedShippingCost=ye(0);isCalculatingShipping=ye(!1);appStore=b(ut);selectedDistrictName=()=>{let e=this.orderForm?.get("delivery_district_id")?.value;return console.log("districtId",e),console.log("this._districtsCache",this._districtsCache),!e||!this._districtsCache?"":this._districtsCache.find(t=>t.id===e)?.name||""};orderService=b(se);fb=b(ae);datePipe=b(X);destroy$=new ne;_districtsCache=[];drivers$=xe([]);isLoadingDrivers=!1;selectedDriver=null;driverSearchCtrl=new ze("");filteredDrivers$;ditricts$=xe([]);isLoadingDistricts=!1;selectedDistrict=null;districSearchCtrl=new ze("");filteredDistricts$;constructor(){this.minDeliveryDate=new Date,this.orderService.getDeliveryDistricts().pipe(Xe(e=>(this._districtsCache=e,console.log("this._districtsCache",this._districtsCache),e.filter(t=>t.isStandard)))).subscribe(e=>{}),this.buildForm(),this.filteredDrivers$=this.driverSearchCtrl.valueChanges.pipe(Ye(""),Ze(300),De(),bt(e=>(this.isLoadingDrivers=!0,console.log("searchTerm",e),this.orderService.getCompanies(e||"").pipe(Oe(()=>this.isLoadingDrivers=!1),F(()=>(this.isLoadingDrivers=!1,xe([])))))),L(this.destroy$)),this.filteredDistricts$=this.districSearchCtrl.valueChanges.pipe(Ye(""),Ze(300),De(),bt(e=>(this.isLoadingDistricts=!0,console.log("searchTerm",e),this.orderService.getDistricts(e||"").pipe(Oe(()=>this.isLoadingDistricts=!1),F(()=>(this.isLoadingDistricts=!1,xe([])))))),L(this.destroy$))}isCompany(){return this.appStore.currentUser()?.role==="EMPRESA"}displayDriverName(e){return e&&e.username?e.username:""}onDriverSelected(e){this.selectedDriver=e.option.value,console.log("cliente selected:",this.selectedDriver),this.orderForm.get("company_id")?.setValue(this.selectedDriver.id),this.orderForm.markAllAsTouched(),console.log("Order form is invalid:",this.getFormErrors(this.orderForm));let t=this.orderForm.getRawValue();console.log("formValue",t)}clearSelection(){this.selectedDriver=null,this.driverSearchCtrl.setValue(""),this.orderForm.markAllAsTouched(),this.orderForm.get("company_id")?.setValue(null),console.log("Order form is invalid:",this.getFormErrors(this.orderForm))}displayDistricName(e){return e&&e.name_and_price?e.name_and_price:""}onDistrictSelected(e){this.selectedDistrict=e.option.value,console.log("district selected:",this.selectedDistrict),this.orderForm.get("delivery_district_id")?.setValue(this.selectedDistrict.id),this.orderForm.markAllAsTouched(),console.log("Order form is invalid:",this.getFormErrors(this.orderForm));let t=this.orderForm.getRawValue();console.log("formValue",t)}clearDistrictSelection(){this.selectedDistrict=null,this.districSearchCtrl.setValue(""),this.orderForm.markAllAsTouched(),this.orderForm.get("delivery_district_id")?.setValue(null),console.log("Order form is invalid:",this.getFormErrors(this.orderForm))}ngOnInit(){this.orderForm.statusChanges.pipe(L(this.destroy$),De()).subscribe(e=>{this.formValidityChanged.emit(e==="VALID")}),this.orderForm.get("delivery_district_id")?.valueChanges.pipe(L(this.destroy$),De()).subscribe(e=>{if(console.log("District changed to:",e),e)if(this.packageDetailsFormGroup.get("package_size_type")?.value==="standard"){let t=this._districtsCache.find(i=>i.id===e);t&&this.calculatedShippingCost.set(parseFloat(t.price))}else this.calculatedShippingCost.set(0)}),this.packageDetailsFormGroup.get("package_size_type")?.valueChanges.pipe(L(this.destroy$),De()).subscribe(e=>{console.log("type",e);let t=this.orderForm.get("delivery_district_id")?.value;if(t&&e==="standard"){let i=this._districtsCache.find(s=>s.id===t);i&&this.calculatedShippingCost.set(parseFloat(i.price))}else this.calculatedShippingCost.set(0)})}get packageDetailsFormGroup(){return this.orderForm.get("package_details")}buildForm(){let e=null;this.isCompany()&&(e=this.appStore.currentUser()?.id),this.orderForm=this.fb.group({shipment_type:[this.shipmentTypes[0],x.required],recipient_name:["",x.required],recipient_phone:["",[x.required,x.pattern("^[0-9]{9}$")]],company_id:[e,x.required],delivery_district_id:[null,x.required],delivery_address:["",[x.required,x.minLength(6)]],delivery_coordinates:[""],delivery_date:[null,x.required],package_details:this.fb.group({package_size_type:["standard",x.required],package_width_cm:[{value:0,disabled:!0}],package_length_cm:[{value:0,disabled:!0}],package_height_cm:[{value:0,disabled:!0}],package_weight_kg:[{value:0,disabled:!0}]}),item_description:["",x.required],amount_to_collect_at_delivery:[0,[x.required,x.min(0)]],payment_method_for_collection:[this.paymentMethodsForCollection[0],x.required],observations:[""]})}onShippingCostCalculated(e){this.calculatedShippingCost.set(e),console.log("Shipping cost updated in OrderCreationForm:",e)}onPackageCalculationLoading(e){this.isCalculatingShipping.set(e)}onSubmit(){if(this.orderForm.invalid){this.orderForm.markAllAsTouched(),console.log("Order form is invalid:",this.getFormErrors(this.orderForm)),alert("Por favor complete todos los campos requeridos.");return}let e=this.orderForm.getRawValue();console.log("this.selectedDistrictName()",this.selectedDistrictName());let t=rt(me(me({},e),e.package_details),{shipping_cost:this.calculatedShippingCost(),delivery_district_name:this.selectedDistrictName(),temp_id:`temp-${Date.now()}-${Math.random().toString(36).substring(2,7)}`});console.log("Submitting New Order Data:",t),this.orderSubmit.emit(t)}resetFormForNextOrder(){this.selectedDriver=null,this.driverSearchCtrl.setValue(""),this.selectedDistrict=null,this.districSearchCtrl.setValue("");let e=null;this.isCompany()&&(e=this.orderForm.get("company_id")?.value);let t=this.orderForm.get("shipment_type")?.value||this.shipmentTypes[0],i=this.paymentMethodsForCollection[0];this.orderForm.reset({company_id:e,shipment_type:t,delivery_date:null,package_details:{package_size_type:"standard"},amount_to_collect_at_delivery:0,payment_method_for_collection:i}),this.calculatedShippingCost.set(0),this.packageDetailsFormGroup.get("package_size_type")?.setValue("standard",{emitEvent:!0}),this.formValidityChanged.emit(this.orderForm.valid)}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}getFormErrors(e){let t={};return Object.keys(e.controls).forEach(i=>{let s=e.get(i)?.errors;if(s&&(t[i]=s),e.get(i)instanceof qi){let m=this.getFormErrors(e.get(i));Object.keys(m).length>0&&(t[i]=m)}}),t}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=O({type:r,selectors:[["app-order-creation-form"]],outputs:{orderSubmit:"orderSubmit",formValidityChanged:"formValidityChanged"},features:[ot([Bt(),X])],decls:105,vars:37,consts:[["autoDistric","matAutocomplete"],["deliveryDatePicker",""],["autoDriver","matAutocomplete"],[1,"order-creation-form",3,"ngSubmit","formGroup"],[1,"form-section-title"],["appearance","outline","class","full-width driver-search-field",4,"ngIf"],[1,"form-grid"],["appearance","outline"],["formControlName","shipment_type"],[3,"value",4,"ngFor","ngForOf"],["matInput","","formControlName","recipient_name","placeholder","Nombre completo"],["matSuffix",""],[4,"ngIf"],["matInput","","formControlName","recipient_phone","type","tel","placeholder",""],["align","end"],["appearance","outline",1,"driver-search-field"],["type","text","placeholder","Escriba el nombre del distrito...","aria-label","distrito","matInput","",3,"formControl","matAutocomplete"],["matSuffix","","mat-icon-button","","aria-label","Limpiar",3,"click",4,"ngIf"],["matSuffix","",4,"ngIf"],["matSuffix","","mode","indeterminate","diameter","20",4,"ngIf"],[3,"optionSelected","displayWith"],[3,"value"],["disabled",""],["appearance","outline",1,"full-span-column"],["matInput","","formControlName","delivery_address","placeholder","Ingresar lugar de entrega (M\xEDnimo 6 caracteres)"],["matInput","","formControlName","delivery_coordinates","placeholder","-12.070,-77.012"],["matInput","","formControlName","delivery_date",3,"matDatepicker","min"],["matSuffix","",3,"for"],[1,"section-divider"],[3,"shippingCostCalculated","calculationLoading","packageFormGroup","listaDeDistritos","deliveryDistrictId"],[1,"shipping-cost-display"],[1,"cost-value"],["mode","indeterminate","diameter","20","class","cost-spinner",4,"ngIf"],["matInput","","formControlName","item_description","placeholder","Detalle del pedido"],["matInput","","formControlName","amount_to_collect_at_delivery","type","number","min","0","placeholder","S/"],["matPrefix",""],["formControlName","payment_method_for_collection"],["matInput","","formControlName","observations","placeholder","\xBFQu\xE9 env\xEDas?...","rows","3"],[1,"add-order-button-container"],["mat-flat-button","","type","submit",1,"btn-corp-primary",3,"disabled"],["appearance","outline",1,"full-width","driver-search-field"],["type","text","placeholder","Escriba el nombre del la empresa...","aria-label","cliente","matInput","",3,"formControl","matAutocomplete"],["matSuffix","","mat-icon-button","","aria-label","Limpiar",3,"click"],["matSuffix","","mode","indeterminate","diameter","20"],[1,"driver-option"],["mode","indeterminate","diameter","20",1,"cost-spinner"]],template:function(t,i){if(t&1){let s=D();o(0,"form",3),_("ngSubmit",function(){return h(s),C(i.onSubmit())}),o(1,"h2",4),a(2,"Registrar pedido"),n(),c(3,bo,15,12,"mat-form-field",5),o(4,"div",6)(5,"mat-form-field",7)(6,"mat-label"),a(7,"Tipo de env\xEDo"),n(),o(8,"mat-select",8),c(9,xo,2,2,"mat-option",9),n()(),o(10,"mat-form-field",7)(11,"mat-label"),a(12,"Nombre del destinatario"),n(),u(13,"input",10),o(14,"mat-icon",11),a(15,"person_outline"),n(),c(16,Oo,2,0,"mat-error",12),n(),o(17,"mat-form-field",7)(18,"mat-label"),a(19,"Tel\xE9fono del destinatario"),n(),u(20,"input",13),o(21,"mat-icon",11),a(22,"phone_outline"),n(),o(23,"mat-hint",14),a(24,"No se debe agregar el +51"),n(),c(25,yo,2,0,"mat-error",12)(26,Mo,2,0,"mat-error",12),n(),o(27,"mat-form-field",15)(28,"mat-label"),a(29,"Buscar y Seleccionar distrito"),n(),u(30,"input",16),c(31,Do,3,0,"button",17)(32,So,2,0,"mat-icon",18)(33,Eo,1,0,"mat-progress-spinner",19),o(34,"mat-autocomplete",20,0),_("optionSelected",function(p){return h(s),C(i.onDistrictSelected(p))}),xt(36,wo,4,2,"mat-option",21,vr),f(38,"async"),c(39,Po,2,0,"mat-option",22),f(40,"async"),n(),c(41,ko,2,0,"mat-error",12),n(),o(42,"mat-form-field",23)(43,"mat-label"),a(44,"Direcci\xF3n de entrega"),n(),u(45,"input",24),o(46,"mat-hint",14),a(47,"No acepta caracteres especiales se borran autom\xE1ticos"),n(),c(48,Io,2,0,"mat-error",12)(49,To,2,0,"mat-error",12),n(),o(50,"mat-form-field",7)(51,"mat-label"),a(52,"Coordenadas (Opcional)"),n(),u(53,"input",25),o(54,"mat-icon",11),a(55,"location_on_outline"),n()(),o(56,"mat-form-field",7)(57,"mat-label"),a(58,"Fecha Entrega"),n(),u(59,"input",26)(60,"mat-datepicker-toggle",27)(61,"mat-datepicker",null,1),c(63,Fo,2,0,"mat-error",12),n()(),u(64,"mat-divider",28),o(65,"app-package-calculator",29),_("shippingCostCalculated",function(p){return h(s),C(i.onShippingCostCalculated(p))})("calculationLoading",function(p){return h(s),C(i.onPackageCalculationLoading(p))}),n(),o(66,"div",30),a(67," Costo de env\xEDo = "),o(68,"span",31),a(69),f(70,"number"),n(),c(71,Ao,1,0,"mat-progress-spinner",32),n(),u(72,"mat-divider",28),o(73,"div",6)(74,"mat-form-field",23)(75,"mat-label"),a(76,"\xBFQu\xE9 env\xEDa?"),n(),u(77,"input",33),o(78,"mat-icon",11),a(79,"inventory_2_outline"),n(),c(80,Ro,2,0,"mat-error",12),n(),o(81,"mat-form-field",7)(82,"mat-label"),a(83,"Monto total a cobrar"),n(),u(84,"input",34),o(85,"span",35),a(86,"S/ "),n(),c(87,No,2,0,"mat-error",12)(88,Vo,2,0,"mat-error",12),n(),o(89,"mat-form-field",7)(90,"mat-label"),a(91,"M\xE9todo de Pago (para cobro en entrega)"),n(),o(92,"mat-select",36),c(93,Lo,2,2,"mat-option",9),n()(),o(94,"mat-form-field",23)(95,"mat-label"),a(96,"Observaciones (Opcional)"),n(),u(97,"textarea",37),n()(),o(98,"div",38)(99,"button",39)(100,"mat-icon"),a(101,"add_shopping_cart"),n(),a(102," AGREGAR PEDIDO AL LISTADO "),o(103,"mat-icon"),a(104,"arrow_downward"),n()()()()}if(t&2){let s,m,p,K,z,R,Q,Ae,Et,Ke,yi,Mi,br=B(35),Di=B(62);d("formGroup",i.orderForm),l(3),d("ngIf",!i.isCompany()),l(6),d("ngForOf",i.shipmentTypes),l(7),d("ngIf",(s=i.orderForm.get("recipient_name"))==null?null:s.hasError("required")),l(9),d("ngIf",(m=i.orderForm.get("recipient_phone"))==null?null:m.hasError("required")),l(),d("ngIf",(p=i.orderForm.get("recipient_phone"))==null?null:p.hasError("pattern")),l(4),d("formControl",i.districSearchCtrl)("matAutocomplete",br),l(),d("ngIf",i.districSearchCtrl.value&&!i.isLoadingDistricts),l(),d("ngIf",!i.districSearchCtrl.value&&!i.isLoadingDistricts),l(),d("ngIf",i.isLoadingDistricts),l(),d("displayWith",i.displayDistricName),l(2),Ot(k(38,30,i.filteredDistricts$)),l(3),P(((K=k(40,32,i.filteredDistricts$))==null?null:K.length)===0&&!i.isLoadingDistricts&&i.districSearchCtrl.value?39:-1),l(2),d("ngIf",(z=i.orderForm.get("delivery_district_id"))==null?null:z.hasError("required")),l(7),d("ngIf",(R=i.orderForm.get("delivery_address"))==null?null:R.hasError("required")),l(),d("ngIf",(Q=i.orderForm.get("delivery_address"))==null?null:Q.hasError("minlength")),l(10),d("matDatepicker",Di)("min",i.minDeliveryDate),l(),d("for",Di),l(3),d("ngIf",(Ae=i.orderForm.get("delivery_date"))==null?null:Ae.hasError("required")),l(2),d("packageFormGroup",i.packageDetailsFormGroup)("listaDeDistritos",i._districtsCache)("deliveryDistrictId",(Et=i.orderForm.get("delivery_district_id"))==null?null:Et.value),l(4),g("S/ ",I(70,34,i.calculatedShippingCost(),"1.2-2"),""),l(2),d("ngIf",i.isCalculatingShipping()),l(9),d("ngIf",(Ke=i.orderForm.get("item_description"))==null?null:Ke.hasError("required")),l(7),d("ngIf",(yi=i.orderForm.get("amount_to_collect_at_delivery"))==null?null:yi.hasError("required")),l(),d("ngIf",(Mi=i.orderForm.get("amount_to_collect_at_delivery"))==null?null:Mi.hasError("min")),l(5),d("ngForOf",i.paymentMethodsForCollection),l(6),d("disabled",i.orderForm.invalid||i.isCalculatingShipping())}},dependencies:[S,Le,G,Be,dt,q,Ee,Z,Ue,$,Y,ct,mt,J,oe,W,H,j,Tt,ee,pt,$e,ie,te,Te,He,Ie,vt,ft,ht,Ct,E,A,we,T,re,ke,Pe,ui,ge,pe,ti,Jt,ei],styles:[".order-creation-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px;padding:10px 20px 20px}.form-section-title[_ngcontent-%COMP%]{font-size:1.5em;font-weight:500;color:#333;margin-bottom:10px;padding-bottom:10px;border-bottom:1px solid #eee}.form-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:20px 24px}@media (max-width: 600px){.form-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}.full-span-column[_ngcontent-%COMP%]{grid-column:1/-1}mat-form-field[_ngcontent-%COMP%]{width:100%}.section-divider[_ngcontent-%COMP%]{margin:24px 0}.shipping-cost-display[_ngcontent-%COMP%]{font-size:1.3em;font-weight:700;text-align:right;color:#d32f2f;display:flex;align-items:center;justify-content:flex-end;gap:8px}@media (max-width: 600px){.shipping-cost-display[_ngcontent-%COMP%]{text-align:left;justify-content:flex-start}}.add-order-button-container[_ngcontent-%COMP%]{margin-top:24px;text-align:center}.add-order-button-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:12px 24px;font-size:1.1em;letter-spacing:.5px}mat-hint[align=end][_ngcontent-%COMP%]{font-size:.75em;opacity:.7}"]})};function Bo(r,e){r&1&&(o(0,"div",3),a(1," A\xFAn no has agregado pedidos. "),n())}function zo(r,e){r&1&&(o(0,"th",22),a(1,"Nombre"),n())}function Uo(r,e){if(r&1&&(o(0,"td",23)(1,"span",24),a(2),n()()),r&2){let t=e.$implicit;l(),d("matTooltip",t.recipient_name)("matTooltipDisabled",t.recipient_name.length<=20),l(),g(" ",t.recipient_name," ")}}function Go(r,e){r&1&&(o(0,"th",22),a(1,"Tel\xE9fono"),n())}function $o(r,e){if(r&1&&(o(0,"td",23),a(1),n()),r&2){let t=e.$implicit;l(),w(t.recipient_phone)}}function qo(r,e){r&1&&(o(0,"th",22),a(1,"F. Entrega"),n())}function jo(r,e){if(r&1&&(o(0,"td",23),a(1),f(2,"date"),n()),r&2){let t=e.$implicit;l(),g(" ",I(2,1,t.delivery_date,"dd/MM/yy")," ")}}function Ho(r,e){r&1&&(o(0,"th",22),a(1,"Distrito"),n())}function Wo(r,e){if(r&1&&(o(0,"td",23),a(1),n()),r&2){let t=e.$implicit;l(),g(" ",t.delivery_district_name," ")}}function Qo(r,e){r&1&&(o(0,"th",22),a(1,"Direcci\xF3n"),n())}function Ko(r,e){if(r&1&&(o(0,"td",23)(1,"span",24),a(2),n()()),r&2){let t=e.$implicit;l(),d("matTooltip",t.delivery_address)("matTooltipDisabled",t.delivery_address.length<=25),l(),g(" ",t.delivery_address," ")}}function Xo(r,e){r&1&&(o(0,"th",22),a(1,"Producto"),n())}function Zo(r,e){if(r&1&&(o(0,"td",23)(1,"span",24),a(2),n()()),r&2){let t=e.$implicit;l(),d("matTooltip",t.item_description)("matTooltipDisabled",t.item_description.length<=20),l(),g(" ",t.item_description," ")}}function Yo(r,e){r&1&&(o(0,"th",22),a(1,"Cobrar"),n())}function Jo(r,e){if(r&1&&(o(0,"td",25),a(1),f(2,"currency"),n()),r&2){let t=e.$implicit;l(),g(" ",ce(2,1,t.amount_to_collect_at_delivery,"PEN","S/ ","1.2-2")," ")}}function ea(r,e){r&1&&(o(0,"th",22),a(1,"Costo env\xEDo"),n())}function ta(r,e){if(r&1&&(o(0,"td",25),a(1),f(2,"currency"),n()),r&2){let t=e.$implicit;l(),g(" ",ce(2,1,t.shipping_cost,"PEN","S/ ","1.2-2")," ")}}function ia(r,e){r&1&&(o(0,"th",22),a(1,"M\xE9todo de Pago"),n())}function ra(r,e){if(r&1&&(o(0,"td",23),a(1),n()),r&2){let t=e.$implicit;l(),g(" ",t.payment_method_for_collection," ")}}function na(r,e){r&1&&(o(0,"th",22),a(1,"Observaci\xF3n"),n())}function oa(r,e){if(r&1&&(o(0,"td",23)(1,"span",24),a(2),n()()),r&2){let t=e.$implicit;l(),d("matTooltip",t.observations)("matTooltipDisabled",!t.observations||t.observations.length<=20),l(),g(" ",t.observations||"-"," ")}}function aa(r,e){r&1&&(o(0,"th",22),a(1,"Quitar"),n())}function la(r,e){if(r&1){let t=D();o(0,"td",23)(1,"button",26),_("click",function(){let s=h(t).$implicit,m=v(2);return C(m.onRemoveOrder(s.temp_id))}),o(2,"mat-icon"),a(3,"remove_circle_outline"),n()()()}}function sa(r,e){r&1&&u(0,"tr",27)}function da(r,e){r&1&&u(0,"tr",28)}function ma(r,e){if(r&1&&(o(0,"div",4)(1,"table",5),y(2,6),c(3,zo,2,0,"th",7)(4,Uo,3,3,"td",8),M(),y(5,9),c(6,Go,2,0,"th",7)(7,$o,2,1,"td",8),M(),y(8,10),c(9,qo,2,0,"th",7)(10,jo,3,4,"td",8),M(),y(11,11),c(12,Ho,2,0,"th",7)(13,Wo,2,1,"td",8),M(),y(14,12),c(15,Qo,2,0,"th",7)(16,Ko,3,3,"td",8),M(),y(17,13),c(18,Xo,2,0,"th",7)(19,Zo,3,3,"td",8),M(),y(20,14),c(21,Yo,2,0,"th",7)(22,Jo,3,6,"td",15),M(),y(23,16),c(24,ea,2,0,"th",7)(25,ta,3,6,"td",15),M(),y(26,17),c(27,ia,2,0,"th",7)(28,ra,2,1,"td",8),M(),y(29,18),c(30,na,2,0,"th",7)(31,oa,3,3,"td",8),M(),y(32,19),c(33,aa,2,0,"th",7)(34,la,4,0,"td",8),M(),c(35,sa,1,0,"tr",20)(36,da,1,0,"tr",21),n()()),r&2){let t=v();l(),d("dataSource",t.pendingOrders),l(34),d("matHeaderRowDef",t.displayedColumns)("matHeaderRowDefSticky",!0),l(),d("matRowDefColumns",t.displayedColumns)}}var _i=class r{pendingOrders=[];removeOrder=new N;displayedColumns=["recipient_name","recipient_phone","delivery_date","delivery_district_name","delivery_address","item_description","amount_to_collect_at_delivery","shipping_cost","payment_method_for_collection","observations","actions"];constructor(){}onRemoveOrder(e){e&&this.removeOrder.emit(e)}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=O({type:r,selectors:[["app-temporary-orders-table"]],inputs:{pendingOrders:"pendingOrders"},outputs:{removeOrder:"removeOrder"},decls:4,vars:2,consts:[["ordersTable",""],[1,"temporary-orders-container","mat-elevation-z1"],["class","no-orders-message",4,"ngIf","ngIfElse"],[1,"no-orders-message"],[1,"table-responsive-wrapper"],["mat-table","",1,"temporary-orders-table",3,"dataSource"],["matColumnDef","recipient_name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","recipient_phone"],["matColumnDef","delivery_date"],["matColumnDef","delivery_district_name"],["matColumnDef","delivery_address"],["matColumnDef","item_description"],["matColumnDef","amount_to_collect_at_delivery"],["mat-cell","","class","align-right",4,"matCellDef"],["matColumnDef","shipping_cost"],["matColumnDef","payment_method_for_collection"],["matColumnDef","observations"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],[1,"truncate-text",3,"matTooltip","matTooltipDisabled"],["mat-cell","",1,"align-right"],["mat-icon-button","","color","warn","matTooltip","Quitar pedido",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(t,i){if(t&1&&(o(0,"div",1),c(1,Bo,2,0,"div",2)(2,ma,37,4,"ng-template",null,0,at),n()),t&2){let s=B(3);l(),d("ngIf",i.pendingOrders.length===0)("ngIfElse",s)}},dependencies:[S,G,Se,X,Xt,zt,Gt,Ht,$t,Ut,Wt,qt,jt,Qt,Kt,E,we,T,re,_t,rr],styles:[".table-responsive-wrapper[_ngcontent-%COMP%]{background-color:#6c757d!important;overflow:auto}.temporary-orders-container[_ngcontent-%COMP%]{margin-top:30px;padding:0;background-color:#fff;border-radius:8px;overflow:hidden;box-shadow:0 1px 3px #0000001f,0 1px 2px #0000003d}.list-title[_ngcontent-%COMP%]{font-size:1.2em;font-weight:500;color:#fff;background-color:#d32f2f;padding:12px 16px;margin:0;border-top-left-radius:8px;border-top-right-radius:8px}.temporary-orders-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}th.mat-header-cell[_ngcontent-%COMP%], td.mat-cell[_ngcontent-%COMP%]{padding:10px 12px;border-bottom:1px solid #e0e0e0;vertical-align:middle;text-align:left}th.mat-header-cell[_ngcontent-%COMP%]{font-weight:500;color:#000000bf;background-color:#f5f5f5;white-space:nowrap}td.mat-cell[_ngcontent-%COMP%]{color:#000000de;font-size:.9em}[matColumnDef=amount_to_collect_at_delivery].mat-header-cell[_ngcontent-%COMP%], [matColumnDef=amount_to_collect_at_delivery].mat-cell[_ngcontent-%COMP%], [matColumnDef=shipping_cost].mat-header-cell[_ngcontent-%COMP%], [matColumnDef=shipping_cost].mat-cell[_ngcontent-%COMP%]{text-align:right;justify-content:flex-end}[matColumnDef=actions][_ngcontent-%COMP%]{width:80px}[matColumnDef=actions].mat-header-cell[_ngcontent-%COMP%], [matColumnDef=actions].mat-cell[_ngcontent-%COMP%]{text-align:center;justify-content:center}.truncate-text[_ngcontent-%COMP%]{display:block;max-width:120px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.no-orders-message[_ngcontent-%COMP%]{text-align:center;padding:30px;font-style:italic;color:#6c757d;background-color:#f8f9fa;border-bottom-left-radius:8px;border-bottom-right-radius:8px}"]})};function ca(r,e){if(r&1&&(o(0,"mat-option",16),a(1),f(2,"titlecase"),n()),r&2){let t=e.$implicit;d("value",t),l(),g(" ",k(2,2,t.replace("_"," "))," ")}}function pa(r,e){r&1&&(o(0,"mat-error"),a(1," Debe seleccionar una opci\xF3n de traslado. "),n())}function ga(r,e){r&1&&(o(0,"mat-error",17),a(1," Debe aceptar los t\xE9rminos y condiciones. "),n())}function ua(r,e){r&1&&u(0,"mat-progress-spinner",18)}function _a(r,e){if(r&1){let t=D();o(0,"div",4)(1,"div",5)(2,"mat-form-field",6)(3,"mat-label"),a(4,"\xBFC\xF3mo se har\xE1 el traslado de los pedidos al almac\xE9n?"),n(),o(5,"mat-select",7),c(6,ca,3,4,"mat-option",8),n(),c(7,pa,2,0,"mat-error",9),n()(),o(8,"div",10)(9,"mat-checkbox",7),a(10," acepto los "),o(11,"a",11),a(12,"t\xE9rminos y condiciones"),n()(),c(13,ga,2,0,"mat-error",12),n(),o(14,"div",13)(15,"button",14),_("click",function(){h(t);let s=v();return C(s.submitAllOrders())}),c(16,ua,1,0,"mat-progress-spinner",15),a(17),n()()()}if(r&2){let t=v();l(5),d("formControl",t.pickupOptionControl),l(),d("ngForOf",t.pickupOptions),l(),d("ngIf",t.pickupOptionControl.hasError("required")&&t.pickupOptionControl.touched),l(2),d("formControl",t.termsAcceptedControl),l(4),d("ngIf",t.termsAcceptedControl.hasError("required")&&t.termsAcceptedControl.touched),l(2),d("disabled",t.pendingOrders().length===0||!t.termsAcceptedControl.value||!t.pickupOptionControl.valid||t.isSubmittingBatch()),l(),d("ngIf",t.isSubmittingBatch()),l(),g(" ",t.isSubmittingBatch()?"Generando Pedidos...":"Haz click aqu\xED para guardar los pedidos"," ")}}var fi=class r{orderCreationFormComponent;pendingOrders=ye([]);isSubmittingBatch=ye(!1);isOrderFormValid=ye(!1);pickupOptionControl=new ze("RECOGER EN DOMICILIO",x.required);termsAcceptedControl=new ze(!1,x.requiredTrue);pickupOptions=["RECOGER EN DOMICILIO","ENTREGAR EN ALMACEN"];orderService=b(se);router=b(kt);snackBar=b(je);cdr=b(Pt);destroy$=new ne;constructor(){}ngOnInit(){}handleOrderAdded(e){this.pendingOrders.update(t=>[...t,e]),this.snackBar.open("Pedido agregado al listado.","OK",{duration:2e3,verticalPosition:"top"}),this.orderCreationFormComponent&&this.orderCreationFormComponent.resetFormForNextOrder(),this.cdr.detectChanges()}handleRemoveOrder(e){this.pendingOrders.update(t=>t.filter(i=>i.temp_id!==e)),this.snackBar.open("Pedido quitado del listado.","OK",{duration:2e3,verticalPosition:"top"})}onOrderFormValidityChanged(e){this.isOrderFormValid.set(e)}submitAllOrders(){if(this.pendingOrders().length===0){this.snackBar.open("No hay pedidos en el listado para enviar.","Cerrar",{duration:3e3,verticalPosition:"top"});return}if(!this.pickupOptionControl.valid){this.snackBar.open("Por favor, seleccione c\xF3mo se har\xE1 el traslado.","Cerrar",{duration:3e3,verticalPosition:"top"}),this.pickupOptionControl.markAsTouched();return}if(!this.termsAcceptedControl.value){this.snackBar.open("Debe aceptar los t\xE9rminos y condiciones.","Cerrar",{duration:3e3,verticalPosition:"top"}),this.termsAcceptedControl.markAsTouched();return}this.isSubmittingBatch.set(!0);let t={orders:this.pendingOrders().map(i=>{let p=i,{temp_id:s}=p;return Si(p,["temp_id"])}).map(i=>rt(me({},i),{type_order_transfer_to_warehouse:this.pickupOptionControl.value})),pickup_option:this.pickupOptionControl.value||"RECOGER EN DOMICILIO",terms_accepted:!0};this.orderService.createBatchOrders(t).pipe(L(this.destroy$),ki(()=>this.isSubmittingBatch.set(!1))).subscribe({next:i=>{this.snackBar.open(i.message||"Pedidos generados exitosamente!","OK",{duration:4e3,verticalPosition:"top",panelClass:["success-snackbar"]}),this.pendingOrders.set([]),this.pickupOptionControl.reset("RECOGER_DOMICILIO"),this.termsAcceptedControl.reset(!1),this.router.navigate(["/orders"])},error:i=>{this.snackBar.open(i.message||"Error al generar los pedidos. Intente nuevamente.","Cerrar",{duration:5e3,verticalPosition:"top",panelClass:["error-snackbar"]}),console.error("Error submitting batch orders:",i)}})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=O({type:r,selectors:[["app-order-create-page"]],viewQuery:function(t,i){if(t&1&&Re(St,5),t&2){let s;Ne(s=Ve())&&(i.orderCreationFormComponent=s.first)}},decls:4,vars:2,consts:[[1,"page-content-wrapper","order-create-page"],[3,"orderSubmit","formValidityChanged"],[3,"removeOrder","pendingOrders"],["class","final-submission-section mat-elevation-z1",4,"ngIf"],[1,"final-submission-section","mat-elevation-z1"],[1,"pickup-option-section"],["appearance","outline",1,"full-width"],[3,"formControl"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"terms-section"],["href","/terms-and-conditions","target","_blank",2,"color","#012147","font-weight","bold"],["class","terms-error",4,"ngIf"],[1,"submit-batch-button-container"],["mat-flat-button","",1,"submit-all-button","btn-corp-primary",3,"click","disabled"],["mode","indeterminate","diameter","24","class","button-spinner",4,"ngIf"],[3,"value"],[1,"terms-error"],["mode","indeterminate","diameter","24",1,"button-spinner"]],template:function(t,i){t&1&&(o(0,"div",0)(1,"app-order-creation-form",1),_("orderSubmit",function(m){return i.handleOrderAdded(m)})("formValidityChanged",function(m){return i.onOrderFormValidityChanged(m)}),n(),o(2,"app-temporary-orders-table",2),_("removeOrder",function(m){return i.handleRemoveOrder(m)}),n(),c(3,_a,18,8,"div",3),n()),t&2&&(l(2),d("pendingOrders",i.pendingOrders()),l(),d("ngIf",i.pendingOrders().length>0))},dependencies:[S,Le,G,st,It,q,$,mt,St,_i,gt,E,A,T,Xi,Ki,Te,H,j,ee,He,Ie,W,ge,pe],styles:[".order-create-page[_ngcontent-%COMP%]{padding:0;background-color:#f4f6f8}.final-submission-section[_ngcontent-%COMP%]{margin-top:30px;padding:24px;background-color:#fff;border-radius:8px;display:flex;flex-direction:column;gap:20px}.pickup-option-section[_ngcontent-%COMP%]   .full-width[_ngcontent-%COMP%]{width:100%}.terms-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-start}.terms-section[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none;font-weight:500}.terms-section[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}.terms-section[_ngcontent-%COMP%]   .terms-error[_ngcontent-%COMP%]{font-size:.75em;margin-top:4px}.submit-batch-button-container[_ngcontent-%COMP%]{margin-top:16px;text-align:center}.submit-batch-button-container[_ngcontent-%COMP%]   .submit-all-button[_ngcontent-%COMP%]{padding:25px 28px!important;font-size:1.1em;font-weight:500;letter-spacing:.5px;min-width:250px}.button-spinner[_ngcontent-%COMP%]{display:inline-block;vertical-align:middle;margin-right:10px}"]})};var hp=[{path:"",component:gi},{path:"create",component:fi}];export{hp as ORDERS_ROUTES};
