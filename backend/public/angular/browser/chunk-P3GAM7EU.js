import{b as D}from"./chunk-HXDGUKYX.js";import{a as y}from"./chunk-764HARQF.js";import{Ba as M,Ha as R,Ia as I,Kc as k,a as n,b as p,f as b,ga as v,hc as m,ic as l,la as u}from"./chunk-AIQW7TM2.js";function A(e){let t=m(()=>e());return H(t)?new Proxy(e,{get(o,r){return r in t?(R(o[r])||Object.defineProperty(o,r,{value:l(()=>o()[r]),configurable:!0}),A(o[r])):o[r]}}):e}var L=[WeakSet,WeakMap,Promise,Date,Error,RegExp,ArrayBuffer,DataView,Function];function H(e){if(e===null||typeof e!="object"||B(e))return!1;let t=Object.getPrototypeOf(e);if(t===Object.prototype)return!0;for(;t&&t!==Object.prototype;){if(L.includes(t.constructor))return!1;t=Object.getPrototypeOf(t)}return t===Object.prototype}function B(e){return typeof e?.[Symbol.iterator]=="function"}var F=new WeakMap,i=Symbol("STATE_SOURCE");function d(e,...t){e[i].update(o=>t.reduce((r,f)=>n(n({},r),typeof f=="function"?f(r):f),o)),z(e)}function _(e){return e[i]()}function q(e){return F.get(e[i])||[]}function z(e){let t=q(e);for(let o of t){let r=m(()=>_(e));o(r)}}function P(...e){let t=[...e],o=typeof t[0]=="function"?{}:t.shift(),r=t;return(()=>{class s{constructor(){let c=r.reduce((g,O)=>O(g),V()),{stateSignals:h,props:T,methods:U,hooks:K}=c,S=n(n(n({},h),T),U);this[i]=c[i];for(let g of Reflect.ownKeys(S))this[g]=S[g];let{onInit:j,onDestroy:w}=K;j&&j(),w&&u(M).onDestroy(w)}static \u0275fac=function(h){return new(h||s)};static \u0275prov=v({token:s,factory:s.\u0275fac,providedIn:o.providedIn||null})}return s})()}function V(){return{[i]:I({}),stateSignals:{},props:{},methods:{},hooks:{}}}function Y(e){return t=>{let o=e(n(n(n({[i]:t[i]},t.stateSignals),t.props),t.methods));return Reflect.ownKeys(o),p(n({},t),{props:n(n({},t.props),o)})}}function x(e){return Y(e)}function C(e){return t=>{let o=e(n(n(n({[i]:t[i]},t.stateSignals),t.props),t.methods));return Reflect.ownKeys(o),p(n({},t),{methods:n(n({},t.methods),o)})}}function W(e){return t=>{let o=typeof e=="function"?e():e,r=Reflect.ownKeys(o);t[i].update(s=>n(n({},s),o));let f=r.reduce((s,a)=>{let c=l(()=>t[i]()[a]);return p(n({},s),{[a]:A(c)})},{});return p(n({},t),{stateSignals:n(n({},t.stateSignals),f)})}}var E={isLoading:!1,error:null},at=P({providedIn:"root"},W(E),x((e,t=u(y))=>({currentUser:l(()=>t.currentUser()),isAuthenticated:l(()=>t.isAuthenticated())})),C((e,t=u(k),o=u(y),r=u(D))=>({login(s){return b(this,null,function*(){d(e,{isLoading:!0,error:null});try{let a=yield o.loginPromise(s);console.log("authResponse",a),r.open(`Welcome back, ${a.user.username}!`,"OK",{duration:3e3,verticalPosition:"top",panelClass:["success-snackbar"]}),t.navigate(["/configuracion/users"])}catch(a){let c=a.message||"Login failed. Please try again.";d(e,{error:c}),r.open(c,"Retry",{duration:5e3,verticalPosition:"top",panelClass:["error-snackbar"]})}finally{d(e,{isLoading:!1})}})},logout(){o.logout(),d(e,E),r.open("You have been logged out.","OK",{duration:3e3,verticalPosition:"top"})},clearError(){d(e,{error:null})}})));export{at as a};
