import{a as Le,b as Oe}from"./chunk-N24MSZBW.js";import{a as N,b as Te}from"./chunk-UKBDVULT.js";import{a as Ue,b as Me}from"./chunk-5PZ25QHJ.js";import"./chunk-2JNWSY3M.js";import{d as Se,e as Fe}from"./chunk-44LGRUYF.js";import{a as we,b as ke}from"./chunk-3IGH7FBX.js";import"./chunk-7RWCIHFI.js";import{A as he,D as xe,G as ve,H as be,b as oe,d as E,f as re,g as ae,l as le,o as se,p as me,q as ce,r as de,t as pe,u as ge,v as ue,x as _e,z as fe}from"./chunk-ICWTIKD4.js";import"./chunk-BWBG2IHT.js";import"./chunk-U3COC3EF.js";import{a as X,b as W,d as Y,f as Z,g as ee,i as te}from"./chunk-K4QNRRQ5.js";import{a as ie,b as ne}from"./chunk-ASKMK2H5.js";import"./chunk-XRPHOQB2.js";import{a as Ce,b as Pe,e as Ie}from"./chunk-2H2YZZAU.js";import"./chunk-NUMYIFQH.js";import{Bb as U,Db as g,Eb as u,Ec as Q,Gd as Ee,Hd as ye,Ib as J,Pb as S,Qb as s,Rb as O,S as M,Sb as x,T as C,Ta as P,Va as m,a as w,b as B,ba as b,cb as z,gc as V,h as j,ib as h,l as $,mb as c,na as k,rb as y,tb as q,ub as H,vb as o,wa as d,wb as i,wc as K,xa as p,xb as _,yb as T,zb as L}from"./chunk-YUSEJVZ2.js";var f=[];for(let a=0;a<256;++a)f.push((a+256).toString(16).slice(1));function Ve(a,e=0){return(f[a[e+0]]+f[a[e+1]]+f[a[e+2]]+f[a[e+3]]+"-"+f[a[e+4]]+f[a[e+5]]+"-"+f[a[e+6]]+f[a[e+7]]+"-"+f[a[e+8]]+f[a[e+9]]+"-"+f[a[e+10]]+f[a[e+11]]+f[a[e+12]]+f[a[e+13]]+f[a[e+14]]+f[a[e+15]]).toLowerCase()}var A,Ge=new Uint8Array(16);function G(){if(!A){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");A=crypto.getRandomValues.bind(crypto)}return A(Ge)}var Re=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),R={randomUUID:Re};function De(a,e,n){if(R.randomUUID&&!e&&!a)return R.randomUUID();a=a||{};let t=a.random??a.rng?.()??G();if(t.length<16)throw new Error("Random bytes length must be >= 16");if(t[6]=t[6]&15|64,t[8]=t[8]&63|128,e){if(n=n||0,n<0||n+16>e.length)throw new RangeError(`UUID byte range ${n}:${n+15} is out of buffer bounds`);for(let l=0;l<16;++l)e[n+l]=t[l];return e}return Ve(t)}var D=De;function Be(a,e){let n;return(n=e.get("id"))==null?null:n.value}function je(a,e){a&1&&(o(0,"div",12),_(1,"mat-progress-spinner",13),i())}function $e(a,e){a&1&&(o(0,"mat-error"),s(1," Se requiere el nombre de la empresa. "),i())}function ze(a,e){a&1&&(o(0,"mat-error"),s(1," Se requiere el ruc. "),i())}function qe(a,e){if(a&1&&(T(0),s(1," Archivo actual: "),o(2,"a",50),s(3),i(),L()),a&2){let n=u(2);m(2),c("href",n.currentExcelImportTemplateUrl,P),m(),O(n.currentExcelImportTemplateUrl.split("/").pop()||"View Terms")}}function He(a,e){a&1&&(o(0,"span",51),s(1,"A\xFAn no se ha cargado ning\xFAn archivo."),i())}function Je(a,e){a&1&&(o(0,"p",32),s(1," Sube un archivo "),i())}function Ke(a,e){if(a&1&&(o(0,"p",32),s(1),i()),a&2){let n=u(2);m(),x(" Selected: ",n.selectedExcelImportTemplateFile.name," ")}}function Qe(a,e){if(a&1&&(T(0),s(1," Archivo actual: "),o(2,"a",50),s(3),i(),L()),a&2){let n=u(2);m(2),c("href",n.currentTermsUrl,P),m(),O(n.currentTermsUrl.split("/").pop()||"View Terms")}}function Xe(a,e){a&1&&(o(0,"span",51),s(1,"A\xFAn no se ha cargado ning\xFAn PDF de T\xE9rminos y Condiciones."),i())}function We(a,e){a&1&&(o(0,"p",32),s(1," Sube un archivo PDF con tus t\xE9rminos y condiciones. "),i())}function Ye(a,e){if(a&1&&(o(0,"p",32),s(1),i()),a&2){let n=u(2);m(),x(" Selected: ",n.selectedTermsFile.name," ")}}function Ze(a,e){if(a&1){let n=U();o(0,"button",52),g("click",function(){d(n);let l=u(2);return p(l.removeGlobalNoticeImage())}),o(1,"mat-icon"),s(2,"delete_forever"),i(),s(3," Quitar imagen "),i()}}function et(a,e){a&1&&(o(0,"p",61),s(1),i()),a&2&&(m(),x(" Seleccionado: ",e.name," "))}function tt(a,e){a&1&&(o(0,"mat-error"),s(1,"Ingrese una URL v\xE1lida (ej. http:// o https://)."),i())}function it(a,e){a&1&&(o(0,"mat-error"),s(1,"M\xE1ximo 30 caracteres."),i())}function nt(a,e){a&1&&_(0,"mat-divider",65)}function ot(a,e){if(a&1){let n=U();o(0,"mat-card",53)(1,"mat-card-header",54)(2,"mat-card-title"),s(3),i(),o(4,"button",55),g("click",function(){let l=d(n).$index,r=u(2);return p(r.removePromotionalSet(l))}),o(5,"mat-icon"),s(6,"delete_outline"),i()()(),o(7,"mat-card-content"),_(8,"input",56),o(9,"div",57)(10,"p",58),s(11,"Imagen del Conjunto"),i(),o(12,"div",59),_(13,"img",60),i(),o(14,"input",30,7),g("change",function(l){let r=d(n).$index,v=u(2);return p(v.onPromotionalSetFileSelected(l,r))}),i(),o(16,"button",31),g("click",function(){d(n);let l=S(15);return p(l.click())}),o(17,"mat-icon"),s(18,"cloud_upload"),i(),s(19),i(),h(20,et,2,1,"p",61),i(),o(21,"mat-form-field",16)(22,"mat-label"),s(23,"Enlace (URL)"),i(),_(24,"input",62),o(25,"mat-icon",18),s(26,"link"),i(),h(27,tt,2,0,"mat-error"),i(),o(28,"mat-form-field",16)(29,"mat-label"),s(30,"Texto del Bot\xF3n"),i(),_(31,"input",63),h(32,it,2,0,"mat-error"),i(),o(33,"mat-slide-toggle",64),s(34," Activo "),i()()(),h(35,nt,1,0,"mat-divider",65)}if(a&2){let n,t,l,r,v,F=e.$implicit,I=e.$index,Ae=e.$count;c("formGroupName",I),m(3),x("Conjunto ",I+1,""),m(10),J("alt","Vista previa de imagen del conjunto ",I+1,""),c("src",((n=F.get("imagePreviewUrl"))==null?null:n.value)||"assets/images/placeholder-image.png",P),m(6),x(" ",(t=F.get("imageFile"))!=null&&t.value?"Cambiar Imagen":"Subir Imagen"," "),m(),y((l=(l=F.get("imageFile"))==null?null:l.value)?20:-1,l),m(7),y((r=F.get("linkUrl"))!=null&&r.hasError("pattern")?27:-1),m(5),y((v=F.get("buttonText"))!=null&&v.hasError("maxlength")?32:-1),m(3),y(I!==Ae-1?35:-1)}}function rt(a,e){if(a&1){let n=U();o(0,"mat-card",14)(1,"mat-card-content")(2,"form",15),g("ngSubmit",function(){d(n);let l=u();return p(l.onSaveSettings())}),o(3,"h2"),s(4,"Nombre del negocio"),i(),o(5,"mat-form-field",16)(6,"mat-label"),s(7,"Nombre de la empresa"),i(),_(8,"input",17),o(9,"mat-icon",18),s(10,"storefront"),i(),h(11,$e,2,0,"mat-error",19),i(),o(12,"mat-form-field",16)(13,"mat-label"),s(14,"RUC"),i(),_(15,"input",20),h(16,ze,2,0,"mat-error",19),i(),o(17,"mat-form-field",16)(18,"mat-label"),s(19,"Direcci\xF3n"),i(),_(20,"input",21),i(),o(21,"div",22)(22,"mat-form-field",23)(23,"mat-label"),s(24,"Telefono"),i(),_(25,"input",24),o(26,"mat-icon",18),s(27,"phone"),i()()(),o(28,"mat-form-field",16)(29,"mat-label"),s(30,"Enlace del mapa de cobertura"),i(),_(31,"input",25),i(),o(32,"h2"),s(33,"Marca y aspectos legales"),i(),o(34,"div",26)(35,"p",27),s(36,"Logotipo de empresa"),i(),o(37,"div",28),_(38,"img",29),i(),o(39,"input",30,0),g("change",function(l){d(n);let r=u();return p(r.onLogoFileSelected(l))}),i(),o(41,"button",31),g("click",function(){d(n);let l=S(40);return p(l.click())}),o(42,"mat-icon"),s(43,"cloud_upload"),i(),s(44),i(),o(45,"p",32),s(46,"Recomendado: PNG, JPG, SVG. Max 2MB."),i()(),o(47,"div",26)(48,"p",27),s(49,"Imagen de fondo"),i(),o(50,"div",28),_(51,"img",33),i(),o(52,"input",30,1),g("change",function(l){d(n);let r=u();return p(r.onLogoFileSelected3(l))}),i(),o(54,"button",31),g("click",function(){d(n);let l=S(53);return p(l.click())}),o(55,"mat-icon"),s(56,"cloud_upload"),i(),s(57),i(),o(58,"p",32),s(59,"Recomendado: PNG, JPG, SVG. Max 2MB."),i()(),o(60,"div",26)(61,"p",27),s(62,"imagen de las tarifas"),i(),o(63,"div",28),_(64,"img",34),i(),o(65,"input",30,2),g("change",function(l){d(n);let r=u();return p(r.onLogoFileSelected4(l))}),i(),o(67,"button",31),g("click",function(){d(n);let l=S(66);return p(l.click())}),o(68,"mat-icon"),s(69,"cloud_upload"),i(),s(70),i(),o(71,"p",32),s(72,"Recomendado: PNG, JPG, SVG. Max 2MB."),i()(),o(73,"div",35)(74,"p",27),s(75," Plantilla de Excel para importaci\xF3n "),i(),o(76,"div",36),h(77,qe,4,2,"ng-container",37)(78,He,2,0,"ng-template",null,3,V),i(),o(80,"input",38,4),g("change",function(l){d(n);let r=u();return p(r.onLogoFileSelected5(l))}),i(),o(82,"button",31),g("click",function(){d(n);let l=S(81);return p(l.click())}),o(83,"mat-icon"),s(84,"cloud_upload"),i(),s(85),i(),h(86,Je,2,0,"p",39)(87,Ke,2,1,"p",39),i(),o(88,"div",35)(89,"p",27),s(90," T\xE9rminos y condiciones (PDF) "),i(),o(91,"div",36),h(92,Qe,4,2,"ng-container",37)(93,Xe,2,0,"ng-template",null,3,V),i(),o(95,"input",40,5),g("change",function(l){d(n);let r=u();return p(r.onTermsFileSelected(l))}),i(),o(97,"button",31),g("click",function(){d(n);let l=S(96);return p(l.click())}),o(98,"mat-icon"),s(99,"cloud_upload"),i(),s(100),i(),h(101,We,2,0,"p",39)(102,Ye,2,1,"p",39),i(),o(103,"div",26)(104,"p",27),s(105,"imagen para avisos globales"),i(),o(106,"div",28),_(107,"img",41),i(),o(108,"input",30,6),g("change",function(l){d(n);let r=u();return p(r.onLogoFileSelected6(l))}),i(),o(110,"button",31),g("click",function(){d(n);let l=S(109);return p(l.click())}),o(111,"mat-icon"),s(112,"cloud_upload"),i(),s(113),i(),h(114,Ze,4,0,"button",42),o(115,"p",32),s(116,"Recomendado: PNG, JPG, SVG. Max 2MB."),i()(),_(117,"mat-divider",43),o(118,"div",44)(119,"h2"),s(120,"Conjuntos Promocionales/Banners (M\xE1x. 3)"),i(),o(121,"button",45),g("click",function(){d(n);let l=u();return p(l.addPromotionalSet())}),o(122,"mat-icon"),s(123,"add_circle_outline"),i(),s(124," A\xF1adir Conjunto "),i()(),o(125,"div",46),q(126,ot,36,10,null,null,Be),i(),o(128,"mat-card-actions",47)(129,"button",48),g("click",function(){d(n);let l=u();return p(l.onDiscardChanges())}),s(130," Descartar cambios "),i(),o(131,"button",49)(132,"mat-icon"),s(133,"save"),i(),s(134),i()()()()()}if(a&2){let n,t,l=S(79),r=u();m(2),c("formGroup",r.settingsForm),m(9),c("ngIf",(n=r.settingsForm.get("business_name"))==null?null:n.hasError("required")),m(5),c("ngIf",(t=r.settingsForm.get("ruc"))==null?null:t.hasError("required")),m(22),c("src",r.logoPreviewUrl,P),m(6),x(" ",r.selectedLogoFile?"Cambiar Logo ("+r.selectedLogoFile.name+")":"Subir nuevo logotipo"," "),m(7),c("src",r.backgroundImagePreviewUrl,P),m(6),x(" ",r.selectedBackgroundImageFile?"Change imagen ("+r.selectedBackgroundImageFile.name+")":"Subir nueva imagen"," "),m(7),c("src",r.ratesImagePreviewUrl,P),m(6),x(" ",r.selectedRatesImageFile?"Cambiar imagen ("+r.selectedRatesImageFile.name+")":"Subir nueva imagen"," "),m(7),c("ngIf",r.currentExcelImportTemplateUrl)("ngIfElse",l),m(8),x(" ",r.selectedExcelImportTemplateFile?"Cambiar archivo ("+r.selectedExcelImportTemplateFile.name+")":"Subir nuevo archivo"," "),m(),c("ngIf",!r.selectedExcelImportTemplateFile),m(),c("ngIf",r.selectedExcelImportTemplateFile),m(5),c("ngIf",r.currentTermsUrl)("ngIfElse",l),m(8),x(" ",r.selectedTermsFile?"Cambiar PDF ("+r.selectedTermsFile.name+")":"Subir nuevo PDF"," "),m(),c("ngIf",!r.selectedTermsFile),m(),c("ngIf",r.selectedTermsFile),m(5),c("src",r.globalNoticeImagePreviewUrl,P),m(6),x(" ",r.selectedGlobalNoticeImageFile?"Cambiar imagen ("+r.selectedGlobalNoticeImageFile.name+")":"Subir nueva imagen"," "),m(),c("ngIf",r.globalNoticeImagePreviewUrl&&r.globalNoticeImagePreviewUrl!=="assets/images/placeholder-image.png"),m(7),c("disabled",r.promotionalSetsFormArray.length>=3),m(5),H(r.promotionalSetsFormArray.controls),m(3),c("disabled",r.isSaving||!r.settingsForm.dirty),m(2),c("disabled",r.isSaving||r.settingsForm.invalid||!r.settingsForm.dirty),m(3),x(" ",r.isSaving?"Guardando...":"Guardar configuracion"," ")}}var Ne=class a{fb=k(ue);settingsService=k(Te);snackBar=k(we);settingsForm;isLoadingInitialData=!0;isSaving=!1;currentLogoUrl=null;selectedLogoFile=null;logoPreviewUrl=null;currentBackgroundImageUrl=null;selectedBackgroundImageFile=null;backgroundImagePreviewUrl=null;currentRatesImageUrl=null;selectedRatesImageFile=null;ratesImagePreviewUrl=null;currentExcelImportTemplateUrl=null;selectedExcelImportTemplateFile=null;currentTermsUrl=null;selectedTermsFile=null;currentGlobalNoticeImageUrl=null;selectedGlobalNoticeImageFile=null;globalNoticeImagePreviewUrl=null;destroy$=new $;get promotionalSetsFormArray(){return this.settingsForm.get("promotional_sets")}ngOnInit(){this.buildForm(N),this.loadCurrentSettings()}buildForm(e){this.settingsForm=this.fb.group({id:[e.id],business_name:[e.business_name,E.required],ruc:[e.ruc,E.required],address:[e.address],phone_number:[e.phone_number],logo_url:[e.logo_url],terms_conditions_url:[e.terms_conditions_url],global_notice_image_url:[e.global_notice_image_url],background_image_url:[e.background_image_url],rates_image_url:[e.rates_image_url],coverage_map_url:[e.coverage_map_url],promotional_sets:this.fb.array(e.promotional_sets.map(n=>this.createPromotionalSetGroup(n)))}),this.currentLogoUrl=e.logo_url,this.logoPreviewUrl=e.logo_url,this.currentBackgroundImageUrl=e.background_image_url,this.backgroundImagePreviewUrl=e.background_image_url,this.currentRatesImageUrl=e.rates_image_url,this.ratesImagePreviewUrl=e.rates_image_url,this.currentExcelImportTemplateUrl=e.excel_import_template_url,this.currentTermsUrl=e.terms_conditions_url,this.currentGlobalNoticeImageUrl=e.global_notice_image_url,this.globalNoticeImagePreviewUrl=e.global_notice_image_url,this.promotionalSetsFormArray.controls.forEach((n,t)=>{let l=e.promotional_sets[t];l&&n&&(n.addControl("imagePreviewUrl",this.fb.control(l.imageUrl)),n.addControl("imageFile",this.fb.control(null)))})}loadCurrentSettings(){this.isLoadingInitialData=!0,this.settingsService.loadSettings().pipe(b(this.destroy$),M(()=>this.isLoadingInitialData=!1)).subscribe({next:e=>{let n=e&&e.length>0?e[0]:N;this.promotionalSetsFormArray.clear(),(n.promotional_sets||[]).forEach(t=>{this.promotionalSetsFormArray.push(this.createPromotionalSetGroup(t))}),this.settingsForm.patchValue(B(w({},n),{promotional_sets:[]})),this.currentLogoUrl=n.logo_url,this.logoPreviewUrl=n.logo_url,this.currentBackgroundImageUrl=n.background_image_url,this.backgroundImagePreviewUrl=n.background_image_url,this.currentRatesImageUrl=n.rates_image_url,this.ratesImagePreviewUrl=n.rates_image_url,this.currentExcelImportTemplateUrl=n.excel_import_template_url,this.currentTermsUrl=n.terms_conditions_url,this.currentGlobalNoticeImageUrl=n.global_notice_image_url,this.globalNoticeImagePreviewUrl=n.global_notice_image_url},error:e=>{this.snackBar.open("No se pudo cargar la configuraci\xF3n actual. Int\xE9ntalo de nuevo.","Close",{duration:5e3,panelClass:["error-snackbar"],verticalPosition:"top"})}})}hasPendingFileUploads(){if(this.selectedLogoFile||this.selectedBackgroundImageFile||this.selectedTermsFile||this.selectedGlobalNoticeImageFile||this.selectedExcelImportTemplateFile)return!0;for(let e of this.promotionalSetsFormArray.controls)if(e.get("imageFile")?.value)return!0;return!1}createPromotionalSetGroup(e=null){let n=e?.id||D();return this.fb.group({id:[n,E.required],imageUrl:[e?.imageUrl||null],linkUrl:[e?.linkUrl||null,[E.pattern("https?://.+")]],buttonText:[e?.buttonText||null,[E.maxLength(30)]],isActive:[e?.isActive===void 0?!0:e.isActive],order:[e?.order||0],imageFile:[null],imagePreviewUrl:[e?.imageUrl||null]})}addPromotionalSet(){if(this.promotionalSetsFormArray.length<3){let e=this.createPromotionalSetGroup();this.promotionalSetsFormArray.push(e),this.settingsForm.markAsDirty()}else this.snackBar.open("Se permite un m\xE1ximo de 3 conjuntos promocionales.","OK",{duration:3e3,verticalPosition:"top"})}removePromotionalSet(e){this.promotionalSetsFormArray.removeAt(e),this.settingsForm.markAsDirty()}onPromotionalSetFileSelected(e,n){let l=e.target.files,r=this.promotionalSetsFormArray.at(n);if(l&&l.length>0){let v=l[0];r.patchValue({imageFile:v});let F=new FileReader;F.onload=I=>{r.patchValue({imagePreviewUrl:I.target.result})},F.readAsDataURL(v),this.settingsForm.markAsDirty()}else r.patchValue({imageFile:null,imagePreviewUrl:r.get("imageUrl")?.value||null})}onLogoFileSelected(e){let t=e.target.files;if(t&&t.length>0){this.selectedLogoFile=t[0];let l=new FileReader;l.onload=r=>{this.logoPreviewUrl=r.target.result},l.readAsDataURL(this.selectedLogoFile),this.settingsForm.get("logo_url")?.markAsDirty()}else this.selectedLogoFile=null,this.logoPreviewUrl=this.currentLogoUrl}onLogoFileSelected3(e){let t=e.target.files;if(t&&t.length>0){this.selectedBackgroundImageFile=t[0];let l=new FileReader;l.onload=r=>{this.backgroundImagePreviewUrl=r.target.result},l.readAsDataURL(this.selectedBackgroundImageFile),this.settingsForm.get("background_image_url")?.markAsDirty()}else this.selectedBackgroundImageFile=null,this.backgroundImagePreviewUrl=this.currentBackgroundImageUrl}onLogoFileSelected4(e){let t=e.target.files;if(t&&t.length>0){this.selectedRatesImageFile=t[0];let l=new FileReader;l.onload=r=>{this.ratesImagePreviewUrl=r.target.result},l.readAsDataURL(this.selectedRatesImageFile),this.settingsForm.get("rates_image_url")?.markAsDirty()}else this.selectedRatesImageFile=null,this.ratesImagePreviewUrl=this.currentRatesImageUrl}onLogoFileSelected5(e){let t=e.target.files;t&&t.length>0?(this.selectedExcelImportTemplateFile=t[0],this.settingsForm.get("terms_conditions_url")?.markAsDirty()):this.selectedExcelImportTemplateFile=null}onLogoFileSelected6(e){let t=e.target.files;if(t&&t.length>0){this.selectedGlobalNoticeImageFile=t[0];let l=new FileReader;l.onload=r=>{this.globalNoticeImagePreviewUrl=r.target.result},l.readAsDataURL(this.selectedGlobalNoticeImageFile),this.settingsForm.get("global_notice_image_url")?.markAsDirty()}else this.selectedGlobalNoticeImageFile=null,this.globalNoticeImagePreviewUrl=this.currentGlobalNoticeImageUrl}removeGlobalNoticeImage(){this.selectedGlobalNoticeImageFile=null,this.globalNoticeImagePreviewUrl="assets/images/placeholder-image.png",this.settingsForm.get("global_notice_image_url")?.setValue(null),this.settingsForm.get("global_notice_image_url")?.markAsDirty()}onTermsFileSelected(e){let t=e.target.files;t&&t.length>0?(this.selectedTermsFile=t[0],this.settingsForm.get("terms_conditions_url")?.markAsDirty(),console.log("Terms PDF selected:",this.selectedTermsFile.name)):this.selectedTermsFile=null}onSaveSettings(){return j(this,null,function*(){if(this.settingsForm.invalid){this.snackBar.open("Por favor corrija cualquier error en el formulario.","Close",{duration:3e3,panelClass:["error-snackbar"]}),this.settingsForm.markAllAsTouched();return}this.isSaving=!0;let e=w({},this.settingsForm.value),n=[];for(let t=0;t<this.promotionalSetsFormArray.length;t++){let l=this.promotionalSetsFormArray.at(t),r=w({},l.value);if(r.imageFile)try{let v=yield this.settingsService.uploadFile(r.imageFile).pipe(C(),b(this.destroy$)).toPromise();r.imageUrl=v?.file_url||r.imageUrl}catch(v){console.error(`Error uploading promotional set image ${t+1}:`,v),this.snackBar.open(`Error al cargar imagen del conjunto ${t+1}.`,"OK",{duration:3e3,verticalPosition:"top",panelClass:["error-snackbar"]})}delete r.imageFile,delete r.imagePreviewUrl,n.push(r)}if(e.promotional_sets=n,this.selectedLogoFile)try{let t=yield this.settingsService.uploadFile(this.selectedLogoFile).pipe(C(),b(this.destroy$)).toPromise();if(t?.file_url)e.logo_url=t.file_url;else throw new Error("Logo URL not returned from upload.")}catch(t){console.error("Logo upload failed:",t),this.snackBar.open("Error al cargar el logotipo. No se guardaron los ajustes.","Close",{duration:4e3,panelClass:["error-snackbar"],verticalPosition:"top"}),this.isSaving=!1;return}if(this.selectedBackgroundImageFile)try{let t=yield this.settingsService.uploadFile(this.selectedBackgroundImageFile).pipe(C(),b(this.destroy$)).toPromise();if(t?.file_url)e.background_image_url=t.file_url;else throw new Error("Logo URL not returned from upload.")}catch(t){console.error("Logo upload failed:",t),this.snackBar.open("Error al cargar el logotipo. No se guardaron los ajustes.","Close",{duration:4e3,panelClass:["error-snackbar"],verticalPosition:"top"}),this.isSaving=!1;return}if(this.selectedRatesImageFile)try{let t=yield this.settingsService.uploadFile(this.selectedRatesImageFile).pipe(C(),b(this.destroy$)).toPromise();if(t?.file_url)e.rates_image_url=t.file_url;else throw new Error("Logo URL not returned from upload.")}catch(t){console.error("Logo upload failed:",t),this.snackBar.open("Error al cargar el logotipo. No se guardaron los ajustes.","Close",{duration:4e3,panelClass:["error-snackbar"],verticalPosition:"top"}),this.isSaving=!1;return}if(this.selectedExcelImportTemplateFile)try{let t=yield this.settingsService.uploadFile(this.selectedExcelImportTemplateFile).pipe(C(),b(this.destroy$)).toPromise();if(t?.file_url)e.excel_import_template_url=t.file_url;else throw new Error("Logo URL not returned from upload.")}catch(t){console.error("Logo upload failed:",t),this.snackBar.open("Error al cargar el logotipo. No se guardaron los ajustes.","Close",{duration:4e3,panelClass:["error-snackbar"],verticalPosition:"top"}),this.isSaving=!1;return}if(this.selectedTermsFile)try{let t=yield this.settingsService.uploadFile(this.selectedTermsFile).pipe(C(),b(this.destroy$)).toPromise();if(t?.file_url)e.terms_conditions_url=t.file_url;else throw new Error("Terms & Conditions URL not returned from PDF upload.")}catch(t){console.error("Terms PDF upload failed:",t),this.snackBar.open("Terms & Conditions PDF upload failed. Settings not saved.","Close",{duration:4e3,panelClass:["error-snackbar"],verticalPosition:"top"}),this.isSaving=!1;return}if(this.selectedGlobalNoticeImageFile)try{let t=yield this.settingsService.uploadFile(this.selectedGlobalNoticeImageFile).pipe(C(),b(this.destroy$)).toPromise();if(t?.file_url)e.global_notice_image_url=t.file_url;else throw new Error("Logo URL not returned from upload.")}catch(t){console.error("Logo upload failed:",t),this.snackBar.open("Error al cargar el logotipo. No se guardaron los ajustes.","Close",{duration:4e3,panelClass:["error-snackbar"],verticalPosition:"top"}),this.isSaving=!1;return}else e.global_notice_image_url="";this.settingsService.saveSettings(e).pipe(b(this.destroy$),M(()=>this.isSaving=!1)).subscribe({next:t=>{this.snackBar.open("\xA1Configuraci\xF3n guardada exitosamente!","OK",{duration:3e3,verticalPosition:"top",panelClass:["success-snackbar"]}),this.buildForm(t),this.settingsForm.markAsPristine(),this.selectedLogoFile=null,this.selectedBackgroundImageFile=null,this.selectedRatesImageFile=null,this.selectedExcelImportTemplateFile=null,this.selectedTermsFile=null,this.selectedGlobalNoticeImageFile=null},error:t=>{this.snackBar.open("No se pudo guardar la configuraci\xF3n. Int\xE9ntalo de nuevo.","Retry",{duration:5e3,verticalPosition:"top",panelClass:["error-snackbar"]})}})})}onDiscardChanges(){this.loadCurrentSettings(),this.snackBar.open("Cambios descartados.","OK",{duration:2e3,verticalPosition:"top"})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(n){return new(n||a)};static \u0275cmp=z({type:a,selectors:[["app-settings-page"]],decls:6,vars:2,consts:[["logoUploadInput",""],["logoUploadInput3",""],["logoUploadInput4",""],["noTermsFile",""],["termsUploadInput2",""],["termsUploadInput",""],["logoUploadInput6",""],["promoSetUploadInput",""],[1,"page-container","settings-container"],[1,"page-header"],["class","spinner-overlay",4,"ngIf"],["class","settings-card",4,"ngIf"],[1,"spinner-overlay"],["mode","indeterminate","diameter","60"],[1,"settings-card"],[3,"ngSubmit","formGroup"],["appearance","outline",1,"full-width"],["matInput","","formControlName","business_name","required",""],["matSuffix",""],[4,"ngIf"],["matInput","","formControlName","ruc","required",""],["matInput","","formControlName","address"],[1,"form-row"],["appearance","outline",1,"flex-field"],["matInput","","formControlName","phone_number"],["matInput","","formControlName","coverage_map_url"],[1,"logo-section","file-upload-section"],[1,"mat-body-1","section-subtitle"],[1,"logo-preview-container"],["alt","Vista previa del logotipo",1,"logo-preview",3,"src"],["type","file","accept","image/png, image/jpeg, image/svg+xml",2,"display","none",3,"change"],["mat-stroked-button","","type","button",1,"upload-button","btn-corp-secondary",3,"click"],[1,"mat-caption","hint"],["alt","Vista previa del imagen de fondo",1,"logo-preview",3,"src"],["alt","Vista previa del imagen de las tarifas",1,"logo-preview",3,"src"],[1,"terms-pdf-section","file-upload-section"],[1,"current-file-info"],[4,"ngIf","ngIfElse"],["type","file",2,"display","none",3,"change"],["class","mat-caption hint",4,"ngIf"],["type","file","accept","application/pdf",2,"display","none",3,"change"],["alt","Vista previa de imagen para avisos globales",1,"logo-preview",3,"src"],["mat-stroked-button","","type","button","class","remove-button btn-corp-warn btn-corp-primary",3,"click",4,"ngIf"],[1,"section-divider"],[1,"section-header-with-action"],["mat-stroked-button","","type","button",1,"btn-corp-primary",3,"click","disabled"],["formArrayName","promotional_sets"],["align","end",1,"form-actions"],["mat-stroked-button","","type","button",1,"btn-corp-secondary",3,"click","disabled"],["mat-flat-button","","type","submit",1,"btn-corp-primary",3,"disabled"],["target","_blank",1,"file-link",3,"href"],[1,"no-file-text"],["mat-stroked-button","","type","button",1,"remove-button","btn-corp-warn","btn-corp-primary",3,"click"],["appearance","outlined",1,"promotional-set-item",3,"formGroupName"],[1,"item-header"],["mat-icon-button","","color","warn","type","button","matTooltip","Eliminar este conjunto",3,"click"],["type","hidden","formControlName","id"],[1,"file-upload-section","compact-upload"],[1,"mat-body-1"],[1,"logo-preview-container","small-preview"],[1,"logo-preview",3,"src","alt"],[1,"mat-caption","hint","selected-file-name"],["matInput","","formControlName","linkUrl","placeholder","https://ejemplo.com/oferta"],["matInput","","formControlName","buttonText","placeholder","Ej: Ver M\xE1s, Comprar Ahora","maxlength","30"],["formControlName","isActive","color","primary",1,"is-active-toggle"],[1,"item-divider"]],template:function(n,t){n&1&&(o(0,"div",8)(1,"div",9)(2,"h1"),s(3,"Configuraci\xF3n de la aplicaci\xF3n"),i()(),h(4,je,2,0,"div",10)(5,rt,135,26,"mat-card",11),i()),n&2&&(m(4),c("ngIf",t.isLoadingInitialData),m(),c("ngIf",!t.isLoadingInitialData&&t.settingsForm))},dependencies:[Q,K,_e,le,oe,re,ae,pe,ge,se,de,me,ce,te,X,Z,Y,ee,W,be,ve,fe,he,xe,Fe,Se,Ie,Pe,Ce,ye,Ee,ke,ne,ie,Me,Ue,Oe,Le],styles:[".page-container[_ngcontent-%COMP%]{padding:24px}.settings-container[_ngcontent-%COMP%]{max-width:800px;margin:0 auto}.page-header[_ngcontent-%COMP%]{margin-bottom:24px}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:2em;font-weight:500;color:var(--mat-toolbar-standard-title-text-color, #333)}.spinner-overlay[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;position:fixed;top:0;left:0;width:100%;height:100%;background-color:#ffffffb3;z-index:1000}h2[_ngcontent-%COMP%]{font-size:1.5em;margin-top:24px;margin-bottom:16px;padding-bottom:8px;border-bottom:1px solid rgba(0,0,0,.12);color:var(--mat-card-title-text-color, #333);font-weight:400}h2[_ngcontent-%COMP%]:first-of-type{margin-top:0}.full-width[_ngcontent-%COMP%]{width:100%;margin-bottom:20px}.form-row[_ngcontent-%COMP%]{display:flex;gap:20px;margin-bottom:20px}.form-row[_ngcontent-%COMP%]   .flex-field[_ngcontent-%COMP%]{flex:1}.logo-section[_ngcontent-%COMP%]{margin-bottom:24px;padding:16px;border:1px solid #e0e0e0;border-radius:4px;background-color:#fafafa}.logo-section[_ngcontent-%COMP%]   .mat-body-1[_ngcontent-%COMP%]{font-weight:500;margin-bottom:12px}.logo-preview-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;margin-bottom:16px;min-height:120px}.logo-preview[_ngcontent-%COMP%]{max-width:200px;max-height:100px;object-fit:contain;border:1px solid #ccc;border-radius:4px;background-color:#fff;padding:5px}.hint[_ngcontent-%COMP%]{display:block;text-align:center;color:#757575}.form-actions[_ngcontent-%COMP%]{margin-top:32px;padding-top:24px;border-top:1px solid rgba(0,0,0,.12)}.file-upload-section[_ngcontent-%COMP%]{margin-bottom:24px;padding:16px;border:1px solid #e0e0e0;border-radius:8px;background-color:#f9f9f9}.file-upload-section[_ngcontent-%COMP%]   .section-subtitle[_ngcontent-%COMP%]{font-weight:500;margin-bottom:12px;font-size:1.1em;color:#424242}.logo-preview-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;margin-bottom:16px;min-height:120px;background-color:#f0f0f0;border-radius:4px}.logo-preview[_ngcontent-%COMP%]{max-width:200px;max-height:100px;object-fit:contain;border:1px dashed #ccc;padding:5px}.terms-pdf-section[_ngcontent-%COMP%]   .current-file-info[_ngcontent-%COMP%]{margin-bottom:12px;font-size:.9em}.terms-pdf-section[_ngcontent-%COMP%]   .current-file-info[_ngcontent-%COMP%]   .file-link[_ngcontent-%COMP%]{color:var(--mat-primary-default, #3f51b5);text-decoration:none;font-weight:500}.terms-pdf-section[_ngcontent-%COMP%]   .current-file-info[_ngcontent-%COMP%]   .file-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.terms-pdf-section[_ngcontent-%COMP%]   .current-file-info[_ngcontent-%COMP%]   .no-file-text[_ngcontent-%COMP%]{font-style:italic;color:#757575}.upload-button[_ngcontent-%COMP%]{display:block;margin:0 auto 8px}.hint[_ngcontent-%COMP%]{display:block;text-align:center;color:#757575;font-size:.85em}.section-divider[_ngcontent-%COMP%]{margin:32px 0}.section-header-with-action[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}.section-header-with-action[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0}.promotional-set-item[_ngcontent-%COMP%]{margin-bottom:24px;padding:16px;border-radius:8px}.promotional-set-item[_ngcontent-%COMP%]   .item-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding-bottom:12px;margin-bottom:16px;border-bottom:1px solid #eee}.promotional-set-item[_ngcontent-%COMP%]   .item-header[_ngcontent-%COMP%]   mat-card-title[_ngcontent-%COMP%]{font-size:1.1em;font-weight:500}.promotional-set-item[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]{padding-top:0}.compact-upload[_ngcontent-%COMP%]   .section-subtitle[_ngcontent-%COMP%]{font-size:.9em;margin-bottom:8px}.compact-upload[_ngcontent-%COMP%]   .logo-preview-container.small-preview[_ngcontent-%COMP%]{height:80px;width:auto;max-width:150px;margin-bottom:8px;border:1px dashed #ccc}.compact-upload[_ngcontent-%COMP%]   .logo-preview[_ngcontent-%COMP%]{max-height:100%;max-width:100%;object-fit:contain}.compact-upload[_ngcontent-%COMP%]   .upload-button[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:4px}.compact-upload[_ngcontent-%COMP%]   .hint[_ngcontent-%COMP%]{margin-top:0}.is-active-toggle[_ngcontent-%COMP%]{margin-top:16px;margin-bottom:8px;display:block}.item-divider[_ngcontent-%COMP%]{margin-top:0;margin-bottom:24px}.selected-file-name[_ngcontent-%COMP%]{font-style:italic;color:#555;font-size:.8em}"]})};export{Ne as SettingsPageComponent};
