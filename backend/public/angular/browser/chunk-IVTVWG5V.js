import{a as dr}from"./chunk-H4NNRUMC.js";import{a as ui}from"./chunk-XHB5JMZP.js";import{a as gi,b as pr}from"./chunk-KHWSM7FZ.js";import"./chunk-TICF6Q7F.js";import{a as mr}from"./chunk-JXSQJBTT.js";import{a as si,b as ci,c as pi}from"./chunk-XC2RTFDJ.js";import{a as oe}from"./chunk-IGZPKPTU.js";import{a as kt,b as Ft,c as Tt}from"./chunk-H7P4GO3Q.js";import{b as sr,c as cr}from"./chunk-INNR5TUR.js";import{a as Qi,b as Xi}from"./chunk-JOWSY7RZ.js";import{i as Yi}from"./chunk-OMPPSW6K.js";import{a as ti,b as ii,c as ri,d as ni}from"./chunk-ZKSEBIMY.js";import"./chunk-GDDGCRCE.js";import{a as Zi,b as Ji,c as er}from"./chunk-MZOTBTYR.js";import"./chunk-F5X5MWHG.js";import{a as Ke,b as Qe,c as Xe,d as Ye,e as Ze,f as Je,g as et,h as tt,i as it,j as rt,k as tr,l as nt,m as St,n as mi,o as nr,p as or}from"./chunk-PM3VLQI7.js";import"./chunk-MS4AQ6UA.js";import{a as ir,b as Mt,d as di,e as rr}from"./chunk-URZB77TE.js";import{a as Et,b as Ve}from"./chunk-WNVFSXTV.js";import{a as xt,b as Ot}from"./chunk-CZEPZVE5.js";import"./chunk-BYXBJQAS.js";import{a as _e,b as fe,c as oi,e as Te,f as he,g as Ce,h as ne}from"./chunk-GXNIZWNA.js";import"./chunk-74KGK7YW.js";import{a as We}from"./chunk-K72O7MSM.js";import{a as ar,b as lr}from"./chunk-VQMPHLXF.js";import{a as Dt,b as wt,c as Pt,d as ot}from"./chunk-WF66USBX.js";import{c as li,d as yt}from"./chunk-PKHWH5C3.js";import{b as ai}from"./chunk-4UMFQSK3.js";import"./chunk-3PSRRXT4.js";import{a as Ie,b as Ae}from"./chunk-5PZ25QHJ.js";import{d as Re}from"./chunk-UAHG2GVE.js";import"./chunk-FR3NO5YB.js";import"./chunk-2JNWSY3M.js";import{a as bt,d as ie,e as re}from"./chunk-6IG52UKJ.js";import{a as ge,b as Fe}from"./chunk-3IGH7FBX.js";import"./chunk-7RWCIHFI.js";import{A as H,B as te,C as ei,D as vt,E as ke,H as W,I as K,b as Y,d as b,f as U,g as Z,h as Jt,j as Se,l as Pe,m as je,n as He,o as J,r as pe,t as ht,u as Ct,w as ee,y as j}from"./chunk-2ONXJ7S3.js";import"./chunk-BWBG2IHT.js";import"./chunk-U3COC3EF.js";import{a as Ui,b as ji,d as Hi,g as Wi,i as Ki}from"./chunk-K4QNRRQ5.js";import{a as De,b as we}from"./chunk-ASKMK2H5.js";import"./chunk-XRPHOQB2.js";import{a as ue,b as N,e as T}from"./chunk-2H2YZZAU.js";import"./chunk-NUMYIFQH.js";import{$ as Be,$b as qi,Ac as G,Bb as E,Bc as ft,Cc as X,Db as f,Ea as B,Eb as u,Ec as F,F as Ht,Gd as $,Hd as I,I as Ee,J as me,K as Wt,Ka as A,Kb as dt,Lb as mt,Mb as st,Pb as V,Q as se,Qb as a,Rb as w,S as Vi,Sb as g,Sc as Gi,Ub as ut,Va as l,Xc as Yt,Yc as Zt,Za as z,Zb as $e,_b as zi,a as Q,aa as Le,ac as Kt,b as le,ba as P,bc as v,c as Fi,cb as k,cc as R,da as Me,dc as M,fc as ce,gc as gt,h as jt,ia as Ni,ib as c,jc as $i,l as de,lb as Li,m as Ri,mb as m,na as O,pc as Qt,rb as L,t as ye,tb as ze,ub as qe,uc as Ge,va as Bi,vb as o,vc as _t,w as Ti,wa as h,wb as n,wc as q,xa as C,xb as p,yb as y,yc as Ue,zb as S,zc as Xt}from"./chunk-YUSEJVZ2.js";function vr(i,e){if(i&1&&(o(0,"mat-option",8),a(1),n()),i&2){let t=e.$implicit;m("value",t),l(),g(" ",t," ")}}var _i=class i{filtersChanged=new B;filterForm;orderStatuses$;orderService=O(oe);fb=O(ee);datePipe=O(G);destroy$=new de;constructor(){let e=new Date,t=new Date(e.getFullYear(),e.getMonth(),1),r=new Date(e.getFullYear(),e.getMonth()+1,0);this.filterForm=this.fb.group({start_date:[t],end_date:[r],status:[null],search_term:[""]}),this.orderStatuses$=this.orderService.getOrderStatuses()}ngOnInit(){this.filterForm.valueChanges.pipe(P(this.destroy$),me(400),se((e,t)=>JSON.stringify(e)===JSON.stringify(t))).subscribe(()=>{this.applyFilters()})}applyFilters(){let e=this.filterForm.value,t={start_date:e.start_date?this.datePipe.transform(e.start_date,"yyyy-MM-dd"):null,end_date:e.end_date?this.datePipe.transform(e.end_date,"yyyy-MM-dd"):null,status:e.status||null,search_term:e.search_term?.trim()||null};console.log("OrderFiltersComponent: Emitting filters",t),this.filtersChanged.emit(t)}clearFilters(){this.filterForm.reset({start_date:null,end_date:null,status:null,search_term:""})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=k({type:i,selectors:[["app-order-filters"]],outputs:{filtersChanged:"filtersChanged"},features:[$e([yt(),G])],decls:36,vars:9,consts:[["startDatePicker",""],["endDatePicker",""],[1,"filters-container",3,"formGroup"],["appearance","outline"],["matInput","","formControlName","start_date","placeholder","mm/dd/yyyy",3,"matDatepicker"],["matSuffix","",3,"for"],["matInput","","formControlName","end_date","placeholder","mm/dd/yyyy",3,"matDatepicker"],["formControlName","status","placeholder","Seleccione estado..."],[3,"value"],[3,"value",4,"ngFor","ngForOf"],[1,"filter-actions"],["appearance","outline",2,"margin-top","15px"],["matInput","","formControlName","search_term","placeholder","Buscar..."],["mat-flat-button","","type","button",1,"btn-corp-primary",3,"click"],["mat-stroked-button","","type","button",1,"btn-corp-secondary",3,"click"]],template:function(t,r){if(t&1){let d=E();o(0,"form",2)(1,"mat-form-field",3)(2,"mat-label"),a(3,"Fecha de entrega inicio"),n(),p(4,"input",4)(5,"mat-datepicker-toggle",5)(6,"mat-datepicker",null,0),n(),o(8,"mat-form-field",3)(9,"mat-label"),a(10,"Fecha de entrega fin"),n(),p(11,"input",6)(12,"mat-datepicker-toggle",5)(13,"mat-datepicker",null,1),n(),o(15,"mat-form-field",3)(16,"mat-label"),a(17,"Estado"),n(),o(18,"mat-select",7)(19,"mat-option",8),a(20,"Todos"),n(),c(21,vr,2,2,"mat-option",9),v(22,"async"),n()(),o(23,"div",10)(24,"mat-form-field",11)(25,"mat-label"),a(26,"Buscar"),n(),p(27,"input",12),n(),o(28,"button",13),f("click",function(){return h(d),C(r.applyFilters())}),o(29,"mat-icon"),a(30,"search"),n(),a(31," Buscar "),n(),o(32,"button",14),f("click",function(){return h(d),C(r.clearFilters())}),o(33,"mat-icon"),a(34,"clear_all"),n(),a(35," Limpiar "),n()()()}if(t&2){let d=V(7),s=V(14);m("formGroup",r.filterForm),l(4),m("matDatepicker",d),l(),m("for",d),l(6),m("matDatepicker",s),l(),m("for",s),l(7),m("value",null),l(2),m("ngForOf",R(22,7,r.orderStatuses$))}},dependencies:[F,_t,Ue,j,Pe,Y,U,Z,J,pe,K,W,H,ke,re,ie,ot,Dt,wt,Pt,li,Ve,Et,Re,T,N,I,$],styles:[".filters-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:10px;align-items:flex-start;padding:6px;background-color:var(--sys-surface-container-low);border-radius:8px;box-shadow:0 1px 3px #00000014}mat-form-field[_ngcontent-%COMP%]{min-width:200px;flex-grow:1}.filter-actions[_ngcontent-%COMP%]{display:flex;gap:10px;align-items:center!important;justify-content:center!important;min-width:100%}@media (max-width: 768px){.filters-container[_ngcontent-%COMP%]{flex-direction:column}mat-form-field[_ngcontent-%COMP%]{width:100%;min-width:unset}}@media (max-width: 768px) and (max-width: 480px){mat-form-field[_ngcontent-%COMP%]{width:100%}.filter-actions[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch!important}}"]})};function br(i,e){if(i&1&&(o(0,"mat-grid-tile")(1,"div",9)(2,"mat-icon",10),a(3,"account_circle"),n(),o(4,"div")(5,"div",11),a(6,"Usuario Creador"),n(),o(7,"div",12),a(8),v(9,"default"),n()()()()),i&2){let t=u();l(8),g(" ",M(9,1,t.data.order.user==null?null:t.data.order.user.username,"N/A")," ")}}function xr(i,e){if(i&1&&(o(0,"mat-grid-tile")(1,"div",9)(2,"mat-icon",10),a(3,"account_circle"),n(),o(4,"div")(5,"div",11),a(6,"Motorizado"),n(),o(7,"div",12),a(8),v(9,"default"),n()()()()),i&2){let t=u();l(8),g(" ",M(9,1,t.data.order.assigned_driver==null?null:t.data.order.assigned_driver.username,"N/A")," ")}}function Or(i,e){if(i&1&&(o(0,"mat-grid-tile")(1,"div",9)(2,"mat-icon",10),a(3,"explore"),n(),o(4,"div")(5,"div",11),a(6,"Coordenadas"),n(),o(7,"div",12),a(8),n()()()()),i&2){let t=u();l(8),g(" ",t.data.order.delivery_coordinates," ")}}function yr(i,e){i&1&&p(0,"mat-divider")}function Sr(i,e){if(i&1&&(o(0,"mat-grid-tile")(1,"div",9)(2,"mat-icon",10),a(3,"aspect_ratio"),n(),o(4,"div")(5,"div",11),a(6,"Tama\xF1o Paquete"),n(),o(7,"div",12),a(8),v(9,"titlecase"),n()()()()),i&2){let t=u();l(8),g(" ",R(9,1,t.data.order.package_size_type)," ")}}function Er(i,e){if(i&1&&(o(0,"mat-grid-tile")(1,"div",9)(2,"mat-icon",10),a(3,"fitness_center"),n(),o(4,"div")(5,"div",11),a(6,"Peso (kg)"),n(),o(7,"div",12),a(8),v(9,"number"),n()()()()),i&2){let t=u();l(8),g(" ",M(9,1,t.data.order.package_weight_kg,"1.1-2")," kg ")}}function Mr(i,e){if(i&1&&(o(0,"mat-grid-tile")(1,"div",9)(2,"mat-icon",10),a(3,"width_normal"),n(),o(4,"div")(5,"div",11),a(6,"Dimensiones (cm)"),n(),o(7,"div",12),a(8),n()()()()),i&2){let t=u();l(8),ut(" An: ",t.data.order.package_width_cm," x L: ",t.data.order.package_length_cm," x Al: ",t.data.order.package_height_cm," ")}}function Dr(i,e){if(i&1&&(o(0,"mat-grid-tile")(1,"div",9)(2,"mat-icon",10),a(3,"credit_card"),n(),o(4,"div")(5,"div",11),a(6,"M\xE9todo de Cobro"),n(),o(7,"div",12),a(8),v(9,"titlecase"),n()()()()),i&2){let t=u();l(8),g(" ",R(9,1,t.data.order.payment_method_for_collection)," ")}}function wr(i,e){if(i&1&&(o(0,"div",24)(1,"div",25)(2,"mat-icon"),a(3,"speaker_notes"),n(),a(4," Observaciones Cliente/Pedido: "),n(),o(5,"p",26),a(6),n()()),i&2){let t=u(2);l(6),w(t.data.order.observations)}}function Pr(i,e){i&1&&p(0,"mat-divider")}function kr(i,e){if(i&1&&(o(0,"div",24)(1,"div",25)(2,"mat-icon"),a(3,"warehouse"),n(),a(4," Tipo de Transferencia a Almac\xE9n: "),n(),o(5,"p",26),a(6),v(7,"titlecase"),n()()),i&2){let t=u(2);l(6),g(" ",R(7,1,t.data.order.type_order_transfer_to_warehouse)," ")}}function Fr(i,e){if(i&1&&(o(0,"mat-card",5)(1,"mat-card-header",6)(2,"mat-card-title"),a(3,"Observaciones y Log\xEDstica"),n()(),o(4,"mat-card-content"),c(5,wr,7,1,"div",23)(6,Pr,1,0,"mat-divider",13)(7,kr,8,3,"div",23),n()()),i&2){let t=u();l(5),m("ngIf",t.data.order.observations),l(),m("ngIf",t.data.order.observations&&t.data.order.type_order_transfer_to_warehouse),l(),m("ngIf",t.data.order.type_order_transfer_to_warehouse)}}var hi=class i{constructor(e,t){this.dialogRef=e;this.data=t;console.log("data",t)}OrderStatusEnum=ui;getStatusBadgeClass(e){return e?`status-${e.toString().toLowerCase().replace(/[\s_]+/g,"-")}`:"status-desconocido"}onClose(){this.dialogRef.close()}openMaps(e){e&&window.open(`https://www.google.com/maps/search/?api=1&query=${e}`,"_blank")}callPhone(e){e&&(window.location.href=`tel:${e}`)}printOrder(){console.log("Imprimiendo pedido (simulado):",this.data.order.code),this.dialogRef.close("print")}static \u0275fac=function(t){return new(t||i)(z(_e),z(fe))};static \u0275cmp=k({type:i,selectors:[["app-order-detail-dialog"]],decls:142,vars:66,consts:[["cdkDrag","","cdkDragRootElement",".cdk-overlay-pane","cdkDragHandle",".dialog-header-draggable",1,"dialog-container"],[1,"dialog-header","dialog-header-draggable"],["mat-dialog-title",""],[1,"order-code-chip"],["tabindex","-1",1,"dialog-content"],["appearance","outlined",1,"info-card"],[1,"compact-card-header"],[1,"status-badge-dialog",3,"ngClass"],["cols","2","rowHeight","80px"],[1,"detail-item"],[1,"detail-icon"],[1,"detail-label"],[1,"detail-value"],[4,"ngIf"],["cols","2","rowHeight","90px"],[1,"detail-item",3,"click"],[1,"detail-value","link-like"],[3,"colspan"],[1,"item-description"],[1,"detail-value","bold-value"],["appearance","outlined","class","info-card",4,"ngIf"],["align","end",1,"dialog-actions"],["mat-flat-button","",1,"btn-corp-primary",3,"click"],["class","detail-block",4,"ngIf"],[1,"detail-block"],[1,"detail-label-block"],[1,"detail-value-block"]],template:function(t,r){t&1&&(o(0,"div",0)(1,"div",1)(2,"h2",2),a(3,"Detalles del Pedido"),n(),o(4,"span",3),a(5),n()(),o(6,"mat-dialog-content",4)(7,"mat-card",5)(8,"mat-card-header",6)(9,"mat-card-title"),a(10,"Informaci\xF3n General"),n(),o(11,"span",7),a(12),v(13,"titlecase"),n()(),o(14,"mat-card-content")(15,"mat-grid-list",8)(16,"mat-grid-tile")(17,"div",9)(18,"mat-icon",10),a(19,"local_shipping"),n(),o(20,"div")(21,"div",11),a(22,"Tipo de Env\xEDo"),n(),o(23,"div",12),a(24),v(25,"titlecase"),v(26,"default"),n()()()(),o(27,"mat-grid-tile")(28,"div",9)(29,"mat-icon",10),a(30,"calendar_today"),n(),o(31,"div")(32,"div",11),a(33,"Fecha Registro"),n(),o(34,"div",12),a(35),v(36,"date"),v(37,"default"),n()()()(),o(38,"mat-grid-tile")(39,"div",9)(40,"mat-icon",10),a(41,"event_available"),n(),o(42,"div")(43,"div",11),a(44,"Fecha Entrega Prog."),n(),o(45,"div",12),a(46),v(47,"date"),v(48,"default"),n()()()(),c(49,br,10,4,"mat-grid-tile",13)(50,xr,10,4,"mat-grid-tile",13),n()()(),o(51,"mat-card",5)(52,"mat-card-header",6)(53,"mat-card-title"),a(54,"Destinatario y Entrega"),n()(),o(55,"mat-card-content")(56,"mat-grid-list",14)(57,"mat-grid-tile")(58,"div",9)(59,"mat-icon",10),a(60,"person_pin"),n(),o(61,"div")(62,"div",11),a(63,"Nombre Destinatario"),n(),o(64,"div",12),a(65),v(66,"default"),n()()()(),o(67,"mat-grid-tile")(68,"div",15),f("click",function(){return r.callPhone(r.data.order.recipient_phone)}),o(69,"mat-icon",10),a(70,"phone_iphone"),n(),o(71,"div")(72,"div",11),a(73,"Tel\xE9fono Destinatario"),n(),o(74,"div",16),a(75),n()()()(),o(76,"mat-grid-tile",17)(77,"div",9)(78,"mat-icon",10),a(79,"location_on"),n(),o(80,"div")(81,"div",11),a(82,"Direcci\xF3n de Entrega"),n(),o(83,"div",12),a(84),v(85,"default"),n()()()(),o(86,"mat-grid-tile")(87,"div",9)(88,"mat-icon",10),a(89,"map"),n(),o(90,"div")(91,"div",11),a(92,"Distrito"),n(),o(93,"div",12),a(94),v(95,"titlecase"),v(96,"default"),n()()()(),c(97,Or,9,1,"mat-grid-tile",13),n()()(),o(98,"mat-card",5)(99,"mat-card-header",6)(100,"mat-card-title"),a(101,"Detalles del Envio"),n()(),o(102,"mat-card-content")(103,"p",18),a(104),v(105,"default"),n(),c(106,yr,1,0,"mat-divider",13),o(107,"mat-grid-list",8),c(108,Sr,10,3,"mat-grid-tile",13)(109,Er,10,4,"mat-grid-tile",13)(110,Mr,9,3,"mat-grid-tile",13),n()()(),o(111,"mat-card",5)(112,"mat-card-header",6)(113,"mat-card-title"),a(114,"Informaci\xF3n Financiera"),n()(),o(115,"mat-card-content")(116,"mat-grid-list",8)(117,"mat-grid-tile")(118,"div",9)(119,"mat-icon",10),a(120,"payments"),n(),o(121,"div")(122,"div",11),a(123,"Monto a Cobrar Entrega"),n(),o(124,"div",19),a(125),v(126,"currency"),n()()()(),o(127,"mat-grid-tile")(128,"div",9)(129,"mat-icon",10),a(130,"local_atm"),n(),o(131,"div")(132,"div",11),a(133,"Costo de Env\xEDo"),n(),o(134,"div",19),a(135),v(136,"currency"),n()()()(),c(137,Dr,10,3,"mat-grid-tile",13),n()()(),c(138,Fr,8,3,"mat-card",20),n(),o(139,"mat-dialog-actions",21)(140,"button",22),f("click",function(){return r.onClose()}),a(141," Cerrar "),n()()()),t&2&&(l(5),g("N\xB0: ",r.data.order.code||r.data.order.id,""),l(6),m("ngClass",r.getStatusBadgeClass(r.data.order.status)),l(),g(" ",R(13,23,r.data.order.status)," "),l(12),g(" ",M(26,27,R(25,25,r.data.order.shipment_type),"N/A")," "),l(11),g(" ",M(37,33,M(36,30,r.data.order.createdAt,"dd/MM/yy HH:mm"),"N/A")," "),l(11),g(" ",M(48,39,M(47,36,r.data.order.delivery_date,"dd/MM/yyyy"),"No especificada")," "),l(3),m("ngIf",r.data.order.user==null?null:r.data.order.user.username),l(),m("ngIf",r.data.order.assigned_driver==null?null:r.data.order.assigned_driver.username),l(15),g(" ",M(66,42,r.data.order.recipient_name,"N/A")," "),l(10),g(" ",r.data.order.recipient_phone||"N/A"," "),l(),m("colspan",2),l(8),g(" ",M(85,45,r.data.order.delivery_address,"N/A")," "),l(10),g(" ",M(96,50,R(95,48,r.data.order.delivery_district_name),"N/A")," "),l(3),m("ngIf",r.data.order.delivery_coordinates),l(7),g(" ",M(105,53,r.data.order.item_description,"Sin descripci\xF3n del contenido.")," "),l(2),m("ngIf",r.data.order.package_size_type||r.data.order.package_weight_kg),l(2),m("ngIf",r.data.order.package_size_type),l(),m("ngIf",r.data.order.package_size_type==="custom"&&r.data.order.package_weight_kg),l(),m("ngIf",r.data.order.package_size_type==="custom"&&r.data.order.package_width_cm),l(15),g(" ",ce(126,56,r.data.order.amount_to_collect_at_delivery||0,"PEN","S/ ","1.2-2")," "),l(10),g(" ",ce(136,61,r.data.order.shipping_cost||0,"PEN","S/ ","1.2-2")," "),l(2),m("ngIf",r.data.order.payment_method_for_collection),l(),m("ngIf",r.data.order.observations||r.data.order.type_order_transfer_to_warehouse))},dependencies:[F,Ge,q,ft,Xt,X,G,ne,Te,Ce,he,T,N,I,$,Ae,Ie,Ki,Ui,Hi,Wi,ji,er,Ji,Zi,Mt,mr],styles:["[_nghost-%COMP%]{display:block}.dialog-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;max-height:calc(100vh - 80px)}.dialog-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:16px 24px;border-bottom:1px solid #e0e0e0;background-color:#f5f5f5}.dialog-header-draggable[_ngcontent-%COMP%]{cursor:move}h2.mat-mdc-dialog-title[_ngcontent-%COMP%]{margin:0;font-size:1.35em;font-weight:500;color:#455a64}.order-code-chip[_ngcontent-%COMP%]{font-size:.9em;color:#3f51b5;font-weight:500;margin-left:16px;flex-grow:1}.close-button[_ngcontent-%COMP%]{min-width:auto;padding:0;line-height:normal;color:#757575}.dialog-content[_ngcontent-%COMP%]{padding:20px 24px 24px;overflow-y:auto;flex-grow:1;background-color:#fff}.info-card[_ngcontent-%COMP%]{margin-bottom:24px;border:1px solid #eeeeee!important;box-shadow:none!important;border-radius:8px}.info-card[_ngcontent-%COMP%]:last-child{margin-bottom:0}.info-card[_ngcontent-%COMP%]   mat-card-header.compact-card-header[_ngcontent-%COMP%]{padding:12px 16px;display:flex;align-items:center;justify-content:space-between;background-color:#fafafa;border-bottom:1px solid #eeeeee}.info-card[_ngcontent-%COMP%]   mat-card-title[_ngcontent-%COMP%]{font-size:1.1em;font-weight:500;color:#546e7a;margin:0}.info-card[_ngcontent-%COMP%]   .status-badge-dialog[_ngcontent-%COMP%]{padding:4px 10px;border-radius:12px;font-size:.7rem;font-weight:600;text-transform:uppercase;color:#fff;line-height:1.2}.info-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]{padding:16px;font-size:.9rem}mat-grid-list[_ngcontent-%COMP%]{padding:0}@media (max-width: 600px){mat-grid-list[_ngcontent-%COMP%]{cols:1!important}}mat-grid-tile[_ngcontent-%COMP%]     .mat-figure{align-items:flex-start;padding:8px}.detail-item[_ngcontent-%COMP%]{display:flex;align-items:center;width:100%;gap:10px}.detail-item[_ngcontent-%COMP%]   .detail-icon[_ngcontent-%COMP%]{color:#90a4ae;font-size:20px}.detail-item[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:flex;flex-direction:column;line-height:1.4}.interactive-detail-item[_ngcontent-%COMP%]{cursor:pointer}.interactive-detail-item[_ngcontent-%COMP%]:hover   .detail-value[_ngcontent-%COMP%]{color:#3f51b5;text-decoration:underline}.link-like[_ngcontent-%COMP%]{color:#5c6bc0;font-weight:500}.detail-label[_ngcontent-%COMP%]{font-size:.75em;color:#616161;margin-bottom:2px;font-weight:500;text-transform:uppercase;letter-spacing:.5px}.detail-value[_ngcontent-%COMP%]{color:#212121;word-break:break-word}.bold-value[_ngcontent-%COMP%]{font-weight:600;font-size:1.05em}.item-description[_ngcontent-%COMP%]{font-style:italic;color:#555;margin-bottom:12px;padding-bottom:12px;border-bottom:1px dashed #e0e0e0;font-size:.9em}.detail-block[_ngcontent-%COMP%]{margin-bottom:16px}.detail-block[_ngcontent-%COMP%]   .detail-label-block[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-size:.9em;font-weight:500;color:#607d8b;margin-bottom:6px}.detail-block[_ngcontent-%COMP%]   .detail-label-block[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px}.detail-block[_ngcontent-%COMP%]   .detail-value-block[_ngcontent-%COMP%]{font-size:.9em;color:#424242;padding-left:26px;white-space:pre-wrap}.dialog-actions[_ngcontent-%COMP%]{padding:16px 24px;border-top:1px solid #e0e0e0;background-color:#fafafa}.dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-left:8px}.dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-child{margin-left:0}.status-registrado[_ngcontent-%COMP%]{background-color:#6610f2;color:#fff}.status-recogido[_ngcontent-%COMP%]{background-color:#fd7e14;color:#fff}.status-en-almacen[_ngcontent-%COMP%]{background-color:#0d6efd;color:#fff}.status-en-transito[_ngcontent-%COMP%]{background-color:#0c1a77;color:#d0c8c8}.status-entregado[_ngcontent-%COMP%]{background-color:#198754;color:#fff}.status-anulado[_ngcontent-%COMP%]{background-color:#dc3545;color:#fff}.status-cancelado[_ngcontent-%COMP%]{background-color:#6c757d;color:#fff}.status-rechazado-en-punto[_ngcontent-%COMP%]{background-color:#ff6b6b;color:#fff}.status-reprogramado[_ngcontent-%COMP%]{background-color:#adb5bd;color:#212529}.status-desconocido[_ngcontent-%COMP%]{background-color:#9e9e9e;color:#fff}"]})};var Tr=(i,e)=>e.uid;function Ir(i,e){if(i&1&&(o(0,"div",23)(1,"p"),a(2," Actualmente asignado a: "),o(3,"strong"),a(4),n()()()),i&2){let t=e.ngIf;l(4),w(t)}}function Ar(i,e){i&1&&(o(0,"p",24),a(1," Este pedido a\xFAn no tiene un motorizado asignado. "),n())}function Rr(i,e){if(i&1){let t=E();o(0,"button",25),f("click",function(){h(t);let d=u();return C(d.clearSelection())}),o(1,"mat-icon"),a(2,"close"),n()()}}function Vr(i,e){i&1&&(o(0,"mat-icon",26),a(1,"person_search"),n())}function Nr(i,e){i&1&&p(0,"mat-progress-spinner",27)}function Br(i,e){if(i&1&&(o(0,"mat-option",16)(1,"div",28)(2,"mat-icon",29),a(3,"two_wheeler"),n(),o(4,"span"),a(5),n()()()),i&2){let t=e.$implicit;m("value",t),l(5),w(t.username)}}function Lr(i,e){i&1&&(o(0,"mat-option",17),a(1,"No se encontraron motorizados."),n())}function zr(i,e){i&1&&(o(0,"mat-error"),a(1," Debe seleccionar un motorizado. "),n())}function qr(i,e){if(i&1&&(o(0,"p",30),a(1," Motorizado seleccionado: "),o(2,"strong"),a(3),n()()),i&2){let t=u();l(3),w(t.selectedDriver.username)}}var vi=class i{constructor(e,t){this.dialogRef=e;this.data=t;this.assignDriverForm=this.fb.group({}),this.filteredDrivers$=this.driverSearchCtrl.valueChanges.pipe(Be(""),me(300),se(),Le(r=>(this.isLoadingDrivers=!0,console.log("searchTerm",r),this.orderService.getAvailableDrivers(r||"").pipe(Me(()=>this.isLoadingDrivers=!1),Ee(()=>(this.isLoadingDrivers=!1,ye([])))))),P(this.destroy$))}assignDriverForm;drivers$=ye([]);isLoadingDrivers=!1;selectedDriver=null;driverSearchCtrl=new Se("");filteredDrivers$;destroy$=new de;orderService=O(oe);fb=O(ee);ngOnInit(){this.data.currentDriverId&&this.data.order.assigned_driver&&(this.selectedDriver=this.data.order.assigned_driver,this.driverSearchCtrl.setValue(this.data.order.assigned_driver.username||"",{emitEvent:!1}))}displayDriverName(e){return e&&e.name?e.name:""}onDriverSelected(e){this.selectedDriver=e.option.value}onConfirm(){this.selectedDriver&&this.dialogRef.close({selectedDriver:this.selectedDriver})}onCancel(){this.dialogRef.close()}clearSelection(){this.selectedDriver=null,this.driverSearchCtrl.setValue("")}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(t){return new(t||i)(z(_e),z(fe))};static \u0275cmp=k({type:i,selectors:[["app-assign-driver-dialog"]],decls:35,vars:19,consts:[["noDriverAssigned",""],["autoDriver","matAutocomplete"],["cdkDrag","","cdkDragRootElement",".cdk-overlay-pane","cdkDragHandle",".dialog-header-draggable",1,"dialog-container"],[1,"dialog-header","dialog-header-draggable"],["mat-dialog-title",""],[1,"order-code-chip"],[1,"dialog-content"],["class","current-assignment",4,"ngIf","ngIfElse"],[1,"content-divider"],["novalidate","",3,"formGroup"],["appearance","outline",1,"full-width","driver-search-field"],["type","text","placeholder","Escriba el nombre del motorizado...","aria-label","Motorizado","matInput","",3,"formControl","matAutocomplete"],["matSuffix","","mat-icon-button","","aria-label","Limpiar",3,"click",4,"ngIf"],["matSuffix","",4,"ngIf"],["matSuffix","","mode","indeterminate","diameter","20",4,"ngIf"],[3,"optionSelected","displayWith"],[3,"value"],["disabled",""],[4,"ngIf"],["class","selected-driver-info",4,"ngIf"],["align","end",1,"dialog-actions"],["mat-stroked-button","",1,"cancel-button","btn-corp-secondary",3,"click"],["mat-flat-button","",1,"confirm-button","btn-corp-primary",3,"click","disabled"],[1,"current-assignment"],[1,"no-driver-message"],["matSuffix","","mat-icon-button","","aria-label","Limpiar",3,"click"],["matSuffix",""],["matSuffix","","mode","indeterminate","diameter","20"],[1,"driver-option"],[1,"driver-option-icon"],[1,"selected-driver-info"]],template:function(t,r){if(t&1){let d=E();o(0,"div",2)(1,"div",3)(2,"h2",4),a(3,"Asignar / Cambiar Motorizado"),n(),o(4,"span",5),a(5),n()(),o(6,"mat-dialog-content",6)(7,"section"),c(8,Ir,5,1,"div",7)(9,Ar,2,0,"ng-template",null,0,gt),n(),p(11,"mat-divider",8),o(12,"section")(13,"form",9)(14,"mat-form-field",10)(15,"mat-label"),a(16,"Buscar y Seleccionar Motorizado"),n(),p(17,"input",11),c(18,Rr,3,0,"button",12)(19,Vr,2,0,"mat-icon",13)(20,Nr,1,0,"mat-progress-spinner",14),o(21,"mat-autocomplete",15,1),f("optionSelected",function(_){return h(d),C(r.onDriverSelected(_))}),ze(23,Br,6,2,"mat-option",16,Tr),v(25,"async"),c(26,Lr,2,0,"mat-option",17),v(27,"async"),n(),c(28,zr,2,0,"mat-error",18),n()()(),c(29,qr,4,1,"p",19),n(),o(30,"mat-dialog-actions",20)(31,"button",21),f("click",function(){return h(d),C(r.onCancel())}),a(32," Cancelar "),n(),o(33,"button",22),f("click",function(){return h(d),C(r.onConfirm())}),a(34),n()()()}if(t&2){let d,s=V(10),_=V(22);l(5),g("Pedido N\xB0: ",r.data.order.code||r.data.order.id,""),l(3),m("ngIf",r.data.order.assigned_driver==null?null:r.data.order.assigned_driver.username)("ngIfElse",s),l(5),m("formGroup",r.assignDriverForm),l(4),m("formControl",r.driverSearchCtrl)("matAutocomplete",_),l(),m("ngIf",r.driverSearchCtrl.value&&!r.isLoadingDrivers),l(),m("ngIf",!r.driverSearchCtrl.value&&!r.isLoadingDrivers),l(),m("ngIf",r.isLoadingDrivers),l(),m("displayWith",r.displayDriverName),l(2),qe(R(25,15,r.filteredDrivers$)),l(3),L(((d=R(27,17,r.filteredDrivers$))==null?null:d.length)===0&&!r.isLoadingDrivers&&r.driverSearchCtrl.value?26:-1),l(2),m("ngIf",r.assignDriverForm.hasError("required","driverId")&&r.selectedDriver===null),l(),m("ngIf",r.selectedDriver),l(4),m("disabled",!r.selectedDriver||r.isLoadingDrivers),l(),g(" ",r.data.currentDriverId?"Reasignar":"Asignar"," Motorizado ")}},dependencies:[F,q,Ue,j,Pe,Y,U,Z,He,J,ne,Te,Ce,he,K,W,H,te,ke,Ve,Re,Tt,kt,Ft,re,ie,T,N,ue,I,$,we,De,Yi,Ie],styles:["[_nghost-%COMP%]{display:block}.dialog-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;max-height:95vh;max-width:90%;padding:16px;box-shadow:0 4px 16px #0000001a}.dialog-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:16px 24px;margin-bottom:16px;border-bottom:1px solid var(--app-border-color);background-color:var(--app-background-dialog-header)}.dialog-header-draggable[_ngcontent-%COMP%]{cursor:move}h2.mat-mdc-dialog-title[_ngcontent-%COMP%]{margin:0;font-size:1.3em;font-weight:500;color:var(--app-blue-grey-700)}.order-code-chip[_ngcontent-%COMP%]{font-size:.85em;color:var(--app-indigo-500);font-weight:500;margin-left:12px;flex-grow:1}.close-button[_ngcontent-%COMP%]{min-width:auto;padding:0;line-height:normal;color:var(--app-gray-600)}.dialog-content[_ngcontent-%COMP%]{padding:20px 24px 24px;overflow-y:auto;flex-grow:1}.dialog-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:0;margin-bottom:8px;color:var(--app-text-default);font-size:.95em}.dialog-content[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-weight:500;color:var(--app-text-default)}.current-assignment[_ngcontent-%COMP%]{margin-bottom:16px;padding:10px;background-color:var(--app-blue-50);border-radius:4px;border-left:4px solid var(--app-blue-500)}.no-driver-message[_ngcontent-%COMP%]{font-style:italic;color:var(--app-orange-700);margin-bottom:16px}.content-divider[_ngcontent-%COMP%]{margin:16px 0;border-top-color:var(--app-border-color)}.full-width[_ngcontent-%COMP%]{width:100%}.driver-search-field[_ngcontent-%COMP%]{margin-bottom:8px}.driver-select-container[_ngcontent-%COMP%]{position:relative;min-height:90px}.spinner-container-small[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;padding:10px;color:var(--app-text-secondary);font-size:.9em}.spinner-container-small[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-left:8px}.mat-mdc-autocomplete-panel[_ngcontent-%COMP%]{max-height:250px!important}.driver-option[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}.driver-option[_ngcontent-%COMP%]   .driver-option-icon[_ngcontent-%COMP%]{color:var(--app-blue-grey-400)}.driver-option[_ngcontent-%COMP%]   .driver-status[_ngcontent-%COMP%]{font-size:.8em;font-style:italic;color:var(--app-orange-700);margin-left:auto}.selected-driver-info[_ngcontent-%COMP%]{margin-top:16px;margin-bottom:16px;padding:8px;background-color:var(--app-green-50);border-left:3px solid var(--app-green-500);border-radius:4px;font-size:.9em}.dialog-actions[_ngcontent-%COMP%]{padding:16px 24px;border-top:1px solid var(--app-border-color);background-color:var(--sys-surface-container-low);display:flex;flex-direction:row;justify-content:flex-end;gap:8px}.dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-left:0!important}@media (max-width: 480px){.dialog-actions[_ngcontent-%COMP%]{gap:10px;flex-direction:row-reverse}}.hidden[_ngcontent-%COMP%]{visibility:hidden;height:0;overflow:hidden}"]})};function $r(i,e){if(i&1&&(o(0,"strong"),a(1),v(2,"date"),n()),i&2){let t=u();l(),g(" ",M(2,1,t.data.order.delivery_date,"dd/MM/yyyy")," ")}}function Gr(i,e){i&1&&(o(0,"span"),a(1,"No programada"),n())}function Ur(i,e){i&1&&(o(0,"mat-error"),a(1,"Debe seleccionar una nueva fecha de entrega."),n())}function jr(i,e){i&1&&(o(0,"mat-error"),a(1,"El motivo no debe exceder los 250 caracteres."),n())}var xi=class i{constructor(e,t){this.dialogRef=e;this.data=t;this.minDateForReschedule=this.data.minDate||new Date,this.data.minDate||this.minDateForReschedule.setDate(this.minDateForReschedule.getDate()+1),this.rescheduleForm=this.fb.group({newDeliveryDate:[this.data.order.delivery_date?new Date(this.data.order.delivery_date):null,b.required],reason:["",b.maxLength(250)]})}rescheduleForm;minDateForReschedule;formSubmitted=!1;fb=O(ee);ngOnInit(){}get newDeliveryDateCtrl(){return this.rescheduleForm.get("newDeliveryDate")}get reasonCtrl(){return this.rescheduleForm.get("reason")}onConfirm(){this.formSubmitted=!0,this.rescheduleForm.valid?this.dialogRef.close({newDeliveryDate:this.newDeliveryDateCtrl?.value,reason:this.reasonCtrl?.value?.trim()||void 0}):this.rescheduleForm.markAllAsTouched()}onCancel(){this.dialogRef.close()}static \u0275fac=function(t){return new(t||i)(z(_e),z(fe))};static \u0275cmp=k({type:i,selectors:[["app-reschedule-order-dialog"]],features:[$e([])],decls:36,vars:11,consts:[["noCurrentDate",""],["picker",""],["cdkDrag","","cdkDragRootElement",".cdk-overlay-pane","cdkDragHandle",".dialog-header-draggable",1,"dialog-container"],[1,"dialog-header","dialog-header-draggable"],["mat-dialog-title",""],[1,"order-code-chip"],[3,"ngSubmit","formGroup"],[1,"dialog-content"],[4,"ngIf","ngIfElse"],[1,"content-divider"],["appearance","outline",1,"full-width","date-picker-field"],["matInput","","formControlName","newDeliveryDate","placeholder","Seleccione una fecha","readonly","","required","",3,"matDatepicker","min"],["matSuffix","",3,"for"],["appearance","outline",1,"full-width","reason-field"],["matInput","","formControlName","reason","rows","3","cdkTextareaAutosize","","cdkAutosizeMinRows","2","cdkAutosizeMaxRows","5","placeholder","Ej: Cliente solicit\xF3 cambio, Ruta congestionada..."],["align","end",1,"dialog-actions"],["mat-stroked-button","","type","button",1,"cancel-button","btn-corp-secondary",3,"click"],["mat-flat-button","","type","submit",1,"confirm-button","btn-corp-primary",3,"disabled"]],template:function(t,r){if(t&1){let d=E();o(0,"div",2)(1,"div",3)(2,"h2",4),a(3,"Reprogramar Pedido"),n(),o(4,"span",5),a(5),n()(),o(6,"form",6),f("ngSubmit",function(){return h(d),C(r.onConfirm())}),o(7,"mat-dialog-content",7)(8,"p"),a(9," Cliente: "),o(10,"strong"),a(11),n()(),o(12,"p"),a(13," Fecha de Entrega Actual: "),c(14,$r,3,4,"strong",8)(15,Gr,2,0,"ng-template",null,0,gt),n(),p(17,"mat-divider",9),o(18,"mat-form-field",10)(19,"mat-label"),a(20,"Nueva Fecha de Entrega"),n(),p(21,"input",11)(22,"mat-datepicker-toggle",12)(23,"mat-datepicker",null,1),c(25,Ur,2,0,"mat-error"),n(),o(26,"mat-form-field",13)(27,"mat-label"),a(28,"Motivo de Reprogramaci\xF3n (Opcional)"),n(),p(29,"textarea",14),c(30,jr,2,0,"mat-error"),n()(),o(31,"mat-dialog-actions",15)(32,"button",16),f("click",function(){return h(d),C(r.onCancel())}),a(33," Cancelar "),n(),o(34,"button",17),a(35," Confirmar Reprogramaci\xF3n "),n()()()()}if(t&2){let d=V(16),s=V(24);l(5),g("Pedido N\xB0: ",r.data.order.code||r.data.order.id,""),l(),m("formGroup",r.rescheduleForm),l(5),w(r.data.order.recipient_name),l(3),m("ngIf",r.data.order.delivery_date)("ngIfElse",d),l(7),m("matDatepicker",s)("min",r.minDateForReschedule),l(),m("for",s),l(3),L(r.newDeliveryDateCtrl!=null&&r.newDeliveryDateCtrl.hasError("required")&&(r.newDeliveryDateCtrl!=null&&r.newDeliveryDateCtrl.touched||r.newDeliveryDateCtrl!=null&&r.newDeliveryDateCtrl.dirty||r.formSubmitted)?25:-1),l(5),L(r.reasonCtrl!=null&&r.reasonCtrl.hasError("maxlength")?30:-1),l(4),m("disabled",r.rescheduleForm.invalid)}},dependencies:[F,q,G,j,Pe,Y,U,Z,Ct,J,pe,ne,Te,Ce,he,K,W,H,te,ke,re,ie,bt,T,N,I,ot,Dt,wt,Pt,li,Ae,Ie],styles:["[_nghost-%COMP%]{display:block}.dialog-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;max-height:85vh;width:480px;max-width:90vw}.dialog-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:16px 24px}.dialog-header-draggable[_ngcontent-%COMP%]{cursor:move}h2.mat-mdc-dialog-title[_ngcontent-%COMP%]{margin:0;font-size:1.3em;font-weight:500}.order-code-chip[_ngcontent-%COMP%]{font-size:.85em;font-weight:500;margin-left:12px;flex-grow:1}.close-button[_ngcontent-%COMP%]{min-width:auto;padding:0;line-height:normal}.dialog-content[_ngcontent-%COMP%]{padding:20px 24px 10px;overflow-y:auto;flex-grow:1}.dialog-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:0;margin-bottom:8px;font-size:.95em}.dialog-content[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-weight:500}.content-divider[_ngcontent-%COMP%]{margin:16px 0 20px}.full-width[_ngcontent-%COMP%]{width:100%}.date-picker-field[_ngcontent-%COMP%]{margin-bottom:20px}.reason-field[_ngcontent-%COMP%]{margin-top:10px}.reason-field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{min-height:50px}.dialog-actions[_ngcontent-%COMP%]{padding:16px 24px;gap:10px}.dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-child{margin-left:0}@media (max-width: 480px){.dialog-actions[_ngcontent-%COMP%]{gap:10px;flex-direction:row-reverse}}"]})};function Hr(i,e){i&1&&(o(0,"mat-error"),a(1,"El nuevo costo es obligatorio."),n())}function Wr(i,e){i&1&&(o(0,"mat-error"),a(1,"El costo no puede ser negativo."),n())}function Kr(i,e){i&1&&(o(0,"mat-error"),a(1,"El motivo es obligatorio."),n())}function Qr(i,e){i&1&&(o(0,"mat-error"),a(1,"El motivo debe tener al menos 5 caracteres."),n())}var Oi=class i{constructor(e,t,r){this.fb=e;this.dialogRef=t;this.data=r}editCostForm;isLoading=!1;ngOnInit(){this.editCostForm=this.fb.group({shipping_cost:[this.data.currentAmount,[b.required,b.min(0)]],observation:["",[b.required,b.minLength(5)]]})}get shippingCostCtrl(){return this.editCostForm.get("shipping_cost")}get observationCtrl(){return this.editCostForm.get("observation")}onConfirm(){this.editCostForm.valid?this.dialogRef.close({newAmount:parseFloat(this.shippingCostCtrl?.value),observation:this.observationCtrl?.value.trim()}):this.editCostForm.markAllAsTouched()}onCancel(){this.dialogRef.close()}static \u0275fac=function(t){return new(t||i)(z(ee),z(_e),z(fe))};static \u0275cmp=k({type:i,selectors:[["app-edit-shipping-cost-dialog"]],decls:31,vars:14,consts:[[1,"dialog-container"],[1,"dialog-header"],["mat-dialog-title",""],[1,"order-code-chip"],[1,"dialog-content",3,"formGroup"],[1,"current-cost-info"],["appearance","outline",1,"full-width"],["matInput","","formControlName","shipping_cost","type","number","min","0","step","0.01","required","","placeholder","0.00"],["matTextPrefix",""],["appearance","outline",1,"full-width","reason-field"],["matInput","","formControlName","observation","rows","2","cdkTextareaAutosize","","cdkAutosizeMinRows","2","cdkAutosizeMaxRows","4","required","","placeholder","Explique brevemente por qu\xE9 se est\xE1 modificando..."],["align","end",1,"dialog-actions"],["mat-stroked-button","",1,"cancel-button","btn-corp-secondary",3,"click"],["mat-flat-button","","color","primary",1,"confirm-button","btn-corp-primary",3,"click","disabled"]],template:function(t,r){t&1&&(o(0,"div",0)(1,"div",1)(2,"h2",2),a(3,"Modificar Monto a Cobrar"),n(),o(4,"span",3),a(5),n()(),o(6,"mat-dialog-content",4)(7,"p",5),a(8," Monto a Cobrar Actual: "),o(9,"strong"),a(10),v(11,"currency"),n()(),o(12,"mat-form-field",6)(13,"mat-label"),a(14,"Nuevo monto a cobrar (S/)"),n(),p(15,"input",7),o(16,"span",8),a(17,"S/"),n(),c(18,Hr,2,0,"mat-error")(19,Wr,2,0,"mat-error"),n(),o(20,"mat-form-field",9)(21,"mat-label"),a(22,"Motivo del Ajuste"),n(),p(23,"textarea",10),c(24,Kr,2,0,"mat-error")(25,Qr,2,0,"mat-error"),n()(),o(26,"mat-dialog-actions",11)(27,"button",12),f("click",function(){return r.onCancel()}),a(28," Cancelar "),n(),o(29,"button",13),f("click",function(){return r.onConfirm()}),a(30),n()()()),t&2&&(l(5),g("Pedido N\xB0: ",r.data.orderCode,""),l(),m("formGroup",r.editCostForm),l(4),w(ce(11,9,r.data.currentAmount,"PEN","S/ ","1.2-2")),l(8),L(r.shippingCostCtrl!=null&&r.shippingCostCtrl.hasError("required")&&(r.shippingCostCtrl!=null&&r.shippingCostCtrl.touched)?18:-1),l(),L(r.shippingCostCtrl!=null&&r.shippingCostCtrl.hasError("min")&&(r.shippingCostCtrl!=null&&r.shippingCostCtrl.touched)?19:-1),l(5),L(r.observationCtrl!=null&&r.observationCtrl.hasError("required")&&(r.observationCtrl!=null&&r.observationCtrl.touched)?24:-1),l(),L(r.observationCtrl!=null&&r.observationCtrl.hasError("minlength")&&(r.observationCtrl!=null&&r.observationCtrl.touched)?25:-1),l(4),m("disabled",r.editCostForm.invalid||r.isLoading),l(),g(" ",r.isLoading?"Guardando...":"Guardar Cambios"," "))},dependencies:[F,X,j,Y,je,U,Z,Ct,ht,J,pe,ne,Te,Ce,he,K,W,H,te,vt,re,ie,bt,T,N,I],styles:['.dialog-container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.dialog-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:20px 24px 16px;border-bottom:1px solid #eee;background-color:#f9f9f9}.dialog-header[_ngcontent-%COMP%]   .header-icon[_ngcontent-%COMP%]{color:"";font-size:28px;height:28px;width:28px}.dialog-header[_ngcontent-%COMP%]   h2.mat-mdc-dialog-title[_ngcontent-%COMP%]{margin:0;font-size:1.3em;font-weight:500;color:"";flex-grow:1}.order-code-chip[_ngcontent-%COMP%]{font-size:.85em;color:#555;background-color:#f0f0f0;padding:4px 10px;border-radius:16px}.dialog-content[_ngcontent-%COMP%]{padding:24px;min-width:400px}.current-cost-info[_ngcontent-%COMP%]{margin-bottom:24px;font-size:1em;color:#444;padding:10px;background-color:#eceff1;border-radius:4px}.current-cost-info[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-weight:600;color:#263238}.full-width[_ngcontent-%COMP%]{width:100%}.reason-field[_ngcontent-%COMP%]{margin-top:20px}.reason-field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{min-height:70px}.dialog-actions[_ngcontent-%COMP%]{padding:16px 24px;border-top:1px solid #eee;background-color:#f9f9f9}.dialog-actions[_ngcontent-%COMP%]   .cancel-button[_ngcontent-%COMP%]{margin-right:8px}']})};function Xr(i,e){i&1&&(o(0,"mat-error"),a(1,"El nuevo costo es obligatorio."),n())}function Yr(i,e){i&1&&(o(0,"mat-error"),a(1,"El costo no puede ser negativo."),n())}function Zr(i,e){i&1&&(o(0,"mat-error"),a(1,"El motivo es obligatorio."),n())}function Jr(i,e){i&1&&(o(0,"mat-error"),a(1,"El motivo debe tener al menos 5 caracteres."),n())}var yi=class i{constructor(e,t,r){this.fb=e;this.dialogRef=t;this.data=r}editCostForm;isLoading=!1;ngOnInit(){this.editCostForm=this.fb.group({shipping_cost:[this.data.currentShippingCost,[b.required,b.min(0)]],observation_shipping_cost_modification:["",[b.required,b.minLength(5)]]})}get shippingCostCtrl(){return this.editCostForm.get("shipping_cost")}get observationCtrl(){return this.editCostForm.get("observation_shipping_cost_modification")}onConfirm(){this.editCostForm.valid?this.dialogRef.close({newShippingCost:parseFloat(this.shippingCostCtrl?.value),observation:this.observationCtrl?.value.trim()}):this.editCostForm.markAllAsTouched()}onCancel(){this.dialogRef.close()}static \u0275fac=function(t){return new(t||i)(z(ee),z(_e),z(fe))};static \u0275cmp=k({type:i,selectors:[["app-edit-shipping-cost-dialog"]],decls:31,vars:14,consts:[[1,"dialog-container"],[1,"dialog-header"],["mat-dialog-title",""],[1,"order-code-chip"],[1,"dialog-content",3,"formGroup"],[1,"current-cost-info"],["appearance","outline",1,"full-width"],["matInput","","formControlName","shipping_cost","type","number","min","0","step","0.01","required","","placeholder","0.00"],["matTextPrefix",""],["appearance","outline",1,"full-width","reason-field"],["matInput","","formControlName","observation_shipping_cost_modification","rows","2","cdkTextareaAutosize","","cdkAutosizeMinRows","2","cdkAutosizeMaxRows","4","required","","placeholder","Explique brevemente por qu\xE9 se est\xE1 modificando el costo..."],["align","end",1,"dialog-actions"],["mat-stroked-button","",1,"cancel-button","btn-corp-secondary",3,"click"],["mat-flat-button","","color","primary",1,"confirm-button","btn-corp-primary",3,"click","disabled"]],template:function(t,r){t&1&&(o(0,"div",0)(1,"div",1)(2,"h2",2),a(3,"Modificar Costo de Env\xEDo"),n(),o(4,"span",3),a(5),n()(),o(6,"mat-dialog-content",4)(7,"p",5),a(8," Costo de Env\xEDo Actual: "),o(9,"strong"),a(10),v(11,"currency"),n()(),o(12,"mat-form-field",6)(13,"mat-label"),a(14,"Nuevo Costo de Env\xEDo (S/)"),n(),p(15,"input",7),o(16,"span",8),a(17,"S/\xA0"),n(),c(18,Xr,2,0,"mat-error")(19,Yr,2,0,"mat-error"),n(),o(20,"mat-form-field",9)(21,"mat-label"),a(22,"Motivo del Ajuste de Costo"),n(),p(23,"textarea",10),c(24,Zr,2,0,"mat-error")(25,Jr,2,0,"mat-error"),n()(),o(26,"mat-dialog-actions",11)(27,"button",12),f("click",function(){return r.onCancel()}),a(28," Cancelar "),n(),o(29,"button",13),f("click",function(){return r.onConfirm()}),a(30),n()()()),t&2&&(l(5),g("Pedido N\xB0: ",r.data.orderCode,""),l(),m("formGroup",r.editCostForm),l(4),w(ce(11,9,r.data.currentShippingCost,"PEN","S/ ","1.2-2")),l(8),L(r.shippingCostCtrl!=null&&r.shippingCostCtrl.hasError("required")&&(r.shippingCostCtrl!=null&&r.shippingCostCtrl.touched)?18:-1),l(),L(r.shippingCostCtrl!=null&&r.shippingCostCtrl.hasError("min")&&(r.shippingCostCtrl!=null&&r.shippingCostCtrl.touched)?19:-1),l(5),L(r.observationCtrl!=null&&r.observationCtrl.hasError("required")&&(r.observationCtrl!=null&&r.observationCtrl.touched)?24:-1),l(),L(r.observationCtrl!=null&&r.observationCtrl.hasError("minlength")&&(r.observationCtrl!=null&&r.observationCtrl.touched)?25:-1),l(4),m("disabled",r.editCostForm.invalid||r.isLoading),l(),g(" ",r.isLoading?"Guardando...":"Guardar Cambios"," "))},dependencies:[F,X,j,Y,je,U,Z,Ct,ht,J,pe,ne,Te,Ce,he,K,W,H,te,vt,re,ie,bt,T,N,I],styles:['.dialog-container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.dialog-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:20px 24px 16px;border-bottom:1px solid #eee;background-color:#f9f9f9}.dialog-header[_ngcontent-%COMP%]   .header-icon[_ngcontent-%COMP%]{color:"";font-size:28px;height:28px;width:28px}.dialog-header[_ngcontent-%COMP%]   h2.mat-mdc-dialog-title[_ngcontent-%COMP%]{margin:0;font-size:1.3em;font-weight:500;color:"";flex-grow:1}.order-code-chip[_ngcontent-%COMP%]{font-size:.85em;color:#555;background-color:#f0f0f0;padding:4px 10px;border-radius:16px}.dialog-content[_ngcontent-%COMP%]{padding:24px;min-width:400px}.current-cost-info[_ngcontent-%COMP%]{margin-bottom:24px;font-size:1em;color:#444;padding:10px;background-color:#eceff1;border-radius:4px}.current-cost-info[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-weight:600;color:#263238}.full-width[_ngcontent-%COMP%]{width:100%}.reason-field[_ngcontent-%COMP%]{margin-top:20px}.reason-field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{min-height:70px}.dialog-actions[_ngcontent-%COMP%]{padding:16px 24px;border-top:1px solid #eee;background-color:#f9f9f9}.dialog-actions[_ngcontent-%COMP%]   .cancel-button[_ngcontent-%COMP%]{margin-right:8px}']})};var rn=(i,e)=>({"principal-item":i,"additional-item":e}),fr=(i,e)=>e.id;function nn(i,e){if(i&1){let t=E();o(0,"button",38),f("click",function(){h(t);let d=u();return C(d.clearDriverSelection())}),o(1,"mat-icon"),a(2,"close"),n()()}}function on(i,e){i&1&&(o(0,"mat-icon",16),a(1,"person_search"),n())}function an(i,e){i&1&&p(0,"mat-progress-spinner",39)}function ln(i,e){if(i&1&&(o(0,"mat-option",10)(1,"div",40)(2,"span"),a(3),n()()()),i&2){let t=e.$implicit;m("value",t),l(3),w(t.username)}}function dn(i,e){i&1&&(o(0,"mat-option",11),a(1,"No se encontraron motorizados."),n())}function mn(i,e){i&1&&(o(0,"mat-error"),a(1,"Requerido"),n())}function sn(i,e){i&1&&(o(0,"mat-error"),a(1,"Requerido"),n())}function cn(i,e){i&1&&(o(0,"mat-error"),a(1,"Requerido"),n())}function pn(i,e){i&1&&(o(0,"mat-error"),a(1,"Tel\xE9fono inv\xE1lido"),n())}function un(i,e){if(i&1){let t=E();o(0,"button",38),f("click",function(){h(t);let d=u();return C(d.clearDistrictSelection())}),o(1,"mat-icon"),a(2,"close"),n()()}}function gn(i,e){i&1&&(o(0,"mat-icon",16),a(1,"person_search"),n())}function _n(i,e){i&1&&p(0,"mat-progress-spinner",39)}function fn(i,e){if(i&1&&(o(0,"mat-option",10)(1,"div",40)(2,"span"),a(3),n()()()),i&2){let t=e.$implicit;m("value",t),l(3),w(t.name_and_price)}}function hn(i,e){i&1&&(o(0,"mat-option",11),a(1,"No se encontraron distritos."),n())}function Cn(i,e){i&1&&(o(0,"mat-error"),a(1,"Requerido"),n())}function vn(i,e){i&1&&(o(0,"mat-error"),a(1,"Requerido"),n())}function bn(i,e){i&1&&(o(0,"mat-error"),a(1,"M\xEDnimo 6 caracteres"),n())}function xn(i,e){if(i&1&&(o(0,"div",41)(1,"div",42)(2,"span",43),a(3,"\u{1F4E6}"),n(),o(4,"div",44)(5,"strong"),a(6,"Paquete Est\xE1ndar seleccionado"),n(),o(7,"div"),a(8),n()()()()),i&2){let t=u();l(8),w(t.standardPackageLabel())}}function On(i,e){i&1&&(o(0,"div",45)(1,"p"),a(2," Si su paquete excede las medidas y pesos est\xE1ndar y no utiliza la calculadora de env\xEDo, se le cobrar\xE1 en funci\xF3n de esas medidas sin previo aviso. "),n()())}function yn(i,e){i&1&&(o(0,"mat-error"),a(1,"Requerido"),n())}function Sn(i,e){i&1&&(o(0,"mat-error"),a(1,"Requerido"),n())}function En(i,e){i&1&&(o(0,"mat-error"),a(1,"Requerido"),n())}function Mn(i,e){i&1&&(o(0,"mat-error"),a(1,"Requerido"),n())}function Dn(i,e){i&1&&(o(0,"mat-error"),a(1,"Requerido"),n())}function wn(i,e){if(i&1&&(o(0,"div",58),a(1," Costo de env\xEDo del paquete = "),o(2,"span",33),a(3),v(4,"number"),n()()),i&2){let t=u(2);l(3),g("S/ ",M(4,1,t.shippingCostPackage(),"1.2-2"),"")}}function Pn(i,e){i&1&&(o(0,"th",73),a(1,"Descripci\xF3n"),n())}function kn(i,e){if(i&1&&(o(0,"td",74),a(1),n()),i&2){let t=e.$implicit;l(),g(" ",t.value.description," ")}}function Fn(i,e){i&1&&(o(0,"th",73),a(1,"Medidas"),n())}function Tn(i,e){if(i&1&&(o(0,"td",74),a(1),p(2,"br"),o(3,"small"),a(4),n()()),i&2){let t=e.$implicit;l(),ut(" ",t.value.length_cm,"x",t.value.width_cm,"x",t.value.height_cm,"cm "),l(3),g("",t.value.weight_kg,"kg")}}function In(i,e){i&1&&(o(0,"th",73),a(1,"Precio Base"),n())}function An(i,e){if(i&1&&(o(0,"td",74),a(1),v(2,"currency"),n()),i&2){let t=e.$implicit;l(),g(" ",M(2,1,t.value.basePrice,"S/ ")," ")}}function Rn(i,e){i&1&&(o(0,"th",73),a(1,"Tipo"),n())}function Vn(i,e){if(i&1&&(o(0,"td",74)(1,"span",75),a(2),n()()),i&2){let t=e.$implicit;l(),m("ngClass",Kt(2,rn,t.value.isPrincipal,!t.value.isPrincipal)),l(),g(" ",t.value.isPrincipal?"Principal":"Adicional"," ")}}function Nn(i,e){i&1&&(o(0,"th",73),a(1,"Precio Final"),n())}function Bn(i,e){if(i&1&&(o(0,"div",77)(1,"span",78),a(2),v(3,"currency"),n(),o(4,"span",79),a(5),v(6,"currency"),n()()),i&2){let t=u().$implicit;l(2),w(M(3,2,t.value.basePrice,"S/ ")),l(3),w(M(6,5,t.value.finalPrice,"S/ "))}}function Ln(i,e){if(i&1&&(o(0,"div"),a(1),v(2,"currency"),n()),i&2){let t=u().$implicit;l(),g(" ",M(2,1,t.value.finalPrice,"S/ ")," ")}}function zn(i,e){if(i&1&&(o(0,"td",74),c(1,Bn,7,8,"div",76)(2,Ln,3,4,"div",12),n()),i&2){let t=e.$implicit;l(),m("ngIf",!t.value.isPrincipal&&t.value.finalPrice<t.value.basePrice),l(),m("ngIf",t.value.isPrincipal||t.value.finalPrice>=t.value.basePrice)}}function qn(i,e){i&1&&(o(0,"th",73),a(1,"Eliminar"),n())}function $n(i,e){if(i&1){let t=E();o(0,"td",74)(1,"button",80),f("click",function(){let d=h(t).index,s=u(3);return C(s.removeItem(d))}),o(2,"mat-icon"),a(3,"delete"),n()()()}}function Gn(i,e){i&1&&p(0,"tr",81)}function Un(i,e){i&1&&p(0,"tr",82)}function jn(i,e){if(i&1){let t=E();o(0,"div",59)(1,"h3",24),a(2,"Desglose de Paquetes"),n(),o(3,"mat-form-field",60)(4,"mat-label"),a(5,"% Descuento Adicional"),n(),o(6,"input",61),f("input",function(d){h(t);let s=u(2);return C(s.multiPackageDiscountPercentage.set(+d.target.value))}),n(),o(7,"mat-icon",16),a(8,"percent"),n()(),o(9,"table",62),y(10,63),c(11,Pn,2,0,"th",64)(12,kn,2,1,"td",65),S(),y(13,66),c(14,Fn,2,0,"th",64)(15,Tn,5,4,"td",65),S(),y(16,67),c(17,In,2,0,"th",64)(18,An,3,4,"td",65),S(),y(19,68),c(20,Rn,2,0,"th",64)(21,Vn,3,5,"td",65),S(),y(22,69),c(23,Nn,2,0,"th",64)(24,zn,3,2,"td",65),S(),y(25,70),c(26,qn,2,0,"th",64)(27,$n,4,0,"td",65),S(),c(28,Gn,1,0,"tr",71)(29,Un,1,0,"tr",72),n()()}if(i&2){let t=u(2);l(6),m("value",t.multiPackageDiscountPercentage())("disabled",!t.hasPermissionToEditPercentage()),l(3),m("dataSource",t.itemsDataSource),l(19),m("matHeaderRowDef",t.itemsDisplayedColumns),l(),m("matRowDefColumns",t.itemsDisplayedColumns)}}function Hn(i,e){if(i&1){let t=E();o(0,"div")(1,"div",46)(2,"h3",24),a(3,"A\xF1adir Paquete a la Lista"),n(),o(4,"mat-form-field",47)(5,"mat-label"),a(6,"Descripci\xF3n del Bulto"),n(),p(7,"input",48),c(8,yn,2,0,"mat-error",12),n(),o(9,"div",49)(10,"mat-form-field",14)(11,"mat-label"),a(12,"Largo (cm)"),n(),p(13,"input",50),c(14,Sn,2,0,"mat-error",12),n(),o(15,"mat-form-field",14)(16,"mat-label"),a(17,"Ancho (cm)"),n(),p(18,"input",51),c(19,En,2,0,"mat-error",12),n(),o(20,"mat-form-field",14)(21,"mat-label"),a(22,"Alto (cm)"),n(),p(23,"input",52),c(24,Mn,2,0,"mat-error",12),n(),o(25,"mat-form-field",14)(26,"mat-label"),a(27,"Peso (kg)"),n(),p(28,"input",53),c(29,Dn,2,0,"mat-error",12),n()(),o(30,"div",54)(31,"button",55),f("click",function(){h(t);let d=u();return C(d.addItemToList())}),o(32,"mat-icon"),a(33,"add"),n(),a(34," Agregar Paquete a la Lista "),n()(),c(35,wn,5,4,"div",56),n(),c(36,jn,30,5,"div",57),n()}if(i&2){let t,r,d,s,_,D,x=u();l(),m("formGroup",x.newItemForm),l(7),m("ngIf",(t=x.newItemForm.get("description"))==null?null:t.hasError("required")),l(6),m("ngIf",(r=x.newItemForm.get("length_cm"))==null?null:r.hasError("required")),l(5),m("ngIf",(d=x.newItemForm.get("width_cm"))==null?null:d.hasError("required")),l(5),m("ngIf",(s=x.newItemForm.get("height_cm"))==null?null:s.hasError("required")),l(5),m("ngIf",(_=x.newItemForm.get("weight_kg"))==null?null:_.hasError("required")),l(6),m("ngIf",((D=x.newItemForm.get("package_type"))==null?null:D.value)==="CUSTOM"),l(),m("ngIf",x.itemsFormArray.controls.length>0)}}function Wn(i,e){i&1&&p(0,"mat-progress-spinner",83)}function Kn(i,e){i&1&&(o(0,"mat-error"),a(1,"Requerido"),n())}function Qn(i,e){i&1&&(o(0,"mat-error"),a(1,"Requerido"),n())}function Xn(i,e){if(i&1&&(o(0,"mat-form-field",21)(1,"mat-label"),a(2,"Observaci\xF3n de modificaci\xF3n de costo de env\xEDo"),n(),p(3,"textarea",84),c(4,Qn,2,0,"mat-error",12),n()),i&2){let t,r=u();l(4),m("ngIf",(t=r.orderForm.get("observation_shipping_cost_modification"))==null?null:t.hasError("required"))}}var $t=class i{itemsDataSource=new St;order=null;orderSubmit=new B;formValidityChanged=new B;orderForm;minDeliveryDate;originalShippingCost=-1;originalDistrict="";isCalculatingShipping=A(!1);appStore=O(We);selectedDistrictName=()=>{let e=this.orderForm?.get("delivery_district_id")?.value;return!e||!this.districtsCache?"":this.districtsCache.find(t=>t.id===e)?.name||""};orderService=O(oe);fb=O(ee);destroy$=new de;districtsCache=[];isLoadingCompanies=!1;companySearchCtrl=new Se;filteredCompanies$;isLoadingDistricts=!1;districSearchCtrl=new Se;filteredDistricts$;newItemForm;itemsDisplayedColumns=["description","medidas","basePrice","tipo","finalPrice","eliminar"];settingsService=O(ai);multiPackageDiscountPercentage=A(0);standardPackageLabel=A("");volumetricFactor=A(0);shippingCostPackage=A(0);maxDimensionsInfo=A("");staLengthCm=A(0);staWidthCm=A(0);staHeightCm=A(0);staWeightKg=A(0);snackBar=O(ge);constructor(){this.orderService.getMaxPackageDimensions().subscribe(e=>{e&&e.standard_package_info&&e.volumetric_factor&&e.info_text&&e.sta_length_cm&&e.sta_width_cm&&e.sta_height_cm&&e.sta_weight_kg&&(this.standardPackageLabel.set(e.standard_package_info),this.volumetricFactor.set(e.volumetric_factor),this.maxDimensionsInfo.set(e.info_text),this.staLengthCm.set(e.sta_length_cm),this.staWidthCm.set(e.sta_width_cm),this.staHeightCm.set(e.sta_height_cm),this.staWeightKg.set(e.sta_weight_kg))}),this.buildForm(),this.minDeliveryDate=new Date,this.filteredCompanies$=this.companySearchCtrl.valueChanges.pipe(Be(""),me(300),se(),Le(e=>(this.isLoadingCompanies=!0,this.orderService.getCompanies(e||"").pipe(Me(()=>this.isLoadingCompanies=!1),Ee(()=>(this.isLoadingCompanies=!1,ye([])))))),P(this.destroy$)),this.filteredDistricts$=this.districSearchCtrl.valueChanges.pipe(Be(""),me(900),Le(e=>(this.isLoadingDistricts=!0,this.orderService.getDistricts(e||"",this.orderForm.get("isExpress")?.value).pipe(Me(()=>this.isLoadingDistricts=!1),Ee(()=>(this.isLoadingDistricts=!1,ye([])))))),P(this.destroy$)),Qt(()=>{this.multiPackageDiscountPercentage(),this.newItemForm.get("package_type")?.value==="CUSTOM"&&this.recalculateTotalCost(this.itemsFormArray.value)})}getCheckboxValue(){this.districSearchCtrl.setValue("",{emitEvent:!0}),this.orderForm.markAllAsTouched(),this.orderForm.get("delivery_district_id")?.setValue(null,{emitEvent:!0}),this.orderService.getDeliveryDistricts(this.orderForm.get("isExpress")?.value).subscribe(e=>{this.districtsCache=e})}isCompany(){let e=this.appStore.currentUser()?.role;return e==="EMPRESA_DISTRIBUIDOR"||e==="EMPRESA"}hasPermissionToEditPercentage(){let e=this.appStore.currentUser()?.role;return e==="RECEPCIONISTA"||e==="ADMINISTRADOR"}get itemsFormArray(){return this.orderForm.get("items")}loadSettings(){this.settingsService.loadSettings().pipe(Wt(1)).subscribe(e=>{let t=Array.isArray(e)?e[0]:e,r=this.orderService.getEffectiveDiscount(t);this.multiPackageDiscountPercentage.set(r)})}ngOnInit(){this.loadSettings(),this.itemsDataSource.data=this.itemsFormArray.controls,this.order&&this.orderService.getDeliveryDistricts(this.order?.isExpress).subscribe(e=>{this.districtsCache=e,this.order&&this.populateForm(this.order,this.districtsCache)}),this.orderForm.statusChanges.pipe(P(this.destroy$),se()).subscribe(e=>{this.formValidityChanged.emit(e==="VALID")}),this.orderForm.get("delivery_district_id")?.valueChanges.pipe(P(this.destroy$),se()).subscribe(e=>{if(this.itemsFormArray.clear(),this.itemsDataSource.data=this.itemsFormArray.controls,this.orderForm.get("shipping_cost")?.setValue(0),e){if(this.newItemForm.get("package_type")?.value==="STANDARD"){let t=this.getDistrictPrice(e);this.orderForm.get("shipping_cost")?.setValue(t)}this.checkShippingCostDifference()}})}displayDriverName(e){return e&&e.username?e.username:""}onDriverSelected(e){this.orderForm.get("company_id")?.setValue(e.option.value.id),this.orderForm.markAllAsTouched()}clearDriverSelection(){this.companySearchCtrl.setValue(""),this.orderForm.markAllAsTouched(),this.orderForm.get("company_id")?.setValue(null)}displayDistricName(e){return e&&e.name_and_price?e.name_and_price:""}onDistrictSelected(e){this.orderForm.get("delivery_district_id")?.setValue(e.option.value.id),this.orderForm.markAllAsTouched()}clearDistrictSelection(){this.districSearchCtrl.setValue(""),this.orderForm.markAllAsTouched(),this.orderForm.get("delivery_district_id")?.setValue(null)}buildForm(){this.newItemForm=this.fb.group({package_type:["STANDARD"],description:[""],length_cm:[0,[b.required,b.min(1)]],width_cm:[0,[b.required,b.min(1)]],height_cm:[0,[b.required,b.min(1)]],weight_kg:[0,[b.required,b.min(.1)]]}),this.newItemForm.get("package_type")?.valueChanges.pipe(P(this.destroy$)).subscribe(e=>{let t=this.orderForm.get("delivery_district_id")?.value;if(t||(this.itemsFormArray.clear(),this.itemsDataSource.data=this.itemsFormArray.controls,this.orderForm.get("shipping_cost")?.setValue(0)),e==="STANDARD"){this.itemsFormArray.clear(),this.itemsDataSource.data=this.itemsFormArray.controls;let r=this.getDistrictPrice(t);this.orderForm.get("shipping_cost")?.setValue(r)}else{this.recalculateTotalCost(this.itemsFormArray.value);let r=["length_cm","width_cm","height_cm","weight_kg"];e==="CUSTOM"?r.forEach(d=>this.newItemForm.get(d)?.setValidators([b.required,b.min(.1)])):r.forEach(d=>this.newItemForm.get(d)?.clearValidators()),this.newItemForm.updateValueAndValidity()}}),this.orderForm=this.fb.group({isExpress:[!1],recipient_name:["",b.required],recipient_phone:["",[b.required,b.pattern("^[0-9]{9}$")]],company_id:[null,b.required],delivery_district_id:[null,b.required],delivery_address:["",[b.required,b.minLength(6)]],items:this.fb.array([]),item_description:[""],observations:[""],shipping_cost:[this.originalShippingCost],observation_shipping_cost_modification:[{value:"",disabled:!0}]}),Ht(this.newItemForm.valueChanges,this.orderForm.get("delivery_district_id").valueChanges).pipe(me(300),P(this.destroy$)).subscribe(()=>{if(this.newItemForm.getRawValue().package_type==="CUSTOM"){if(this.newItemForm.invalid){this.shippingCostPackage.set(0);return}let t=this.newItemForm.getRawValue(),r={delivery_district_id:this.orderForm.get("delivery_district_id")?.value,package_length_cm:t.length_cm,package_width_cm:t.width_cm,package_height_cm:t.height_cm,package_weight_kg:t.weight_kg},d=this.calculateBasePrice(r);this.shippingCostPackage.set(d)}})}populateForm(e,t){let r=t.find(s=>s.name===e.delivery_district_name);this.orderForm.patchValue({isExpress:e.isExpress||!1,recipient_name:e.recipient_name,recipient_phone:e.recipient_phone,company_id:e.company?.id,delivery_district_id:r?.id,delivery_address:e.delivery_address,delivery_coordinates:e.delivery_coordinates,item_description:e.item_description,observations:e.observations,shipping_cost:e.shipping_cost,observation_shipping_cost_modification:"",items:[]},{emitEvent:!1}),r&&(r.name_and_price=r.name+" - S/ "+parseFloat(r.price).toFixed(2),this.originalDistrict=r.name),this.originalShippingCost=e.shipping_cost||-1,e.company&&this.companySearchCtrl.setValue(Q({},e.company)),r&&this.districSearchCtrl.setValue(Q({},r)),console.log("order",e,this.orderForm.value);let d=this.orderForm.get("items");e.items.forEach(s=>{d.push(this.fb.group({package_type:[s.package_type],description:[s.description],length_cm:[s.length_cm],width_cm:[s.width_cm],height_cm:[s.height_cm],weight_kg:[s.weight_kg],basePrice:[s.basePrice],finalPrice:[s.finalPrice],isPrincipal:[s.isPrincipal]}))}),this.newItemForm.get("package_type")?.setValue(e.items.some(s=>s.package_type==="STANDARD")?"STANDARD":"CUSTOM"),this.newItemForm.get("package_type")?.value==="CUSTOM"&&this.recalculateTotalCost(this.itemsFormArray.value),this.itemsDataSource.data=this.itemsFormArray.controls}getFormErrors(e){let t={};return Object.keys(e.controls).forEach(r=>{let d=e.get(r)?.errors;if(d&&(t[r]=d),e.get(r)instanceof Jt){let s=this.getFormErrors(e.get(r));Object.keys(s).length>0&&(t[r]=s)}}),t}checkShippingCostDifference(){let e=this.orderForm.get("shipping_cost")?.value,t=this.orderForm.get("observation_shipping_cost_modification");e!==this.originalShippingCost||this.selectedDistrictName()!==this.originalDistrict?(t?.enable(),t?.setValidators(b.required)):(t?.disable(),t?.clearValidators(),t?.setValue("")),t?.updateValueAndValidity()}calculateBasePrice(e){if(!e.delivery_district_id)return this.snackBar.open("Por favor, seleccione un distrito de entrega primero.","Cerrar",{duration:3e3,panelClass:["error-snackbar"]}),0;if(this.newItemForm.get("package_type")?.value==="CUSTOM"){let x=!0;if(["length_cm","width_cm","height_cm","weight_kg"].forEach(Ne=>{let Oe=this.newItemForm.get(Ne);Oe?.markAsTouched(),Oe?.invalid&&(x=!1)}),!x)return console.log("Custom dimensions form is invalid"),0}if(!e.package_width_cm||!e.package_length_cm||!e.package_height_cm||!e.package_weight_kg||!this.volumetricFactor())return this.snackBar.open("Las entradas no son v\xE1lidas","Cerrar",{duration:3e3,panelClass:["error-snackbar"]}),0;let t=e.package_length_cm*e.package_width_cm*e.package_height_cm/this.volumetricFactor(),r=t>e.package_weight_kg?t:e.package_weight_kg,d=this.districtsCache.find(x=>x.id===e.delivery_district_id);if(!d)return this.shippingCostPackage.set(0),0;let s=this.districtsCache.filter(x=>x.name===d.name),_=this.findTariffForWeight(r,s),D=_?.price?parseFloat(_.price):0;return D===0&&this.snackBar.open(`No hay ninguna tarifa asociada con el peso (${r}) del distrito seleccionado.`,"Cerrar",{duration:3e3,panelClass:["error-snackbar"]}),this.shippingCostPackage.set(D),D}findTariffForWeight(e,t){let r=t;for(let d of r)if(d.weight_from!==void 0&&d.weight_to!==void 0&&e>=d.weight_from&&e<=d.weight_to)return d}getDistrictPrice(e){let t=this.districtsCache.find(r=>r.id===e);return t?parseFloat(t.price):0}addItemToList(){if(this.newItemForm.invalid){this.newItemForm.markAllAsTouched();return}if(!this.orderForm.get("delivery_district_id")?.value){this.snackBar.open("Por favor, seleccione un distrito de entrega primero.","Cerrar",{duration:3e3,panelClass:["error-snackbar"]});return}let t=this.newItemForm.getRawValue();if(!t.description){alert("Complete el campo de descripci\xF3n del paquete");return}let r={delivery_district_id:this.orderForm.get("delivery_district_id")?.value,package_length_cm:t.length_cm,package_width_cm:t.width_cm,package_height_cm:t.height_cm,package_weight_kg:t.weight_kg},d=this.calculateBasePrice(r);if(d===0){this.snackBar.open("No se pudo calcular una tarifa para el paquete. Verifique el distrito y las medidas.","Cerrar",{duration:3e3,panelClass:["error-snackbar"]});return}this.orderForm.get("items").push(this.fb.group({package_type:[t.package_type],description:[t.description],length_cm:[t.length_cm],width_cm:[t.width_cm],height_cm:[t.height_cm],weight_kg:[t.weight_kg],basePrice:[d],finalPrice:[0],isPrincipal:[!1]})),this.recalculateTotalCost(this.itemsFormArray.value),this.itemsDataSource.data=this.itemsFormArray.controls,this.newItemForm.reset({package_type:this.newItemForm.get("package_type")?.value,description:"",length_cm:0,width_cm:0,height_cm:0,weight_kg:0})}recalculateTotalCost(e){if(e.length===0){this.orderForm.get("shipping_cost")?.setValue(0);return}let t=e.reduce((s,_)=>_.basePrice>s.basePrice?_:s,e[0]),r=0,d=e.map(s=>{let _=s===t,D=s.basePrice;return _||(D=s.basePrice*(1-this.multiPackageDiscountPercentage()/100)),r+=D,le(Q({},s),{finalPrice:D,isPrincipal:_})});this.itemsFormArray.patchValue(d,{emitEvent:!1}),this.orderForm.get("shipping_cost")?.setValue(r)}removeItem(e){this.itemsFormArray.removeAt(e),this.itemsDataSource.data=this.itemsFormArray.controls,this.recalculateTotalCost(this.itemsFormArray.value)}onSubmit(){if(this.orderForm.invalid){this.orderForm.markAllAsTouched(),console.log("Order form is invalid:",this.getFormErrors(this.orderForm)),alert("Por favor complete todos los campos requeridos.");return}if(!this.order){console.error("No order to update.");return}let e=this.orderForm.getRawValue();if(this.newItemForm.get("package_type")?.value==="STANDARD"){let d=this.orderForm.get("delivery_district_id")?.value;if(!d){this.snackBar.open("Por favor, seleccione un distrito.","Cerrar",{duration:3e3,panelClass:["error-snackbar"]});return}let s=this.getDistrictPrice(d);this.orderForm.get("shipping_cost")?.setValue(s);let _={package_type:"STANDARD",description:"Paquete Est\xE1ndar",length_cm:this.staLengthCm(),width_cm:this.staWidthCm(),height_cm:this.staHeightCm(),weight_kg:this.staWeightKg(),basePrice:this.orderForm.get("shipping_cost")?.value,finalPrice:this.orderForm.get("shipping_cost")?.value,isPrincipal:!0};e.items.push(_),e.shipping_cost=this.orderForm.get("shipping_cost")?.value}if(e.items.length===0){this.snackBar.open("Debe agregar al menos un paquete.","Cerrar",{duration:3e3,panelClass:["error-snackbar"]});return}if(e.shipping_cost===0){this.snackBar.open("El costo de env\xEDo no puede ser 0.","Cerrar",{duration:3e3,panelClass:["error-snackbar"]});return}e.item_description=(e.items.length===1?"1 Bulto: ":e.items.length+" Bultos: ")+e.items.map(d=>d.description+" Medidas L:"+d.length_cm+" x An:"+d.width_cm+" x Al:  "+d.height_cm+" ("+d.weight_kg+"kg)").join(", ");let r={isExpress:e.isExpress||!1,recipient_name:e.recipient_name,recipient_phone:e.recipient_phone,delivery_district_name:this.selectedDistrictName(),delivery_address:e.delivery_address,shipping_cost:e.shipping_cost,item_description:e.item_description,observations:e.observations,company_id:e.company_id,observation_shipping_cost_modification:e.observation_shipping_cost_modification,items:e.items};console.log("Submitting Updated Order Data:",r),this.orderService.updateOrder(this.order.id,r).pipe(P(this.destroy$)).subscribe({next:d=>{console.log("Order updated successfully",d),this.orderSubmit.emit(d)},error:d=>{console.error("Error updating order",d),alert("Error al actualizar el pedido.")}})}resetFormForNextOrder(){this.companySearchCtrl.setValue(""),this.districSearchCtrl.setValue("");let e=null;this.isCompany()&&(e=this.orderForm.get("company_id")?.value),this.orderForm.reset({company_id:e,delivery_date:null}),this.orderForm.get("shipping_cost")?.setValue(0),this.formValidityChanged.emit(this.orderForm.valid)}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=k({type:i,selectors:[["app-order-edition-form"]],inputs:{order:"order"},outputs:{orderSubmit:"orderSubmit",formValidityChanged:"formValidityChanged"},features:[$e([yt(),G])],decls:92,vars:42,consts:[["autoDriver","matAutocomplete"],["autoDistric","matAutocomplete"],[1,"order-creation-form",3,"ngSubmit","formGroup"],["formControlName","isExpress","color","primary",1,"standard-checkbox",3,"click"],["appearance","outline",1,"full-width","driver-search-field"],["type","text","placeholder","Escriba el nombre del la empresa...","aria-label","cliente","matInput","",3,"formControl","matAutocomplete"],["matSuffix","","mat-icon-button","","aria-label","Limpiar",3,"click",4,"ngIf"],["matSuffix","",4,"ngIf"],["matSuffix","","mode","indeterminate","diameter","20",4,"ngIf"],[3,"optionSelected","displayWith"],[3,"value"],["disabled",""],[4,"ngIf"],[1,"form-grid"],["appearance","outline"],["matInput","","formControlName","recipient_name","placeholder","Nombre completo"],["matSuffix",""],["matInput","","formControlName","recipient_phone","type","tel","placeholder",""],["align","end"],["appearance","outline",1,"driver-search-field"],["type","text","placeholder","Escriba el nombre del distrito...","aria-label","distrito","matInput","",3,"formControl","matAutocomplete"],["appearance","outline",1,"full-span-column"],["matInput","","formControlName","delivery_address","placeholder","Ingresar lugar de entrega (M\xEDnimo 6 caracteres)"],[1,"section-divider"],[1,"section-subtitle"],[3,"formGroup"],["formControlName","package_type","aria-label","Tipo de paquete"],["value","STANDARD"],["value","CUSTOM"],["id","standard-package-info","class","info-box hidden",4,"ngIf"],["class","warning-paquete-size",4,"ngIf"],[1,"max-dimensions-info"],[1,"shipping-cost-display"],[1,"cost-value"],["mode","indeterminate","diameter","20","class","cost-spinner",4,"ngIf"],["matInput","","formControlName","item_description","placeholder","Detalle del pedido"],["matInput","","formControlName","observations","placeholder","\xBFQu\xE9 env\xEDas?...","rows","3"],["appearance","outline","class","full-span-column",4,"ngIf"],["matSuffix","","mat-icon-button","","aria-label","Limpiar",3,"click"],["matSuffix","","mode","indeterminate","diameter","20"],[1,"driver-option"],["id","standard-package-info",1,"info-box","hidden"],[1,"info-content"],[1,"info-icon"],[1,"info-text"],[1,"warning-paquete-size"],[1,"package-calculator-container",3,"formGroup"],["appearance","outline",1,"full-width"],["matInput","","formControlName","description","placeholder","Ej: Zapatos, Laptop...","appAutoSelect",""],[1,"custom-dimensions-grid"],["matInput","","type","number","formControlName","length_cm","appAutoSelect",""],["matInput","","type","number","formControlName","width_cm","appAutoSelect",""],["matInput","","type","number","formControlName","height_cm","appAutoSelect",""],["matInput","","type","number","formControlName","weight_kg","appAutoSelect",""],[1,"add-item-button-container"],["mat-flat-button","","type","button",1,"btn-corp-primary",3,"click"],["class","shipping-cost-display-package",4,"ngIf"],["class","package-list-container",4,"ngIf"],[1,"shipping-cost-display-package"],[1,"package-list-container"],["appearance","outline",1,"discount-field"],["matInput","",3,"input","value","disabled"],["mat-table","",1,"mat-elevation-z2","items-table",3,"dataSource"],["matColumnDef","description"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","medidas"],["matColumnDef","basePrice"],["matColumnDef","tipo"],["matColumnDef","finalPrice"],["matColumnDef","eliminar"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],[3,"ngClass"],["class","discounted-price",4,"ngIf"],[1,"discounted-price"],[1,"original-price"],[1,"final-price"],["mat-icon-button","","color","warn","type","button",3,"click"],["mat-header-row",""],["mat-row",""],["mode","indeterminate","diameter","20",1,"cost-spinner"],["matInput","","formControlName","observation_shipping_cost_modification","placeholder","Ingrese la raz\xF3n de la modificaci\xF3n del costo de env\xEDo","rows","3"]],template:function(t,r){if(t&1){let d=E();o(0,"form",2),f("ngSubmit",function(){return h(d),C(r.onSubmit())}),o(1,"mat-checkbox",3),f("click",function(){return h(d),C(r.getCheckboxValue())}),a(2," Express "),n(),o(3,"mat-form-field",4)(4,"mat-label"),a(5,"Buscar y Seleccionar empresa"),n(),p(6,"input",5),c(7,nn,3,0,"button",6)(8,on,2,0,"mat-icon",7)(9,an,1,0,"mat-progress-spinner",8),o(10,"mat-autocomplete",9,0),f("optionSelected",function(_){return h(d),C(r.onDriverSelected(_))}),ze(12,ln,4,2,"mat-option",10,fr),v(14,"async"),c(15,dn,2,0,"mat-option",11),v(16,"async"),n(),c(17,mn,2,0,"mat-error",12),n(),o(18,"div",13)(19,"mat-form-field",14)(20,"mat-label"),a(21,"Nombre del destinatario"),n(),p(22,"input",15),o(23,"mat-icon",16),a(24,"person_outline"),n(),c(25,sn,2,0,"mat-error",12),n(),o(26,"mat-form-field",14)(27,"mat-label"),a(28,"Tel\xE9fono del destinatario"),n(),p(29,"input",17),o(30,"mat-icon",16),a(31,"phone_outline"),n(),o(32,"mat-hint",18),a(33,"No se debe agregar el +51"),n(),c(34,cn,2,0,"mat-error",12)(35,pn,2,0,"mat-error",12),n(),o(36,"mat-form-field",19)(37,"mat-label"),a(38,"Buscar y Seleccionar distrito"),n(),p(39,"input",20),c(40,un,3,0,"button",6)(41,gn,2,0,"mat-icon",7)(42,_n,1,0,"mat-progress-spinner",8),o(43,"mat-autocomplete",9,1),f("optionSelected",function(_){return h(d),C(r.onDistrictSelected(_))}),ze(45,fn,4,2,"mat-option",10,fr),v(47,"async"),c(48,hn,2,0,"mat-option",11),v(49,"async"),n(),c(50,Cn,2,0,"mat-error",12),n(),o(51,"mat-form-field",21)(52,"mat-label"),a(53,"Direcci\xF3n de entrega"),n(),p(54,"input",22),c(55,vn,2,0,"mat-error",12)(56,bn,2,0,"mat-error",12),n()(),p(57,"mat-divider",23),o(58,"h3",24),a(59,"Tama\xF1o del paquete"),n(),o(60,"div",25)(61,"mat-radio-group",26)(62,"mat-radio-button",27),a(63,"Est\xE1ndar (1 solo paquete)"),n(),o(64,"mat-radio-button",28),a(65,"Otros tama\xF1os (M\xFAltiples paquetes)"),n()()(),c(66,xn,9,1,"div",29)(67,On,3,0,"div",30),o(68,"div",31)(69,"p"),a(70),n()(),c(71,Hn,37,8,"div",12),o(72,"div",32),a(73," Costo de env\xEDo = "),o(74,"span",33),a(75),v(76,"number"),n(),c(77,Wn,1,0,"mat-progress-spinner",34),n(),p(78,"mat-divider",23),o(79,"div",13)(80,"mat-form-field",21)(81,"mat-label"),a(82,"\xBFQu\xE9 env\xEDa?"),n(),p(83,"input",35),o(84,"mat-icon",16),a(85,"inventory_2_outline"),n(),c(86,Kn,2,0,"mat-error",12),n(),o(87,"mat-form-field",21)(88,"mat-label"),a(89,"Observaciones (Opcional)"),n(),p(90,"textarea",36),n(),c(91,Xn,5,1,"mat-form-field",37),n()()}if(t&2){let d,s,_,D,x,lt,Ne,Oe,At,Rt,Vt,Nt,Bt,Lt,zt,ki=V(11),Ut=V(44);m("formGroup",r.orderForm),l(6),m("formControl",r.companySearchCtrl)("matAutocomplete",ki),l(),m("ngIf",r.companySearchCtrl.value&&!r.isLoadingCompanies),l(),m("ngIf",!r.companySearchCtrl.value&&!r.isLoadingCompanies),l(),m("ngIf",r.isLoadingCompanies),l(),m("displayWith",r.displayDriverName),l(2),qe(R(14,31,r.filteredCompanies$)),l(3),L(((d=R(16,33,r.filteredCompanies$))==null?null:d.length)===0&&!r.isLoadingCompanies&&r.companySearchCtrl.value?15:-1),l(2),m("ngIf",(s=r.orderForm.get("company_id"))==null?null:s.hasError("required")),l(8),m("ngIf",(_=r.orderForm.get("recipient_name"))==null?null:_.hasError("required")),l(9),m("ngIf",(D=r.orderForm.get("recipient_phone"))==null?null:D.hasError("required")),l(),m("ngIf",(x=r.orderForm.get("recipient_phone"))==null?null:x.hasError("pattern")),l(4),m("formControl",r.districSearchCtrl)("matAutocomplete",Ut),l(),m("ngIf",r.districSearchCtrl.value&&!r.isLoadingDistricts),l(),m("ngIf",!r.districSearchCtrl.value&&!r.isLoadingDistricts),l(),m("ngIf",r.isLoadingDistricts),l(),m("displayWith",r.displayDistricName),l(2),qe(R(47,35,r.filteredDistricts$)),l(3),L(((lt=R(49,37,r.filteredDistricts$))==null?null:lt.length)===0&&!r.isLoadingDistricts&&r.districSearchCtrl.value?48:-1),l(2),m("ngIf",(Ne=r.orderForm.get("delivery_district_id"))==null?null:Ne.hasError("required")),l(5),m("ngIf",(Oe=r.orderForm.get("delivery_address"))==null?null:Oe.hasError("required")),l(),m("ngIf",(At=r.orderForm.get("delivery_address"))==null?null:At.hasError("minlength")),l(4),m("formGroup",r.newItemForm),l(6),m("ngIf",((Rt=r.newItemForm.get("package_type"))==null?null:Rt.value)==="STANDARD"),l(),m("ngIf",((Vt=r.newItemForm.get("package_type"))==null?null:Vt.value)==="STANDARD"),l(3),w(r.maxDimensionsInfo()),l(),m("ngIf",((Nt=r.newItemForm.get("package_type"))==null?null:Nt.value)==="CUSTOM"),l(4),g("S/ ",M(76,39,(Bt=r.orderForm.get("shipping_cost"))==null?null:Bt.value,"1.2-2"),""),l(2),m("ngIf",r.isCalculatingShipping()),l(9),m("ngIf",(Lt=r.orderForm.get("item_description"))==null?null:Lt.hasError("required")),l(5),m("ngIf",(zt=r.orderForm.get("observation_shipping_cost_modification"))==null?null:zt.enabled)}},dependencies:[F,Ge,q,Ue,ft,X,j,Pe,Y,je,U,Z,He,J,pe,K,W,H,ei,te,ke,re,ie,Ve,Re,ot,T,N,ue,I,$,Ae,Ie,we,De,Tt,kt,Ft,Ot,xt,pi,si,ci,nt,Ke,Xe,et,Ye,Qe,tt,Ze,Je,it,rt,gi,Fe],styles:[".order-creation-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}.form-section-title[_ngcontent-%COMP%]{font-size:1.5em;font-weight:500;color:#333;margin-bottom:10px;padding-bottom:10px}.form-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:20px 24px}@media (max-width: 600px){.form-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}.full-span-column[_ngcontent-%COMP%]{grid-column:1/-1}mat-form-field[_ngcontent-%COMP%]{width:100%}.section-divider[_ngcontent-%COMP%]{margin:24px 0}.shipping-cost-display[_ngcontent-%COMP%]{font-size:1.3em;font-weight:700;text-align:right;color:#d32f2f;display:flex;align-items:center;justify-content:flex-end;gap:8px}@media (max-width: 600px){.shipping-cost-display[_ngcontent-%COMP%]{text-align:left;justify-content:flex-start}}.add-order-button-container[_ngcontent-%COMP%]{margin-top:24px;text-align:center}.add-order-button-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:12px 24px;font-size:1.1em;letter-spacing:.5px}mat-hint[align=end][_ngcontent-%COMP%]{font-size:.75em;opacity:.7}.standard-checkbox[_ngcontent-%COMP%]{margin-top:0;margin-bottom:0}.package-calculator-container[_ngcontent-%COMP%]{margin-top:20px;padding:16px;border:1px solid #e0e0e0;border-radius:4px;background-color:#f9f9f9}.section-subtitle[_ngcontent-%COMP%]{font-size:1.1em;font-weight:500;margin-top:0;margin-bottom:16px}mat-radio-group[_ngcontent-%COMP%]{margin-bottom:20px}.custom-dimensions-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:16px;margin-top:16px}.add-item-button-container[_ngcontent-%COMP%]{margin-top:20px}.package-list-container[_ngcontent-%COMP%]{margin-top:24px}.items-table[_ngcontent-%COMP%]{width:100%}.discount-field[_ngcontent-%COMP%]{max-width:250px;margin-bottom:16px}.principal-item[_ngcontent-%COMP%]{font-weight:700;color:#1e88e5;background-color:#e3f2fd;padding:2px 6px;border-radius:4px}.additional-item[_ngcontent-%COMP%]{color:#43a047;background-color:#e8f5e9;padding:2px 6px;border-radius:4px}.discounted-price[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-start}.discounted-price[_ngcontent-%COMP%]   .original-price[_ngcontent-%COMP%]{text-decoration:line-through;color:#e03131;font-size:.8em}.discounted-price[_ngcontent-%COMP%]   .final-price[_ngcontent-%COMP%]{font-weight:700}.shipping-cost-display-package[_ngcontent-%COMP%]{font-size:1.1em;font-weight:500;margin-top:16px;text-align:right;color:#1e88e5}.info-content[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.info-icon[_ngcontent-%COMP%]{font-size:1.5rem}.info-box[_ngcontent-%COMP%]{background:#e4eef8;border:1px solid #d0d3d6;border-radius:8px;padding:15px;margin-bottom:15px;transition:all .3s ease;opacity:1;transform:translateY(0)}.warning-paquete-size[_ngcontent-%COMP%]{font-size:17px;font-weight:700;margin:0;text-align:left;color:#d32f2f;display:flex;align-items:center;justify-content:flex-start}.max-dimensions-info[_ngcontent-%COMP%]{margin-top:0!important;font-size:16px;color:#3d3636;text-align:center;padding:8px;background-color:#e4eef8;border-radius:4px}"]})};function Yn(i,e){if(i&1){let t=E();o(0,"app-order-edition-form",9,0),f("orderSubmit",function(d){h(t);let s=u();return C(s.onOrderUpdated(d))})("formValidityChanged",function(d){h(t);let s=u();return C(s.onFormValidityChanged(d))}),n()}if(i&2){let t=u();m("order",t.order)}}var Si=class i{constructor(e,t){this.dialogRef=e;this.data=t}orderEditionForm;snackBar=O(ge);isFormValid=!1;orderService=O(oe);order=null;ngOnInit(){this.orderService.getOrderById(this.data.orderId).subscribe({next:e=>{e&&(this.order=e)},error:e=>{console.error("Error fetching order:",e),this.snackBar.open("Error al cargar el pedido.","Cerrar",{duration:3e3})}})}onCancel(){this.dialogRef.close()}onOrderUpdated(e){this.dialogRef.close(e),this.snackBar.open("Pedido actualizado exitosamente.","Cerrar",{duration:3e3})}onFormValidityChanged(e){this.isFormValid=e}static \u0275fac=function(t){return new(t||i)(z(_e),z(fe))};static \u0275cmp=k({type:i,selectors:[["app-order-edition-dialog"]],viewQuery:function(t,r){if(t&1&&dt($t,5),t&2){let d;mt(d=st())&&(r.orderEditionForm=d.first)}},decls:14,vars:3,consts:[["orderEditionForm",""],["color","primary"],[1,"spacer"],["mat-icon-button","","aria-label","Cerrar di\xE1logo",3,"click"],[1,"mat-typography","mat-dialog-content"],[3,"order","orderSubmit","formValidityChanged",4,"ngIf"],["align","end"],["mat-button","",1,"btn-corp-secondary",3,"click"],["mat-raised-button","","color","primary",1,"btn-corp-primary",3,"click","disabled"],[3,"orderSubmit","formValidityChanged","order"]],template:function(t,r){t&1&&(o(0,"mat-toolbar",1)(1,"span"),a(2),n(),p(3,"span",2),o(4,"button",3),f("click",function(){return r.onCancel()}),o(5,"mat-icon"),a(6,"close"),n()()(),o(7,"mat-dialog-content",4),c(8,Yn,2,1,"app-order-edition-form",5),n(),o(9,"mat-dialog-actions",6)(10,"button",7),f("click",function(){return r.onCancel()}),a(11," Cancelar "),n(),o(12,"button",8),f("click",function(){return r.orderEditionForm.onSubmit()}),a(13," Guardar Cambios "),n()()),t&2&&(l(2),g("Editar Pedido: ",r.order==null?null:r.order.code,""),l(6),m("ngIf",r.order),l(4),m("disabled",!r.isFormValid))},dependencies:[F,q,T,N,ue,I,$,Xi,Qi,ne,Ce,he,$t],styles:[".mat-toolbar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.spacer[_ngcontent-%COMP%]{flex:1 1 auto}.mat-dialog-content[_ngcontent-%COMP%]{height:100vh;min-height:85vh}.mat-dialog-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:8px}"]})};var Jn=()=>[10,25,50,100],eo=i=>({"highlight-row":!1,"row-cancelled-strikethrough":i});function to(i,e){i&1&&(o(0,"div",47),p(1,"mat-progress-spinner",48),n())}function io(i,e){i&1&&(o(0,"th",49),a(1," N\xB0 "),n())}function ro(i,e){if(i&1&&(o(0,"td",50),a(1),n()),i&2){let t=e.$implicit;l(),g(" ",t.code," ")}}function no(i,e){i&1&&(o(0,"th",51),a(1," Empresa "),n())}function oo(i,e){if(i&1&&(o(0,"td",52),a(1),n()),i&2){let t=e.$implicit;l(),g(" ",t.company==null?null:t.company.username," ")}}function ao(i,e){i&1&&(o(0,"th",53),a(1," Tipo "),n())}function lo(i,e){if(i&1&&(o(0,"td",54),a(1),n()),i&2){let t=e.$implicit;l(),g(" ",t.shipment_type," ")}}function mo(i,e){i&1&&(o(0,"th",55),a(1," Destinatario "),n())}function so(i,e){if(i&1&&(o(0,"td",56),a(1),n()),i&2){let t=e.$implicit;l(),g(" ",t.recipient_name," ")}}function co(i,e){i&1&&(o(0,"th",57),a(1," Tel\xE9fono "),n())}function po(i,e){if(i&1&&(o(0,"td",58),a(1),n()),i&2){let t=e.$implicit;l(),g(" ",t.recipient_phone," ")}}function uo(i,e){i&1&&(o(0,"th",59),a(1," Estado "),n())}function go(i,e){if(i&1&&(o(0,"td",60)(1,"span",61),a(2),n()()),i&2){let t=e.$implicit,r=u();l(),m("ngClass",r.getStatusClass(t.status)),l(),g(" ",t.status," ")}}function _o(i,e){i&1&&(o(0,"th",62),a(1," Distrito "),n())}function fo(i,e){i&1&&(o(0,"span",65),a(1,"Express"),n())}function ho(i,e){if(i&1&&(o(0,"td",63),a(1),c(2,fo,2,0,"span",64),n()),i&2){let t=e.$implicit;l(),g(" ",t.delivery_district_name," "),l(),m("ngIf",t.isExpress)}}function Co(i,e){i&1&&(o(0,"th",66),a(1," Direcci\xF3n "),n())}function vo(i,e){if(i&1&&(o(0,"td",67),a(1),n()),i&2){let t=e.$implicit;l(),g(" ",t.delivery_address," ")}}function bo(i,e){i&1&&(o(0,"th",68),a(1," F. Entrega "),n())}function xo(i,e){if(i&1&&(o(0,"td",69),a(1),v(2,"date"),n()),i&2){let t=e.$implicit;l(),g(" ",t.delivery_date?M(2,1,t.delivery_date,"dd/MM/yy"):"-"," ")}}function Oo(i,e){i&1&&(o(0,"th",70),a(1," Motorizado "),n())}function yo(i,e){if(i&1&&(o(0,"td",71),a(1),n()),i&2){let t=e.$implicit;l(),g(" ",t.assigned_driver==null?null:t.assigned_driver.username," ")}}function So(i,e){i&1&&(o(0,"th",72),a(1," Cobrar "),n())}function Eo(i,e){if(i&1&&(o(0,"td",73),a(1),v(2,"currency"),n()),i&2){let t=e.$implicit;l(),g(" ",ce(2,1,t.amount_to_collect_at_delivery,"PEN","","1.2-2")," ")}}function Mo(i,e){i&1&&(o(0,"th",74),a(1," Tracking "),n())}function Do(i,e){if(i&1&&(o(0,"td",75),a(1),n()),i&2){let t=e.$implicit;l(),g(" ",t.tracking_code," ")}}function wo(i,e){i&1&&(o(0,"th",76),a(1," Acciones "),n())}function Po(i,e){if(i&1){let t=E();o(0,"button",82),f("click",function(){h(t);let d=u().$implicit,s=u();return C(s.editOrder(d))}),o(1,"mat-icon"),a(2,"edit"),n(),o(3,"span"),a(4,"Editar Pedido"),n()()}}function ko(i,e){if(i&1){let t=E();o(0,"button",82),f("click",function(){h(t);let d=u().$implicit,s=u();return C(s.openEditAmountToCollectModal(d))}),o(1,"mat-icon"),a(2,"attach_money"),n(),o(3,"span"),a(4,"Modificar el monto a cobrar"),n()()}}function Fo(i,e){if(i&1){let t=E();o(0,"button",82),f("click",function(){h(t);let d=u().$implicit,s=u();return C(s.openEditShippingCostModal(d))}),o(1,"mat-icon"),a(2,"attach_money"),n(),o(3,"span"),a(4,"Modificar el costo env\xEDo"),n()()}}function To(i,e){if(i&1){let t=E();o(0,"button",82),f("click",function(){h(t);let d=u().$implicit,s=u();return C(s.openChangeStatusModal(d))}),o(1,"mat-icon"),a(2,"swap_horiz"),n(),o(3,"span"),a(4,"Cambiar Estado General"),n()()}}function Io(i,e){if(i&1){let t=E();o(0,"button",82),f("click",function(){h(t);let d=u().$implicit,s=u();return C(s.openRescheduleOrderModal(d))}),o(1,"mat-icon"),a(2,"event_repeat"),n(),o(3,"span"),a(4,"Reprogramar"),n()()}}function Ao(i,e){if(i&1){let t=E();o(0,"button",82),f("click",function(){h(t);let d=u().$implicit,s=u();return C(s.openAssignDriverModal(d))}),o(1,"mat-icon"),a(2,"person_pin_circle"),n(),o(3,"span"),a(4),n()()}if(i&2){let t=u().$implicit;l(4),g("",t.assigned_driver?"Reasignar":"Asignar"," Motorizado")}}function Ro(i,e){if(i&1){let t=E();o(0,"td",77)(1,"button",78)(2,"mat-icon",79),a(3,"more_vert"),n()(),o(4,"mat-menu",80,0),c(6,Po,5,0,"button",81)(7,ko,5,0,"button",81)(8,Fo,5,0,"button",81),o(9,"button",82),f("click",function(){let d=h(t).$implicit,s=u();return C(s.onViewOrderDetails(d))}),o(10,"mat-icon"),a(11,"visibility"),n(),o(12,"span"),a(13,"Ver Detalles Completos"),n()(),c(14,To,5,0,"button",81)(15,Io,5,0,"button",81)(16,Ao,5,1,"button",81),o(17,"button",82),f("click",function(){let d=h(t).$implicit,s=u();return C(s.onViewPdfA4(d))}),o(18,"mat-icon"),a(19,"picture_as_pdf"),n(),o(20,"span"),a(21,"PDF Rotulado"),n()(),o(22,"button",82),f("click",function(){let d=h(t).$implicit,s=u();return C(s.onViewPdfTicket80mm(d))}),o(23,"mat-icon"),a(24,"picture_as_pdf"),n(),o(25,"span"),a(26,"PDF formato ticket"),n()(),o(27,"button",82),f("click",function(){let d=h(t).$implicit,s=u();return C(s.onSeguimiento(d))}),o(28,"mat-icon"),a(29,"timeline"),n(),o(30,"span"),a(31,"Seguimiento"),n()()()()}if(i&2){let t=e.$implicit,r=V(5),d=u();l(),m("matMenuTriggerFor",r),l(5),m("ngIf",d.isAdmin()),l(),m("ngIf",d.isAdminOrReceptionist()),l(),m("ngIf",d.isAdminOrReceptionist()),l(6),m("ngIf",d.hasPermision(t)),l(),m("ngIf",d.isAdminOrReceptionist()),l(),m("ngIf",d.isAdminOrReceptionist())}}function Vo(i,e){i&1&&p(0,"tr",83)}function No(i,e){if(i&1&&p(0,"tr",84),i&2){let t=e.$implicit,r=u();m("ngClass",qi(1,eo,t.status===r.OrderStatus.ANULADO))}}function Bo(i,e){if(i&1&&(o(0,"tr",85)(1,"td",86),a(2," No se encontraron pedidos que coincidan con los filtros. "),n()()),i&2){let t=u();l(),Li("colspan",t.displayedColumns.length)}}var Ei=class i{appStore=O(We);orders=[];isLoading=!1;totalCount=0;pageSize=10;pageIndex=0;pageChanged=new B;sortChanged=new B;statusChanged=new B;motorizedChanged=new B;rescheduleChanged=new B;viewPdfClicked=new B;viewDetailsClicked=new B;amountToCollectChanged=new B;shippingCostChanged=new B;orderChanged=new B;displayedColumns=["code","company","shipment_type","recipient_name","recipient_phone","status","delivery_district_name","delivery_address","delivery_date","motorizado","amount_to_collect_at_delivery","tracking_code","actions"];dataSource=new St;paginator;sort;dialog=O(oi);snackBar=O(ge);OrderStatus=ui;constructor(){}ngOnChanges(e){e.orders&&this.orders&&(this.dataSource.data=this.orders)}ngAfterViewInit(){}onViewPdfA4(e){let t=Zt.apiUrl+"/orders/"+e.id+"/pdf-rotulo";window.open(t,"_blank")}onViewPdfA4Landscape(e){let t=Zt.apiUrl+"/orders/"+e.id+"/pdf-a4-landscape";window.open(t,"_blank")}onViewPdfTicket80mm(e){let t=Zt.apiUrl+"/orders/"+e.id+"/pdf-ticket-80mm";window.open(t,"_blank")}onSeguimiento(e){window.open("/tracking?code="+e.tracking_code,"_blank")}changeOrderStatus(e,t){console.log(`Changing status of order ${e.code} to ${t}`),this.statusChanged.emit({orderId:e.id,newStatus:t})}getStatusClass(e){return e?`status-${e.toLowerCase().replace(/[\s_]+/g,"-")}`:"status-desconocido"}openChangeStatusModal(e){let t=this.getAvailableStatuses(e);if(t.length===0){this.snackBar.open("No hay cambios de estado disponibles para este pedido.","OK",{duration:3e3});return}this.dialog.open(dr,{width:"450px",data:{order:e,availableStatuses:t},disableClose:!0}).afterClosed().subscribe(d=>{if(d&&d.newStatus){let s={newStatus:d.newStatus,reason:d.reason||"",proofOfDeliveryImageUrl:"",shippingCostPaymentMethod:"",collectionPaymentMethod:""};d.newStatus==="ENTREGADO"&&(d.proofOfDeliveryImageUrl&&(s.proofOfDeliveryImageUrl=d.proofOfDeliveryImageUrl),d.shippingCostPaymentMethod&&(s.shippingCostPaymentMethod=d.shippingCostPaymentMethod),d.collectionPaymentMethod&&(s.collectionPaymentMethod=d.collectionPaymentMethod)),this.statusChanged.emit(le(Q({orderId:e.id},s),{updatedAt:e.updatedAt}))}else console.log("Cambio de estado cancelado o sin selecci\xF3n.")})}getAvailableStatuses(e){let t=this.appStore.currentUser()?.role,r=["EN ALMACEN"];if(t==="MOTORIZADO"&&"REGISTRADO"&&(r=[]),t==="ADMINISTRADOR")switch(e.status){case"ENTREGADO":return["ANULADO"];case"RECHAZADO EN PUNTO":return["ANULADO"];default:return["REGISTRADO","RECOGIDO","EN ALMACEN","EN TRANSITO","ENTREGADO","RECHAZADO EN PUNTO","REPROGRAMADO","ANULADO"]}switch(e.status){case"REGISTRADO":return["RECOGIDO",...r];case"RECOGIDO":return["EN ALMACEN"];case"EN ALMACEN":return["EN TRANSITO"];case"EN TRANSITO":return["ENTREGADO","RECHAZADO EN PUNTO","REPROGRAMADO"];case"REPROGRAMADO":return["EN TRANSITO"];default:return[]}}onViewOrderDetails(e){this.viewDetailsClicked.emit(e),this.dialog.open(hi,{width:"750px",maxWidth:"90vw",maxHeight:"90vh",data:{order:e},panelClass:"order-detail-dialog-responsive",autoFocus:"dialog"})}onUploadProof(e){console.log("Upload proof for order:",e.code),this.snackBar.open('Funci\xF3n "Subir Prueba" no implementada.',"OK",{duration:2e3})}onReschedule(e){console.log("Reschedule order:",e.code),this.snackBar.open('Funci\xF3n "Reprogramar" no implementada.',"OK",{duration:2e3})}openAssignDriverModal(e){console.log(`Open modal to assign driver for order: ${e.code}`),this.dialog.open(vi,{width:"550px",data:{order:e,currentDriverId:e.assigned_driver?.uid},disableClose:!0}).afterClosed().subscribe(r=>{r&&r.selectedDriver?(console.log("Driver selected from dialog:",e.id,r.selectedDriver),this.motorizedChanged.emit({orderId:e.id,motorizedId:r.selectedDriver.id})):console.log("Assign driver cancelled or no driver selected.")})}openRescheduleOrderModal(e){console.log(`Open modal to reschedule order: ${e.code}`);let t=new Date;t.setDate(t.getDate()),this.dialog.open(xi,{width:"500px",data:{order:e,minDate:t},disableClose:!0}).afterClosed().subscribe(d=>{d&&d.newDeliveryDate?(console.log("Reschedule details from dialog:",d),this.rescheduleChanged.emit({orderId:e.id,newDate:d.newDeliveryDate,reason:d.reason})):console.log("Reschedule cancelled or no new date selected.")})}hasPermision(e){let t=this.appStore.currentUser()?.role;return t==="MOTORIZADO"&&(e.status==="REGISTRADO"||e.assigned_driver?.id===this.appStore.currentUser()?.id)||t==="ADMINISTRADOR"||t==="RECEPCIONISTA"}isAdminOrReceptionist(){let e=this.appStore.currentUser()?.role;return e==="ADMINISTRADOR"||e==="RECEPCIONISTA"}isAdmin(){return this.appStore.currentUser()?.role==="ADMINISTRADOR"}editOrder(e){if(!e.id){console.error("Order ID is missing for editing.",e),this.snackBar.open("No se puede editar el pedido: faltan datos.","Cerrar",{duration:3e3});return}this.dialog.open(Si,{width:"100vw",height:"100vh",maxWidth:"100vw",maxHeight:"100vh",data:{orderId:e.id.toString()},disableClose:!0}).afterClosed().subscribe(r=>{r?(console.log("Order updated via dialog:",r),this.orderChanged.emit(r)):console.log("Edici\xF3n de pedido cancelada.")})}openEditAmountToCollectModal(e){if(!e.id){console.error("Order ID or current monto a cabrar is missing for editing.",e),this.snackBar.open("No se puede modificar el monto a cabrar: faltan datos del pedido.","Cerrar",{duration:3e3});return}this.dialog.open(Oi,{width:"500px",data:{orderCode:e.code,currentAmount:e.amount_to_collect_at_delivery},disableClose:!0}).afterClosed().subscribe(r=>{r?(console.log("Edit Shipping Cost Dialog result:",r),this.amountToCollectChanged.emit({orderId:e.id,newAmount:r.newAmount,observation:r.observation})):console.log("Edici\xF3n de costo de env\xEDo cancelada.")})}openEditShippingCostModal(e){if(!e.id||e.shipping_cost===void 0||e.shipping_cost===null){console.error("Order ID or current shipping cost is missing for editing.",e),this.snackBar.open("No se puede modificar el costo: faltan datos del pedido.","Cerrar",{duration:3e3});return}this.dialog.open(yi,{width:"500px",data:{orderCode:e.code||e.id.toString(),currentShippingCost:e.shipping_cost},disableClose:!0}).afterClosed().subscribe(r=>{r?(console.log("Edit Shipping Cost Dialog result:",r),this.shippingCostChanged.emit({orderId:e.id,newShippingCost:r.newShippingCost,observation:r.observation})):console.log("Edici\xF3n de costo de env\xEDo cancelada.")})}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=k({type:i,selectors:[["app-order-table"]],viewQuery:function(t,r){if(t&1&&(dt(di,5),dt(mi,5)),t&2){let d;mt(d=st())&&(r.paginator=d.first),mt(d=st())&&(r.sort=d.first)}},inputs:{orders:"orders",isLoading:"isLoading",totalCount:"totalCount",pageSize:"pageSize",pageIndex:"pageIndex"},outputs:{pageChanged:"pageChanged",sortChanged:"sortChanged",statusChanged:"statusChanged",motorizedChanged:"motorizedChanged",rescheduleChanged:"rescheduleChanged",viewPdfClicked:"viewPdfClicked",viewDetailsClicked:"viewDetailsClicked",amountToCollectChanged:"amountToCollectChanged",shippingCostChanged:"shippingCostChanged",orderChanged:"orderChanged"},features:[Bi],decls:46,vars:10,consts:[["orderActionMenu","matMenu"],[1,"table-wrapper","mat-elevation-z4"],["class","spinner-overlay",4,"ngIf"],["mat-table","","matSort","",1,"orders-table","compact-table-grid",3,"matSortChange","dataSource"],["matColumnDef","code"],["mat-header-cell","","mat-sort-header","","class","compact-table-header column-code",4,"matHeaderCellDef"],["mat-cell","","class","compact-table-cell compact-cell column-code",4,"matCellDef"],["matColumnDef","company"],["mat-header-cell","","mat-sort-header","","class","compact-table-header column-company",4,"matHeaderCellDef"],["mat-cell","","class","compact-table-cell column-company",4,"matCellDef"],["matColumnDef","shipment_type"],["mat-header-cell","","mat-sort-header","","class","compact-table-header column-shipment_type",4,"matHeaderCellDef"],["mat-cell","","class","compact-table-cell compact-cell column-shipment_type",4,"matCellDef"],["matColumnDef","recipient_name"],["mat-header-cell","","mat-sort-header","","class","compact-table-header column-recipient_name",4,"matHeaderCellDef"],["mat-cell","","class","compact-table-cell column-recipient_name",4,"matCellDef"],["matColumnDef","recipient_phone"],["mat-header-cell","","mat-sort-header","","class","compact-table-header column-recipient_phone",4,"matHeaderCellDef"],["mat-cell","","class","compact-table-cell compact-cell column-recipient_phone",4,"matCellDef"],["matColumnDef","status"],["mat-header-cell","","mat-sort-header","","class","compact-table-header status-column-header column-status",4,"matHeaderCellDef"],["mat-cell","","class","compact-table-cell column-status",4,"matCellDef"],["matColumnDef","delivery_district_name"],["mat-header-cell","","mat-sort-header","","class","compact-table-header column-delivery_district_name",4,"matHeaderCellDef"],["mat-cell","","class","compact-table-cell compact-cell column-delivery_district_name",4,"matCellDef"],["matColumnDef","delivery_address"],["mat-header-cell","","mat-sort-header","","class","compact-table-header column-delivery_address",4,"matHeaderCellDef"],["mat-cell","","class","compact-table-cell compact-cell column-delivery_address",4,"matCellDef"],["matColumnDef","delivery_date"],["mat-header-cell","","mat-sort-header","","class","compact-table-header column-delivery_date",4,"matHeaderCellDef"],["mat-cell","","class","compact-table-cell compact-cell date-cell column-delivery_date",4,"matCellDef"],["matColumnDef","motorizado"],["mat-header-cell","","mat-sort-header","motorizado","class","compact-table-header column-motorizado",4,"matHeaderCellDef"],["mat-cell","","class","compact-table-cell compact-cell column-motorizado",4,"matCellDef"],["matColumnDef","amount_to_collect_at_delivery"],["mat-header-cell","","mat-sort-header","","class","compact-table-header align-right column-amount_to_collect_at_delivery",4,"matHeaderCellDef"],["mat-cell","","class","compact-table-cell align-right amount-cell compact-cell column-amount_to_collect_at_delivery",4,"matCellDef"],["matColumnDef","tracking_code"],["mat-header-cell","","mat-sort-header","","class","compact-table-header column-tracking_code",4,"matHeaderCellDef"],["mat-cell","","class","compact-table-cell compact-cell column-tracking_code",4,"matCellDef"],["matColumnDef","actions"],["mat-header-cell","","class","compact-table-header actions-column-header column-actions",4,"matHeaderCellDef"],["mat-cell","","class","compact-table-cell actions-cell column-actions",4,"matCellDef"],["mat-header-row","","class","header-row-sticky",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","","class","data-row",3,"ngClass",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["showFirstLastButtons","","aria-label","Seleccione p\xE1gina de pedidos",3,"page","length","pageSize","pageIndex","pageSizeOptions"],[1,"spinner-overlay"],["mode","indeterminate","diameter","60"],["mat-header-cell","","mat-sort-header","",1,"compact-table-header","column-code"],["mat-cell","",1,"compact-table-cell","compact-cell","column-code"],["mat-header-cell","","mat-sort-header","",1,"compact-table-header","column-company"],["mat-cell","",1,"compact-table-cell","column-company"],["mat-header-cell","","mat-sort-header","",1,"compact-table-header","column-shipment_type"],["mat-cell","",1,"compact-table-cell","compact-cell","column-shipment_type"],["mat-header-cell","","mat-sort-header","",1,"compact-table-header","column-recipient_name"],["mat-cell","",1,"compact-table-cell","column-recipient_name"],["mat-header-cell","","mat-sort-header","",1,"compact-table-header","column-recipient_phone"],["mat-cell","",1,"compact-table-cell","compact-cell","column-recipient_phone"],["mat-header-cell","","mat-sort-header","",1,"compact-table-header","status-column-header","column-status"],["mat-cell","",1,"compact-table-cell","column-status"],[1,"status-badge",3,"ngClass"],["mat-header-cell","","mat-sort-header","",1,"compact-table-header","column-delivery_district_name"],["mat-cell","",1,"compact-table-cell","compact-cell","column-delivery_district_name"],["class","express-badge",4,"ngIf"],[1,"express-badge"],["mat-header-cell","","mat-sort-header","",1,"compact-table-header","column-delivery_address"],["mat-cell","",1,"compact-table-cell","compact-cell","column-delivery_address"],["mat-header-cell","","mat-sort-header","",1,"compact-table-header","column-delivery_date"],["mat-cell","",1,"compact-table-cell","compact-cell","date-cell","column-delivery_date"],["mat-header-cell","","mat-sort-header","motorizado",1,"compact-table-header","column-motorizado"],["mat-cell","",1,"compact-table-cell","compact-cell","column-motorizado"],["mat-header-cell","","mat-sort-header","",1,"compact-table-header","align-right","column-amount_to_collect_at_delivery"],["mat-cell","",1,"compact-table-cell","align-right","amount-cell","compact-cell","column-amount_to_collect_at_delivery"],["mat-header-cell","","mat-sort-header","",1,"compact-table-header","column-tracking_code"],["mat-cell","",1,"compact-table-cell","compact-cell","column-tracking_code"],["mat-header-cell","",1,"compact-table-header","actions-column-header","column-actions"],["mat-cell","",1,"compact-table-cell","actions-cell","column-actions"],["mat-icon-button","","aria-label","M\xE1s acciones del pedido",1,"action-icon-neutral","compact-action-button",3,"matMenuTriggerFor"],[1,"compact-icon"],["xPosition","before"],["mat-menu-item","",3,"click",4,"ngIf"],["mat-menu-item","",3,"click"],["mat-header-row","",1,"header-row-sticky"],["mat-row","",1,"data-row",3,"ngClass"],[1,"mat-row"],[1,"no-data-cell"]],template:function(t,r){t&1&&(o(0,"div",1),c(1,to,2,0,"div",2),o(2,"table",3),f("matSortChange",function(s){return r.sortChanged.emit(s)}),y(3,4),c(4,io,2,0,"th",5)(5,ro,2,1,"td",6),S(),y(6,7),c(7,no,2,0,"th",8)(8,oo,2,1,"td",9),S(),y(9,10),c(10,ao,2,0,"th",11)(11,lo,2,1,"td",12),S(),y(12,13),c(13,mo,2,0,"th",14)(14,so,2,1,"td",15),S(),y(15,16),c(16,co,2,0,"th",17)(17,po,2,1,"td",18),S(),y(18,19),c(19,uo,2,0,"th",20)(20,go,3,2,"td",21),S(),y(21,22),c(22,_o,2,0,"th",23)(23,ho,3,2,"td",24),S(),y(24,25),c(25,Co,2,0,"th",26)(26,vo,2,1,"td",27),S(),y(27,28),c(28,bo,2,0,"th",29)(29,xo,3,4,"td",30),S(),y(30,31),c(31,Oo,2,0,"th",32)(32,yo,2,1,"td",33),S(),y(33,34),c(34,So,2,0,"th",35)(35,Eo,3,6,"td",36),S(),y(36,37),c(37,Mo,2,0,"th",38)(38,Do,2,1,"td",39),S(),y(39,40),c(40,wo,2,0,"th",41)(41,Ro,32,7,"td",42),S(),c(42,Vo,1,0,"tr",43)(43,No,1,3,"tr",44)(44,Bo,3,1,"tr",45),n(),o(45,"mat-paginator",46),f("page",function(s){return r.pageChanged.emit(s)}),n()()),t&2&&(l(),m("ngIf",r.isLoading),l(),m("dataSource",r.dataSource),l(40),m("matHeaderRowDef",r.displayedColumns)("matHeaderRowDefSticky",!0),l(),m("matRowDefColumns",r.displayedColumns),l(2),m("length",r.totalCount)("pageSize",r.pageSize)("pageIndex",r.pageIndex)("pageSizeOptions",zi(9,Jn)))},dependencies:[F,Ge,q,X,G,nt,Ke,Xe,et,Ye,Qe,tt,Ze,Je,it,rt,tr,rr,di,or,mi,nr,we,De,T,ue,I,$,Mt,ni,ii,ti,ri,ne,Fe,Ae],styles:["[_nghost-%COMP%]{display:block}.table-wrapper[_ngcontent-%COMP%]{position:relative;overflow:auto;background-color:var(--sys-surface);color:var(--sys-on-surface);margin-top:20px;box-shadow:0 4px 20px #00000014;transition:box-shadow .3s ease-in-out}.table-wrapper[_ngcontent-%COMP%]:hover{box-shadow:0 6px 25px #0000001f}.spinner-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background-color:rgba(var(--sys-surface),.85);display:flex;justify-content:center;align-items:center;z-index:100;border-radius:12px}.orders-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.compact-table-header[_ngcontent-%COMP%]{font-weight:600;color:var(--sys-on-surface-variant);background-color:var(--sys-surface-container-low);padding:0!important;border-bottom:1px solid var(--sys-outline-variant);text-transform:uppercase;font-size:.65rem;letter-spacing:.2px;white-space:nowrap;line-height:1.1}.compact-table-cell[_ngcontent-%COMP%]{padding:0!important;border-bottom:1px solid var(--sys-outline-variant);color:var(--sys-on-surface-variant);font-size:.75rem;line-height:1.1;border-right:1px solid #f5f5f5}.compact-table-cell[_ngcontent-%COMP%]:last-child{border-right:none}.header-row-sticky[_ngcontent-%COMP%]{position:sticky;top:0;z-index:10;background-color:var(--sys-surface-container-low)}.data-row[_ngcontent-%COMP%]{position:relative;transition:background-color .15s ease-in-out}.data-row[_ngcontent-%COMP%]:hover:not(.row-cancelled-strikethrough){background-color:#f8f9fa}.data-row.row-cancelled-strikethrough[_ngcontent-%COMP%]{color:#9e9e9e;opacity:.75}.data-row.row-cancelled-strikethrough[_ngcontent-%COMP%]:after{position:absolute;left:8px;right:8px;top:50%;height:1.5px;background-color:#d32f2f;transform:translateY(-50%);z-index:1;pointer-events:none}.highlight-row[_ngcontent-%COMP%]{background-color:var(--sys-primary-container)!important;font-weight:500}.actions-column-header[_ngcontent-%COMP%]{text-align:center!important}.actions-cell[_ngcontent-%COMP%]{text-align:center;white-space:nowrap}.actions-cell[_ngcontent-%COMP%]   button.mat-icon-button[_ngcontent-%COMP%]{margin:0 2px;color:var(--sys-on-surface-variant);transition:color .2s ease}.actions-cell[_ngcontent-%COMP%]   button.mat-icon-button[_ngcontent-%COMP%]:hover{color:var(--sys-primary)}.action-icon-delivered[_ngcontent-%COMP%]{color:#4caf50}.action-icon-delivered[_ngcontent-%COMP%]:hover{color:#388e3c}.action-icon-neutral[_ngcontent-%COMP%]{color:var(--sys-on-surface-variant)}.action-icon-neutral[_ngcontent-%COMP%]:hover{color:var(--sys-on-surface)}.compact-action-button[_ngcontent-%COMP%]{transform:scale(.8);margin:0!important}.compact-icon[_ngcontent-%COMP%]{font-size:18px!important;width:18px!important;height:18px!important;line-height:18px!important}.status-badge[_ngcontent-%COMP%]{padding:3px 8px;border-radius:12px;font-size:.65rem;font-weight:700!important;text-transform:uppercase;letter-spacing:.3px;display:inline-flex;align-items:center;line-height:1;white-space:nowrap}.status-registrado[_ngcontent-%COMP%]{background-color:#6610f2;color:#fff}.status-recogido[_ngcontent-%COMP%]{background-color:#fd7e14;color:#fff}.status-en-almacen[_ngcontent-%COMP%]{background-color:#0d6efd;color:#fff;white-space:nowrap}.status-en-transito[_ngcontent-%COMP%]{background-color:#0c1a77;color:#fff;white-space:nowrap;font-weight:900!important}.status-entregado[_ngcontent-%COMP%]{background-color:#198754;color:#fff}.status-anulado[_ngcontent-%COMP%]{background-color:#dc3545;color:#fff;white-space:nowrap}.status-cancelado[_ngcontent-%COMP%]{background-color:#6c757d;color:#fff}.status-rechazado-en-punto[_ngcontent-%COMP%]{background-color:#ff6b6b;color:#fff;white-space:nowrap}.status-reprogramado[_ngcontent-%COMP%]{background-color:#adb5bd;color:#212529}.status-desconocido[_ngcontent-%COMP%]{background-color:#9e9e9e;color:#fff}.express-badge[_ngcontent-%COMP%]{background-color:#f97c06;color:#fff;border-radius:6px;margin-left:4px;padding:1px 4px;font-size:.6rem;font-weight:600;display:inline-block;line-height:1}.align-right[_ngcontent-%COMP%]{text-align:right;justify-content:flex-end}.amount-cell[_ngcontent-%COMP%]{font-weight:500}.no-data-cell[_ngcontent-%COMP%]{text-align:center;padding:0;font-style:italic;color:var(--sys-on-surface-variant);font-size:1rem}.truncate-text[_ngcontent-%COMP%]{max-width:120px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:inline-block;vertical-align:middle}.truncate-texts[_ngcontent-%COMP%]{max-width:100px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:inline-block;vertical-align:middle}.code-cell[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#3f51b5;text-decoration:none;font-weight:500}.code-cell[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}.date-cell[_ngcontent-%COMP%]{white-space:nowrap}.compact-table-grid[_ngcontent-%COMP%]{border-collapse:separate;border-spacing:0}.compact-table-grid[_ngcontent-%COMP%]   .compact-table-header[_ngcontent-%COMP%], .compact-table-grid[_ngcontent-%COMP%]   .compact-table-cell[_ngcontent-%COMP%]{border-right:1px solid var(--sys-outline-variant)}.compact-table-grid[_ngcontent-%COMP%]   .compact-table-header[_ngcontent-%COMP%]:last-child, .compact-table-grid[_ngcontent-%COMP%]   .compact-table-cell[_ngcontent-%COMP%]:last-child{border-right:none}.compact-cell[_ngcontent-%COMP%]{padding:0!important;font-size:.75rem!important;line-height:1.1}.orders-table.compact-table-grid[_ngcontent-%COMP%]   .column-code[_ngcontent-%COMP%]{width:55px}.orders-table.compact-table-grid[_ngcontent-%COMP%]   .column-company[_ngcontent-%COMP%]{width:90px}.orders-table.compact-table-grid[_ngcontent-%COMP%]   .column-recipient_name[_ngcontent-%COMP%]{width:120px!important}.orders-table.compact-table-grid[_ngcontent-%COMP%]   .column-shipment_type[_ngcontent-%COMP%]{width:50px}.orders-table.compact-table-grid[_ngcontent-%COMP%]   .column-status[_ngcontent-%COMP%]{width:70px}.orders-table.compact-table-grid[_ngcontent-%COMP%]   .column-recipient_phone[_ngcontent-%COMP%]{width:85px}.orders-table.compact-table-grid[_ngcontent-%COMP%]   .column-delivery_district_name[_ngcontent-%COMP%]{width:90px}.orders-table.compact-table-grid[_ngcontent-%COMP%]   .column-delivery_address[_ngcontent-%COMP%]{width:150px}.orders-table.compact-table-grid[_ngcontent-%COMP%]   .column-delivery_date[_ngcontent-%COMP%], .orders-table.compact-table-grid[_ngcontent-%COMP%]   .column-motorizado[_ngcontent-%COMP%]{width:90px}.orders-table.compact-table-grid[_ngcontent-%COMP%]   .column-amount_to_collect_at_delivery[_ngcontent-%COMP%]{width:75px}.orders-table.compact-table-grid[_ngcontent-%COMP%]   .column-tracking_code[_ngcontent-%COMP%]{width:110px}.orders-table.compact-table-grid[_ngcontent-%COMP%]   .column-actions[_ngcontent-%COMP%]{width:35px}.mat-mdc-paginator[_ngcontent-%COMP%]{background-color:var(--sys-surface-container-low);border-bottom-left-radius:12px;border-bottom-right-radius:12px;color:var(--sys-on-surface-variant);border-top:1px solid var(--sys-outline-variant);padding:8px 0}@media (max-width: 768px){.compact-table-header[_ngcontent-%COMP%], .compact-table-cell[_ngcontent-%COMP%]{padding:3px 4px;font-size:.6rem}.status-badge[_ngcontent-%COMP%]{padding:2px 4px;font-size:.55rem}.compact-cell[_ngcontent-%COMP%]{padding:3px 4px!important;font-size:.6rem!important}}"]})};var Lo="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-TFG-8",zo=".xlsx",Mi=class i{constructor(){}exportAsExcelFile(e,t,r="Sheet1"){if(!e||e.length===0){console.warn("No data provided for Excel export.");return}let d=cr.json_to_sheet(e),s={Sheets:{[r]:d},SheetNames:[r]},_=sr(s,{bookType:"xlsx",type:"array"});this.saveAsExcelFile(_,t)}saveAsExcelFile(e,t){let r=new Blob([e],{type:Lo}),d=window.URL.createObjectURL(r),s=document.createElement("a");s.href=d,s.download=`${t}${zo}`,document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(d)}static \u0275fac=function(t){return new(t||i)};static \u0275prov=Ni({token:i,factory:i.\u0275fac,providedIn:"root"})};function qo(i,e){if(i&1){let t=E();o(0,"div",8)(1,"mat-slide-toggle",9),f("change",function(d){h(t);let s=u();return C(s.onToggleMyOrders(d))}),a(2," Mis pedidos "),n()()}if(i&2){let t=u();l(),m("checked",t.showMyOrders)}}function $o(i,e){if(i&1){let t=E();o(0,"button",13),f("click",function(){h(t);let d=u();return C(d.exportDataToExcel2())}),a(1," Exportar para planificaci\xF3n de rutas "),n()}}var Di=class i{orderService=O(oe);snackBar=O(ge);dialog=O(oi);excelExportService=O(Mi);datePipe=O(G);appStore=O(We);orders=[];isLoading=!1;totalOrderCount=0;currentPageIndex=0;currentPageSize=10;currentSortField="registration_date";currentSortDirection="desc";showMyOrders=!1;isExpress=!1;now=new Date;firstDay=new Date(this.now.getFullYear(),this.now.getMonth(),1);lastDay=new Date(this.now.getFullYear(),this.now.getMonth()+1,0);filterCriteriaSubject=new Ri({start_date:this.datePipe.transform(this.firstDay,"yyyy-MM-dd"),end_date:this.datePipe.transform(this.lastDay,"yyyy-MM-dd"),status:null});destroy$=new de;constructor(){}ngOnInit(){this.filterCriteriaSubject.pipe(P(this.destroy$),Me(()=>this.currentPageIndex=0)).subscribe(()=>{this.fetchOrders()})}isDriver(){return this.appStore.currentUser()?.role==="MOTORIZADO"}hasPermissionToExportRoutePlanningExcel(){return this.appStore.currentUser()?.role==="RECEPCIONISTA"||this.appStore.currentUser()?.role==="ADMINISTRADOR"}onToggleMyOrders(e){this.showMyOrders=e.checked;let t=this.filterCriteriaSubject.value;this.filterCriteriaSubject.next(le(Q({},t),{myOrders:this.showMyOrders}))}onToggleIsExpress(e){this.isExpress=e.checked;let t=this.filterCriteriaSubject.value;this.filterCriteriaSubject.next(le(Q({},t),{isExpress:this.isExpress}))}getAllFilteredOrdersForExport(){return jt(this,null,function*(){try{let e=this.filterCriteriaSubject.value;return(yield Ti(this.orderService.getOrders2(e,this.currentSortField,this.currentSortDirection).pipe(P(this.destroy$))))||[]}catch(e){return console.error("Error fetching all filtered orders for export:",e),this.snackBar.open("Failed to fetch data for export.","Close",{duration:3e3,panelClass:["error-snackbar"]}),[]}})}exportDataToExcel(){return jt(this,null,function*(){this.isLoading=!0,this.snackBar.open("Preparando la exportaci\xF3n a Excel, esto puede tardar un momento...","",{duration:0});try{let e=yield this.getAllFilteredOrdersForExport();if(e&&e.length>0){let t=e.map(r=>({"TIPO DE ENVIO":r.shipment_type,"NOMBRE DEL DESTINATARIO":r.recipient_name,"TELEFONO DESTINATARIO 9 DIGITOS":r.recipient_phone,DISTRITO:r.delivery_district_name,"DIRECCION DE ENTREGA":r.delivery_address,"FECHA DE REGISTRO":r.createdAt?this.datePipe.transform(r.createdAt,"dd/MM/yyyy"):"N/A","FECHA DE ENTREGA":r.delivery_date,"DETALLE DEL PRODUCTO":r.item_description,"COSTO DE ENVIO":r.shipping_cost,"MONTO A COBRAR":r.amount_to_collect_at_delivery,"FORMA DE PAGO":r.payment_method_for_collection,OBSERVACION:r.observations||""}));this.excelExportService.exportAsExcelFile(t,"Listado_Pedidos_Filtrados","Pedidos"),this.snackBar.dismiss(),this.snackBar.open("\xA1Archivo Excel exportado exitosamente!","OK",{duration:3500,panelClass:["success-snackbar"]})}else this.snackBar.dismiss(),this.snackBar.open("No hay datos disponibles para exportar con los filtros actuales.","OK",{duration:3e3})}catch(e){console.error("Error during Excel export process:",e),this.snackBar.dismiss(),this.snackBar.open("An error occurred during Excel export.","Close",{duration:3e3,panelClass:["error-snackbar"]})}finally{this.isLoading=!1}})}exportDataToExcel2(){return jt(this,null,function*(){this.isLoading=!0,this.snackBar.open("Preparando la exportaci\xF3n a Excel, esto puede tardar un momento...","",{duration:0});let e=yield Ti(this.orderService.getStandardPackageMeasurements().pipe(P(this.destroy$)));try{let t=yield this.getAllFilteredOrdersForExport();if(t&&t.length>0){let r=t.map(d=>{let s=e.sta_height_cm,_=e.sta_length_cm,D=e.sta_width_cm,x=e.sta_weight_kg;return d.package_size_type==="custom"&&(s=d.package_height_cm,_=d.package_length_cm,D=d.package_width_cm,x=d.package_weight_kg),{pedido_id:d.code,peso_kg:x,largo_cm:_,ancho_cm:D,alto_cm:s,direccion:d.delivery_address+"-"+d.delivery_district_name}});this.excelExportService.exportAsExcelFile(r,"Listado_Pedidos_Filtrados","Pedidos"),this.snackBar.dismiss(),this.snackBar.open("\xA1Archivo Excel exportado exitosamente!","OK",{duration:3500,panelClass:["success-snackbar"]})}else this.snackBar.dismiss(),this.snackBar.open("No hay datos disponibles para exportar con los filtros actuales.","OK",{duration:3e3})}catch(t){console.error("Error during Excel export process:",t),this.snackBar.dismiss(),this.snackBar.open("An error occurred during Excel export.","Close",{duration:3e3,panelClass:["error-snackbar"]})}finally{this.isLoading=!1}})}fetchOrders(){this.isLoading=!0;let e=this.filterCriteriaSubject.value,t=Q({},e);this.showMyOrders?t.myOrders=!0:delete t.myOrders,console.log(e,this.isExpress),this.isExpress?t.isExpress=!0:delete t.isExpress,this.orderService.getOrders(t,this.currentPageIndex+1,this.currentPageSize,this.currentSortField,this.currentSortDirection).pipe(P(this.destroy$),Ee(r=>(this.snackBar.open(r.message||"Failed to load orders.","Close",{duration:5e3,panelClass:["error-snackbar"]}),this.isLoading=!1,[]))).subscribe(r=>{this.orders=r.items,this.totalOrderCount=r.total_count||0,this.isLoading=!1,console.log("Orders fetched:",r)})}openImportModal(){let e=this.dialog.open(pr,{width:"90%",maxWidth:"700px",autoFocus:!1,disableClose:!0});e.componentInstance.importCompleted.subscribe(t=>{t&&(console.log("Import completed, reloading orders..."),this.fetchOrders())}),e.afterClosed().subscribe(t=>{console.log("The import dialog was closed",t)})}handleEditOrderChanged(e){this.fetchOrders()}handleStatusChanged(e){this.isLoading=!0,console.log("OrderListPage: Status change requested",e),this.orderService.updateOrderStatus(e.orderId,e.newStatus,e.reason||"",e.proofOfDeliveryImageUrl,e.shippingCostPaymentMethod,e.collectionPaymentMethod,e.updatedAt).subscribe({next:t=>{this.snackBar.open(`Estado del pedido ${t.code} actualizado a ${e.newStatus}.`,"OK",{duration:3e3,panelClass:["success-snackbar"]}),this.fetchOrders()},error:t=>{console.log("err",t.message),this.snackBar.open(`${t.message||"Intente de nuevo"}`,"Cerrar",{duration:7e3,panelClass:["error-snackbar"]}),this.isLoading=!1},complete:()=>{this.isLoading=!1}})}handleMotorizedChanged(e){console.log("orderId",e.orderId),console.log("motorizedId",e.motorizedId),this.orderService.assignDriverToOrder(e.orderId,e.motorizedId).subscribe({next:t=>{this.snackBar.open(`Motorizado ${t.assigned_driver?.username} asignado al pedido ${t.code}.`,"OK",{duration:3e3,panelClass:["success-snackbar"]}),this.fetchOrders()},error:t=>{this.snackBar.open(`Error al asignar motorizado: ${t.message||"Intente de nuevo"}`,"Cerrar",{duration:5e3,panelClass:["error-snackbar"]})}})}handleRescheduleChanged(e){let t=new Date(e.newDate).toISOString();this.orderService.rescheduleOrder(e.orderId,t||"",e.reason).subscribe({next:r=>{this.snackBar.open(`Pedido ${r.code} reprogramado para ${this.datePipe.transform(r.delivery_date,"dd/MM/yyyy")}.`,"OK",{duration:3500,panelClass:["success-snackbar"]}),this.fetchOrders()},error:r=>{this.snackBar.open(`Error al reprogramar pedido: ${r.message||"Intente de nuevo"}`,"Cerrar",{duration:5e3,panelClass:["error-snackbar"]})}})}handleAmountToCollectChanged(e){this.isLoading=!0,console.log("OrderListPage: Shipping cost change requested",e),this.orderService.updateOrderAmountToCollect(e.orderId,e.newAmount,e.observation).subscribe({next:t=>{this.snackBar.open(`Monto a cobrar del pedido ${t.code} actualizado.`,"OK",{duration:3e3,panelClass:["success-snackbar"]}),this.fetchOrders()},error:t=>{this.snackBar.open(`Error al actualizar costo: ${t.message||"Intente de nuevo"}`,"Cerrar",{duration:5e3,panelClass:["error-snackbar"]}),this.isLoading=!1},complete:()=>{this.isLoading=!1}})}handleShippingCostChanged(e){this.isLoading=!0,console.log("OrderListPage: Shipping cost change requested",e),this.orderService.updateOrderShippingCost(e.orderId,e.newShippingCost,e.observation).subscribe({next:t=>{this.snackBar.open(`Costo de env\xEDo del pedido ${t.code} actualizado.`,"OK",{duration:3e3,panelClass:["success-snackbar"]}),this.fetchOrders()},error:t=>{this.snackBar.open(`Error al actualizar costo: ${t.message||"Intente de nuevo"}`,"Cerrar",{duration:5e3,panelClass:["error-snackbar"]}),this.isLoading=!1},complete:()=>{this.isLoading=!1}})}onFiltersChanged(e){console.log("OrderListPage: Filters changed",e),this.filterCriteriaSubject.next(e)}onPageChanged(e){console.log("OrderListPage: Page changed",e),this.currentPageIndex=e.pageIndex,this.currentPageSize=e.pageSize,this.fetchOrders()}onSortChanged(e){console.log("OrderListPage: Sort changed",e),this.currentSortField=e.active,this.currentSortDirection=e.direction,this.currentPageIndex=0,this.fetchOrders()}handleMassiveActions(e){console.log("Massive action selected:",e),this.snackBar.open(`Action: ${e} not implemented yet.`,"OK",{duration:3e3})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=k({type:i,selectors:[["app-order-list-page"]],decls:25,vars:9,consts:[["massiveActionsMenu","matMenu"],[1,"page-content-wrapper"],[1,"page-title-bar"],[1,"page-title"],[1,"breadcrumbs"],[3,"filtersChanged"],[1,"table-controls-bar"],["class","my-orders-toggle",4,"ngIf"],[1,"my-orders-toggle"],[3,"change","checked"],[1,"records-info"],[1,"actions-group"],["mat-flat-button","",1,"btn-corp-primary","acciones-masivas",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-menu-item","",3,"click",4,"ngIf"],[3,"pageChanged","sortChanged","statusChanged","motorizedChanged","rescheduleChanged","amountToCollectChanged","shippingCostChanged","orderChanged","orders","isLoading","totalCount","pageSize","pageIndex"]],template:function(t,r){if(t&1){let d=E();o(0,"div",1)(1,"div",2)(2,"h1",3),a(3,"Listado de pedidos"),n(),p(4,"div",4),n(),o(5,"app-order-filters",5),f("filtersChanged",function(_){return h(d),C(r.onFiltersChanged(_))}),n(),o(6,"div",6),c(7,qo,3,1,"div",7),o(8,"div",8)(9,"mat-slide-toggle",9),f("change",function(_){return h(d),C(r.onToggleIsExpress(_))}),a(10," Pedidos Express "),n()(),p(11,"div",10),o(12,"div",11)(13,"button",12),a(14," Acciones Masivas "),o(15,"mat-icon"),a(16,"arrow_drop_down"),n()(),o(17,"mat-menu",null,0)(19,"button",13),f("click",function(){return h(d),C(r.exportDataToExcel())}),a(20," Exportar a Excel "),n(),c(21,$o,2,0,"button",14),o(22,"button",13),f("click",function(){return h(d),C(r.openImportModal())}),a(23," Importar desde Excel "),n()()()(),o(24,"app-order-table",15),f("pageChanged",function(_){return h(d),C(r.onPageChanged(_))})("sortChanged",function(_){return h(d),C(r.onSortChanged(_))})("statusChanged",function(_){return h(d),C(r.handleStatusChanged(_))})("motorizedChanged",function(_){return h(d),C(r.handleMotorizedChanged(_))})("rescheduleChanged",function(_){return h(d),C(r.handleRescheduleChanged(_))})("amountToCollectChanged",function(_){return h(d),C(r.handleAmountToCollectChanged(_))})("shippingCostChanged",function(_){return h(d),C(r.handleShippingCostChanged(_))})("orderChanged",function(_){return h(d),C(r.handleEditOrderChanged(_))}),n()()}if(t&2){let d=V(18);l(7),m("ngIf",r.isDriver()),l(2),m("checked",r.isExpress),l(4),m("matMenuTriggerFor",d),l(8),m("ngIf",r.hasPermissionToExportRoutePlanningExcel()),l(3),m("orders",r.orders)("isLoading",r.isLoading)("totalCount",r.totalOrderCount)("pageSize",r.currentPageSize)("pageIndex",r.currentPageIndex)}},dependencies:[F,q,Yt,_i,Ei,Fe,T,N,I,$,ni,ii,ti,ri,lr,ar],styles:[".page-content-wrapper[_ngcontent-%COMP%]{padding:20px 24px;background-color:var(--sys-surface-container-lowest);color:var(--sys-on-surface);min-height:calc(100vh - 64px)}.page-title-bar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:30px}.page-title[_ngcontent-%COMP%]{font-size:24px;font-weight:600;color:var(--sys-on-surface);margin:0}.breadcrumbs[_ngcontent-%COMP%]{font-size:14px;color:var(--sys-on-surface-variant)}.breadcrumbs[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--sys-primary);text-decoration:none}.breadcrumbs[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}.breadcrumbs[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-left:5px}.table-controls-bar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;background-color:var(--sys-surface-container-low);padding:8px 16px}.records-info[_ngcontent-%COMP%]{font-size:.9em;color:#555}.actions-group[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center}.orders-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr;gap:20px}.acciones-masivas[_ngcontent-%COMP%]{padding:25px!important}@media (min-width: 768px){.orders-grid[_ngcontent-%COMP%]{grid-template-columns:1fr 1fr}.acciones-masivas[_ngcontent-%COMP%]{padding:20px!important}}"]})};var Go=(i,e)=>({"principal-item":i,"additional-item":e}),Cr=(i,e)=>e.id;function Uo(i,e){if(i&1){let t=E();o(0,"button",49),f("click",function(){h(t);let d=u(2);return C(d.clearDriverSelection())}),o(1,"mat-icon"),a(2,"close"),n()()}}function jo(i,e){i&1&&(o(0,"mat-icon",12),a(1,"person_search"),n())}function Ho(i,e){i&1&&p(0,"mat-progress-spinner",50)}function Wo(i,e){if(i&1&&(o(0,"mat-option",22)(1,"div",51)(2,"span"),a(3),n()()()),i&2){let t=e.$implicit;m("value",t),l(3),w(t.username)}}function Ko(i,e){i&1&&(o(0,"mat-option",23),a(1,"No se encontraron motorizados."),n())}function Qo(i,e){i&1&&(o(0,"mat-error"),a(1,"Requerido"),n())}function Xo(i,e){if(i&1){let t=E();o(0,"mat-form-field",47)(1,"mat-label"),a(2,"Buscar y Seleccionar empresa"),n(),p(3,"input",48),c(4,Uo,3,0,"button",18)(5,jo,2,0,"mat-icon",19)(6,Ho,1,0,"mat-progress-spinner",20),o(7,"mat-autocomplete",21,2),f("optionSelected",function(d){h(t);let s=u();return C(s.onDriverSelected(d))}),ze(9,Wo,4,2,"mat-option",22,Cr),v(11,"async"),c(12,Ko,2,0,"mat-option",23),v(13,"async"),n(),c(14,Qo,2,0,"mat-error",13),n()}if(i&2){let t,r,d=V(8),s=u();l(3),m("formControl",s.driverSearchCtrl)("matAutocomplete",d),l(),m("ngIf",s.driverSearchCtrl.value&&!s.isLoadingDrivers),l(),m("ngIf",!s.driverSearchCtrl.value&&!s.isLoadingDrivers),l(),m("ngIf",s.isLoadingDrivers),l(),m("displayWith",s.displayDriverName),l(2),qe(R(11,8,s.filteredDrivers$)),l(3),L(((t=R(13,10,s.filteredDrivers$))==null?null:t.length)===0&&!s.isLoadingDrivers&&s.driverSearchCtrl.value?12:-1),l(2),m("ngIf",(r=s.orderForm.get("company_id"))==null?null:r.hasError("required"))}}function Yo(i,e){if(i&1&&(o(0,"mat-option",22),a(1),n()),i&2){let t=e.$implicit;m("value",t),l(),w(t)}}function Zo(i,e){i&1&&(o(0,"mat-error"),a(1,"Requerido"),n())}function Jo(i,e){i&1&&(o(0,"mat-error"),a(1,"Requerido"),n())}function ea(i,e){i&1&&(o(0,"mat-error"),a(1,"Tel\xE9fono inv\xE1lido"),n())}function ta(i,e){if(i&1){let t=E();o(0,"button",49),f("click",function(){h(t);let d=u();return C(d.clearDistrictSelection())}),o(1,"mat-icon"),a(2,"close"),n()()}}function ia(i,e){i&1&&(o(0,"mat-icon",12),a(1,"person_search"),n())}function ra(i,e){i&1&&p(0,"mat-progress-spinner",50)}function na(i,e){if(i&1&&(o(0,"mat-option",22)(1,"div",51)(2,"span"),a(3),n()()()),i&2){let t=e.$implicit;m("value",t),l(3),w(t.name_and_price)}}function oa(i,e){i&1&&(o(0,"mat-option",23),a(1,"No se encontraron distritos."),n())}function aa(i,e){i&1&&(o(0,"mat-error"),a(1,"Requerido"),n())}function la(i,e){i&1&&(o(0,"mat-error"),a(1,"Requerido"),n())}function da(i,e){i&1&&(o(0,"mat-error"),a(1,"M\xEDnimo 6 caracteres"),n())}function ma(i,e){i&1&&(o(0,"mat-error"),a(1,"Requerido"),n())}function sa(i,e){if(i&1&&(o(0,"div",52)(1,"div",53)(2,"span",54),a(3,"\u{1F4E6}"),n(),o(4,"div",55)(5,"strong"),a(6,"Paquete Est\xE1ndar seleccionado"),n(),o(7,"div"),a(8),n()()()()),i&2){let t=u();l(8),w(t.standardPackageLabel())}}function ca(i,e){i&1&&(o(0,"div",56)(1,"p"),a(2," Si su paquete excede las medidas y pesos est\xE1ndar y no utiliza la calculadora de env\xEDo, se le cobrar\xE1 en funci\xF3n de esas medidas sin previo aviso. "),n()())}function pa(i,e){i&1&&(o(0,"mat-error"),a(1,"Requerido"),n())}function ua(i,e){i&1&&(o(0,"mat-error"),a(1,"Requerido"),n())}function ga(i,e){i&1&&(o(0,"mat-error"),a(1,"Requerido"),n())}function _a(i,e){i&1&&(o(0,"mat-error"),a(1,"Requerido"),n())}function fa(i,e){i&1&&(o(0,"mat-error"),a(1,"Requerido"),n())}function ha(i,e){if(i&1&&(o(0,"div",69),a(1," Costo de env\xEDo del paquete = "),o(2,"span",39),a(3),v(4,"number"),n()()),i&2){let t=u(2);l(3),g("S/ ",M(4,1,t.shippingCostPackage(),"1.2-2"),"")}}function Ca(i,e){i&1&&(o(0,"th",84),a(1,"Descripci\xF3n"),n())}function va(i,e){if(i&1&&(o(0,"td",85),a(1),n()),i&2){let t=e.$implicit;l(),g(" ",t.value.description," ")}}function ba(i,e){i&1&&(o(0,"th",84),a(1,"Medidas"),n())}function xa(i,e){if(i&1&&(o(0,"td",85),a(1),p(2,"br"),o(3,"small"),a(4),n()()),i&2){let t=e.$implicit;l(),ut(" ",t.value.length_cm,"x",t.value.width_cm,"x",t.value.height_cm,"cm "),l(3),g("",t.value.weight_kg,"kg")}}function Oa(i,e){i&1&&(o(0,"th",84),a(1,"Precio Base"),n())}function ya(i,e){if(i&1&&(o(0,"td",85),a(1),v(2,"currency"),n()),i&2){let t=e.$implicit;l(),g(" ",M(2,1,t.value.basePrice,"S/ ")," ")}}function Sa(i,e){i&1&&(o(0,"th",84),a(1,"Tipo"),n())}function Ea(i,e){if(i&1&&(o(0,"td",85)(1,"span",86),a(2),n()()),i&2){let t=e.$implicit;l(),m("ngClass",Kt(2,Go,t.value.isPrincipal,!t.value.isPrincipal)),l(),g(" ",t.value.isPrincipal?"Principal":"Adicional"," ")}}function Ma(i,e){i&1&&(o(0,"th",84),a(1,"Precio Final"),n())}function Da(i,e){if(i&1&&(o(0,"div",88)(1,"span",89),a(2),v(3,"currency"),n(),o(4,"span",90),a(5),v(6,"currency"),n()()),i&2){let t=u().$implicit;l(2),w(M(3,2,t.value.basePrice,"S/ ")),l(3),w(M(6,5,t.value.finalPrice,"S/ "))}}function wa(i,e){if(i&1&&(o(0,"div"),a(1),v(2,"currency"),n()),i&2){let t=u().$implicit;l(),g(" ",M(2,1,t.value.finalPrice,"S/ ")," ")}}function Pa(i,e){if(i&1&&(o(0,"td",85),c(1,Da,7,8,"div",87)(2,wa,3,4,"div",13),n()),i&2){let t=e.$implicit;l(),m("ngIf",!t.value.isPrincipal&&t.value.finalPrice<t.value.basePrice),l(),m("ngIf",t.value.isPrincipal||t.value.finalPrice>=t.value.basePrice)}}function ka(i,e){i&1&&(o(0,"th",84),a(1,"Eliminar"),n())}function Fa(i,e){if(i&1){let t=E();o(0,"td",85)(1,"button",91),f("click",function(){let d=h(t).index,s=u(3);return C(s.removeItem(d))}),o(2,"mat-icon"),a(3,"delete"),n()()()}}function Ta(i,e){i&1&&p(0,"tr",92)}function Ia(i,e){i&1&&p(0,"tr",93)}function Aa(i,e){if(i&1){let t=E();o(0,"div",70)(1,"h3",30),a(2,"Desglose de Paquetes"),n(),o(3,"mat-form-field",71)(4,"mat-label"),a(5,"% Descuento Adicional"),n(),o(6,"input",72),f("input",function(d){h(t);let s=u(2);return C(s.multiPackageDiscountPercentage.set(+d.target.value))}),n(),o(7,"mat-icon",12),a(8,"percent"),n()(),o(9,"table",73),y(10,74),c(11,Ca,2,0,"th",75)(12,va,2,1,"td",76),S(),y(13,77),c(14,ba,2,0,"th",75)(15,xa,5,4,"td",76),S(),y(16,78),c(17,Oa,2,0,"th",75)(18,ya,3,4,"td",76),S(),y(19,79),c(20,Sa,2,0,"th",75)(21,Ea,3,5,"td",76),S(),y(22,80),c(23,Ma,2,0,"th",75)(24,Pa,3,2,"td",76),S(),y(25,81),c(26,ka,2,0,"th",75)(27,Fa,4,0,"td",76),S(),c(28,Ta,1,0,"tr",82)(29,Ia,1,0,"tr",83),n()()}if(i&2){let t=u(2);l(6),m("value",t.multiPackageDiscountPercentage())("disabled",!t.hasPermissionToEditPercentage()),l(3),m("dataSource",t.itemsDataSource),l(19),m("matHeaderRowDef",t.itemsDisplayedColumns),l(),m("matRowDefColumns",t.itemsDisplayedColumns)}}function Ra(i,e){if(i&1){let t=E();o(0,"div")(1,"div",57)(2,"h3",30),a(3,"A\xF1adir Paquete a la Lista"),n(),o(4,"mat-form-field",58)(5,"mat-label"),a(6,"Descripci\xF3n del Bulto"),n(),p(7,"input",59),c(8,pa,2,0,"mat-error",13),n(),o(9,"div",60)(10,"mat-form-field",8)(11,"mat-label"),a(12,"Largo (cm)"),n(),p(13,"input",61),c(14,ua,2,0,"mat-error",13),n(),o(15,"mat-form-field",8)(16,"mat-label"),a(17,"Ancho (cm)"),n(),p(18,"input",62),c(19,ga,2,0,"mat-error",13),n(),o(20,"mat-form-field",8)(21,"mat-label"),a(22,"Alto (cm)"),n(),p(23,"input",63),c(24,_a,2,0,"mat-error",13),n(),o(25,"mat-form-field",8)(26,"mat-label"),a(27,"Peso (kg)"),n(),p(28,"input",64),c(29,fa,2,0,"mat-error",13),n()(),o(30,"div",65)(31,"button",66),f("click",function(){h(t);let d=u();return C(d.addItemToList())}),o(32,"mat-icon"),a(33,"add"),n(),a(34," Agregar Paquete a la Lista "),n()(),c(35,ha,5,4,"div",67),n(),c(36,Aa,30,5,"div",68),n()}if(i&2){let t,r,d,s,_,D,x=u();l(),m("formGroup",x.newItemForm),l(7),m("ngIf",(t=x.newItemForm.get("description"))==null?null:t.hasError("required")),l(6),m("ngIf",(r=x.newItemForm.get("length_cm"))==null?null:r.hasError("required")),l(5),m("ngIf",(d=x.newItemForm.get("width_cm"))==null?null:d.hasError("required")),l(5),m("ngIf",(s=x.newItemForm.get("height_cm"))==null?null:s.hasError("required")),l(5),m("ngIf",(_=x.newItemForm.get("weight_kg"))==null?null:_.hasError("required")),l(6),m("ngIf",((D=x.newItemForm.get("package_type"))==null?null:D.value)==="CUSTOM"),l(),m("ngIf",x.itemsFormArray.controls.length>0)}}function Va(i,e){i&1&&(o(0,"mat-error"),a(1,"Requerido"),n())}function Na(i,e){i&1&&(o(0,"mat-error"),a(1,"Requerido"),n())}function Ba(i,e){i&1&&(o(0,"mat-error"),a(1,"Monto no puede ser negativo"),n())}function La(i,e){if(i&1&&(o(0,"mat-option",22),a(1),n()),i&2){let t=e.$implicit;m("value",t),l(),w(t)}}var Gt=class i{itemsDataSource=new St;orderSubmit=new B;formValidityChanged=new B;orderForm;minDeliveryDate;newItemForm;itemsDisplayedColumns=["description","medidas","basePrice","tipo","finalPrice","eliminar"];settingsService=O(ai);multiPackageDiscountPercentage=A(0);standardPackageLabel=A("");maxDimensionsInfo=A("");volumetricFactor=A(0);shippingCostPackage=A(0);staLengthCm=A(0);staWidthCm=A(0);staHeightCm=A(0);staWeightKg=A(0);shipmentTypes=["CONTRAENTREGA","SOLO ENTREGAR","CAMBIO","RECOJO"];paymentMethodsForCollection=["NO COBRAR","EFECTIVO","YAPE","PLIN","TRANSFERENCIA"];appStore=O(We);selectedDistrictName=()=>{let e=this.orderForm?.get("delivery_district_id")?.value;return!e||!this.districtsCache?"":this.districtsCache.find(t=>t.id===e)?.name||""};orderService=O(oe);fb=O(ee);snackBar=O(ge);destroy$=new de;districtsCache=[];drivers$=ye([]);isLoadingDrivers=!1;driverSearchCtrl=new Se("");filteredDrivers$;districts$=ye([]);isLoadingDistricts=!1;districtSearchCtrl=new Se("");filteredDistricts$;constructor(){this.orderService.getMaxPackageDimensions().subscribe(e=>{e&&e.standard_package_info&&e.volumetric_factor&&e.info_text&&e.sta_length_cm&&e.sta_width_cm&&e.sta_height_cm&&e.sta_weight_kg&&(this.standardPackageLabel.set(e.standard_package_info),this.volumetricFactor.set(e.volumetric_factor),this.maxDimensionsInfo.set(e.info_text),this.staLengthCm.set(e.sta_length_cm),this.staWidthCm.set(e.sta_width_cm),this.staHeightCm.set(e.sta_height_cm),this.staWeightKg.set(e.sta_weight_kg))}),this.minDeliveryDate=new Date,this.buildForm(),this.orderService.getDeliveryDistricts().subscribe(e=>{this.districtsCache=e}),this.filteredDrivers$=this.driverSearchCtrl.valueChanges.pipe(Be(""),me(900),se(),Le(e=>(this.isLoadingDrivers=!0,this.orderService.getCompanies(e||"").pipe(Me(()=>this.isLoadingDrivers=!1),Ee(()=>(this.isLoadingDrivers=!1,ye([])))))),P(this.destroy$)),this.filteredDistricts$=this.districtSearchCtrl.valueChanges.pipe(Be(""),me(900),Le(e=>(this.isLoadingDistricts=!0,this.orderService.getDistricts(e||"",this.orderForm.get("isExpress")?.value).pipe(Me(()=>this.isLoadingDistricts=!1),Ee(()=>(this.isLoadingDistricts=!1,ye([])))))),P(this.destroy$)),Qt(()=>{this.multiPackageDiscountPercentage(),this.newItemForm.get("package_type")?.value==="CUSTOM"&&this.recalculateTotalCost(this.itemsFormArray.value)})}calculateBasePrice(e){if(!e.delivery_district_id)return this.snackBar.open("Por favor, seleccione un distrito de entrega primero.","Cerrar",{duration:3e3,panelClass:["error-snackbar"]}),0;if(this.newItemForm.get("package_type")?.value==="CUSTOM"){let x=!0;if(["length_cm","width_cm","height_cm","weight_kg"].forEach(Ne=>{let Oe=this.newItemForm.get(Ne);Oe?.markAsTouched(),Oe?.invalid&&(x=!1)}),!x)return console.log("Custom dimensions form is invalid"),0}if(!e.package_width_cm||!e.package_length_cm||!e.package_height_cm||!e.package_weight_kg||!this.volumetricFactor())return this.snackBar.open("Las entradas no son v\xE1lidas","Cerrar",{duration:3e3,panelClass:["error-snackbar"]}),0;let t=e.package_length_cm*e.package_width_cm*e.package_height_cm/this.volumetricFactor(),r=t>e.package_weight_kg?t:e.package_weight_kg,d=this.districtsCache.find(x=>x.id===e.delivery_district_id);if(!d)return this.shippingCostPackage.set(0),0;let s=this.districtsCache.filter(x=>x.name===d.name),_=this.findTariffForWeight(r,s),D=_?.price?parseFloat(_.price):0;return D===0&&this.snackBar.open(`No hay ninguna tarifa asociada con el peso (${r}) del distrito seleccionado.`,"Cerrar",{duration:3e3,panelClass:["error-snackbar"]}),this.shippingCostPackage.set(D),D}findTariffForWeight(e,t){let r=t;for(let d of r)if(d.weight_from!==void 0&&d.weight_to!==void 0&&e>=d.weight_from&&e<=d.weight_to)return d}getDistrictPrice(e){let t=this.districtsCache.find(r=>r.id===e);return t?parseFloat(t.price):0}getCheckboxValue(){this.districtSearchCtrl.setValue("",{emitEvent:!0}),this.orderForm.markAllAsTouched(),this.orderForm.get("delivery_district_id")?.setValue(null,{emitEvent:!0}),this.orderService.getDeliveryDistricts(this.orderForm.get("isExpress")?.value).subscribe(e=>{this.districtsCache=e})}isCompany(){let e=this.appStore.currentUser()?.role;return e==="EMPRESA_DISTRIBUIDOR"||e==="EMPRESA"}hasPermissionToEditPercentage(){let e=this.appStore.currentUser()?.role;return e==="RECEPCIONISTA"||e==="ADMINISTRADOR"}displayDriverName(e){return e&&e.username?e.username:""}onDriverSelected(e){this.orderForm.get("company_id")?.setValue(e.option.value.id),this.orderForm.markAllAsTouched()}clearDriverSelection(){this.driverSearchCtrl.setValue(""),this.orderForm.markAllAsTouched(),this.orderForm.get("company_id")?.setValue(null)}displayDistrictName(e){return e&&e.name_and_price?e.name_and_price:""}onDistrictSelected(e){this.orderForm.get("delivery_district_id")?.setValue(e.option.value.id),this.orderForm.markAllAsTouched()}clearDistrictSelection(){this.districtSearchCtrl.setValue(""),this.orderForm.markAllAsTouched(),this.orderForm.get("delivery_district_id")?.setValue(null)}get itemsFormArray(){return this.orderForm.get("items")}loadSettings(){this.settingsService.loadSettings().pipe(Wt(1)).subscribe(e=>{let t=Array.isArray(e)?e[0]:e,r=this.orderService.getEffectiveDiscount(t);this.multiPackageDiscountPercentage.set(r)})}ngOnInit(){this.itemsDataSource.data=this.itemsFormArray.controls,this.loadSettings(),this.orderForm.statusChanges.pipe(P(this.destroy$),se()).subscribe(e=>{console.log("Order form is invalid:",this.getFormErrors(this.orderForm)),this.formValidityChanged.emit(e==="VALID")}),this.orderForm.get("delivery_district_id")?.valueChanges.pipe(P(this.destroy$),se()).subscribe(e=>{if(this.itemsFormArray.clear(),this.itemsDataSource.data=this.itemsFormArray.controls,this.orderForm.get("shipping_cost")?.setValue(0),e&&this.newItemForm.get("package_type")?.value==="STANDARD"){let t=this.getDistrictPrice(e);this.orderForm.get("shipping_cost")?.setValue(t)}})}buildForm(){let e=this.isCompany()?this.appStore.currentUser()?.id??null:null;this.createNewItemForm(),this.setupPackageTypeSubscription(),this.createOrderForm(e),this.setupRealtimePriceCalculation()}createNewItemForm(){this.newItemForm=this.fb.group({package_type:["STANDARD",b.required],description:[""],length_cm:[0,[b.required,b.min(1)]],width_cm:[0,[b.required,b.min(1)]],height_cm:[0,[b.required,b.min(1)]],weight_kg:[0,[b.required,b.min(.1)]]})}setupPackageTypeSubscription(){this.newItemForm.get("package_type")?.valueChanges.pipe(P(this.destroy$)).subscribe(e=>{let t=this.orderForm.get("delivery_district_id")?.value;if(t||(this.itemsFormArray.clear(),this.itemsDataSource.data=this.itemsFormArray.controls,this.orderForm.get("shipping_cost")?.setValue(0)),e==="STANDARD"){this.itemsFormArray.clear(),this.itemsDataSource.data=this.itemsFormArray.controls;let r=this.getDistrictPrice(t);this.orderForm.get("shipping_cost")?.setValue(r)}else{this.recalculateTotalCost(this.itemsFormArray.value);let r=["length_cm","width_cm","height_cm","weight_kg"];e==="CUSTOM"?r.forEach(d=>this.newItemForm.get(d)?.setValidators([b.required,b.min(.1)])):r.forEach(d=>this.newItemForm.get(d)?.clearValidators()),this.newItemForm.updateValueAndValidity()}})}createOrderForm(e){this.orderForm=this.fb.group({isExpress:[!1],shipment_type:[this.shipmentTypes[0],b.required],recipient_name:["",b.required],recipient_phone:["",[b.required,b.pattern("^[0-9]{9}$")]],company_id:[e,b.required],delivery_district_id:[null,b.required],delivery_address:["",[b.required,b.minLength(6)]],delivery_coordinates:[""],delivery_date:[null,b.required],items:this.fb.array([]),shipping_cost:[0],item_description:[""],amount_to_collect_at_delivery:[0,[b.required,b.min(0)]],payment_method_for_collection:[this.paymentMethodsForCollection[0],b.required],observations:[""]})}setupRealtimePriceCalculation(){Ht(this.newItemForm.valueChanges,this.orderForm.get("delivery_district_id").valueChanges).pipe(me(300),P(this.destroy$)).subscribe(()=>{if(this.newItemForm.getRawValue().package_type==="CUSTOM"){if(this.newItemForm.invalid){this.shippingCostPackage.set(0);return}let t=this.newItemForm.getRawValue(),r={delivery_district_id:this.orderForm.get("delivery_district_id")?.value,package_length_cm:t.length_cm,package_width_cm:t.width_cm,package_height_cm:t.height_cm,package_weight_kg:t.weight_kg},d=this.calculateBasePrice(r);this.shippingCostPackage.set(d)}})}addItemToList(){if(this.newItemForm.invalid){this.newItemForm.markAllAsTouched();return}if(!this.orderForm.get("delivery_district_id")?.value){this.snackBar.open("Por favor, seleccione un distrito de entrega primero.","Cerrar",{duration:3e3,panelClass:["error-snackbar"]});return}let t=this.newItemForm.getRawValue();if(!t.description){alert("Complete el campo de descripci\xF3n del paquete");return}let r={delivery_district_id:this.orderForm.get("delivery_district_id")?.value,package_length_cm:t.length_cm,package_width_cm:t.width_cm,package_height_cm:t.height_cm,package_weight_kg:t.weight_kg},d=this.calculateBasePrice(r);if(d===0){this.snackBar.open("No se pudo calcular una tarifa para el paquete. Verifique el distrito y las medidas.","Cerrar",{duration:3e3,panelClass:["error-snackbar"]});return}this.orderForm.get("items").push(this.fb.group({package_type:[t.package_type],description:[t.description],length_cm:[t.length_cm],width_cm:[t.width_cm],height_cm:[t.height_cm],weight_kg:[t.weight_kg],basePrice:[d],finalPrice:[0],isPrincipal:[!1]})),this.recalculateTotalCost(this.itemsFormArray.value),this.itemsDataSource.data=this.itemsFormArray.controls,this.newItemForm.reset({package_type:this.newItemForm.get("package_type")?.value,description:"",length_cm:0,width_cm:0,height_cm:0,weight_kg:0})}recalculateTotalCost(e){if(e.length===0){this.orderForm.get("shipping_cost")?.setValue(0);return}let t=e.reduce((s,_)=>_.basePrice>s.basePrice?_:s,e[0]),r=0,d=e.map(s=>{let _=s===t,D=s.basePrice;return _||(D=s.basePrice*(1-this.multiPackageDiscountPercentage()/100)),r+=D,le(Q({},s),{finalPrice:D,isPrincipal:_})});this.itemsFormArray.patchValue(d,{emitEvent:!1}),this.orderForm.get("shipping_cost")?.setValue(r)}removeItem(e){this.itemsFormArray.removeAt(e),this.itemsDataSource.data=this.itemsFormArray.controls,this.recalculateTotalCost(this.itemsFormArray.value)}onSubmit(){if(this.orderForm.invalid){this.orderForm.markAllAsTouched(),console.log("Order form is invalid:",this.getFormErrors(this.orderForm)),this.snackBar.open("Por favor complete todos los campos requeridos.","Cerrar",{duration:3e3,panelClass:["error-snackbar"]});return}let e=this.orderForm.getRawValue();if(this.newItemForm.get("package_type")?.value==="STANDARD"&&e.items.length===0){let d=this.orderForm.get("delivery_district_id")?.value;if(!d){this.snackBar.open("Por favor, seleccione un distrito.","Cerrar",{duration:3e3,panelClass:["error-snackbar"]});return}if(this.newItemForm.get("package_type")?.value==="STANDARD"){let _=this.getDistrictPrice(d);this.orderForm.get("shipping_cost")?.setValue(_)}let s={package_type:"STANDARD",description:"Paquete Est\xE1ndar",length_cm:this.staLengthCm(),width_cm:this.staWidthCm(),height_cm:this.staHeightCm(),weight_kg:this.staWeightKg(),basePrice:this.orderForm.get("shipping_cost")?.value,finalPrice:this.orderForm.get("shipping_cost")?.value,isPrincipal:!0};e.items.push(s),e.shipping_cost=this.orderForm.get("shipping_cost")?.value}if(e.items.length===0){this.snackBar.open("Debe agregar al menos un paquete.","Cerrar",{duration:3e3,panelClass:["error-snackbar"]});return}if(e.shipping_cost===0){this.snackBar.open("El costo de env\xEDo no puede ser 0.","Cerrar",{duration:3e3,panelClass:["error-snackbar"]});return}e.item_description=(e.items.length===1?"1 Bulto: ":e.items.length+" Bultos: ")+e.items.map(d=>d.description+" Medidas L:"+d.length_cm+" x An:"+d.width_cm+" x Al:  "+d.height_cm+" ("+d.weight_kg+"kg)").join(", ")+(e.item_description?" | "+e.item_description:"");let r=le(Q({},e),{delivery_district_name:this.selectedDistrictName(),temp_id:`temp-${Date.now()}`});console.log("Submitting New Order Data:",r),this.orderSubmit.emit(r)}resetFormForNextOrder(){this.driverSearchCtrl.setValue(""),this.districtSearchCtrl.setValue("");let e=null;this.isCompany()&&(e=this.orderForm.get("company_id")?.value);let t=this.orderForm.get("shipment_type")?.value||this.shipmentTypes[0],r=this.paymentMethodsForCollection[0];this.orderForm.reset({isExpress:!1,company_id:e,shipment_type:t,delivery_date:null,items:this.fb.array([],b.required),shipping_cost:0,amount_to_collect_at_delivery:0,payment_method_for_collection:r}),this.newItemForm.reset({package_type:"STANDARD",description:"",length_cm:0,width_cm:0,height_cm:0,weight_kg:0}),this.loadSettings(),this.formValidityChanged.emit(this.orderForm.valid)}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}getFormErrors(e){let t={};return Object.keys(e.controls).forEach(r=>{let d=e.get(r)?.errors;if(d&&(t[r]=d),e.get(r)instanceof Jt){let s=this.getFormErrors(e.get(r));Object.keys(s).length>0&&(t[r]=s)}}),t}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=k({type:i,selectors:[["app-order-creation-form"]],outputs:{orderSubmit:"orderSubmit",formValidityChanged:"formValidityChanged"},features:[$e([yt(),G])],decls:119,vars:38,consts:[["autoDistric","matAutocomplete"],["deliveryDatePicker",""],["autoDriver","matAutocomplete"],[1,"order-creation-form",3,"ngSubmit","formGroup"],[1,"form-section-title"],["formControlName","isExpress","color","primary",1,"standard-checkbox",3,"click"],["appearance","outline","class","full-width driver-search-field",4,"ngIf"],[1,"form-grid"],["appearance","outline"],["formControlName","shipment_type"],[3,"value",4,"ngFor","ngForOf"],["matInput","","formControlName","recipient_name","placeholder","Nombre completo"],["matSuffix",""],[4,"ngIf"],["matInput","","formControlName","recipient_phone","type","tel","placeholder",""],["align","end"],["appearance","outline",1,"driver-search-field"],["type","text","placeholder","Escriba el nombre del distrito...","aria-label","distrito","matInput","",3,"formControl","matAutocomplete"],["matSuffix","","mat-icon-button","","aria-label","Limpiar",3,"click",4,"ngIf"],["matSuffix","",4,"ngIf"],["matSuffix","","mode","indeterminate","diameter","20",4,"ngIf"],[3,"optionSelected","displayWith"],[3,"value"],["disabled",""],["appearance","outline",1,"full-span-column"],["matInput","","formControlName","delivery_address","placeholder","Ingresar lugar de entrega (M\xEDnimo 6 caracteres)"],["matInput","","formControlName","delivery_coordinates","placeholder","-12.070,-77.012"],["matInput","","formControlName","delivery_date",3,"matDatepicker","min"],["matSuffix","",3,"for"],[1,"section-divider"],[1,"section-subtitle"],[3,"formGroup"],["formControlName","package_type","aria-label","Tipo de paquete"],["value","STANDARD"],["value","CUSTOM"],["id","standard-package-info","class","info-box hidden",4,"ngIf"],["class","warning-paquete-size",4,"ngIf"],[1,"max-dimensions-info"],[1,"shipping-cost-display"],[1,"cost-value"],["matInput","","formControlName","item_description","placeholder","Detalle del pedido"],["matInput","","formControlName","amount_to_collect_at_delivery","type","number","min","0","placeholder","S/"],["matPrefix",""],["formControlName","payment_method_for_collection"],["matInput","","formControlName","observations","placeholder","\xBFQu\xE9 env\xEDas?...","rows","3"],[1,"add-order-button-container"],["mat-flat-button","","type","submit",1,"btn-corp-primary",3,"disabled"],["appearance","outline",1,"full-width","driver-search-field"],["type","text","placeholder","Escriba el nombre del la empresa...","aria-label","cliente","matInput","",3,"formControl","matAutocomplete"],["matSuffix","","mat-icon-button","","aria-label","Limpiar",3,"click"],["matSuffix","","mode","indeterminate","diameter","20"],[1,"driver-option"],["id","standard-package-info",1,"info-box","hidden"],[1,"info-content"],[1,"info-icon"],[1,"info-text"],[1,"warning-paquete-size"],[1,"package-calculator-container",3,"formGroup"],["appearance","outline",1,"full-width"],["matInput","","formControlName","description","placeholder","Ej: Zapatos, Laptop...","appAutoSelect",""],[1,"custom-dimensions-grid"],["matInput","","type","number","formControlName","length_cm","appAutoSelect",""],["matInput","","type","number","formControlName","width_cm","appAutoSelect",""],["matInput","","type","number","formControlName","height_cm","appAutoSelect",""],["matInput","","type","number","formControlName","weight_kg","appAutoSelect",""],[1,"add-item-button-container"],["mat-flat-button","","type","button",1,"btn-corp-primary",3,"click"],["class","shipping-cost-display-package",4,"ngIf"],["class","package-list-container",4,"ngIf"],[1,"shipping-cost-display-package"],[1,"package-list-container"],["appearance","outline",1,"discount-field"],["matInput","",3,"input","value","disabled"],["mat-table","",1,"mat-elevation-z2","items-table",3,"dataSource"],["matColumnDef","description"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","medidas"],["matColumnDef","basePrice"],["matColumnDef","tipo"],["matColumnDef","finalPrice"],["matColumnDef","eliminar"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],[3,"ngClass"],["class","discounted-price",4,"ngIf"],[1,"discounted-price"],[1,"original-price"],[1,"final-price"],["mat-icon-button","","color","warn","type","button",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(t,r){if(t&1){let d=E();o(0,"form",3),f("ngSubmit",function(){return h(d),C(r.onSubmit())}),o(1,"h2",4),a(2,"Registrar pedido"),n(),o(3,"mat-checkbox",5),f("click",function(){return h(d),C(r.getCheckboxValue())}),a(4," Express "),n(),c(5,Xo,15,12,"mat-form-field",6),o(6,"div",7)(7,"mat-form-field",8)(8,"mat-label"),a(9,"Tipo de env\xEDo"),n(),o(10,"mat-select",9),c(11,Yo,2,2,"mat-option",10),n()(),o(12,"mat-form-field",8)(13,"mat-label"),a(14,"Nombre del destinatario"),n(),p(15,"input",11),o(16,"mat-icon",12),a(17,"person_outline"),n(),c(18,Zo,2,0,"mat-error",13),n(),o(19,"mat-form-field",8)(20,"mat-label"),a(21,"Tel\xE9fono del destinatario"),n(),p(22,"input",14),o(23,"mat-icon",12),a(24,"phone_outline"),n(),o(25,"mat-hint",15),a(26,"No se debe agregar el +51"),n(),c(27,Jo,2,0,"mat-error",13)(28,ea,2,0,"mat-error",13),n(),o(29,"mat-form-field",16)(30,"mat-label"),a(31,"Buscar y Seleccionar distrito"),n(),p(32,"input",17),c(33,ta,3,0,"button",18)(34,ia,2,0,"mat-icon",19)(35,ra,1,0,"mat-progress-spinner",20),o(36,"mat-autocomplete",21,0),f("optionSelected",function(_){return h(d),C(r.onDistrictSelected(_))}),ze(38,na,4,2,"mat-option",22,Cr),v(40,"async"),c(41,oa,2,0,"mat-option",23),v(42,"async"),n(),c(43,aa,2,0,"mat-error",13),n(),o(44,"mat-form-field",24)(45,"mat-label"),a(46,"Direcci\xF3n de entrega"),n(),p(47,"input",25),o(48,"mat-hint",15),a(49,"No acepta caracteres especiales se borran autom\xE1ticos"),n(),c(50,la,2,0,"mat-error",13)(51,da,2,0,"mat-error",13),n(),o(52,"mat-form-field",8)(53,"mat-label"),a(54,"Coordenadas (Opcional)"),n(),p(55,"input",26),o(56,"mat-icon",12),a(57,"location_on_outline"),n()(),o(58,"mat-form-field",8)(59,"mat-label"),a(60,"Fecha Entrega"),n(),p(61,"input",27)(62,"mat-datepicker-toggle",28)(63,"mat-datepicker",null,1),c(65,ma,2,0,"mat-error",13),n()(),p(66,"mat-divider",29),o(67,"h3",30),a(68,"Tama\xF1o del paquete"),n(),o(69,"div",31)(70,"mat-radio-group",32)(71,"mat-radio-button",33),a(72,"Est\xE1ndar (1 solo paquete)"),n(),o(73,"mat-radio-button",34),a(74,"Otros tama\xF1os (M\xFAltiples paquetes)"),n()()(),c(75,sa,9,1,"div",35)(76,ca,3,0,"div",36),o(77,"div",37)(78,"p"),a(79),n()(),c(80,Ra,37,8,"div",13),o(81,"div",38),a(82," Costo de env\xEDo = "),o(83,"span",39),a(84),v(85,"number"),n()(),p(86,"mat-divider",29),o(87,"div",7)(88,"mat-form-field",24)(89,"mat-label"),a(90,"\xBFQu\xE9 env\xEDa?"),n(),p(91,"input",40),o(92,"mat-icon",12),a(93,"inventory_2_outline"),n(),c(94,Va,2,0,"mat-error",13),n(),o(95,"mat-form-field",8)(96,"mat-label"),a(97,"Monto total a cobrar"),n(),p(98,"input",41),o(99,"span",42),a(100,"S/ "),n(),c(101,Na,2,0,"mat-error",13)(102,Ba,2,0,"mat-error",13),n(),o(103,"mat-form-field",8)(104,"mat-label"),a(105,"M\xE9todo de Pago (para cobro en entrega)"),n(),o(106,"mat-select",43),c(107,La,2,2,"mat-option",10),n()(),o(108,"mat-form-field",24)(109,"mat-label"),a(110,"Observaciones (Opcional)"),n(),p(111,"textarea",44),n()(),o(112,"div",45)(113,"button",46)(114,"mat-icon"),a(115,"add_shopping_cart"),n(),a(116," AGREGAR PEDIDO AL LISTADO "),o(117,"mat-icon"),a(118,"arrow_downward"),n()()()()}if(t&2){let d,s,_,D,x,lt,Ne,Oe,At,Rt,Vt,Nt,Bt,Lt,zt,ki=V(37),Ut=V(64);m("formGroup",r.orderForm),l(5),m("ngIf",!r.isCompany()),l(6),m("ngForOf",r.shipmentTypes),l(7),m("ngIf",(d=r.orderForm.get("recipient_name"))==null?null:d.hasError("required")),l(9),m("ngIf",(s=r.orderForm.get("recipient_phone"))==null?null:s.hasError("required")),l(),m("ngIf",(_=r.orderForm.get("recipient_phone"))==null?null:_.hasError("pattern")),l(4),m("formControl",r.districtSearchCtrl)("matAutocomplete",ki),l(),m("ngIf",r.districtSearchCtrl.value&&!r.isLoadingDistricts),l(),m("ngIf",!r.districtSearchCtrl.value&&!r.isLoadingDistricts),l(),m("ngIf",r.isLoadingDistricts),l(),m("displayWith",r.displayDistrictName),l(2),qe(R(40,31,r.filteredDistricts$)),l(3),L(((D=R(42,33,r.filteredDistricts$))==null?null:D.length)===0&&!r.isLoadingDistricts&&r.districtSearchCtrl.value?41:-1),l(2),m("ngIf",(x=r.orderForm.get("delivery_district_id"))==null?null:x.hasError("required")),l(7),m("ngIf",(lt=r.orderForm.get("delivery_address"))==null?null:lt.hasError("required")),l(),m("ngIf",(Ne=r.orderForm.get("delivery_address"))==null?null:Ne.hasError("minlength")),l(10),m("matDatepicker",Ut)("min",r.minDeliveryDate),l(),m("for",Ut),l(3),m("ngIf",(Oe=r.orderForm.get("delivery_date"))==null?null:Oe.hasError("required")),l(4),m("formGroup",r.newItemForm),l(6),m("ngIf",((At=r.newItemForm.get("package_type"))==null?null:At.value)==="STANDARD"),l(),m("ngIf",((Rt=r.newItemForm.get("package_type"))==null?null:Rt.value)==="STANDARD"),l(3),w(r.maxDimensionsInfo()),l(),m("ngIf",((Vt=r.newItemForm.get("package_type"))==null?null:Vt.value)==="CUSTOM"),l(4),g("S/ ",M(85,35,(Nt=r.orderForm.get("shipping_cost"))==null?null:Nt.value,"1.2-2"),""),l(10),m("ngIf",(Bt=r.orderForm.get("item_description"))==null?null:Bt.hasError("required")),l(7),m("ngIf",(Lt=r.orderForm.get("amount_to_collect_at_delivery"))==null?null:Lt.hasError("required")),l(),m("ngIf",(zt=r.orderForm.get("amount_to_collect_at_delivery"))==null?null:zt.hasError("min")),l(5),m("ngForOf",r.paymentMethodsForCollection),l(6),m("disabled",r.orderForm.invalid)}},dependencies:[F,Ge,_t,q,Ue,ft,X,j,Pe,Y,je,U,Z,ht,He,J,pe,K,W,H,ei,te,vt,ke,re,ie,Ve,Et,Re,ot,Dt,wt,Pt,T,N,ue,I,$,Ae,Ie,we,De,Tt,kt,Ft,Ot,xt,pi,si,ci,nt,Ke,Xe,et,Ye,Qe,tt,Ze,Je,it,rt,Fe,gi],styles:[".order-creation-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px;padding:10px 20px 20px}.form-section-title[_ngcontent-%COMP%]{font-size:1.5em;font-weight:500;color:#333;margin-bottom:10px;padding-bottom:10px;border-bottom:1px solid #eee}.form-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:20px 24px}@media (max-width: 600px){.form-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}.full-span-column[_ngcontent-%COMP%]{grid-column:1/-1}mat-form-field[_ngcontent-%COMP%]{width:100%}.section-divider[_ngcontent-%COMP%]{margin:24px 0}.shipping-cost-display[_ngcontent-%COMP%]{font-size:1.3em;font-weight:700;text-align:right;color:#d32f2f;display:flex;align-items:center;justify-content:flex-end;gap:8px}@media (max-width: 600px){.shipping-cost-display[_ngcontent-%COMP%]{text-align:left;justify-content:flex-start}}.add-order-button-container[_ngcontent-%COMP%]{margin-top:24px;text-align:center}.add-order-button-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:12px 24px;font-size:1.1em;letter-spacing:.5px}mat-hint[align=end][_ngcontent-%COMP%]{font-size:.75em;opacity:.7}.standard-checkbox[_ngcontent-%COMP%]{margin-top:0;margin-bottom:0}.package-calculator-container[_ngcontent-%COMP%]{margin-top:20px;padding:16px;border:1px solid #e0e0e0;border-radius:4px;background-color:#f9f9f9}.section-subtitle[_ngcontent-%COMP%]{font-size:1.1em;font-weight:500;margin-top:0;margin-bottom:16px}mat-radio-group[_ngcontent-%COMP%]{margin-bottom:20px}.custom-dimensions-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:16px;margin-top:16px}.add-item-button-container[_ngcontent-%COMP%]{margin-top:20px}.package-list-container[_ngcontent-%COMP%]{margin-top:24px}.items-table[_ngcontent-%COMP%]{width:100%}.discount-field[_ngcontent-%COMP%]{max-width:250px;margin-bottom:16px}.principal-item[_ngcontent-%COMP%]{font-weight:700;color:#1e88e5;background-color:#e3f2fd;padding:2px 6px;border-radius:4px}.additional-item[_ngcontent-%COMP%]{color:#43a047;background-color:#e8f5e9;padding:2px 6px;border-radius:4px}.discounted-price[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-start}.discounted-price[_ngcontent-%COMP%]   .original-price[_ngcontent-%COMP%]{text-decoration:line-through;color:#e03131;font-size:.8em}.discounted-price[_ngcontent-%COMP%]   .final-price[_ngcontent-%COMP%]{font-weight:700}.shipping-cost-display-package[_ngcontent-%COMP%]{font-size:1.1em;font-weight:500;margin-top:16px;text-align:right;color:#1e88e5}.info-content[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.info-icon[_ngcontent-%COMP%]{font-size:1.5rem}.info-box[_ngcontent-%COMP%]{background:#e4eef8;border:1px solid #d0d3d6;border-radius:8px;padding:15px;margin-bottom:15px;transition:all .3s ease;opacity:1;transform:translateY(0)}.warning-paquete-size[_ngcontent-%COMP%]{font-size:17px;font-weight:700;margin:0;text-align:left;color:#d32f2f;display:flex;align-items:center;justify-content:flex-start}.max-dimensions-info[_ngcontent-%COMP%]{margin-top:0!important;font-size:16px;color:#3d3636;text-align:center;padding:8px;background-color:#e4eef8;border-radius:4px}"],changeDetection:0})};function za(i,e){i&1&&(o(0,"div",3),a(1," A\xFAn no has agregado pedidos. "),n())}function qa(i,e){i&1&&(o(0,"th",22),a(1,"Nombre"),n())}function $a(i,e){if(i&1&&(o(0,"td",23)(1,"span",24),a(2),n()()),i&2){let t=e.$implicit;l(),m("matTooltip",t.recipient_name)("matTooltipDisabled",t.recipient_name.length<=20),l(),g(" ",t.recipient_name," ")}}function Ga(i,e){i&1&&(o(0,"th",22),a(1,"Tel\xE9fono"),n())}function Ua(i,e){if(i&1&&(o(0,"td",23),a(1),n()),i&2){let t=e.$implicit;l(),w(t.recipient_phone)}}function ja(i,e){i&1&&(o(0,"th",22),a(1,"F. Entrega"),n())}function Ha(i,e){if(i&1&&(o(0,"td",23),a(1),v(2,"date"),n()),i&2){let t=e.$implicit;l(),g(" ",M(2,1,t.delivery_date,"dd/MM/yy")," ")}}function Wa(i,e){i&1&&(o(0,"th",22),a(1,"Distrito"),n())}function Ka(i,e){if(i&1&&(o(0,"td",23),a(1),n()),i&2){let t=e.$implicit;l(),g(" ",t.delivery_district_name," ")}}function Qa(i,e){i&1&&(o(0,"th",22),a(1,"Direcci\xF3n"),n())}function Xa(i,e){if(i&1&&(o(0,"td",23)(1,"span",24),a(2),n()()),i&2){let t=e.$implicit;l(),m("matTooltip",t.delivery_address)("matTooltipDisabled",t.delivery_address.length<=25),l(),g(" ",t.delivery_address," ")}}function Ya(i,e){i&1&&(o(0,"th",22),a(1,"Producto"),n())}function Za(i,e){if(i&1&&(o(0,"td",23)(1,"span",24),a(2),n()()),i&2){let t=e.$implicit;l(),m("matTooltip",t.item_description)("matTooltipDisabled",t.item_description.length<=20),l(),g(" ",t.item_description," ")}}function Ja(i,e){i&1&&(o(0,"th",22),a(1,"Cobrar"),n())}function el(i,e){if(i&1&&(o(0,"td",25),a(1),v(2,"currency"),n()),i&2){let t=e.$implicit;l(),g(" ",ce(2,1,t.amount_to_collect_at_delivery,"PEN","S/ ","1.2-2")," ")}}function tl(i,e){i&1&&(o(0,"th",22),a(1,"Costo env\xEDo"),n())}function il(i,e){if(i&1&&(o(0,"td",25),a(1),v(2,"currency"),n()),i&2){let t=e.$implicit;l(),g(" ",ce(2,1,t.shipping_cost,"PEN","S/ ","1.2-2")," ")}}function rl(i,e){i&1&&(o(0,"th",22),a(1,"M\xE9todo de Pago"),n())}function nl(i,e){if(i&1&&(o(0,"td",23),a(1),n()),i&2){let t=e.$implicit;l(),g(" ",t.payment_method_for_collection," ")}}function ol(i,e){i&1&&(o(0,"th",22),a(1,"Observaci\xF3n"),n())}function al(i,e){if(i&1&&(o(0,"td",23)(1,"span",24),a(2),n()()),i&2){let t=e.$implicit;l(),m("matTooltip",t.observations)("matTooltipDisabled",!t.observations||t.observations.length<=20),l(),g(" ",t.observations||"-"," ")}}function ll(i,e){i&1&&(o(0,"th",22),a(1,"Quitar"),n())}function dl(i,e){if(i&1){let t=E();o(0,"td",23)(1,"button",26),f("click",function(){let d=h(t).$implicit,s=u(2);return C(s.onRemoveOrder(d.temp_id))}),o(2,"mat-icon"),a(3,"remove_circle_outline"),n()()()}}function ml(i,e){i&1&&p(0,"tr",27)}function sl(i,e){i&1&&p(0,"tr",28)}function cl(i,e){if(i&1&&(o(0,"div",4)(1,"table",5),y(2,6),c(3,qa,2,0,"th",7)(4,$a,3,3,"td",8),S(),y(5,9),c(6,Ga,2,0,"th",7)(7,Ua,2,1,"td",8),S(),y(8,10),c(9,ja,2,0,"th",7)(10,Ha,3,4,"td",8),S(),y(11,11),c(12,Wa,2,0,"th",7)(13,Ka,2,1,"td",8),S(),y(14,12),c(15,Qa,2,0,"th",7)(16,Xa,3,3,"td",8),S(),y(17,13),c(18,Ya,2,0,"th",7)(19,Za,3,3,"td",8),S(),y(20,14),c(21,Ja,2,0,"th",7)(22,el,3,6,"td",15),S(),y(23,16),c(24,tl,2,0,"th",7)(25,il,3,6,"td",15),S(),y(26,17),c(27,rl,2,0,"th",7)(28,nl,2,1,"td",8),S(),y(29,18),c(30,ol,2,0,"th",7)(31,al,3,3,"td",8),S(),y(32,19),c(33,ll,2,0,"th",7)(34,dl,4,0,"td",8),S(),c(35,ml,1,0,"tr",20)(36,sl,1,0,"tr",21),n()()),i&2){let t=u();l(),m("dataSource",t.pendingOrders),l(34),m("matHeaderRowDef",t.displayedColumns)("matHeaderRowDefSticky",!0),l(),m("matRowDefColumns",t.displayedColumns)}}var wi=class i{pendingOrders=[];removeOrder=new B;displayedColumns=["recipient_name","recipient_phone","delivery_date","delivery_district_name","delivery_address","item_description","amount_to_collect_at_delivery","shipping_cost","payment_method_for_collection","observations","actions"];constructor(){}onRemoveOrder(e){e&&this.removeOrder.emit(e)}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=k({type:i,selectors:[["app-temporary-orders-table"]],inputs:{pendingOrders:"pendingOrders"},outputs:{removeOrder:"removeOrder"},decls:4,vars:2,consts:[["ordersTable",""],[1,"temporary-orders-container","mat-elevation-z1"],["class","no-orders-message",4,"ngIf","ngIfElse"],[1,"no-orders-message"],[1,"table-responsive-wrapper"],["mat-table","",1,"temporary-orders-table",3,"dataSource"],["matColumnDef","recipient_name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","recipient_phone"],["matColumnDef","delivery_date"],["matColumnDef","delivery_district_name"],["matColumnDef","delivery_address"],["matColumnDef","item_description"],["matColumnDef","amount_to_collect_at_delivery"],["mat-cell","","class","align-right",4,"matCellDef"],["matColumnDef","shipping_cost"],["matColumnDef","payment_method_for_collection"],["matColumnDef","observations"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],[1,"truncate-text",3,"matTooltip","matTooltipDisabled"],["mat-cell","",1,"align-right"],["mat-icon-button","","color","warn","matTooltip","Quitar pedido",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(t,r){if(t&1&&(o(0,"div",1),c(1,za,2,0,"div",2)(2,cl,37,4,"ng-template",null,0,gt),n()),t&2){let d=V(3);l(),m("ngIf",r.pendingOrders.length===0)("ngIfElse",d)}},dependencies:[F,q,X,G,nt,Ke,Xe,et,Ye,Qe,tt,Ze,Je,it,rt,T,ue,I,$,Mt,ir],styles:[".table-responsive-wrapper[_ngcontent-%COMP%]{background-color:#6c757d!important;overflow:auto}.temporary-orders-container[_ngcontent-%COMP%]{margin-top:30px;padding:0;background-color:#fff;border-radius:8px;overflow:hidden;box-shadow:0 1px 3px #0000001f,0 1px 2px #0000003d}.list-title[_ngcontent-%COMP%]{font-size:1.2em;font-weight:500;color:#fff;background-color:#d32f2f;padding:12px 16px;margin:0;border-top-left-radius:8px;border-top-right-radius:8px}.temporary-orders-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}th.mat-header-cell[_ngcontent-%COMP%], td.mat-cell[_ngcontent-%COMP%]{padding:10px 12px;border-bottom:1px solid #e0e0e0;vertical-align:middle;text-align:left}th.mat-header-cell[_ngcontent-%COMP%]{font-weight:500;color:#000000bf;background-color:#f5f5f5;white-space:nowrap}td.mat-cell[_ngcontent-%COMP%]{color:#000000de;font-size:.9em}[matColumnDef=amount_to_collect_at_delivery].mat-header-cell[_ngcontent-%COMP%], [matColumnDef=amount_to_collect_at_delivery].mat-cell[_ngcontent-%COMP%], [matColumnDef=shipping_cost].mat-header-cell[_ngcontent-%COMP%], [matColumnDef=shipping_cost].mat-cell[_ngcontent-%COMP%]{text-align:right;justify-content:flex-end}[matColumnDef=actions][_ngcontent-%COMP%]{width:80px}[matColumnDef=actions].mat-header-cell[_ngcontent-%COMP%], [matColumnDef=actions].mat-cell[_ngcontent-%COMP%]{text-align:center;justify-content:center}.truncate-text[_ngcontent-%COMP%]{display:block;max-width:120px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.no-orders-message[_ngcontent-%COMP%]{text-align:center;padding:30px;font-style:italic;color:#6c757d;background-color:#f8f9fa;border-bottom-left-radius:8px;border-bottom-right-radius:8px}"]})};function pl(i,e){if(i&1&&(o(0,"mat-option",16),a(1),v(2,"titlecase"),n()),i&2){let t=e.$implicit;m("value",t),l(),g(" ",R(2,2,t.replace("_"," "))," ")}}function ul(i,e){i&1&&(o(0,"mat-error"),a(1," Debe seleccionar una opci\xF3n de traslado. "),n())}function gl(i,e){i&1&&(o(0,"mat-error",17),a(1," Debe aceptar los t\xE9rminos y condiciones. "),n())}function _l(i,e){i&1&&p(0,"mat-progress-spinner",18)}function fl(i,e){if(i&1){let t=E();o(0,"div",4)(1,"div",5)(2,"mat-form-field",6)(3,"mat-label"),a(4,"\xBFC\xF3mo se har\xE1 el traslado de los pedidos al almac\xE9n?"),n(),o(5,"mat-select",7),c(6,pl,3,4,"mat-option",8),n(),c(7,ul,2,0,"mat-error",9),n()(),o(8,"div",10)(9,"mat-checkbox",7),a(10," Acepto los "),o(11,"a",11),a(12,"t\xE9rminos y condiciones"),n()(),c(13,gl,2,0,"mat-error",12),n(),o(14,"div",13)(15,"button",14),f("click",function(){h(t);let d=u();return C(d.submitAllOrders())}),c(16,_l,1,0,"mat-progress-spinner",15),a(17),n()()()}if(i&2){let t=u();l(5),m("formControl",t.pickupOptionControl),l(),m("ngForOf",t.pickupOptions),l(),m("ngIf",t.pickupOptionControl.hasError("required")&&t.pickupOptionControl.touched),l(2),m("formControl",t.termsAcceptedControl),l(4),m("ngIf",t.termsAcceptedControl.hasError("required")&&t.termsAcceptedControl.touched),l(2),m("disabled",t.pendingOrders().length===0||!t.termsAcceptedControl.value||!t.pickupOptionControl.valid||t.isSubmittingBatch()),l(),m("ngIf",t.isSubmittingBatch()),l(),g(" ",t.isSubmittingBatch()?"Generando Pedidos...":"Haz click aqu\xED para guardar los pedidos"," ")}}var Pi=class i{orderCreationFormComponent;pendingOrders=A([]);isSubmittingBatch=A(!1);isOrderFormValid=A(!1);pickupOptionControl=new Se("RECOGER EN DOMICILIO",b.required);termsAcceptedControl=new Se(!1,b.requiredTrue);pickupOptions=["RECOGER EN DOMICILIO","ENTREGAR EN ALMACEN"];orderService=O(oe);router=O(Gi);snackBar=O(ge);cdr=O($i);destroy$=new de;constructor(){}ngOnInit(){}handleOrderAdded(e){this.pendingOrders.update(t=>[...t,e]),this.snackBar.open("Pedido agregado al listado.","OK",{duration:2e3,verticalPosition:"top"}),this.orderCreationFormComponent&&this.orderCreationFormComponent.resetFormForNextOrder(),this.cdr.detectChanges()}handleRemoveOrder(e){this.pendingOrders.update(t=>t.filter(r=>r.temp_id!==e)),this.snackBar.open("Pedido quitado del listado.","OK",{duration:2e3,verticalPosition:"top"})}onOrderFormValidityChanged(e){this.isOrderFormValid.set(e)}submitAllOrders(){if(this.pendingOrders().length===0){this.snackBar.open("No hay pedidos en el listado para enviar.","Cerrar",{duration:3e3,verticalPosition:"top"});return}if(!this.pickupOptionControl.valid){this.snackBar.open("Por favor, seleccione c\xF3mo se har\xE1 el traslado.","Cerrar",{duration:3e3,verticalPosition:"top"}),this.pickupOptionControl.markAsTouched();return}if(!this.termsAcceptedControl.value){this.snackBar.open("Debe aceptar los t\xE9rminos y condiciones.","Cerrar",{duration:3e3,verticalPosition:"top"}),this.termsAcceptedControl.markAsTouched();return}console.log(this.pendingOrders().map(r=>{let _=r,{temp_id:d}=_;return Fi(_,["temp_id"])})),this.isSubmittingBatch.set(!0);let t={orders:this.pendingOrders().map(r=>{let _=r,{temp_id:d}=_;return Fi(_,["temp_id"])}).map(r=>le(Q({},r),{type_order_transfer_to_warehouse:this.pickupOptionControl.value})),pickup_option:this.pickupOptionControl.value||"RECOGER EN DOMICILIO",terms_accepted:!0};this.orderService.createBatchOrders(t).pipe(P(this.destroy$),Vi(()=>this.isSubmittingBatch.set(!1))).subscribe({next:r=>{this.snackBar.open(r.message||"Pedidos generados exitosamente!","OK",{duration:4e3,verticalPosition:"top",panelClass:["success-snackbar"]}),this.pendingOrders.set([]),this.pickupOptionControl.reset("RECOGER_DOMICILIO"),this.termsAcceptedControl.reset(!1),this.router.navigate(["/orders"])},error:r=>{this.snackBar.open(r.message||"Error al generar los pedidos. Intente nuevamente.","Cerrar",{duration:5e3,verticalPosition:"top",panelClass:["error-snackbar"]}),console.error("Error submitting batch orders:",r)}})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=k({type:i,selectors:[["app-order-create-page"]],viewQuery:function(t,r){if(t&1&&dt(Gt,5),t&2){let d;mt(d=st())&&(r.orderCreationFormComponent=d.first)}},decls:4,vars:2,consts:[[1,"page-content-wrapper","order-create-page"],[3,"orderSubmit","formValidityChanged"],[3,"removeOrder","pendingOrders"],["class","final-submission-section mat-elevation-z1",4,"ngIf"],[1,"final-submission-section","mat-elevation-z1"],[1,"pickup-option-section"],["appearance","outline",1,"full-width"],[3,"formControl"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"terms-section"],["href","/terms-and-conditions","target","_blank",2,"color","#012147","font-weight","bold"],["class","terms-error",4,"ngIf"],[1,"submit-batch-button-container"],["mat-flat-button","",1,"submit-all-button","btn-corp-primary",3,"click","disabled"],["mode","indeterminate","diameter","24","class","button-spinner",4,"ngIf"],[3,"value"],[1,"terms-error"],["mode","indeterminate","diameter","24",1,"button-spinner"]],template:function(t,r){t&1&&(o(0,"div",0)(1,"app-order-creation-form",1),f("orderSubmit",function(s){return r.handleOrderAdded(s)})("formValidityChanged",function(s){return r.onOrderFormValidityChanged(s)}),n(),o(2,"app-temporary-orders-table",2),f("removeOrder",function(s){return r.handleRemoveOrder(s)}),n(),c(3,fl,18,8,"div",3),n()),t&2&&(l(2),m("pendingOrders",r.pendingOrders()),l(),m("ngIf",r.pendingOrders().length>0))},dependencies:[F,_t,q,Xt,Yt,j,U,He,Gt,wi,Fe,T,N,I,Ot,xt,Ve,W,H,te,Et,Re,K,we,De],styles:[".order-create-page[_ngcontent-%COMP%]{padding:0;background-color:#f4f6f8}.final-submission-section[_ngcontent-%COMP%]{margin-top:30px;padding:24px;background-color:#fff;border-radius:8px;display:flex;flex-direction:column;gap:20px}.pickup-option-section[_ngcontent-%COMP%]   .full-width[_ngcontent-%COMP%]{width:100%}.terms-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-start}.terms-section[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none;font-weight:500}.terms-section[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}.terms-section[_ngcontent-%COMP%]   .terms-error[_ngcontent-%COMP%]{font-size:.75em;margin-top:4px}.submit-batch-button-container[_ngcontent-%COMP%]{margin-top:16px;text-align:center}.submit-batch-button-container[_ngcontent-%COMP%]   .submit-all-button[_ngcontent-%COMP%]{padding:25px 28px!important;font-size:1.1em;font-weight:500;letter-spacing:.5px;min-width:250px}.button-spinner[_ngcontent-%COMP%]{display:inline-block;vertical-align:middle;margin-right:10px}"]})};var I0=[{path:"",component:Di},{path:"create",component:Pi}];export{I0 as ORDERS_ROUTES};
