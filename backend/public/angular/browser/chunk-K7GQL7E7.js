import{a as X,b as sr,c as mr,d as cr}from"./chunk-HV64JZXN.js";import{a as Kt,b as Jt,c as Zt}from"./chunk-EPPEGOBV.js";import{a as at,b as lt,c as dt,d as st,e as pr,f as ur,g as gr,h as _r,i as fr,j as hr,k as vr,l as br,m as Yt}from"./chunk-ZYJUMLKF.js";import{a as Cr}from"./chunk-5P5HMDTF.js";import{a as wt,b as kt,c as It,d as Tt,h as Rt,i as Nt}from"./chunk-2HM2RQI4.js";import{a as ir,b as rr}from"./chunk-J3MCEMSQ.js";import"./chunk-F5X5MWHG.js";import{a as Pt}from"./chunk-PFFDGLHC.js";import{b as Yi}from"./chunk-TFSII5VP.js";import{a as ee,b as te}from"./chunk-LS42GOGO.js";import{b as Ce,c as ot}from"./chunk-32YNFKZJ.js";import{d as er,e as tr,h as At}from"./chunk-JDXMLECF.js";import{a as Vt,b as Lt,c as Bt,d as zt,e as Gt,f as Ut,g as $t,h as qt,i as jt,j as Ht,k as nr,l as Wt,m as or,n as Xt,o as ar,p as Qt,q as lr,r as dr}from"./chunk-LOSJYKEK.js";import{a as $e,b as Ee}from"./chunk-AP4SLUVM.js";import{a as Ji,b as Zi}from"./chunk-SNHUGF2I.js";import{a as ze,b as Ge}from"./chunk-SJNX65IV.js";import{a as ve,b as Ue,c as Ft,e as be,f as xe,g as Oe,h as de}from"./chunk-WLCEUAAI.js";import{d as Se}from"./chunk-SU4DFO7R.js";import{a as ye,b as Me}from"./chunk-MELD4LZZ.js";import"./chunk-TKRH7WHC.js";import"./chunk-APZ5R6TQ.js";import{a as Li,b as Bi,d as zi,g as Gi,i as Ui}from"./chunk-W4CSZLWO.js";import{C as j,D as H,E as Dt,F as Xi,J as ae,K as le,b as ie,d as O,f as U,g as re,h as $i,j as We,k as qi,l as _e,m as Mt,n as nt,o as ne,p as fe,q as ji,r as St,s as he,t as Hi,u as $,v as q,w as oe,x as Et,y as Wi,z as Be}from"./chunk-U3WC6S2W.js";import{a as L,b as I}from"./chunk-YAUGPVR6.js";import"./chunk-SGYCFQGT.js";import"./chunk-KWFNSAFG.js";import{a as Vi}from"./chunk-T6Q7PKL7.js";import{a as W,b as V,c as Qi,d as Ki,e as D}from"./chunk-PNZEVFCU.js";import"./chunk-OJN7FPAP.js";import{$ as F,$b as y,Ac as E,Bb as g,Ca as A,Cb as u,Ec as Ai,G as Te,Gb as Fe,Gc as Ri,H as Qe,Hb as Ae,Ia as se,Ib as Re,Lb as R,Mb as o,Mc as Ot,Nb as S,Nc as Ni,O as Pe,Ob as p,Pb as ki,Q as Di,Qb as Ii,Ra as Ct,Rb as hi,Rc as yt,Sb as Ci,Sc as rt,Ta as l,Tb as vi,Vb as Je,Wb as Ze,Xa as Y,Yb as Ti,Z as Ke,Zb as C,_ as ft,_b as k,a as He,ab as M,b as _t,ba as ue,bc as Ne,c as yi,cc as Ye,f as ke,fc as xt,ga as ht,gb as c,j as z,jb as wi,k as Mi,kb as s,kc as Fi,la as b,pb as K,qc as Ve,r as Ie,rb as vt,rc as ge,s as fi,sb as bt,sc as N,ta as Pi,tb as n,u as Si,ua as _,ub as i,uc as Le,v as Ei,va as f,vb as h,vc as et,wb as P,wc as G,xb as w,xc as tt,yc as it,zb as x}from"./chunk-4RYFT4MT.js";function yr(r,e){if(r&1&&(n(0,"mat-option",8),o(1),i()),r&2){let t=e.$implicit;s("value",t),l(),p(" ",t," ")}}var ei=class r{filtersChanged=new A;filterForm;orderStatuses$;orderService=b(X);fb=b(he);datePipe=b(G);destroy$=new z;constructor(){this.filterForm=this.fb.group({start_date:[null],end_date:[null],status:[null],search_term:[""]}),this.orderStatuses$=this.orderService.getOrderStatuses()}ngOnInit(){this.filterForm.valueChanges.pipe(F(this.destroy$),Qe(400),Pe((e,t)=>JSON.stringify(e)===JSON.stringify(t))).subscribe(()=>{this.applyFilters()})}applyFilters(){let e=this.filterForm.value,t={start_date:e.start_date?this.datePipe.transform(e.start_date,"yyyy-MM-dd"):null,end_date:e.end_date?this.datePipe.transform(e.end_date,"yyyy-MM-dd"):null,status:e.status||null,search_term:e.search_term?.trim()||null};console.log("OrderFiltersComponent: Emitting filters",t),this.filtersChanged.emit(t)}clearFilters(){this.filterForm.reset({start_date:null,end_date:null,status:null,search_term:""})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=M({type:r,selectors:[["app-order-filters"]],outputs:{filtersChanged:"filtersChanged"},features:[Je([Nt(),G])],decls:36,vars:9,consts:[["startDatePicker",""],["endDatePicker",""],[1,"filters-container",3,"formGroup"],["appearance","outline"],["matInput","","formControlName","start_date","placeholder","mm/dd/yyyy",3,"matDatepicker"],["matSuffix","",3,"for"],["matInput","","formControlName","end_date","placeholder","mm/dd/yyyy",3,"matDatepicker"],["formControlName","status","placeholder","Seleccione estado..."],[3,"value"],[3,"value",4,"ngFor","ngForOf"],["matInput","","formControlName","search_term","placeholder","Buscar..."],[1,"filter-actions"],["mat-stroked-button","","color","primary","type","button",3,"click"],["mat-stroked-button","","type","button",3,"click"]],template:function(t,a){if(t&1){let d=x();n(0,"form",2)(1,"mat-form-field",3)(2,"mat-label"),o(3,"Fecha de entrega inicio"),i(),h(4,"input",4)(5,"mat-datepicker-toggle",5)(6,"mat-datepicker",null,0),i(),n(8,"mat-form-field",3)(9,"mat-label"),o(10,"Fecha de entrega fin"),i(),h(11,"input",6)(12,"mat-datepicker-toggle",5)(13,"mat-datepicker",null,1),i(),n(15,"mat-form-field",3)(16,"mat-label"),o(17,"Estado"),i(),n(18,"mat-select",7)(19,"mat-option",8),o(20,"Todos"),i(),c(21,yr,2,2,"mat-option",9),C(22,"async"),i()(),n(23,"mat-form-field",3)(24,"mat-label"),o(25,"Buscar"),i(),h(26,"input",10),i(),n(27,"div",11)(28,"button",12),g("click",function(){return _(d),f(a.applyFilters())}),n(29,"mat-icon"),o(30,"search"),i(),o(31," Buscar "),i(),n(32,"button",13),g("click",function(){return _(d),f(a.clearFilters())}),n(33,"mat-icon"),o(34,"clear_all"),i(),o(35," Limpiar "),i()()()}if(t&2){let d=R(7),m=R(14);s("formGroup",a.filterForm),l(4),s("matDatepicker",d),l(),s("for",d),l(6),s("matDatepicker",m),l(),s("for",m),l(7),s("value",null),l(2),s("ngForOf",k(22,7,a.orderStatuses$))}},dependencies:[E,ge,Le,$,_e,ie,U,re,ne,fe,H,j,q,Be,le,ae,st,at,lt,dt,Rt,Ee,$e,Se,D,V,I,L],styles:[".filters-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:16px;align-items:flex-start;padding:16px;background-color:var(--sys-surface-container-low);border-radius:8px;margin-bottom:20px;box-shadow:0 1px 3px #00000014}mat-form-field[_ngcontent-%COMP%]{min-width:200px;flex-grow:1}.filter-actions[_ngcontent-%COMP%]{display:flex;gap:10px;align-items:center;padding-top:8px}@media (max-width: 768px){mat-form-field[_ngcontent-%COMP%]{width:calc(50% - 8px);min-width:unset}.filter-actions[_ngcontent-%COMP%]{width:100%;justify-content:flex-end;padding-top:16px}}@media (max-width: 480px){mat-form-field[_ngcontent-%COMP%]{width:100%}}"]})};var Xe=(T=>(T.REGISTRADO="REGISTRADO",T.RECOGIDO="RECOGIDO",T.EN_ALMACEN="EN ALMACEN",T.EN_TRANSITO="EN TRANSITO",T.ENTREGADO="ENTREGADO",T.CANCELADO="CANCELADO",T.RECHAZADO="RECHAZADO EN PUNTO",T.REPROGRAMADO="REPROGRAMADO",T))(Xe||{});var ii=class r{http=b(Ri);apiUrl=rt.apiUrl+"/settings";authService=b(Vi);uploadFile(e){let t=new FormData;t.append("file",e,e.name);let a=this.authService.getAccessToken();if(!a)return fi(()=>new Error("Not authenticated to fetch users."));let d=new Ai({codrr_token:a});return this.http.post(`${this.apiUrl}/upload-file`,t,{headers:d}).pipe(ue(m=>console.log("SettingsService: Terms PDF uploaded",m)),Te(this.handleError("file")))}handleError(e="operation",t){return a=>(console.error(`${e} failed: ${a.message}`,a),t!==void 0?Ie(t):fi(()=>new Error(`Error in ${e}. Details: ${a.message||"Server error"}`)))}static \u0275fac=function(t){return new(t||r)};static \u0275prov=ht({token:r,factory:r.\u0275fac,providedIn:"root"})};var Sr=["videoPlayer"],Er=["canvasElement"],Or=()=>({standalone:!0});function Dr(r,e){if(r&1&&(n(0,"mat-option",20),o(1),C(2,"titlecase"),i()),r&2){let t=e.$implicit;s("value",t),l(),p(" ",k(2,2,t)," ")}}function Pr(r,e){r&1&&(n(0,"mat-error"),o(1,"Debe seleccionar un nuevo estado."),i())}function wr(r,e){r&1&&(n(0,"mat-hint",24),o(1," Es importante detallar el motivo para este estados. "),i())}function kr(r,e){r&1&&(n(0,"mat-error"),o(1," El motivo es obligatorio. "),i())}function Ir(r,e){if(r&1){let t=x();n(0,"mat-form-field",21)(1,"mat-label"),o(2,"Motivo / Observaci\xF3n"),i(),n(3,"textarea",22),vi("ngModelChange",function(d){_(t);let m=u();return Ci(m.reason,d)||(m.reason=d),f(d)}),i(),c(4,wr,2,0,"mat-hint",23)(5,kr,2,0,"mat-error",14),i()}if(r&2){let t=u();l(3),hi("ngModel",t.reason),s("ngModelOptions",Ze(4,Or)),l(),s("ngIf",t.isReasonMandatory(t.selectedStatus)),l(),s("ngIf",t.formSubmitted&&t.isReasonMandatory(t.selectedStatus)&&(!t.reason||t.reason.trim()===""))}}function Tr(r,e){if(r&1){let t=x();n(0,"div",37)(1,"p",42),o(2,"Vista Previa:"),i(),h(3,"img",43),n(4,"button",44),g("click",function(){_(t);let d=u(2);return f(d.removeImage())}),n(5,"mat-icon"),o(6,"delete_forever"),i()()()}if(r&2){let t=u(2);l(3),s("src",t.imagePreviewUrl,Ct)}}function Fr(r,e){r&1&&(n(0,"div",38),h(1,"mat-progress-spinner",45),n(2,"span"),o(3,"Subiendo imagen..."),i()())}function Ar(r,e){if(r&1&&(n(0,"mat-option",20),o(1),i()),r&2){let t=e.$implicit;s("value",t),l(),S(t)}}function Rr(r,e){r&1&&(n(0,"mat-error"),o(1,"Seleccione m\xE9todo de pago para costo de env\xEDo."),i())}function Nr(r,e){if(r&1&&(n(0,"mat-option",20),o(1),i()),r&2){let t=e.$implicit;s("value",t),l(),S(t)}}function Vr(r,e){r&1&&(n(0,"mat-error"),o(1,"Seleccione m\xE9todo de pago para el monto a cobrar."),i())}function Lr(r,e){if(r&1){let t=x();n(0,"div",16),h(1,"mat-divider"),n(2,"h4"),o(3,"Prueba de Entrega y Pagos"),i(),n(4,"div",25)(5,"label",26),o(6,"Foto de Prueba de Entrega:"),i(),n(7,"div",27)(8,"button",28),g("click",function(){_(t);let d=u();return f(d.startCamera())}),n(9,"mat-icon"),o(10,"photo_camera"),i(),o(11," Acceder a C\xE1mara "),i(),n(12,"span",29),o(13,"o"),i(),n(14,"button",30),g("click",function(){_(t);let d=u();return f(d.triggerFileUpload())}),n(15,"mat-icon"),o(16,"attach_file"),i(),o(17," Subir Archivo "),i()(),n(18,"input",31,0),g("change",function(d){_(t);let m=u();return f(m.onFileSelected(d))}),i(),n(20,"div",32),h(21,"video",33,1),n(23,"button",34),g("click",function(){_(t);let d=u();return f(d.takePhoto())}),n(24,"mat-icon"),o(25,"camera"),i(),o(26," Tomar Foto "),i(),n(27,"button",35),g("click",function(){_(t);let d=u();return f(d.stopCamera())}),n(28,"mat-icon"),o(29,"videocam_off"),i()()(),h(30,"canvas",36,2),c(32,Tr,7,1,"div",37)(33,Fr,4,0,"div",38),i(),n(34,"mat-form-field",39)(35,"mat-label"),o(36),C(37,"number"),i(),n(38,"mat-select",40),c(39,Ar,2,2,"mat-option",13),i(),c(40,Rr,2,0,"mat-error"),i(),n(41,"mat-form-field",39)(42,"mat-label"),o(43),C(44,"number"),i(),n(45,"mat-select",41),c(46,Nr,2,2,"mat-option",13),i(),c(47,Vr,2,0,"mat-error"),i()()}if(r&2){let t=u();l(8),s("disabled",t.showCamera),l(15),s("disabled",!t.stream),l(9),K(t.imagePreviewUrl?32:-1),l(),K(t.isUploadingImage?33:-1),l(3),p("M\xE9todo Pago Costo Env\xEDo (S/ ",y(37,10,t.data.order.shipping_cost,"1.2-2"),")"),l(3),s("ngForOf",t.paymentMethods),l(),K(t.formSubmitted&&(t.scpmCtrl!=null&&t.scpmCtrl.hasError("required"))?40:-1),l(3),p("M\xE9todo Pago Cobro (S/ ",y(44,13,t.data.order.amount_to_collect_at_delivery,"1.2-2"),")"),l(3),s("ngForOf",t.paymentMethods),l(),K(t.formSubmitted&&(t.cpmCtrl!=null&&t.cpmCtrl.hasError("required"))?47:-1)}}var ri=class r{constructor(e,t){this.dialogRef=e;this.data=t;this.deliveryDetailsForm=this.fb.group({shippingCostPaymentMethod:[null],collectionPaymentMethod:[null]})}selectedStatus;reason="";showReasonField=!1;deliveryDetailsForm;videoPlayer;canvasElement;imagePreviewUrl=null;selectedImageFile=null;isUploadingImage=!1;uploadedImageUrl=null;showCamera=!1;stream=null;photoTaken=!1;cameraError=null;formSubmitted=!1;paymentMethods=["Efectivo","Pago directo"];showDeliveryDetails=!1;OrderStatusEnum=Xe;fb=b(he);imageUploadService=b(ii);snackBar=b(Ce);cdr=b(xt);destroy$=new z;ngOnInit(){this.data.availableStatuses.includes(this.data.order.status)}startCamera(){return ke(this,null,function*(){this.cameraError=null,this.removeImage();try{navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?(this.stream=yield navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"},audio:!1}),this.videoPlayer&&this.videoPlayer.nativeElement&&(this.videoPlayer.nativeElement.srcObject=this.stream,this.videoPlayer.nativeElement.play().catch(e=>console.error("Error playing video:",alert(e))),this.showCamera=!0,this.photoTaken=!1)):(this.cameraError="Tu navegador no soporta el acceso a la c\xE1mara.",this.snackBar.open(this.cameraError,"Cerrar",{duration:5e3}))}catch(e){console.error("Error al acceder a la c\xE1mara:",e),e.name==="NotAllowedError"||e.name==="PermissionDeniedError"?this.cameraError="Permiso de c\xE1mara denegado. Por favor, habilita el acceso en tu navegador.":e.name==="NotFoundError"||e.name==="DevicesNotFoundError"?this.cameraError="No se encontr\xF3 una c\xE1mara compatible.":this.cameraError="Error al iniciar la c\xE1mara. Intenta de nuevo o sube un archivo.",this.snackBar.open(this.cameraError,"Cerrar",{duration:7e3}),this.showCamera=!1}this.cdr.detectChanges()})}takePhoto(){if(!this.stream||!this.videoPlayer||!this.canvasElement)return;let e=this.videoPlayer.nativeElement,t=this.canvasElement.nativeElement,a=t.getContext("2d");a&&(t.width=e.videoWidth,t.height=e.videoHeight,a.drawImage(e,0,0,t.width,t.height),this.imagePreviewUrl=t.toDataURL("image/jpeg"),this.photoTaken=!0,this.selectedImageFile=null,this.uploadedImageUrl=null,this.stopCamera())}stopCamera(){this.stream&&(this.stream.getTracks().forEach(e=>e.stop()),this.stream=null),this.showCamera=!1}onFileSelected(e){this.stopCamera(),this.photoTaken=!1;let a=e.currentTarget.files;if(a&&a[0]){this.selectedImageFile=a[0];let d=new FileReader;d.onload=m=>{this.imagePreviewUrl=m.target.result,this.uploadedImageUrl=null,this.cdr.detectChanges()},d.readAsDataURL(this.selectedImageFile)}else this.selectedImageFile=null,this.imagePreviewUrl=null}triggerFileUpload(){this.stopCamera(),document.getElementById("proofOfDeliveryImageUpload")?.click()}removeImage(){this.stopCamera(),this.selectedImageFile=null,this.imagePreviewUrl=null,this.uploadedImageUrl=null,this.photoTaken=!1;let e=document.getElementById("proofOfDeliveryImageUpload");e&&(e.value="")}onStatusChange(e){this.selectedStatus=e.value,this.checkIfReasonIsNeeded(this.selectedStatus),this.checkIfDeliveryDetailsNeeded(this.selectedStatus)}checkIfReasonIsNeeded(e){if(!e){this.showReasonField=!1;return}this.showReasonField=this.isReasonMandatory(e)}isReasonMandatory(e){let t=e||this.selectedStatus;return t?["CANCELADO","REPROGRAMADO","RECHAZADO EN PUNTO"].includes(t):!1}checkIfDeliveryDetailsNeeded(e){e==="ENTREGADO"?(this.showDeliveryDetails=!0,this.data.order.shipping_cost&&this.data.order.shipping_cost>0?this.deliveryDetailsForm.get("shippingCostPaymentMethod")?.setValidators([O.required]):this.deliveryDetailsForm.get("shippingCostPaymentMethod")?.clearValidators(),this.data.order.amount_to_collect_at_delivery&&this.data.order.amount_to_collect_at_delivery>0?this.deliveryDetailsForm.get("collectionPaymentMethod")?.setValidators([O.required]):this.deliveryDetailsForm.get("collectionPaymentMethod")?.clearValidators(),this.deliveryDetailsForm.get("shippingCostPaymentMethod")?.updateValueAndValidity(),this.deliveryDetailsForm.get("collectionPaymentMethod")?.updateValueAndValidity()):(this.showDeliveryDetails=!1,this.deliveryDetailsForm.get("shippingCostPaymentMethod")?.clearValidators(),this.deliveryDetailsForm.get("shippingCostPaymentMethod")?.updateValueAndValidity(),this.deliveryDetailsForm.get("collectionPaymentMethod")?.clearValidators(),this.deliveryDetailsForm.get("collectionPaymentMethod")?.updateValueAndValidity(),this.deliveryDetailsForm.reset(),this.imagePreviewUrl=null,this.selectedImageFile=null,this.uploadedImageUrl=null)}isConfirmDisabled(){return!!(!this.selectedStatus||this.isReasonMandatory(this.selectedStatus)&&(!this.reason||this.reason.trim()==="")||this.selectedStatus==="ENTREGADO"&&!this.selectedImageFile)}onConfirm(){return ke(this,null,function*(){if(this.formSubmitted=!0,this.isConfirmDisabled()){this.selectedStatus==="ENTREGADO"&&this.deliveryDetailsForm.markAllAsTouched();return}let e=this.uploadedImageUrl;if(this.selectedStatus==="ENTREGADO"&&(this.photoTaken||this.selectedImageFile)&&!this.uploadedImageUrl){this.isUploadingImage=!0;try{let t=null;if(this.photoTaken&&this.imagePreviewUrl&&typeof this.imagePreviewUrl=="string"?t=yield(yield fetch(this.imagePreviewUrl)).blob():this.selectedImageFile&&(t=this.selectedImageFile),t){let a=t instanceof File?t:new File([t],"proof_of_delivery.jpg",{type:t.type}),d=yield this.imageUploadService.uploadFile(a).toPromise();e=d?.file_url||null,console.log("uploadResponse",d),this.uploadedImageUrl=e}else this.uploadedImageUrl||console.warn("No image data to upload, but proceeding as ENTREGADO without image proof.")}catch(t){console.error("Error uploading/processing image:",t),this.snackBar.open("Error al procesar la imagen de prueba.","Cerrar",{duration:3e3,panelClass:["error-snackbar"]}),this.isUploadingImage=!1;return}finally{this.isUploadingImage=!1}}this.dialogRef.close({newStatus:this.selectedStatus,reason:this.showReasonField&&this.reason?this.reason.trim():void 0,proofOfDeliveryImageUrl:e,shippingCostPaymentMethod:this.showDeliveryDetails?this.deliveryDetailsForm.value.shippingCostPaymentMethod:null,collectionPaymentMethod:this.showDeliveryDetails?this.deliveryDetailsForm.value.collectionPaymentMethod:null})})}onCancel(){this.dialogRef.close()}get scpmCtrl(){return this.deliveryDetailsForm.get("shippingCostPaymentMethod")}get cpmCtrl(){return this.deliveryDetailsForm.get("collectionPaymentMethod")}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}getStatusClass(e){if(!e)return"status-desconocido";let t=e.toLowerCase().replace(/[\s_]+/g,"-");return console.log("`status-${formattedStatus}`",`status-${t}`),`status-${t}`}static \u0275fac=function(t){return new(t||r)(Y(ve),Y(Ue))};static \u0275cmp=M({type:r,selectors:[["app-change-status-dialog"]],viewQuery:function(t,a){if(t&1&&(Fe(Sr,5),Fe(Er,5)),t&2){let d;Ae(d=Re())&&(a.videoPlayer=d.first),Ae(d=Re())&&(a.canvasElement=d.first)}},decls:27,vars:15,consts:[["fileUpload",""],["videoPlayer",""],["canvasElement",""],[1,"dialog-container"],[1,"dialog-header"],["mat-dialog-title",""],[1,"order-code-chip"],[3,"ngSubmit","formGroup"],[1,"dialog-content"],[1,"current-status-container"],[1,"status-badge",3,"ngClass"],["appearance","outline",1,"full-width","select-status-field"],["name","newStatus","required","",3,"ngModelChange","selectionChange","ngModel","ngModelOptions"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["appearance","outline","class","full-width reason-field",4,"ngIf"],[1,"delivery-details-section"],["align","end",1,"dialog-actions"],["mat-stroked-button","","type","button",1,"cancel-button",3,"click"],["mat-flat-button","","color","primary","type","submit",1,"confirm-button",3,"disabled"],[3,"value"],["appearance","outline",1,"full-width","reason-field"],["matInput","","name","reason","rows","3","cdkTextareaAutosize","","cdkAutosizeMinRows","2","cdkAutosizeMaxRows","3","placeholder","Describa el motivo del cambio de estado...",3,"ngModelChange","ngModel","ngModelOptions"],["align","start",4,"ngIf"],["align","start"],[1,"image-upload-container"],[1,"image-upload-label"],[1,"image-actions"],["mat-stroked-button","","type","button","color","primary",1,"camera-button",3,"click","disabled"],[1,"or-divider"],["mat-stroked-button","","type","button","color","accent",1,"upload-button",3,"click"],["type","file","hidden","","id","proofOfDeliveryImageUpload","accept","image/*",3,"change"],[1,"camera-view"],["autoplay","","playsinline","",1,"video-preview"],["mat-fab","","extended","","color","primary",1,"take-photo-button",3,"click","disabled"],["mat-icon-button","","matTooltip","Cerrar c\xE1mara",1,"stop-camera-button",3,"click"],[2,"display","none"],[1,"image-preview-wrapper"],[1,"upload-spinner"],["appearance","outline",1,"full-width","payment-method-field"],["formControlName","shippingCostPaymentMethod","name","shippingCostPaymentMethod"],["formControlName","collectionPaymentMethod","name","collectionPaymentMethod"],[1,"preview-label"],["alt","Vista previa de la imagen",1,"image-preview",3,"src"],["mat-icon-button","","type","button","matTooltip","Quitar imagen / Tomar otra",1,"remove-image-button",3,"click"],["mode","indeterminate","diameter","24"]],template:function(t,a){t&1&&(n(0,"div",3)(1,"div",4)(2,"h2",5),o(3,"Cambiar Estado del Pedido"),i(),n(4,"span",6),o(5),i()(),n(6,"form",7),g("ngSubmit",function(){return a.onConfirm()}),n(7,"mat-dialog-content",8)(8,"div",9)(9,"span"),o(10,"Estado Actual:"),i(),n(11,"span",10),o(12),C(13,"titlecase"),i()(),n(14,"mat-form-field",11)(15,"mat-label"),o(16,"Seleccionar Nuevo Estado"),i(),n(17,"mat-select",12),vi("ngModelChange",function(m){return Ci(a.selectedStatus,m)||(a.selectedStatus=m),m}),g("selectionChange",function(m){return a.onStatusChange(m)}),c(18,Dr,3,4,"mat-option",13),i(),c(19,Pr,2,0,"mat-error",14),i(),c(20,Ir,6,5,"mat-form-field",15)(21,Lr,48,16,"div",16),i(),n(22,"mat-dialog-actions",17)(23,"button",18),g("click",function(){return a.onCancel()}),o(24," Cancelar "),i(),n(25,"button",19),o(26),i()()()()),t&2&&(l(5),p("Pedido N\xB0: ",a.data.order.code||a.data.order.id,""),l(),s("formGroup",a.deliveryDetailsForm),l(5),s("ngClass",a.getStatusClass(a.data.order.status)),l(),p(" ",k(13,12,a.data.order.status)," "),l(5),hi("ngModel",a.selectedStatus),s("ngModelOptions",Ze(14,Or)),l(),s("ngForOf",a.data.availableStatuses),l(),s("ngIf",a.formSubmitted&&!a.selectedStatus),l(),s("ngIf",a.showReasonField),l(),K(a.showDeliveryDetails?21:-1),l(4),s("disabled",a.isConfirmDisabled()||a.isUploadingImage||a.showCamera&&!a.photoTaken&&!a.imagePreviewUrl),l(),p(" ",a.isUploadingImage?"Subiendo...":"Confirmar Cambio"," "))},dependencies:[E,Ve,ge,N,tt,et,Hi,_e,ie,U,re,St,qi,$,ne,fe,de,be,Oe,xe,H,j,q,Et,oe,Ee,$e,Se,le,ae,Dt,D,V,W,Ki,Xi,I,L,te,ee,Me,ye],styles:[".dialog-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;max-height:80vh}.dialog-header[_ngcontent-%COMP%]{padding:20px 24px 0;border-bottom:1px solid var(--sys-outline-variant);margin-bottom:20px}.dialog-header[_ngcontent-%COMP%]   h2.mat-mdc-dialog-title[_ngcontent-%COMP%]{margin-bottom:4px;font-size:1.5em;font-weight:500;color:var(--sys-on-surface)}.order-code-chip[_ngcontent-%COMP%]{display:inline-block;font-size:.85em;color:var(--sys-on-surface-variant);background-color:var(--sys-surface-container-low);padding:4px 10px;border-radius:16px;margin-bottom:16px;font-family:Consolas,Monaco,monospace}.dialog-content[_ngcontent-%COMP%]{padding:0 24px 20px;overflow-y:auto;flex-grow:1}.current-status-container[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:24px;font-size:1em;color:var(--sys-on-surface-variant)}.current-status-container[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:first-child{margin-right:8px}.status-badge[_ngcontent-%COMP%]{padding:5px 12px;border-radius:16px;font-size:.8rem;font-weight:600;text-transform:uppercase;letter-spacing:.5px;display:inline-flex;align-items:center;line-height:1;color:var(--sys-on-surface)}.status-registrado[_ngcontent-%COMP%]{background-color:var(--status-registrado-bg);color:var(--status-registrado-color)}.status-recogido[_ngcontent-%COMP%]{background-color:var(--status-recogido-bg);color:var(--status-recogido-color)}.status-en-almacen[_ngcontent-%COMP%]{background-color:var(--status-en-almacen-bg);color:var(--status-en-almacen-color)}.status-en-transito[_ngcontent-%COMP%]{background-color:var(--status-en-transito-bg);color:var(--status-en-transito-color)}.status-entregado[_ngcontent-%COMP%]{background-color:var(--status-entregado-bg);color:var(--status-entregado-color)}.status-no-entregado[_ngcontent-%COMP%]{background-color:var(--status-no-entregado-bg);color:var(--status-no-entregado-color)}.status-cancelado[_ngcontent-%COMP%]{background-color:var(--status-cancelado-bg);color:var(--status-cancelado-color)}.status-rechazado-en-punto[_ngcontent-%COMP%]{background-color:var(--status-rechazado-bg);color:var(--status-rechazado-color)}.status-reprogramado[_ngcontent-%COMP%]{background-color:var(--status-reprogramado-bg);color:var(--status-reprogramado-color)}.full-width[_ngcontent-%COMP%]{width:100%}.select-status-field[_ngcontent-%COMP%]{margin-bottom:20px}.reason-field[_ngcontent-%COMP%]{margin-top:10px}.reason-field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{min-height:60px}.dialog-actions[_ngcontent-%COMP%]{padding:16px 24px;border-top:1px solid rgba(0,0,0,.12);background-color:var(--sys-surface-container-low)}.dialog-actions[_ngcontent-%COMP%]   .cancel-button[_ngcontent-%COMP%]{margin-right:8px}[_nghost-%COMP%]     .mat-mdc-form-field-subscript-wrapper{min-height:1.25em;height:auto}.delivery-details-section[_ngcontent-%COMP%]{margin-top:20px;padding-top:20px;border-top:1px solid rgba(0,0,0,.12)}.delivery-details-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:1.1em;font-weight:500;margin-bottom:16px;color:#444}.image-upload-container[_ngcontent-%COMP%]{margin-bottom:20px}.image-upload-container[_ngcontent-%COMP%]   .image-upload-label[_ngcontent-%COMP%]{display:block;font-size:.9em;color:#555;margin-bottom:8px;font-weight:500}.image-upload-container[_ngcontent-%COMP%]   .upload-button[_ngcontent-%COMP%]{margin-bottom:10px}.image-upload-container[_ngcontent-%COMP%]   .upload-button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:6px}.image-preview-wrapper[_ngcontent-%COMP%]{position:relative;display:inline-block;border:1px solid #ddd;padding:5px;border-radius:4px;background-color:#f9f9f9;margin-top:10px}.image-preview-wrapper[_ngcontent-%COMP%]   .image-preview[_ngcontent-%COMP%]{display:block;max-width:100%;max-height:200px;border-radius:3px}.image-preview-wrapper[_ngcontent-%COMP%]   .remove-image-button[_ngcontent-%COMP%]{position:absolute;top:-10px;right:-10px;background-color:#fffc;line-height:normal;padding:0;width:28px;height:28px}.image-preview-wrapper[_ngcontent-%COMP%]   .remove-image-button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px}.upload-spinner[_ngcontent-%COMP%]{display:flex;align-items:center;font-size:.9em;color:#555;margin-top:10px}.upload-spinner[_ngcontent-%COMP%]   mat-progress-spinner[_ngcontent-%COMP%]{margin-right:8px}.payment-method-field[_ngcontent-%COMP%]{margin-top:16px}.close-button-header[_ngcontent-%COMP%]{min-width:auto;padding:0;line-height:normal;color:#757575}"]})};function Br(r,e){if(r&1&&(n(0,"mat-grid-tile")(1,"div",10)(2,"mat-icon",11),o(3,"account_circle"),i(),n(4,"div")(5,"div",12),o(6,"Usuario Creador"),i(),n(7,"div",13),o(8),C(9,"default"),i()()()()),r&2){let t=u();l(8),p(" ",y(9,1,t.data.order.user==null?null:t.data.order.user.username,"N/A")," ")}}function zr(r,e){if(r&1&&(n(0,"mat-grid-tile")(1,"div",10)(2,"mat-icon",11),o(3,"account_circle"),i(),n(4,"div")(5,"div",12),o(6,"Motorizado"),i(),n(7,"div",13),o(8),C(9,"default"),i()()()()),r&2){let t=u();l(8),p(" ",y(9,1,t.data.order.assigned_driver==null?null:t.data.order.assigned_driver.username,"N/A")," ")}}function Gr(r,e){if(r&1&&(n(0,"mat-grid-tile")(1,"div",10)(2,"mat-icon",11),o(3,"explore"),i(),n(4,"div")(5,"div",12),o(6,"Coordenadas"),i(),n(7,"div",13),o(8),i()()()()),r&2){let t=u();l(8),p(" ",t.data.order.delivery_coordinates," ")}}function Ur(r,e){r&1&&h(0,"mat-divider")}function $r(r,e){if(r&1&&(n(0,"mat-grid-tile")(1,"div",10)(2,"mat-icon",11),o(3,"aspect_ratio"),i(),n(4,"div")(5,"div",12),o(6,"Tama\xF1o Paquete"),i(),n(7,"div",13),o(8),C(9,"titlecase"),i()()()()),r&2){let t=u();l(8),p(" ",k(9,1,t.data.order.package_size_type)," ")}}function qr(r,e){if(r&1&&(n(0,"mat-grid-tile")(1,"div",10)(2,"mat-icon",11),o(3,"fitness_center"),i(),n(4,"div")(5,"div",12),o(6,"Peso (kg)"),i(),n(7,"div",13),o(8),C(9,"number"),i()()()()),r&2){let t=u();l(8),p(" ",y(9,1,t.data.order.package_weight_kg,"1.1-2")," kg ")}}function jr(r,e){if(r&1&&(n(0,"mat-grid-tile")(1,"div",10)(2,"mat-icon",11),o(3,"width_normal"),i(),n(4,"div")(5,"div",12),o(6,"Dimensiones (cm)"),i(),n(7,"div",13),o(8),i()()()()),r&2){let t=u();l(8),Ii(" An: ",t.data.order.package_width_cm," x L: ",t.data.order.package_length_cm," x Al: ",t.data.order.package_height_cm," ")}}function Hr(r,e){if(r&1&&(n(0,"mat-grid-tile")(1,"div",10)(2,"mat-icon",11),o(3,"credit_card"),i(),n(4,"div")(5,"div",12),o(6,"M\xE9todo de Cobro"),i(),n(7,"div",13),o(8),C(9,"titlecase"),i()()()()),r&2){let t=u();l(8),p(" ",k(9,1,t.data.order.payment_method_for_collection)," ")}}function Wr(r,e){if(r&1&&(n(0,"div",24)(1,"div",25)(2,"mat-icon"),o(3,"speaker_notes"),i(),o(4," Observaciones Cliente/Pedido: "),i(),n(5,"p",26),o(6),i()()),r&2){let t=u(2);l(6),S(t.data.order.observations)}}function Xr(r,e){r&1&&h(0,"mat-divider")}function Qr(r,e){if(r&1&&(n(0,"div",24)(1,"div",25)(2,"mat-icon"),o(3,"warehouse"),i(),o(4," Tipo de Transferencia a Almac\xE9n: "),i(),n(5,"p",26),o(6),C(7,"titlecase"),i()()),r&2){let t=u(2);l(6),p(" ",k(7,1,t.data.order.type_order_transfer_to_warehouse)," ")}}function Kr(r,e){if(r&1&&(n(0,"mat-card",6)(1,"mat-card-header",7)(2,"mat-card-title"),o(3,"Observaciones y Log\xEDstica"),i()(),n(4,"mat-card-content"),c(5,Wr,7,1,"div",23)(6,Xr,1,0,"mat-divider",14)(7,Qr,8,3,"div",23),i()()),r&2){let t=u();l(5),s("ngIf",t.data.order.observations),l(),s("ngIf",t.data.order.observations&&t.data.order.type_order_transfer_to_warehouse),l(),s("ngIf",t.data.order.type_order_transfer_to_warehouse)}}var ai=class r{constructor(e,t){this.dialogRef=e;this.data=t;console.log("data",t)}OrderStatusEnum=Xe;getStatusBadgeClass(e){return e?`status-${e.toString().toLowerCase().replace(/[\s_]+/g,"-")}`:"status-desconocido"}onClose(){this.dialogRef.close()}openMaps(e){e&&window.open(`https://www.google.com/maps/search/?api=1&query=${e}`,"_blank")}callPhone(e){e&&(window.location.href=`tel:${e}`)}printOrder(){console.log("Imprimiendo pedido (simulado):",this.data.order.code),this.dialogRef.close("print")}static \u0275fac=function(t){return new(t||r)(Y(ve),Y(Ue))};static \u0275cmp=M({type:r,selectors:[["app-order-detail-dialog"]],decls:145,vars:66,consts:[["cdkDrag","","cdkDragRootElement",".cdk-overlay-pane","cdkDragHandle",".dialog-header-draggable",1,"dialog-container"],[1,"dialog-header","dialog-header-draggable"],["mat-dialog-title",""],[1,"order-code-chip"],["mat-icon-button","","aria-label","Cerrar di\xE1logo","matTooltip","Cerrar",1,"close-button",3,"click"],["tabindex","-1",1,"dialog-content"],["appearance","outlined",1,"info-card"],[1,"compact-card-header"],[1,"status-badge-dialog",3,"ngClass"],["cols","2","rowHeight","80px"],[1,"detail-item"],[1,"detail-icon"],[1,"detail-label"],[1,"detail-value"],[4,"ngIf"],[1,"detail-item",3,"click"],[1,"detail-value","link-like"],[3,"colspan"],[1,"item-description"],[1,"detail-value","bold-value"],["appearance","outlined","class","info-card",4,"ngIf"],["align","end",1,"dialog-actions"],["mat-flat-button","","color","primary",3,"click"],["class","detail-block",4,"ngIf"],[1,"detail-block"],[1,"detail-label-block"],[1,"detail-value-block"]],template:function(t,a){t&1&&(n(0,"div",0)(1,"div",1)(2,"h2",2),o(3,"Detalles del Pedido"),i(),n(4,"span",3),o(5),i(),n(6,"button",4),g("click",function(){return a.onClose()}),n(7,"mat-icon"),o(8,"close"),i()()(),n(9,"mat-dialog-content",5)(10,"mat-card",6)(11,"mat-card-header",7)(12,"mat-card-title"),o(13,"Informaci\xF3n General"),i(),n(14,"span",8),o(15),C(16,"titlecase"),i()(),n(17,"mat-card-content")(18,"mat-grid-list",9)(19,"mat-grid-tile")(20,"div",10)(21,"mat-icon",11),o(22,"local_shipping"),i(),n(23,"div")(24,"div",12),o(25,"Tipo de Env\xEDo"),i(),n(26,"div",13),o(27),C(28,"titlecase"),C(29,"default"),i()()()(),n(30,"mat-grid-tile")(31,"div",10)(32,"mat-icon",11),o(33,"calendar_today"),i(),n(34,"div")(35,"div",12),o(36,"Fecha Registro"),i(),n(37,"div",13),o(38),C(39,"date"),C(40,"default"),i()()()(),n(41,"mat-grid-tile")(42,"div",10)(43,"mat-icon",11),o(44,"event_available"),i(),n(45,"div")(46,"div",12),o(47,"Fecha Entrega Prog."),i(),n(48,"div",13),o(49),C(50,"date"),C(51,"default"),i()()()(),c(52,Br,10,4,"mat-grid-tile",14)(53,zr,10,4,"mat-grid-tile",14),i()()(),n(54,"mat-card",6)(55,"mat-card-header",7)(56,"mat-card-title"),o(57,"Destinatario y Entrega"),i()(),n(58,"mat-card-content")(59,"mat-grid-list",9)(60,"mat-grid-tile")(61,"div",10)(62,"mat-icon",11),o(63,"person_pin"),i(),n(64,"div")(65,"div",12),o(66,"Nombre Destinatario"),i(),n(67,"div",13),o(68),C(69,"default"),i()()()(),n(70,"mat-grid-tile")(71,"div",15),g("click",function(){return a.callPhone(a.data.order.recipient_phone)}),n(72,"mat-icon",11),o(73,"phone_iphone"),i(),n(74,"div")(75,"div",12),o(76,"Tel\xE9fono Destinatario"),i(),n(77,"div",16),o(78),i()()()(),n(79,"mat-grid-tile",17)(80,"div",10)(81,"mat-icon",11),o(82,"location_on"),i(),n(83,"div")(84,"div",12),o(85,"Direcci\xF3n de Entrega"),i(),n(86,"div",13),o(87),C(88,"default"),i()()()(),n(89,"mat-grid-tile")(90,"div",10)(91,"mat-icon",11),o(92,"map"),i(),n(93,"div")(94,"div",12),o(95,"Distrito"),i(),n(96,"div",13),o(97),C(98,"titlecase"),C(99,"default"),i()()()(),c(100,Gr,9,1,"mat-grid-tile",14),i()()(),n(101,"mat-card",6)(102,"mat-card-header",7)(103,"mat-card-title"),o(104,"Detalles del Paquete"),i()(),n(105,"mat-card-content")(106,"p",18),o(107),C(108,"default"),i(),c(109,Ur,1,0,"mat-divider",14),n(110,"mat-grid-list",9),c(111,$r,10,3,"mat-grid-tile",14)(112,qr,10,4,"mat-grid-tile",14)(113,jr,9,3,"mat-grid-tile",14),i()()(),n(114,"mat-card",6)(115,"mat-card-header",7)(116,"mat-card-title"),o(117,"Informaci\xF3n Financiera"),i()(),n(118,"mat-card-content")(119,"mat-grid-list",9)(120,"mat-grid-tile")(121,"div",10)(122,"mat-icon",11),o(123,"payments"),i(),n(124,"div")(125,"div",12),o(126,"Monto a Cobrar Entrega"),i(),n(127,"div",19),o(128),C(129,"currency"),i()()()(),n(130,"mat-grid-tile")(131,"div",10)(132,"mat-icon",11),o(133,"local_atm"),i(),n(134,"div")(135,"div",12),o(136,"Costo de Env\xEDo"),i(),n(137,"div",19),o(138),C(139,"currency"),i()()()(),c(140,Hr,10,3,"mat-grid-tile",14),i()()(),c(141,Kr,8,3,"mat-card",20),i(),n(142,"mat-dialog-actions",21)(143,"button",22),g("click",function(){return a.onClose()}),o(144,"Cerrar"),i()()()),t&2&&(l(5),p("N\xB0: ",a.data.order.code||a.data.order.id,""),l(9),s("ngClass",a.getStatusBadgeClass(a.data.order.status)),l(),p(" ",k(16,23,a.data.order.status)," "),l(12),p(" ",y(29,27,k(28,25,a.data.order.shipment_type),"N/A")," "),l(11),p(" ",y(40,33,y(39,30,a.data.order.createdAt,"dd/MM/yy HH:mm"),"N/A")," "),l(11),p(" ",y(51,39,y(50,36,a.data.order.delivery_date,"dd/MM/yyyy"),"No especificada")," "),l(3),s("ngIf",a.data.order.user==null?null:a.data.order.user.username),l(),s("ngIf",a.data.order.assigned_driver==null?null:a.data.order.assigned_driver.username),l(15),p(" ",y(69,42,a.data.order.recipient_name,"N/A")," "),l(10),p(" ",a.data.order.recipient_phone||"N/A"," "),l(),s("colspan",2),l(8),p(" ",y(88,45,a.data.order.delivery_address,"N/A")," "),l(10),p(" ",y(99,50,k(98,48,a.data.order.delivery_district_name),"N/A")," "),l(3),s("ngIf",a.data.order.delivery_coordinates),l(7),p(" ",y(108,53,a.data.order.item_description,"Sin descripci\xF3n del contenido.")," "),l(2),s("ngIf",a.data.order.package_size_type||a.data.order.package_weight_kg),l(2),s("ngIf",a.data.order.package_size_type),l(),s("ngIf",a.data.order.package_weight_kg),l(),s("ngIf",a.data.order.package_width_cm),l(15),p(" ",Ne(129,56,a.data.order.amount_to_collect_at_delivery||0,"PEN","S/ ","1.2-2")," "),l(10),p(" ",Ne(139,61,a.data.order.shipping_cost||0,"PEN","S/ ","1.2-2")," "),l(2),s("ngIf",a.data.order.payment_method_for_collection),l(),s("ngIf",a.data.order.observations||a.data.order.type_order_transfer_to_warehouse))},dependencies:[E,Ve,N,tt,et,it,G,de,be,Oe,xe,D,V,W,I,L,Me,ye,Ui,Li,zi,Gi,Bi,gr,ur,pr,Ge,ze,hr,fr,_r,Cr],styles:["[_nghost-%COMP%]{display:block}.dialog-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;max-height:calc(100vh - 80px)}.dialog-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:16px 24px;border-bottom:1px solid #e0e0e0;background-color:#f5f5f5}.dialog-header-draggable[_ngcontent-%COMP%]{cursor:move}h2.mat-mdc-dialog-title[_ngcontent-%COMP%]{margin:0;font-size:1.35em;font-weight:500;color:#455a64}.order-code-chip[_ngcontent-%COMP%]{font-size:.9em;color:#3f51b5;font-weight:500;margin-left:16px;flex-grow:1}.close-button[_ngcontent-%COMP%]{min-width:auto;padding:0;line-height:normal;color:#757575}.dialog-content[_ngcontent-%COMP%]{padding:20px 24px 24px;overflow-y:auto;flex-grow:1;background-color:#fff}.info-card[_ngcontent-%COMP%]{margin-bottom:24px;border:1px solid #eeeeee!important;box-shadow:none!important;border-radius:8px}.info-card[_ngcontent-%COMP%]:last-child{margin-bottom:0}.info-card[_ngcontent-%COMP%]   mat-card-header.compact-card-header[_ngcontent-%COMP%]{padding:12px 16px;display:flex;align-items:center;justify-content:space-between;background-color:#fafafa;border-bottom:1px solid #eeeeee}.info-card[_ngcontent-%COMP%]   mat-card-title[_ngcontent-%COMP%]{font-size:1.1em;font-weight:500;color:#546e7a;margin:0}.info-card[_ngcontent-%COMP%]   .status-badge-dialog[_ngcontent-%COMP%]{padding:4px 10px;border-radius:12px;font-size:.7rem;font-weight:600;text-transform:uppercase;color:#fff;line-height:1.2}.info-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]{padding:16px;font-size:.9rem}mat-grid-list[_ngcontent-%COMP%]{padding:0}mat-grid-tile[_ngcontent-%COMP%]     .mat-figure{align-items:flex-start;padding:8px}.detail-item[_ngcontent-%COMP%]{display:flex;align-items:center;width:100%;gap:10px}.detail-item[_ngcontent-%COMP%]   .detail-icon[_ngcontent-%COMP%]{color:#90a4ae;font-size:20px}.detail-item[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:flex;flex-direction:column;line-height:1.4}.interactive-detail-item[_ngcontent-%COMP%]{cursor:pointer}.interactive-detail-item[_ngcontent-%COMP%]:hover   .detail-value[_ngcontent-%COMP%]{color:#3f51b5;text-decoration:underline}.link-like[_ngcontent-%COMP%]{color:#5c6bc0;font-weight:500}.detail-label[_ngcontent-%COMP%]{font-size:.75em;color:#616161;margin-bottom:2px;font-weight:500;text-transform:uppercase;letter-spacing:.5px}.detail-value[_ngcontent-%COMP%]{color:#212121;word-break:break-word}.bold-value[_ngcontent-%COMP%]{font-weight:600;font-size:1.05em}.item-description[_ngcontent-%COMP%]{font-style:italic;color:#555;margin-bottom:12px;padding-bottom:12px;border-bottom:1px dashed #e0e0e0;font-size:.9em}.detail-block[_ngcontent-%COMP%]{margin-bottom:16px}.detail-block[_ngcontent-%COMP%]   .detail-label-block[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-size:.9em;font-weight:500;color:#607d8b;margin-bottom:6px}.detail-block[_ngcontent-%COMP%]   .detail-label-block[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px}.detail-block[_ngcontent-%COMP%]   .detail-value-block[_ngcontent-%COMP%]{font-size:.9em;color:#424242;padding-left:26px;white-space:pre-wrap}.dialog-actions[_ngcontent-%COMP%]{padding:16px 24px;border-top:1px solid #e0e0e0;background-color:#fafafa}.dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-left:8px}.dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-child{margin-left:0}.status-registrado[_ngcontent-%COMP%]{background-color:#6610f2;color:#fff}.status-recogido[_ngcontent-%COMP%]{background-color:#fd7e14;color:#fff}.status-en-almacen[_ngcontent-%COMP%]{background-color:#0d6efd;color:#fff}.status-en-transito[_ngcontent-%COMP%]{background-color:#0c1a77;color:#d0c8c8}.status-entregado[_ngcontent-%COMP%]{background-color:#198754;color:#fff}.status-no-entregado[_ngcontent-%COMP%]{background-color:#dc3545;color:#fff}.status-cancelado[_ngcontent-%COMP%]{background-color:#6c757d;color:#fff}.status-rechazado-en-punto[_ngcontent-%COMP%]{background-color:#ff6b6b;color:#fff}.status-reprogramado[_ngcontent-%COMP%]{background-color:#adb5bd;color:#212529}.status-desconocido[_ngcontent-%COMP%]{background-color:#9e9e9e;color:#fff}"]})};var Zr=(r,e)=>e.uid;function Yr(r,e){if(r&1&&(n(0,"div",23)(1,"p"),o(2," Actualmente asignado a: "),n(3,"strong"),o(4),i()()()),r&2){let t=e.ngIf;l(4),S(t)}}function en(r,e){r&1&&(n(0,"p",24),o(1," Este pedido a\xFAn no tiene un motorizado asignado. "),i())}function tn(r,e){if(r&1){let t=x();n(0,"button",25),g("click",function(){_(t);let d=u();return f(d.clearSelection())}),n(1,"mat-icon"),o(2,"close"),i()()}}function rn(r,e){r&1&&(n(0,"mat-icon",26),o(1,"person_search"),i())}function nn(r,e){r&1&&h(0,"mat-progress-spinner",27)}function on(r,e){if(r&1&&(n(0,"mat-option",16)(1,"div",28)(2,"mat-icon",29),o(3,"two_wheeler"),i(),n(4,"span"),o(5),i()()()),r&2){let t=e.$implicit;s("value",t),l(5),S(t.username)}}function an(r,e){r&1&&(n(0,"mat-option",17),o(1,"No se encontraron motorizados."),i())}function ln(r,e){r&1&&(n(0,"mat-error"),o(1," Debe seleccionar un motorizado. "),i())}function dn(r,e){if(r&1&&(n(0,"p",30),o(1," Motorizado seleccionado: "),n(2,"strong"),o(3),i()()),r&2){let t=u();l(3),S(t.selectedDriver.username)}}var li=class r{constructor(e,t){this.dialogRef=e;this.data=t;this.assignDriverForm=this.fb.group({}),this.filteredDrivers$=this.driverSearchCtrl.valueChanges.pipe(Ke(""),Qe(300),Pe(),ft(a=>(this.isLoadingDrivers=!0,console.log("searchTerm",a),this.orderService.getAvailableDrivers(a||"").pipe(ue(()=>this.isLoadingDrivers=!1),Te(()=>(this.isLoadingDrivers=!1,Ie([])))))),F(this.destroy$))}assignDriverForm;drivers$=Ie([]);isLoadingDrivers=!1;selectedDriver=null;driverSearchCtrl=new We("");filteredDrivers$;destroy$=new z;orderService=b(X);fb=b(he);ngOnInit(){this.data.currentDriverId&&this.data.order.assigned_driver&&(this.selectedDriver=this.data.order.assigned_driver,this.driverSearchCtrl.setValue(this.data.order.assigned_driver.username||"",{emitEvent:!1}))}displayDriverName(e){return e&&e.name?e.name:""}onDriverSelected(e){this.selectedDriver=e.option.value,console.log("Driver selected:",this.selectedDriver)}onConfirm(){this.selectedDriver?this.dialogRef.close({selectedDriver:this.selectedDriver}):console.warn("No driver selected")}onCancel(){this.dialogRef.close()}clearSelection(){this.selectedDriver=null,this.driverSearchCtrl.setValue("")}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(t){return new(t||r)(Y(ve),Y(Ue))};static \u0275cmp=M({type:r,selectors:[["app-assign-driver-dialog"]],decls:35,vars:19,consts:[["noDriverAssigned",""],["autoDriver","matAutocomplete"],["cdkDrag","","cdkDragRootElement",".cdk-overlay-pane","cdkDragHandle",".dialog-header-draggable",1,"dialog-container"],[1,"dialog-header","dialog-header-draggable"],["mat-dialog-title",""],[1,"order-code-chip"],[1,"dialog-content"],["class","current-assignment",4,"ngIf","ngIfElse"],[1,"content-divider"],["novalidate","",3,"formGroup"],["appearance","outline",1,"full-width","driver-search-field"],["type","text","placeholder","Escriba el nombre del motorizado...","aria-label","Motorizado","matInput","",3,"formControl","matAutocomplete"],["matSuffix","","mat-icon-button","","aria-label","Limpiar",3,"click",4,"ngIf"],["matSuffix","",4,"ngIf"],["matSuffix","","mode","indeterminate","diameter","20",4,"ngIf"],[3,"optionSelected","displayWith"],[3,"value"],["disabled",""],[4,"ngIf"],["class","selected-driver-info",4,"ngIf"],["align","end",1,"dialog-actions"],["mat-stroked-button","",1,"cancel-button",3,"click"],["mat-flat-button","","color","primary",1,"confirm-button",3,"click","disabled"],[1,"current-assignment"],[1,"no-driver-message"],["matSuffix","","mat-icon-button","","aria-label","Limpiar",3,"click"],["matSuffix",""],["matSuffix","","mode","indeterminate","diameter","20"],[1,"driver-option"],[1,"driver-option-icon"],[1,"selected-driver-info"]],template:function(t,a){if(t&1){let d=x();n(0,"div",2)(1,"div",3)(2,"h2",4),o(3,"Asignar / Cambiar Motorizado"),i(),n(4,"span",5),o(5),i()(),n(6,"mat-dialog-content",6)(7,"section"),c(8,Yr,5,1,"div",7)(9,en,2,0,"ng-template",null,0,Ye),i(),h(11,"mat-divider",8),n(12,"section")(13,"form",9)(14,"mat-form-field",10)(15,"mat-label"),o(16,"Buscar y Seleccionar Motorizado"),i(),h(17,"input",11),c(18,tn,3,0,"button",12)(19,rn,2,0,"mat-icon",13)(20,nn,1,0,"mat-progress-spinner",14),n(21,"mat-autocomplete",15,1),g("optionSelected",function(v){return _(d),f(a.onDriverSelected(v))}),vt(23,on,6,2,"mat-option",16,Zr),C(25,"async"),c(26,an,2,0,"mat-option",17),C(27,"async"),i(),c(28,ln,2,0,"mat-error",18),i()()(),c(29,dn,4,1,"p",19),i(),n(30,"mat-dialog-actions",20)(31,"button",21),g("click",function(){return _(d),f(a.onCancel())}),o(32," Cancelar "),i(),n(33,"button",22),g("click",function(){return _(d),f(a.onConfirm())}),o(34),i()()()}if(t&2){let d,m=R(10),v=R(22);l(5),p("Pedido N\xB0: ",a.data.order.code||a.data.order.id,""),l(3),s("ngIf",a.data.order.assigned_driver==null?null:a.data.order.assigned_driver.username)("ngIfElse",m),l(5),s("formGroup",a.assignDriverForm),l(4),s("formControl",a.driverSearchCtrl)("matAutocomplete",v),l(),s("ngIf",a.driverSearchCtrl.value&&!a.isLoadingDrivers),l(),s("ngIf",!a.driverSearchCtrl.value&&!a.isLoadingDrivers),l(),s("ngIf",a.isLoadingDrivers),l(),s("displayWith",a.displayDriverName),l(2),bt(k(25,15,a.filteredDrivers$)),l(3),K(((d=k(27,17,a.filteredDrivers$))==null?null:d.length)===0&&!a.isLoadingDrivers&&a.driverSearchCtrl.value?26:-1),l(2),s("ngIf",a.assignDriverForm.hasError("required","driverId")&&a.selectedDriver===null),l(),s("ngIf",a.selectedDriver),l(4),s("disabled",!a.selectedDriver||a.isLoadingDrivers),l(),p(" ",a.data.currentDriverId?"Reasignar":"Asignar"," Motorizado ")}},dependencies:[E,N,Le,$,_e,ie,U,re,nt,ne,de,be,Oe,xe,H,j,q,oe,Be,Ee,Se,Zt,Kt,Jt,le,ae,D,V,W,I,L,te,ee,At,ye],styles:["[_nghost-%COMP%]{display:block}.dialog-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;max-height:95vh;max-width:90%;padding:16px;box-shadow:0 4px 16px #0000001a}.dialog-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:16px 24px;margin-bottom:16px;border-bottom:1px solid var(--app-border-color);background-color:var(--app-background-dialog-header)}.dialog-header-draggable[_ngcontent-%COMP%]{cursor:move}h2.mat-mdc-dialog-title[_ngcontent-%COMP%]{margin:0;font-size:1.3em;font-weight:500;color:var(--app-blue-grey-700)}.order-code-chip[_ngcontent-%COMP%]{font-size:.85em;color:var(--app-indigo-500);font-weight:500;margin-left:12px;flex-grow:1}.close-button[_ngcontent-%COMP%]{min-width:auto;padding:0;line-height:normal;color:var(--app-gray-600)}.dialog-content[_ngcontent-%COMP%]{padding:20px 24px 24px;overflow-y:auto;flex-grow:1}.dialog-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:0;margin-bottom:8px;color:var(--app-text-default);font-size:.95em}.dialog-content[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-weight:500;color:var(--app-text-default)}.current-assignment[_ngcontent-%COMP%]{margin-bottom:16px;padding:10px;background-color:var(--app-blue-50);border-radius:4px;border-left:4px solid var(--app-blue-500)}.no-driver-message[_ngcontent-%COMP%]{font-style:italic;color:var(--app-orange-700);margin-bottom:16px}.content-divider[_ngcontent-%COMP%]{margin:16px 0;border-top-color:var(--app-border-color)}.full-width[_ngcontent-%COMP%]{width:100%}.driver-search-field[_ngcontent-%COMP%]{margin-bottom:8px}.driver-select-container[_ngcontent-%COMP%]{position:relative;min-height:90px}.spinner-container-small[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;padding:10px;color:var(--app-text-secondary);font-size:.9em}.spinner-container-small[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-left:8px}.mat-mdc-autocomplete-panel[_ngcontent-%COMP%]{max-height:250px!important}.driver-option[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}.driver-option[_ngcontent-%COMP%]   .driver-option-icon[_ngcontent-%COMP%]{color:var(--app-blue-grey-400)}.driver-option[_ngcontent-%COMP%]   .driver-status[_ngcontent-%COMP%]{font-size:.8em;font-style:italic;color:var(--app-orange-700);margin-left:auto}.selected-driver-info[_ngcontent-%COMP%]{margin-top:16px;margin-bottom:16px;padding:8px;background-color:var(--app-green-50);border-left:3px solid var(--app-green-500);border-radius:4px;font-size:.9em}.dialog-actions[_ngcontent-%COMP%]{padding:16px 24px;border-top:1px solid var(--app-border-color);background-color:var(--sys-surface-container-low);display:flex;flex-direction:row;justify-content:flex-end;gap:8px}@media (max-width: 480px){.dialog-actions[_ngcontent-%COMP%]{flex-direction:row-reverse}}.hidden[_ngcontent-%COMP%]{visibility:hidden;height:0;overflow:hidden}"]})};function sn(r,e){if(r&1&&(n(0,"strong"),o(1),C(2,"date"),i()),r&2){let t=u();l(),p(" ",y(2,1,t.data.order.delivery_date,"dd/MM/yyyy")," ")}}function mn(r,e){r&1&&(n(0,"span"),o(1,"No programada"),i())}function cn(r,e){r&1&&(n(0,"mat-error"),o(1,"Debe seleccionar una nueva fecha de entrega."),i())}function pn(r,e){r&1&&(n(0,"mat-error"),o(1,"El motivo no debe exceder los 250 caracteres."),i())}var di=class r{constructor(e,t){this.dialogRef=e;this.data=t;this.minDateForReschedule=this.data.minDate||new Date,this.data.minDate||this.minDateForReschedule.setDate(this.minDateForReschedule.getDate()+1),this.rescheduleForm=this.fb.group({newDeliveryDate:[this.data.order.delivery_date?new Date(this.data.order.delivery_date):null,O.required],reason:["",O.maxLength(250)]})}rescheduleForm;minDateForReschedule;formSubmitted=!1;fb=b(he);ngOnInit(){}get newDeliveryDateCtrl(){return this.rescheduleForm.get("newDeliveryDate")}get reasonCtrl(){return this.rescheduleForm.get("reason")}onConfirm(){this.formSubmitted=!0,this.rescheduleForm.valid?this.dialogRef.close({newDeliveryDate:this.newDeliveryDateCtrl?.value,reason:this.reasonCtrl?.value?.trim()||void 0}):this.rescheduleForm.markAllAsTouched()}onCancel(){this.dialogRef.close()}static \u0275fac=function(t){return new(t||r)(Y(ve),Y(Ue))};static \u0275cmp=M({type:r,selectors:[["app-reschedule-order-dialog"]],features:[Je([])],decls:39,vars:11,consts:[["noCurrentDate",""],["picker",""],["cdkDrag","","cdkDragRootElement",".cdk-overlay-pane","cdkDragHandle",".dialog-header-draggable",1,"dialog-container"],[1,"dialog-header","dialog-header-draggable"],["mat-dialog-title",""],[1,"order-code-chip"],["mat-icon-button","","aria-label","Cerrar di\xE1logo","matTooltip","Cerrar",1,"close-button",3,"click"],[3,"ngSubmit","formGroup"],[1,"dialog-content"],[4,"ngIf","ngIfElse"],[1,"content-divider"],["appearance","outline",1,"full-width","date-picker-field"],["matInput","","formControlName","newDeliveryDate","placeholder","Seleccione una fecha","readonly","","required","",3,"matDatepicker","min"],["matSuffix","",3,"for"],["appearance","outline",1,"full-width","reason-field"],["matInput","","formControlName","reason","rows","3","cdkTextareaAutosize","","cdkAutosizeMinRows","2","cdkAutosizeMaxRows","5","placeholder","Ej: Cliente solicit\xF3 cambio, Ruta congestionada..."],["align","end",1,"dialog-actions"],["mat-stroked-button","","type","button",1,"cancel-button",3,"click"],["mat-flat-button","","color","primary","type","submit",1,"confirm-button",3,"disabled"]],template:function(t,a){if(t&1){let d=x();n(0,"div",2)(1,"div",3)(2,"h2",4),o(3,"Reprogramar Pedido"),i(),n(4,"span",5),o(5),i(),n(6,"button",6),g("click",function(){return _(d),f(a.onCancel())}),n(7,"mat-icon"),o(8,"close"),i()()(),n(9,"form",7),g("ngSubmit",function(){return _(d),f(a.onConfirm())}),n(10,"mat-dialog-content",8)(11,"p"),o(12," Cliente: "),n(13,"strong"),o(14),i()(),n(15,"p"),o(16," Fecha de Entrega Actual: "),c(17,sn,3,4,"strong",9)(18,mn,2,0,"ng-template",null,0,Ye),i(),h(20,"mat-divider",10),n(21,"mat-form-field",11)(22,"mat-label"),o(23,"Nueva Fecha de Entrega"),i(),h(24,"input",12)(25,"mat-datepicker-toggle",13)(26,"mat-datepicker",null,1),c(28,cn,2,0,"mat-error"),i(),n(29,"mat-form-field",14)(30,"mat-label"),o(31,"Motivo de Reprogramaci\xF3n (Opcional)"),i(),h(32,"textarea",15),c(33,pn,2,0,"mat-error"),i()(),n(34,"mat-dialog-actions",16)(35,"button",17),g("click",function(){return _(d),f(a.onCancel())}),o(36," Cancelar "),i(),n(37,"button",18),o(38," Confirmar Reprogramaci\xF3n "),i()()()()}if(t&2){let d=R(19),m=R(27);l(5),p("Pedido N\xB0: ",a.data.order.code||a.data.order.id,""),l(4),s("formGroup",a.rescheduleForm),l(5),S(a.data.order.recipient_name),l(3),s("ngIf",a.data.order.delivery_date)("ngIfElse",d),l(7),s("matDatepicker",m)("min",a.minDateForReschedule),l(),s("for",m),l(3),K(a.newDeliveryDateCtrl!=null&&a.newDeliveryDateCtrl.hasError("required")&&(a.newDeliveryDateCtrl!=null&&a.newDeliveryDateCtrl.touched||a.newDeliveryDateCtrl!=null&&a.newDeliveryDateCtrl.dirty||a.formSubmitted)?28:-1),l(5),K(a.reasonCtrl!=null&&a.reasonCtrl.hasError("maxlength")?33:-1),l(4),s("disabled",a.rescheduleForm.invalid)}},dependencies:[E,N,G,$,_e,ie,U,re,St,ne,fe,de,be,Oe,xe,H,j,q,oe,Be,le,ae,Dt,D,V,W,I,L,st,at,lt,dt,Rt,Me,ye],styles:["[_nghost-%COMP%]{display:block}.dialog-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;max-height:85vh;width:480px;max-width:90vw}.dialog-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:16px 24px}.dialog-header-draggable[_ngcontent-%COMP%]{cursor:move}h2.mat-mdc-dialog-title[_ngcontent-%COMP%]{margin:0;font-size:1.3em;font-weight:500}.order-code-chip[_ngcontent-%COMP%]{font-size:.85em;font-weight:500;margin-left:12px;flex-grow:1}.close-button[_ngcontent-%COMP%]{min-width:auto;padding:0;line-height:normal}.dialog-content[_ngcontent-%COMP%]{padding:20px 24px 10px;overflow-y:auto;flex-grow:1}.dialog-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:0;margin-bottom:8px;font-size:.95em}.dialog-content[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-weight:500}.content-divider[_ngcontent-%COMP%]{margin:16px 0 20px}.full-width[_ngcontent-%COMP%]{width:100%}.date-picker-field[_ngcontent-%COMP%]{margin-bottom:20px}.reason-field[_ngcontent-%COMP%]{margin-top:10px}.reason-field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{min-height:50px}.dialog-actions[_ngcontent-%COMP%]{padding:16px 24px}.dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-left:8px}.dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-child{margin-left:0}"]})};var _n=()=>[10,25,50,100],fn=()=>({"highlight-row":!1});function hn(r,e){r&1&&(n(0,"div",27),h(1,"mat-progress-spinner",28),i())}function Cn(r,e){r&1&&(n(0,"th",29),o(1,"N\xB0 Pedido"),i())}function vn(r,e){if(r&1){let t=x();n(0,"td",30)(1,"a",31),g("click",function(){let d=_(t).$implicit,m=u();return f(m.onViewOrderDetails(d))}),o(2),i()()}if(r&2){let t=e.$implicit;l(2),S(t.code)}}function bn(r,e){r&1&&(n(0,"th",29),o(1,"Empresa"),i())}function xn(r,e){if(r&1&&(n(0,"td",32),o(1),i()),r&2){let t=e.$implicit;s("matTooltip",t.company==null?null:t.company.username),l(),p(" ",t.company==null?null:t.company.username," ")}}function On(r,e){r&1&&(n(0,"th",29),o(1,"Tipo"),i())}function yn(r,e){if(r&1&&(n(0,"td",33),o(1),i()),r&2){let t=e.$implicit;l(),p(" ",t.shipment_type," ")}}function Mn(r,e){r&1&&(n(0,"th",29),o(1,"Destinatario"),i())}function Sn(r,e){if(r&1&&(n(0,"td",32),o(1),i()),r&2){let t=e.$implicit;s("matTooltip",t.recipient_name),l(),p(" ",t.recipient_name," ")}}function En(r,e){r&1&&(n(0,"th",34),o(1," Estado "),i())}function Dn(r,e){if(r&1&&(n(0,"td",33)(1,"span",35),o(2),i()()),r&2){let t=e.$implicit,a=u();l(),s("ngClass",a.getStatusClass(t.status)),l(),p(" ",t.status," ")}}function Pn(r,e){r&1&&(n(0,"th",29),o(1,"Distrito"),i())}function wn(r,e){if(r&1&&(n(0,"td",33),o(1),i()),r&2){let t=e.$implicit;l(),p(" ",t.delivery_district_name," ")}}function kn(r,e){r&1&&(n(0,"th",29),o(1," F. Entrega Prog. "),i())}function In(r,e){if(r&1&&(n(0,"td",33),o(1),C(2,"date"),i()),r&2){let t=e.$implicit;l(),p(" ",t.delivery_date?y(2,1,t.delivery_date,"dd/MM/yy"):"-"," ")}}function Tn(r,e){r&1&&(n(0,"th",36),o(1," Cobrar "),i())}function Fn(r,e){if(r&1&&(n(0,"td",37),o(1),C(2,"currency"),i()),r&2){let t=e.$implicit;l(),p(" ",Ne(2,1,t.amount_to_collect_at_delivery,"PEN","S/ ","1.2-2")," ")}}function An(r,e){r&1&&(n(0,"th",29),o(1,"Codigo Tracking"),i())}function Rn(r,e){if(r&1&&(n(0,"td",33),o(1),i()),r&2){let t=e.$implicit;l(),p(" ",t.tracking_code," ")}}function Nn(r,e){r&1&&(n(0,"th",38),o(1," Acciones "),i())}function Vn(r,e){if(r&1){let t=x();n(0,"button",42),g("click",function(){_(t);let d=u().$implicit,m=u();return f(m.openChangeStatusModal(d))}),n(1,"mat-icon"),o(2,"swap_horiz"),i(),n(3,"span"),o(4,"Cambiar Estado General"),i()()}}function Ln(r,e){if(r&1){let t=x();n(0,"button",42),g("click",function(){_(t);let d=u().$implicit,m=u();return f(m.openRescheduleOrderModal(d))}),n(1,"mat-icon"),o(2,"event_repeat"),i(),n(3,"span"),o(4,"Reprogramar"),i()()}}function Bn(r,e){if(r&1){let t=x();n(0,"button",42),g("click",function(){_(t);let d=u().$implicit,m=u();return f(m.openAssignDriverModal(d))}),n(1,"mat-icon"),o(2,"person_pin_circle"),i(),n(3,"span"),o(4),i()()}if(r&2){let t=u().$implicit;l(4),p("",t.assigned_driver?"Reasignar":"Asignar"," Motorizado")}}function zn(r,e){if(r&1){let t=x();n(0,"td",39)(1,"button",40)(2,"mat-icon"),o(3,"more_vert"),i()(),n(4,"mat-menu",41,0)(6,"button",42),g("click",function(){let d=_(t).$implicit,m=u();return f(m.onViewOrderDetails(d))}),n(7,"mat-icon"),o(8,"visibility"),i(),n(9,"span"),o(10,"Ver Detalles Completos"),i()(),c(11,Vn,5,0,"button",43)(12,Ln,5,0,"button",43)(13,Bn,5,1,"button",43),n(14,"button",42),g("click",function(){let d=_(t).$implicit,m=u();return f(m.onViewPdfA4(d))}),n(15,"mat-icon"),o(16,"picture_as_pdf"),i(),n(17,"span"),o(18,"PDF formato A4"),i()(),n(19,"button",42),g("click",function(){let d=_(t).$implicit,m=u();return f(m.onViewPdfA4Landscape(d))}),n(20,"mat-icon"),o(21,"picture_as_pdf"),i(),n(22,"span"),o(23,"PDF formato A4 Landscape"),i()(),n(24,"button",42),g("click",function(){let d=_(t).$implicit,m=u();return f(m.onViewPdfTicket80mm(d))}),n(25,"mat-icon"),o(26,"picture_as_pdf"),i(),n(27,"span"),o(28,"PDF formato ticket"),i()(),n(29,"button",42),g("click",function(){let d=_(t).$implicit,m=u();return f(m.onSeguimiento(d))}),n(30,"mat-icon"),o(31,"timeline"),i(),n(32,"span"),o(33,"Seguimiento"),i()()()()}if(r&2){let t=R(5),a=u();l(),s("matMenuTriggerFor",t),l(10),s("ngIf",a.isAdminOrDriver()),l(),s("ngIf",a.isAdminOrReceptionist()),l(),s("ngIf",a.isAdminUser())}}function Gn(r,e){r&1&&h(0,"tr",44)}function Un(r,e){r&1&&h(0,"tr",45),r&2&&s("ngClass",Ze(1,fn))}function $n(r,e){if(r&1&&(n(0,"tr",46)(1,"td",47),o(2," No se encontraron pedidos que coincidan con los filtros. "),i()()),r&2){let t=u();l(),wi("colspan",t.displayedColumns.length)}}var si=class r{appStore=b(Pt);orders=[];isLoading=!1;totalCount=0;pageSize=10;pageIndex=0;pageChanged=new A;sortChanged=new A;statusChanged=new A;motorizedChanged=new A;rescheduleChanged=new A;viewPdfClicked=new A;viewDetailsClicked=new A;displayedColumns=["code","company","shipment_type","recipient_name","status","delivery_district_name","delivery_date","amount_to_collect_at_delivery","tracking_code","actions"];dataSource=new or;paginator;sort;dialog=b(Ft);snackBar=b(Ce);OrderStatus=Xe;constructor(){}ngOnChanges(e){e.orders&&this.orders&&(this.dataSource.data=this.orders)}ngAfterViewInit(){}canMarkAs(e,t){let a=e.status;return!1}onViewPdfA4(e){let t=rt.apiUrl+"/orders/"+e.id+"/pdf-a4";window.open(t,"_blank")}onViewPdfA4Landscape(e){let t=rt.apiUrl+"/orders/"+e.id+"/pdf-a4-landscape";window.open(t,"_blank")}onViewPdfTicket80mm(e){let t=rt.apiUrl+"/orders/"+e.id+"/pdf-ticket-80mm";window.open(t,"_blank")}onSeguimiento(e){window.open("/tracking?code="+e.tracking_code,"_blank")}changeOrderStatus(e,t){console.log(`Changing status of order ${e.code} to ${t}`),this.statusChanged.emit({orderId:e.id,newStatus:t})}getStatusClass(e){return e?`status-${e.toLowerCase().replace(/[\s_]+/g,"-")}`:"status-desconocido"}openChangeStatusModal(e){let t=this.getAvailableStatuses(e);if(t.length===0){this.snackBar.open("No hay cambios de estado disponibles para este pedido.","OK",{duration:3e3});return}this.dialog.open(ri,{width:"450px",data:{order:e,availableStatuses:t},disableClose:!0}).afterClosed().subscribe(d=>{if(d&&d.newStatus){console.log("Dialog result:",d);let m={newStatus:d.newStatus,reason:d.reason||"",proofOfDeliveryImageUrl:"",shippingCostPaymentMethod:"",collectionPaymentMethod:""};d.newStatus==="ENTREGADO"&&(d.proofOfDeliveryImageUrl&&(m.proofOfDeliveryImageUrl=d.proofOfDeliveryImageUrl),d.shippingCostPaymentMethod&&(m.shippingCostPaymentMethod=d.shippingCostPaymentMethod),d.collectionPaymentMethod&&(m.collectionPaymentMethod=d.collectionPaymentMethod)),console.log("updatePayload",m),this.statusChanged.emit(He({orderId:e.id},m))}else console.log("Cambio de estado cancelado o sin selecci\xF3n.")})}getAvailableStatuses(e){switch(e.status){case"REGISTRADO":return["RECOGIDO","EN ALMACEN","CANCELADO"];case"RECOGIDO":return["EN ALMACEN","CANCELADO"];case"EN ALMACEN":return["EN TRANSITO","CANCELADO"];case"EN TRANSITO":case"EN TRANSITO":return["ENTREGADO","CANCELADO","RECHAZADO EN PUNTO","REPROGRAMADO"];case"REPROGRAMADO":return["EN TRANSITO","CANCELADO"];default:return[]}}openReportIssueModal(e){console.log(`Open modal to report issue for order: ${e.code}`)}onViewOrderDetails(e){this.viewDetailsClicked.emit(e),this.dialog.open(ai,{width:"750px",maxWidth:"90vw",maxHeight:"90vh",data:{order:e},panelClass:"order-detail-dialog-responsive",autoFocus:"dialog"})}onUploadProof(e){console.log("Upload proof for order:",e.code),this.snackBar.open('Funci\xF3n "Subir Prueba" no implementada.',"OK",{duration:2e3})}onReschedule(e){console.log("Reschedule order:",e.code),this.snackBar.open('Funci\xF3n "Reprogramar" no implementada.',"OK",{duration:2e3})}openAssignDriverModal(e){console.log(`Open modal to assign driver for order: ${e.code}`),this.dialog.open(li,{width:"550px",data:{order:e,currentDriverId:e.assigned_driver?.uid},disableClose:!0}).afterClosed().subscribe(a=>{a&&a.selectedDriver?(console.log("Driver selected from dialog:",e.id,a.selectedDriver),this.motorizedChanged.emit({orderId:e.id,motorizedId:a.selectedDriver.id})):console.log("Assign driver cancelled or no driver selected.")})}openRescheduleOrderModal(e){console.log(`Open modal to reschedule order: ${e.code}`);let t=new Date;t.setDate(t.getDate()+1),this.dialog.open(di,{width:"500px",data:{order:e,minDate:t},disableClose:!0}).afterClosed().subscribe(d=>{d&&d.newDeliveryDate?(console.log("Reschedule details from dialog:",d),this.rescheduleChanged.emit({orderId:e.id,newDate:d.newDeliveryDate,reason:d.reason})):console.log("Reschedule cancelled or no new date selected.")})}isAdminOrDriver(){let e=this.appStore.currentUser()?.role;return e==="ADMINISTRADOR"||e==="MOTORIZADO"}isAdminOrReceptionist(){let e=this.appStore.currentUser()?.role;return e==="ADMINISTRADOR"||e==="RECEPCIONISTA"}isAdminUser(){return this.appStore.currentUser()?.role==="ADMINISTRADOR"}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=M({type:r,selectors:[["app-order-table"]],viewQuery:function(t,a){if(t&1&&(Fe(Xt,5),Fe(Qt,5)),t&2){let d;Ae(d=Re())&&(a.paginator=d.first),Ae(d=Re())&&(a.sort=d.first)}},inputs:{orders:"orders",isLoading:"isLoading",totalCount:"totalCount",pageSize:"pageSize",pageIndex:"pageIndex"},outputs:{pageChanged:"pageChanged",sortChanged:"sortChanged",statusChanged:"statusChanged",motorizedChanged:"motorizedChanged",rescheduleChanged:"rescheduleChanged",viewPdfClicked:"viewPdfClicked",viewDetailsClicked:"viewDetailsClicked"},features:[Pi],decls:37,vars:10,consts:[["orderActionMenu","matMenu"],[1,"table-wrapper","mat-elevation-z4"],["class","spinner-overlay",4,"ngIf"],["mat-table","","matSort","",1,"orders-table",3,"matSortChange","dataSource"],["matColumnDef","code"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","","class","code-cell",4,"matCellDef"],["matColumnDef","company"],["mat-cell","","class","truncate-texts",3,"matTooltip",4,"matCellDef"],["matColumnDef","shipment_type"],["mat-cell","",4,"matCellDef"],["matColumnDef","recipient_name"],["matColumnDef","status"],["mat-header-cell","","mat-sort-header","","class","status-column-header",4,"matHeaderCellDef"],["matColumnDef","delivery_district_name"],["matColumnDef","delivery_date"],["matColumnDef","amount_to_collect_at_delivery"],["mat-header-cell","","mat-sort-header","","class","align-right",4,"matHeaderCellDef"],["mat-cell","","class","align-right amount-cell",4,"matCellDef"],["matColumnDef","tracking_code"],["matColumnDef","actions"],["mat-header-cell","","class","actions-column-header",4,"matHeaderCellDef"],["mat-cell","","class","actions-cell",4,"matCellDef"],["mat-header-row","","class","header-row-sticky",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","","class","data-row",3,"ngClass",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["showFirstLastButtons","","aria-label","Seleccione p\xE1gina de pedidos",3,"page","length","pageSize","pageIndex","pageSizeOptions"],[1,"spinner-overlay"],["mode","indeterminate","diameter","60"],["mat-header-cell","","mat-sort-header",""],["mat-cell","",1,"code-cell"],["matTooltip","Ver detalles del pedido",3,"click"],["mat-cell","",1,"truncate-texts",3,"matTooltip"],["mat-cell",""],["mat-header-cell","","mat-sort-header","",1,"status-column-header"],[1,"status-badge",3,"ngClass"],["mat-header-cell","","mat-sort-header","",1,"align-right"],["mat-cell","",1,"align-right","amount-cell"],["mat-header-cell","",1,"actions-column-header"],["mat-cell","",1,"actions-cell"],["mat-icon-button","","aria-label","M\xE1s acciones del pedido",1,"action-icon-neutral",3,"matMenuTriggerFor"],["xPosition","before"],["mat-menu-item","",3,"click"],["mat-menu-item","",3,"click",4,"ngIf"],["mat-header-row","",1,"header-row-sticky"],["mat-row","",1,"data-row",3,"ngClass"],[1,"mat-row"],[1,"no-data-cell"]],template:function(t,a){t&1&&(n(0,"div",1),c(1,hn,2,0,"div",2),n(2,"table",3),g("matSortChange",function(m){return a.sortChanged.emit(m)}),P(3,4),c(4,Cn,2,0,"th",5)(5,vn,3,1,"td",6),w(),P(6,7),c(7,bn,2,0,"th",5)(8,xn,2,2,"td",8),w(),P(9,9),c(10,On,2,0,"th",5)(11,yn,2,1,"td",10),w(),P(12,11),c(13,Mn,2,0,"th",5)(14,Sn,2,2,"td",8),w(),P(15,12),c(16,En,2,0,"th",13)(17,Dn,3,2,"td",10),w(),P(18,14),c(19,Pn,2,0,"th",5)(20,wn,2,1,"td",10),w(),P(21,15),c(22,kn,2,0,"th",5)(23,In,3,4,"td",10),w(),P(24,16),c(25,Tn,2,0,"th",17)(26,Fn,3,6,"td",18),w(),P(27,19),c(28,An,2,0,"th",5)(29,Rn,2,1,"td",10),w(),P(30,20),c(31,Nn,2,0,"th",21)(32,zn,34,4,"td",22),w(),c(33,Gn,1,0,"tr",23)(34,Un,1,2,"tr",24)(35,$n,3,1,"tr",25),i(),n(36,"mat-paginator",26),g("page",function(m){return a.pageChanged.emit(m)}),i()()),t&2&&(l(),s("ngIf",a.isLoading),l(),s("dataSource",a.dataSource),l(31),s("matHeaderRowDef",a.displayedColumns)("matHeaderRowDefSticky",!0),l(),s("matRowDefColumns",a.displayedColumns),l(2),s("length",a.totalCount)("pageSize",a.pageSize)("pageIndex",a.pageIndex)("pageSizeOptions",Ze(9,_n)))},dependencies:[E,Ve,N,it,G,Wt,Vt,Bt,$t,zt,Lt,qt,Gt,Ut,jt,Ht,nr,ar,Xt,dr,Qt,lr,te,ee,D,W,I,L,Ge,ze,Tt,kt,wt,It,de,ot,Me],styles:["[_nghost-%COMP%]{display:block}.table-wrapper[_ngcontent-%COMP%]{position:relative;overflow:auto;border-radius:12px;background-color:var(--sys-surface);color:var(--sys-on-surface);margin-top:20px;box-shadow:0 4px 20px #00000014;transition:box-shadow .3s ease-in-out}.table-wrapper[_ngcontent-%COMP%]:hover{box-shadow:0 6px 25px #0000001f}.spinner-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background-color:rgba(var(--sys-surface),.85);display:flex;justify-content:center;align-items:center;z-index:100;border-radius:12px}.orders-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}th.mat-header-cell[_ngcontent-%COMP%]{font-weight:600;color:var(--sys-on-surface-variant);background-color:var(--sys-surface-container-low);padding:14px 18px;border-bottom:1px solid var(--sys-outline-variant);text-transform:uppercase;font-size:.8rem;letter-spacing:.5px}td.mat-cell[_ngcontent-%COMP%]{padding:12px 18px;border-bottom:1px solid var(--sys-outline-variant);color:var(--sys-on-surface-variant);font-size:.9rem}.header-row-sticky[_ngcontent-%COMP%]{position:sticky;top:0;z-index:10;background-color:var(--sys-surface-container-low)}.data-row[_ngcontent-%COMP%]{transition:background-color .2s ease-in-out}.data-row[_ngcontent-%COMP%]:hover{background-color:var(--sys-surface-container-highest);cursor:pointer}.highlight-row[_ngcontent-%COMP%]{background-color:var(--sys-primary-container)!important;font-weight:500}.align-right[_ngcontent-%COMP%]{text-align:right;justify-content:flex-end}.amount-cell[_ngcontent-%COMP%]{font-weight:500}.actions-column-header[_ngcontent-%COMP%]{text-align:center!important}.actions-cell[_ngcontent-%COMP%]{text-align:center;white-space:nowrap}.actions-cell[_ngcontent-%COMP%]   button.mat-icon-button[_ngcontent-%COMP%]{margin:0 2px;color:var(--sys-on-surface-variant);transition:color .2s ease}.actions-cell[_ngcontent-%COMP%]   button.mat-icon-button[_ngcontent-%COMP%]:hover{color:var(--sys-primary)}.action-icon-delivered[_ngcontent-%COMP%]{color:#4caf50}.action-icon-delivered[_ngcontent-%COMP%]:hover{color:#388e3c}.action-icon-neutral[_ngcontent-%COMP%]{color:var(--sys-on-surface-variant)}.action-icon-neutral[_ngcontent-%COMP%]:hover{color:var(--sys-on-surface)}.no-data-cell[_ngcontent-%COMP%]{text-align:center;padding:50px;font-style:italic;color:var(--sys-on-surface-variant);font-size:1rem}.mat-mdc-paginator[_ngcontent-%COMP%]{background-color:var(--sys-surface-container-low);border-bottom-left-radius:12px;border-bottom-right-radius:12px;color:var(--sys-on-surface-variant);border-top:1px solid var(--sys-outline-variant);padding:8px 0}.truncate-text[_ngcontent-%COMP%]{max-width:180px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:inline-block;vertical-align:middle}.code-cell[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#3f51b5;text-decoration:none;font-weight:500}.code-cell[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}.status-badge[_ngcontent-%COMP%]{padding:5px 12px;border-radius:16px;font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.5px;display:inline-flex;align-items:center;line-height:1}.status-registrado[_ngcontent-%COMP%]{background-color:var(--status-registrado-bg);color:var(--status-registrado-color)}.status-recogido[_ngcontent-%COMP%]{background-color:var(--status-recogido-bg);color:var(--status-recogido-color)}.status-en-almacen[_ngcontent-%COMP%]{background-color:var(--status-en-almacen-bg);color:var(--status-en-almacen-color);white-space:nowrap}.status-en-transito[_ngcontent-%COMP%]{background-color:var(--status-en-transito-bg);color:var(--status-en-transito-color);white-space:nowrap}.status-entregado[_ngcontent-%COMP%]{background-color:var(--status-entregado-bg);color:var(--status-entregado-color)}.status-no-entregado[_ngcontent-%COMP%]{background-color:var(--status-no-entregado-bg);color:var(--status-no-entregado-color);white-space:nowrap}.status-cancelado[_ngcontent-%COMP%]{background-color:var(--status-cancelado-bg);color:var(--status-cancelado-color)}.status-rechazado-en-punto[_ngcontent-%COMP%]{background-color:var(--status-rechazado-bg);color:var(--status-rechazado-color);white-space:nowrap}.status-reprogramado[_ngcontent-%COMP%]{background-color:var(--status-reprogramado-bg);color:var(--status-reprogramado-color)}@media (max-width: 768px){th.mat-header-cell[_ngcontent-%COMP%], td.mat-cell[_ngcontent-%COMP%]{padding:8px 12px;font-size:.75rem}}"]})};var jn=(r,e)=>({"success-message":r,"error-message":e});function Hn(r,e){if(r&1&&(n(0,"span",17),o(1),i()),r&2){let t=u();l(),S(t.fileName)}}function Wn(r,e){if(r&1&&(n(0,"div",18)(1,"p"),o(2),i(),h(3,"mat-progress-bar",19),i()),r&2){let t=u();l(2),p("Importando archivo... ",t.uploadProgress,"%"),l(),s("value",t.uploadProgress)}}function Xn(r,e){if(r&1&&(n(0,"div",26)(1,"mat-icon",27),o(2,"error_outline"),i(),n(3,"div",28),o(4),i()()),r&2){let t=e.$implicit;l(4),ki(" Fila ",t.row,": ",t.message," ")}}function Qn(r,e){if(r&1&&(n(0,"div",23)(1,"h4"),o(2,"Detalles de Errores:"),i(),n(3,"mat-list",24),c(4,Xn,5,2,"div",25),i()()),r&2){let t=u(2);l(4),s("ngForOf",t.importResult.errors)}}function Kn(r,e){if(r&1&&(n(0,"div",20)(1,"h3",21),o(2),i(),c(3,Qn,5,1,"div",22),i()),r&2){let t=u();l(),s("ngClass",Ti(3,jn,t.importResult.success,!t.importResult.success)),l(),p(" ",t.importResult.message," "),l(),s("ngIf",t.importResult.errors&&t.importResult.errors.length>0)}}var Jn={"TIPO DE ENVIO":"type_order_transfer_to_warehouse","NOMBRE DEL DESTINATARIO":"recipient_name","TELEFONO DESTINATARIO 9 DIGITOS":"recipient_phone",DISTRITO:"delivery_district_name","DIRECCION DE ENTREGA":"delivery_address","FECHA DE ENTREGA (DIA/MES/A\xD1O)":"delivery_date","DETALLE DEL PRODUCTO":"item_description","MONTO A COBRAR":"amount_to_collect_at_delivery","FORMA DE PAGO":"payment_method_for_collection",OBSERVACION:"observations"},Ls=Object.keys(Jn),mi=class r{importCompleted=new A;selectedFile=null;fileName=null;isUploading=!1;uploadProgress=0;importResult=null;orderService=b(X);snackBar=b(Ce);dialogRef=b(ve);settingsService=b(Yi);destroy$=new z;enlace=null;constructor(){}ngOnInit(){this.settingsService.loadSettings().pipe(F(this.destroy$)).subscribe({next:e=>{e.length&&(this.enlace=e[0].excel_import_template_url)},error:e=>{console.log("err",e)}})}onFileSelected(e){let a=e.currentTarget.files;a&&a.length>0?(this.selectedFile=a[0],this.fileName=this.selectedFile.name,this.importResult=null,console.log("File selected:",this.selectedFile)):(this.selectedFile=null,this.fileName=null)}downloadTemplate(){return this.snackBar.open("Plantilla con validaci\xF3n descargada.","OK",{duration:2e3}),this.enlace||""}processImport(){return ke(this,null,function*(){if(!this.selectedFile){this.snackBar.open("Por favor, selecciona un archivo Excel.","OK",{duration:3e3,panelClass:["warn-snackbar"]});return}this.isUploading=!0,this.uploadProgress=0,this.importResult=null;let e=setInterval(()=>{this.uploadProgress<90&&(this.uploadProgress+=10)},200);try{let t=yield this.readFileAndParseToJson(this.selectedFile);if(t=t.filter(a=>a.CARGA==="CARGAR"),console.log("Parsed Excel to JSON:",t),t.length===0)throw new Error("El archivo Excel no contiene datos (despu\xE9s de las cabeceras) o el formato es incorrecto.");this.orderService.importOrdersFromParsedJson(t).subscribe({next:a=>{clearInterval(e),this.uploadProgress=100,this.importResult=a,a.success&&a.importedCount&&a.importedCount>0?(this.snackBar.open(a.message,"OK",{duration:4e3,panelClass:["success-snackbar"]}),this.importCompleted.emit(!0)):(this.snackBar.open(a.message||"Algunos pedidos no pudieron ser importados o hubo errores.","OK",{duration:6e3,panelClass:["warn-snackbar"]}),a.errors&&a.errors.length>0&&console.warn("Import errors from backend:",a.errors)),this.isUploading=!1},error:a=>{clearInterval(e),this.isUploading=!1,this.uploadProgress=0,this.importResult={success:!1,message:a.message||"Error en el servidor durante la importaci\xF3n."},this.snackBar.open(this.importResult.message,"OK",{duration:3e3,panelClass:["error-snackbar"]}),console.error("Error importing orders:",a)}})}catch(t){clearInterval(e),this.isUploading=!1,this.uploadProgress=0,this.importResult={success:!1,message:t.message||"Error al procesar el archivo Excel."},this.snackBar.open(this.importResult.message,"OK",{duration:3e3,panelClass:["error-snackbar"]}),console.error("Error processing file:",t)}})}readFileAndParseToJson(e){return new Promise((t,a)=>{if(!e){a(new Error("No se proporcion\xF3 ning\xFAn archivo."));return}let d=new FileReader;d.onload=m=>{try{let v=m.target.result,Z=vr(v,{type:"binary",cellDates:!0}),T=Z.SheetNames[0];if(!T){a(new Error("El archivo Excel no contiene hojas."));return}let Q=Z.Sheets[T],B=Yt.sheet_to_json(Q,{raw:!1,defval:null});t(B.filter(pe=>Object.values(pe).some(qe=>qe!==null&&qe!=="")))}catch(v){console.error("Error al leer el contenido de la hoja de Excel:",v),a(new Error("No se pudo leer el contenido de la hoja de Excel. Formato incorrecto."))}},d.onerror=m=>{console.error("Error en FileReader:",m),a(new Error("Ocurri\xF3 un error al intentar leer el archivo."))},d.readAsBinaryString(e)})}closeDialog(){this.dialogRef.close()}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=M({type:r,selectors:[["app-order-import-modal"]],outputs:{importCompleted:"importCompleted"},decls:107,vars:8,consts:[["fileInput",""],[1,"import-modal-container"],["mat-dialog-title",""],[1,"mat-typography"],[1,"instructions"],[2,"margin-bottom","10px"],["mat-stroked-button","","color","accent","target","_blank","matTooltip","Descargar la plantilla en formato .xlsx (.xls tambi\xE9n soportado)",1,"template-button",3,"href"],[1,"column-descriptions"],[1,"file-input-container"],["mat-raised-button","","color","primary",3,"click","disabled"],["hidden","","type","file","accept",".xlsx, .xls",3,"change"],["class","file-name-display",4,"ngIf"],["class","upload-progress-container",4,"ngIf"],["class","import-results",4,"ngIf"],["align","end"],["mat-stroked-button","",3,"click","disabled"],["mat-flat-button","","color","primary",3,"click","disabled"],[1,"file-name-display"],[1,"upload-progress-container"],["mode","determinate",3,"value"],[1,"import-results"],[3,"ngClass"],["class","error-details",4,"ngIf"],[1,"error-details"],["dense",""],["class","error-item",4,"ngFor","ngForOf"],[1,"error-item"],["matListItemIcon","","color","warn"],[2,"overflow-wrap","break-word !important"]],template:function(t,a){if(t&1){let d=x();n(0,"div",1)(1,"h2",2),o(2,"Importar Pedidos desde Excel"),i(),n(3,"mat-dialog-content",3)(4,"p",4),o(5," Sigue estos pasos para importar tus pedidos de forma masiva: "),i(),n(6,"ol")(7,"li")(8,"div",5),o(9," Descarga la plantilla de Excel para asegurar el formato correcto de los datos. "),i(),n(10,"a",6)(11,"mat-icon"),o(12,"cloud_download"),i(),o(13," Descargar Plantilla "),i()(),n(14,"li"),o(15," Completa la plantilla con la informaci\xF3n de tus pedidos. Aseg\xFArate de que el orden y nombre de las columnas coincidan con la plantilla. "),i(),n(16,"li")(17,"strong"),o(18,"Descripci\xF3n de las Columnas Esperadas en la Plantilla:"),i(),n(19,"ul",7)(20,"li")(21,"strong"),o(22,"TIPO DE ENVIO:"),i(),o(23," Indica la modalidad del env\xEDo. Valores comunes: "),n(24,"code"),o(25,"CONTRAENTREGA"),i(),o(26,", "),n(27,"code"),o(28,"SOLO-ENTREGA-NO-COBRAR"),i(),o(29,". *(Esta columna podr\xEDa tener una lista desplegable en la plantilla).* "),i(),n(30,"li")(31,"strong"),o(32,"NOMBRE DEL DESTINATARIO:"),i(),o(33," Nombre completo de la persona que recibir\xE1 el pedido. "),i(),n(34,"li")(35,"strong"),o(36,"TELEFONO DESTINATARIO 9 DIGITOS:"),i(),o(37," N\xFAmero de celular del destinatario, debe contener exactamente 9 d\xEDgitos. "),i(),n(38,"li")(39,"strong"),o(40,"DISTRITO (SELECCIONE SOLO DEL LISTADO):"),i(),o(41," El distrito de entrega. Es crucial seleccionar uno de los distritos v\xE1lidos que se mostrar\xE1n en la lista desplegable de esta columna en la plantilla. "),i(),n(42,"li")(43,"strong"),o(44,"DIRECCION DE ENTREGA:"),i(),o(45," Direcci\xF3n completa y detallada donde se entregar\xE1 el pedido (calle, n\xFAmero, urbanizaci\xF3n, referencia, etc.). "),i(),n(46,"li")(47,"strong"),o(48,"FECHA DE ENTREGA (DIA/MES/A\xD1O):"),i(),o(49," Fecha programada para la entrega del pedido. Utiliza el formato DD/MM/AAAA (ej. 25/12/2023). "),i(),n(50,"li")(51,"strong"),o(52,"DETALLE DEL PRODUCTO:"),i(),o(53,' Descripci\xF3n breve pero clara de lo que se est\xE1 enviando (ej. "Ropa y Zapatillas", "Documentos Urgentes", "Regalo Sorpresa"). '),i(),n(54,"li")(55,"strong"),o(56,"MONTO A COBRAR:"),i(),o(57," Si el env\xEDo es "),n(58,"code"),o(59,"CONTRAENTREGA"),i(),o(60,", indica aqu\xED el monto exacto que el courier debe cobrar al destinatario. Si es "),n(61,"code"),o(62,"SOLO-ENTREGA-NO-COBRAR"),i(),o(63,", este campo puede dejarse vac\xEDo o con 0. "),i(),n(64,"li")(65,"strong"),o(66,"FORMA DE PAGO:"),i(),o(67,' Indica c\xF3mo se realizar\xE1 el pago del "MONTO A COBRAR" si aplica. Ejemplos: '),n(68,"code"),o(69,"EFECTIVO"),i(),o(70,", "),n(71,"code"),o(72,"YAPE"),i(),o(73,", "),n(74,"code"),o(75,"PLIN"),i(),o(76,", "),n(77,"code"),o(78,"TRANSFERENCIA"),i(),o(79,". Si es no se realizar\xE1 cobro, puedes indicarlo con la opcion "),n(80,"code"),o(81,"NO COBRAR"),i()(),n(82,"li")(83,"strong"),o(84,"OBSERVACION:"),i(),o(85,' Cualquier nota o indicaci\xF3n adicional importante para el courier o para la gesti\xF3n del pedido (ej. "Entregar solo al titular", "Llamar antes de llegar", "Paquete fr\xE1gil"). '),i()()(),n(86,"li"),o(87,"Guarda el archivo en formato .xlsx o .xls."),i(),n(88,"li"),o(89,'Selecciona el archivo completo y haz clic en "Importar Pedidos".'),i()(),n(90,"div",8)(91,"button",9),g("click",function(){_(d);let v=R(96);return f(v.click())}),n(92,"mat-icon"),o(93,"attach_file"),i(),o(94," Seleccionar Archivo Excel "),i(),n(95,"input",10,0),g("change",function(v){return _(d),f(a.onFileSelected(v))}),i(),c(97,Hn,2,1,"span",11),i(),c(98,Wn,4,2,"div",12)(99,Kn,4,6,"div",13),i(),n(100,"mat-dialog-actions",14)(101,"button",15),g("click",function(){return _(d),f(a.closeDialog())}),o(102," Cancelar "),i(),n(103,"button",16),g("click",function(){return _(d),f(a.processImport())}),n(104,"mat-icon"),o(105,"upload"),i(),o(106),i()()()}t&2&&(l(10),s("href",a.enlace,Ct),l(81),s("disabled",a.isUploading),l(6),s("ngIf",a.fileName),l(),s("ngIf",a.isUploading),l(),s("ngIf",a.importResult),l(2),s("disabled",a.isUploading),l(2),s("disabled",!a.selectedFile||a.isUploading),l(3),p(" ",a.isUploading?"Importando...":"Importar Pedidos"," "))},dependencies:[E,Ve,ge,N,de,be,Oe,xe,D,Qi,V,I,L,rr,ir,At,tr,er,Ge,ze],styles:[".import-modal-container[_ngcontent-%COMP%]{width:100%;max-width:650px}mat-dialog-content[_ngcontent-%COMP%]{padding-top:0;line-height:1.6;font-size:.95em;max-height:70vh;overflow-y:auto}.instructions[_ngcontent-%COMP%]{margin-bottom:16px;font-weight:500}ol[_ngcontent-%COMP%]{padding-left:20px;margin-bottom:24px}ol[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:12px}.template-button[_ngcontent-%COMP%]{margin-left:8px;vertical-align:middle;transform:translateY(-2px)}.file-input-container[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;margin-bottom:24px;padding:16px;border:1px dashed #ccc;border-radius:4px;background-color:#f9f9f9}@media (max-width: 500px){.file-input-container[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.file-input-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%;margin-bottom:8px}}.file-name-display[_ngcontent-%COMP%]{font-style:italic;color:#555;word-break:break-all}.upload-progress-container[_ngcontent-%COMP%]{margin:20px 0}.upload-progress-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:8px;font-weight:500}.import-results[_ngcontent-%COMP%]{margin-top:24px;padding:16px;border-radius:4px;border:1px solid #ddd}.import-results[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-top:0;margin-bottom:12px;font-weight:600}.success-message[_ngcontent-%COMP%]{color:#2e7d32;border-left:4px solid #2e7d32;padding-left:12px}.error-message[_ngcontent-%COMP%]{color:#c62828;border-left:4px solid #c62828;padding-left:12px}.error-details[_ngcontent-%COMP%]{margin-top:16px}.error-details[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin-bottom:8px;font-size:1em;font-weight:500}.error-item[_ngcontent-%COMP%]{padding-bottom:8px!important;border-bottom:1px dotted #eee}.error-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.error-item[_ngcontent-%COMP%]   .mat-mdc-list-item-line[_ngcontent-%COMP%]{white-space:normal!important}.error-data-preview[_ngcontent-%COMP%]{font-size:.8em;color:#757575;display:block;margin-top:4px}mat-dialog-actions[_ngcontent-%COMP%]{padding:8px 24px 16px!important}@media (max-height: 600px){mat-dialog-content[_ngcontent-%COMP%]{max-height:55vh}}ol[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:10px}.column-descriptions[_ngcontent-%COMP%]{list-style-type:disc;margin-top:8px;margin-bottom:16px;font-size:.9em;background-color:#f9f9f9;padding:10px 15px 10px 30px;border-radius:4px}.column-descriptions[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:8px;line-height:1.5}.column-descriptions[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#3f51b5}.column-descriptions[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{background-color:#e0e0e0;padding:1px 4px;border-radius:3px;font-family:monospace}"]})};var Zn="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-TFG-8",Yn=".xlsx",ci=class r{constructor(){}exportAsExcelFile(e,t,a="Sheet1"){if(!e||e.length===0){console.warn("No data provided for Excel export.");return}let d=Yt.json_to_sheet(e),m={Sheets:{[a]:d},SheetNames:[a]},v=br(m,{bookType:"xlsx",type:"array"});this.saveAsExcelFile(v,t)}saveAsExcelFile(e,t){let a=new Blob([e],{type:Zn}),d=window.URL.createObjectURL(a),m=document.createElement("a");m.href=d,m.download=`${t}${Yn}`,document.body.appendChild(m),m.click(),document.body.removeChild(m),window.URL.revokeObjectURL(d)}static \u0275fac=function(t){return new(t||r)};static \u0275prov=ht({token:r,factory:r.\u0275fac,providedIn:"root"})};var pi=class r{orderService=b(X);router=b(Ot);snackBar=b(Ce);dialog=b(Ft);excelExportService=b(ci);datePipe=b(G);orders=[];isLoading=!1;totalOrderCount=0;currentPageIndex=0;currentPageSize=10;currentSortField="registration_date";currentSortDirection="desc";filterCriteriaSubject=new Mi({});destroy$=new z;constructor(){}ngOnInit(){this.filterCriteriaSubject.pipe(F(this.destroy$),ue(()=>this.currentPageIndex=0)).subscribe(e=>{this.fetchOrders()})}getAllFilteredOrdersForExport(){return ke(this,null,function*(){try{let e=this.filterCriteriaSubject.value;return(yield Si(this.orderService.getOrders2(e,this.currentSortField,this.currentSortDirection).pipe(F(this.destroy$))))||[]}catch(e){return console.error("Error fetching all filtered orders for export:",e),this.snackBar.open("Failed to fetch data for export.","Close",{duration:3e3,panelClass:["error-snackbar"]}),[]}})}exportDataToExcel(){return ke(this,null,function*(){this.isLoading=!0,this.snackBar.open("Preparing Excel export, this may take a moment...","",{duration:0});try{let e=yield this.getAllFilteredOrdersForExport();if(e&&e.length>0){let t=e.map(a=>({"TIPO DE ENVIO":a.shipment_type,"NOMBRE DEL DESTINATARIO":a.recipient_name,"TELEFONO DESTINATARIO 9 DIGITOS":a.recipient_phone,DISTRITO:a.delivery_district_name,"DIRECCION DE ENTREGA":a.delivery_address,"FECHA DE REGISTRO":a.createdAt?this.datePipe.transform(a.createdAt,"dd/MM/yyyy"):"N/A","FECHA DE ENTREGA":a.delivery_date,"DETALLE DEL PRODUCTO":a.item_description,"COSTO DE ENVIO":a.shipping_cost,"MONTO A COBRAR":a.amount_to_collect_at_delivery,"FORMA DE PAGO":a.payment_method_for_collection,OBSERVACION:a.observations||""}));this.excelExportService.exportAsExcelFile(t,"Listado_Pedidos_Filtrados","Pedidos"),this.snackBar.dismiss(),this.snackBar.open("Excel file exported successfully!","OK",{duration:3500,panelClass:["success-snackbar"]})}else this.snackBar.dismiss(),this.snackBar.open("No data available to export with current filters.","OK",{duration:3e3})}catch(e){console.error("Error during Excel export process:",e),this.snackBar.dismiss(),this.snackBar.open("An error occurred during Excel export.","Close",{duration:3e3,panelClass:["error-snackbar"]})}finally{this.isLoading=!1}})}fetchOrders(){this.isLoading=!0;let e=this.filterCriteriaSubject.value;this.orderService.getOrders(e,this.currentPageIndex+1,this.currentPageSize,this.currentSortField,this.currentSortDirection).pipe(F(this.destroy$),Te(t=>(this.snackBar.open(t.message||"Failed to load orders.","Close",{duration:5e3,panelClass:["error-snackbar"]}),this.isLoading=!1,[]))).subscribe(t=>{this.orders=t.items,this.totalOrderCount=t.total_count||0,this.isLoading=!1,console.log("Orders fetched:",t)})}openImportModal(){let e=this.dialog.open(mi,{width:"90%",maxWidth:"700px",autoFocus:!1});e.componentInstance.importCompleted.subscribe(t=>{t&&(console.log("Import completed, reloading orders..."),this.fetchOrders())}),e.afterClosed().subscribe(t=>{console.log("The import dialog was closed",t)})}handleStatusChanged(e){this.isLoading=!0,console.log("OrderListPage: Status change requested",e),this.orderService.updateOrderStatus(e.orderId,e.newStatus,e.reason||"",e.proofOfDeliveryImageUrl,e.shippingCostPaymentMethod,e.collectionPaymentMethod).subscribe({next:t=>{this.snackBar.open(`Estado del pedido ${t.code} actualizado a ${e.newStatus}.`,"OK",{duration:3e3,panelClass:["success-snackbar"]}),this.fetchOrders()},error:t=>{this.snackBar.open(`Error al actualizar estado: ${t.message||"Intente de nuevo"}`,"Cerrar",{duration:5e3,panelClass:["error-snackbar"]}),this.isLoading=!1},complete:()=>{this.isLoading=!1}})}handleMotorizedChanged(e){console.log("orderId",e.orderId),console.log("motorizedId",e.motorizedId),this.orderService.assignDriverToOrder(e.orderId,e.motorizedId).subscribe({next:t=>{this.snackBar.open(`Motorizado ${t.assigned_driver?.username} asignado al pedido ${t.code}.`,"OK",{duration:3e3,panelClass:["success-snackbar"]}),this.fetchOrders()},error:t=>{this.snackBar.open(`Error al asignar motorizado: ${t.message||"Intente de nuevo"}`,"Cerrar",{duration:5e3,panelClass:["error-snackbar"]})}})}handleRescheduleChanged(e){let t=new Date(e.newDate).toISOString();this.orderService.rescheduleOrder(e.orderId,t||"",e.reason).subscribe({next:a=>{this.snackBar.open(`Pedido ${a.code} reprogramado para ${this.datePipe.transform(a.delivery_date,"dd/MM/yyyy")}.`,"OK",{duration:3500,panelClass:["success-snackbar"]}),this.fetchOrders()},error:a=>{this.snackBar.open(`Error al reprogramar pedido: ${a.message||"Intente de nuevo"}`,"Cerrar",{duration:5e3,panelClass:["error-snackbar"]})}})}onFiltersChanged(e){console.log("OrderListPage: Filters changed",e),this.filterCriteriaSubject.next(e)}onPageChanged(e){console.log("OrderListPage: Page changed",e),this.currentPageIndex=e.pageIndex,this.currentPageSize=e.pageSize,this.fetchOrders()}onSortChanged(e){console.log("OrderListPage: Sort changed",e),this.currentSortField=e.active,this.currentSortDirection=e.direction,this.currentPageIndex=0,this.fetchOrders()}handleMassiveActions(e){console.log("Massive action selected:",e),this.snackBar.open(`Action: ${e} not implemented yet.`,"OK",{duration:3e3})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=M({type:r,selectors:[["app-order-list-page"]],decls:25,vars:6,consts:[["massiveActionsMenu","matMenu"],[1,"page-content-wrapper"],[1,"page-title-bar"],[1,"page-title"],[1,"breadcrumbs"],["routerLink","/"],[3,"filtersChanged"],[1,"table-controls-bar"],[1,"records-info"],[1,"actions-group"],["mat-stroked-button","","color","primary",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],[3,"pageChanged","sortChanged","statusChanged","motorizedChanged","rescheduleChanged","orders","isLoading","totalCount","pageSize","pageIndex"]],template:function(t,a){if(t&1){let d=x();n(0,"div",1)(1,"div",2)(2,"h1",3),o(3,"Listado de pedidos Lima"),i(),n(4,"div",4)(5,"a",5),o(6,"Inicio"),i(),o(7," / "),n(8,"span"),o(9,"Listado de pedidos Lima"),i()()(),n(10,"app-order-filters",6),g("filtersChanged",function(v){return _(d),f(a.onFiltersChanged(v))}),i(),n(11,"div",7),h(12,"div",8),n(13,"div",9)(14,"button",10),o(15," Acciones Masivas "),n(16,"mat-icon"),o(17,"arrow_drop_down"),i()(),n(18,"mat-menu",null,0)(20,"button",11),g("click",function(){return _(d),f(a.exportDataToExcel())}),o(21," Exportar a Excel "),i(),n(22,"button",11),g("click",function(){return _(d),f(a.openImportModal())}),o(23," Importar desde Excel "),i()()()(),n(24,"app-order-table",12),g("pageChanged",function(v){return _(d),f(a.onPageChanged(v))})("sortChanged",function(v){return _(d),f(a.onSortChanged(v))})("statusChanged",function(v){return _(d),f(a.handleStatusChanged(v))})("motorizedChanged",function(v){return _(d),f(a.handleMotorizedChanged(v))})("rescheduleChanged",function(v){return _(d),f(a.handleRescheduleChanged(v))}),i()()}if(t&2){let d=R(19);l(14),s("matMenuTriggerFor",d),l(10),s("orders",a.orders)("isLoading",a.isLoading)("totalCount",a.totalOrderCount)("pageSize",a.currentPageSize)("pageIndex",a.currentPageIndex)}},dependencies:[E,yt,Ni,ei,si,ot,D,V,I,L,Tt,kt,wt,It],styles:[".page-content-wrapper[_ngcontent-%COMP%]{padding:20px 24px;background-color:var(--sys-surface-container-lowest);color:var(--sys-on-surface);min-height:calc(100vh - 64px)}.page-title-bar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:30px}.page-title[_ngcontent-%COMP%]{font-size:24px;font-weight:600;color:var(--sys-on-surface);margin:0}.breadcrumbs[_ngcontent-%COMP%]{font-size:14px;color:var(--sys-on-surface-variant)}.breadcrumbs[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--sys-primary);text-decoration:none}.breadcrumbs[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}.breadcrumbs[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-left:5px}.table-controls-bar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;background-color:var(--sys-surface-container-low);border-radius:8px;padding:8px 16px}.records-info[_ngcontent-%COMP%]{font-size:.9em;color:#555}.actions-group[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center}.orders-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr;gap:20px}@media (min-width: 768px){.orders-grid[_ngcontent-%COMP%]{grid-template-columns:1fr 1fr}}"]})};function eo(r,e){r&1&&(n(0,"mat-error"),o(1,"Largo es requerido"),i())}function to(r,e){r&1&&(n(0,"mat-error"),o(1,"Valor debe ser positivo"),i())}function io(r,e){r&1&&(n(0,"mat-error"),o(1,"Ancho es requerido"),i())}function ro(r,e){r&1&&(n(0,"mat-error"),o(1,"Valor debe ser positivo"),i())}function no(r,e){r&1&&(n(0,"mat-error"),o(1,"Alto es requerido"),i())}function oo(r,e){r&1&&(n(0,"mat-error"),o(1,"Valor debe ser positivo"),i())}function ao(r,e){r&1&&(n(0,"mat-error"),o(1,"Peso es requerido"),i())}function lo(r,e){r&1&&(n(0,"mat-error"),o(1,"Valor debe ser positivo"),i())}function so(r,e){r&1&&h(0,"mat-progress-spinner",18)}function mo(r,e){if(r&1){let t=x();n(0,"div",8)(1,"mat-form-field",9)(2,"mat-label"),o(3,"Largo (cm)"),i(),h(4,"input",10),c(5,eo,2,0,"mat-error",11)(6,to,2,0,"mat-error",11),i(),n(7,"mat-form-field",9)(8,"mat-label"),o(9,"Ancho (cm)"),i(),h(10,"input",12),c(11,io,2,0,"mat-error",11)(12,ro,2,0,"mat-error",11),i(),n(13,"mat-form-field",9)(14,"mat-label"),o(15,"Alto (cm)"),i(),h(16,"input",13),c(17,no,2,0,"mat-error",11)(18,oo,2,0,"mat-error",11),i(),n(19,"mat-form-field",9)(20,"mat-label"),o(21,"Peso (kg)"),i(),h(22,"input",14),c(23,ao,2,0,"mat-error",11)(24,lo,2,0,"mat-error",11),i(),n(25,"div",15)(26,"button",16),g("click",function(){_(t);let d=u();return f(d.onCalculateCustomCost())}),c(27,so,1,0,"mat-progress-spinner",17),o(28),i()()()}if(r&2){let t,a,d,m,v,Z,T,Q,B=u();l(5),s("ngIf",(t=B.packageFormGroup.get("package_length_cm"))==null?null:t.hasError("required")),l(),s("ngIf",(a=B.packageFormGroup.get("package_length_cm"))==null?null:a.hasError("min")),l(5),s("ngIf",(d=B.packageFormGroup.get("package_width_cm"))==null?null:d.hasError("required")),l(),s("ngIf",(m=B.packageFormGroup.get("package_width_cm"))==null?null:m.hasError("min")),l(5),s("ngIf",(v=B.packageFormGroup.get("package_height_cm"))==null?null:v.hasError("required")),l(),s("ngIf",(Z=B.packageFormGroup.get("package_height_cm"))==null?null:Z.hasError("min")),l(5),s("ngIf",(T=B.packageFormGroup.get("package_weight_kg"))==null?null:T.hasError("required")),l(),s("ngIf",(Q=B.packageFormGroup.get("package_weight_kg"))==null?null:Q.hasError("min")),l(2),s("disabled",B.isCalculating()),l(),s("ngIf",B.isCalculating()),l(),p(" ",B.isCalculating()?"Calculando...":"CALCULAR"," ")}}function co(r,e){r&1&&(n(0,"div",19)(1,"p"),o(2," Si su paquete excede las medidas y pesos est\xE1ndar y no utiliza la calculadora de env\xEDo, se le cobrar\xE1 en funci\xF3n de esas medidas sin previo aviso. "),i()())}function po(r,e){if(r&1&&(n(0,"div",20)(1,"p"),o(2),i()()),r&2){let t=e.ngIf;l(2),S(t.info_text)}}var ui=class r{packageFormGroup;deliveryDistrictId=null;listaDeDistritos=[];shippingCostCalculated=new A;calculationLoading=new A;maxDimensions$;standardPackageLabel=se("Est\xE1ndar");volumetric_factor=se(0);isCalculating=se(!1);orderService=b(X);destroy$=new z;constructor(){this.maxDimensions$=this.orderService.getMaxPackageDimensions().pipe(ue(e=>{e.standard_package_info&&e.volumetric_factor&&(this.standardPackageLabel.set(e.standard_package_info),this.volumetric_factor.set(e.volumetric_factor))}))}ngOnInit(){if(!this.packageFormGroup){console.error("PackageCalculatorComponent: packageFormGroup input is required.");return}this.packageFormGroup.get("package_size_type")?.valueChanges.pipe(F(this.destroy$),Ke(this.packageFormGroup.get("package_size_type")?.value)).subscribe(e=>{this.toggleCustomDimensionControls(e==="custom")})}toggleCustomDimensionControls(e){["package_width_cm","package_length_cm","package_height_cm","package_weight_kg"].forEach(a=>{let d=this.packageFormGroup.get(a);d&&(e?(d.enable(),d.setValidators([O.required,O.min(.1),O.max(999)])):(d.disable(),d.clearValidators(),d.updateValueAndValidity({emitEvent:!1})),d.updateValueAndValidity())})}calculateStandardShippingCost(){if(!this.deliveryDistrictId){console.warn("Cannot calculate standard shipping cost: deliveryDistrictId is missing."),this.shippingCostCalculated.emit(0);return}this.isCalculating.set(!0),this.calculationLoading.emit(!0),this.orderService.calculateShippingCost({delivery_district_id:this.deliveryDistrictId,package_size_type:"standard"}).pipe(F(this.destroy$)).subscribe({next:e=>{this.shippingCostCalculated.emit(e.shipping_cost),this.isCalculating.set(!1),this.calculationLoading.emit(!1)},error:e=>{console.error("Error calculating standard shipping cost:",e),this.shippingCostCalculated.emit(0),this.isCalculating.set(!1),this.calculationLoading.emit(!1)}})}onCalculateCustomCost(){if(this.packageFormGroup.get("package_size_type")?.value!=="custom")return;if(!this.deliveryDistrictId){alert("Por favor, seleccione un distrito de entrega primero.");return}let e=!0;if(["package_width_cm","package_length_cm","package_height_cm","package_weight_kg"].forEach(m=>{let v=this.packageFormGroup.get(m);v?.markAsTouched(),v?.invalid&&(e=!1)}),!e){console.log("Custom dimensions form is invalid");return}this.isCalculating.set(!0),this.calculationLoading.emit(!0);let a={delivery_district_id:this.deliveryDistrictId,package_size_type:"custom",package_width_cm:this.packageFormGroup.get("package_width_cm")?.value,package_length_cm:this.packageFormGroup.get("package_length_cm")?.value,package_height_cm:this.packageFormGroup.get("package_height_cm")?.value,package_weight_kg:this.packageFormGroup.get("package_weight_kg")?.value};if(this.maxDimensions$,a.package_width_cm&&a.package_length_cm&&a.package_height_cm&&a.package_weight_kg&&this.volumetric_factor()){let m=a.package_length_cm*a.package_width_cm*a.package_height_cm/this.volumetric_factor(),v=0,Z=a.package_weight_kg;if(m>a.package_weight_kg&&(Z=m),a.delivery_district_id){console.log("customData.delivery_district_id",a.delivery_district_id);let T=this.listaDeDistritos?.find(Q=>Q.id===a.delivery_district_id);if(T){let B=function(pe,qe=[]){for(let je of qe)if(pe>=je.weight_from&&pe<=je.weight_to)return console.log("tarifa",je),je;return 0};var d=B;let Q=this.listaDeDistritos?.filter(pe=>pe.name===T?.name);console.log("districtFound",T),Q&&(console.log("filtrados",Q),v=B(Z,Q)?.price||0)}}console.log("peso_cobrado",Z),console.log("precio",v),this.shippingCostCalculated.emit(v),this.isCalculating.set(!1),this.calculationLoading.emit(!1)}else alert("las entradas no son validas")}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=M({type:r,selectors:[["app-package-calculator"]],inputs:{packageFormGroup:"packageFormGroup",deliveryDistrictId:"deliveryDistrictId",listaDeDistritos:"listaDeDistritos"},outputs:{shippingCostCalculated:"shippingCostCalculated",calculationLoading:"calculationLoading"},decls:12,vars:7,consts:[[1,"package-calculator-container",3,"formGroup"],[1,"section-subtitle"],["formControlName","package_size_type","aria-label","Seleccione el tipo de tama\xF1o del paquete"],["value","standard",1,"package-option"],["value","custom",1,"package-option"],["class","custom-dimensions-grid",4,"ngIf"],["class","warning-paquete-size",4,"ngIf"],["class","max-dimensions-info",4,"ngIf"],[1,"custom-dimensions-grid"],["appearance","outline"],["matInput","","type","number","formControlName","package_length_cm","placeholder","Ingrese el largo"],[4,"ngIf"],["matInput","","type","number","formControlName","package_width_cm","placeholder","Ingrese el ancho"],["matInput","","type","number","formControlName","package_height_cm","placeholder","Ingrese el alto"],["matInput","","type","number","formControlName","package_weight_kg","placeholder","Ingrese el peso"],[1,"calculate-button-container"],["mat-flat-button","","color","accent","type","button",3,"click","disabled"],["mode","indeterminate","diameter","20","class","button-spinner",4,"ngIf"],["mode","indeterminate","diameter","20",1,"button-spinner"],[1,"warning-paquete-size"],[1,"max-dimensions-info"]],template:function(t,a){if(t&1&&(n(0,"div",0)(1,"h3",1),o(2,"Tama\xF1o del paquete"),i(),n(3,"mat-radio-group",2)(4,"mat-radio-button",3),o(5),i(),n(6,"mat-radio-button",4),o(7,"Otros tama\xF1os : Calcular"),i()(),c(8,mo,29,11,"div",5)(9,co,3,0,"div",6)(10,po,3,1,"div",7),C(11,"async"),i()),t&2){let d,m;s("formGroup",a.packageFormGroup),l(5),S(a.standardPackageLabel()),l(3),s("ngIf",((d=a.packageFormGroup.get("package_size_type"))==null?null:d.value)==="custom"),l(),s("ngIf",((m=a.packageFormGroup.get("package_size_type"))==null?null:m.value)==="standard"),l(),s("ngIf",k(11,5,a.maxDimensions$))}},dependencies:[E,N,Le,$,ie,Mt,U,re,ne,fe,H,j,q,oe,le,ae,cr,sr,mr,D,V,te,ee],styles:[".package-calculator-container[_ngcontent-%COMP%]{margin-top:20px;margin-bottom:20px;padding:16px;border:1px solid #e0e0e0;border-radius:4px;background-color:#f9f9f9}.section-subtitle[_ngcontent-%COMP%]{font-size:1.1em;font-weight:500;margin-top:0;margin-bottom:16px}mat-radio-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px;margin-bottom:20px}.package-option[_ngcontent-%COMP%]{font-weight:400}.custom-dimensions-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:16px;margin-top:16px;align-items:start}.calculate-button-container[_ngcontent-%COMP%]{grid-column:1/-1;display:flex;justify-content:flex-start;margin-top:10px}.calculate-button-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:120px}.button-spinner[_ngcontent-%COMP%]{display:inline-block;vertical-align:middle;margin-right:8px}.max-dimensions-info[_ngcontent-%COMP%]{margin-top:16px;font-size:.85em;color:#757575;text-align:center;padding:8px;background-color:#efefef;border-radius:4px}.warning-paquete-size[_ngcontent-%COMP%]{font-size:14px;font-weight:700;margin:16px 0;text-align:left;color:#d32f2f;display:flex;align-items:center;justify-content:flex-end}"]})};var uo=(r,e)=>e.id;function go(r,e){if(r&1){let t=x();n(0,"button",41),g("click",function(){_(t);let d=u(2);return f(d.clearSelection())}),n(1,"mat-icon"),o(2,"close"),i()()}}function _o(r,e){r&1&&(n(0,"mat-icon",10),o(1,"person_search"),i())}function fo(r,e){r&1&&h(0,"mat-progress-spinner",42)}function ho(r,e){if(r&1&&(n(0,"mat-option",39)(1,"div",43)(2,"span"),o(3),i()()()),r&2){let t=e.$implicit;s("value",t),l(3),S(t.username)}}function Co(r,e){r&1&&(n(0,"mat-option",40),o(1,"No se encontraron motorizados."),i())}function vo(r,e){r&1&&(n(0,"mat-error"),o(1,"Requerido"),i())}function bo(r,e){if(r&1){let t=x();n(0,"mat-form-field",33)(1,"mat-label"),o(2,"Buscar y Seleccionar empresa"),i(),h(3,"input",34),c(4,go,3,0,"button",35)(5,_o,2,0,"mat-icon",36)(6,fo,1,0,"mat-progress-spinner",37),n(7,"mat-autocomplete",38,1),g("optionSelected",function(d){_(t);let m=u();return f(m.onDriverSelected(d))}),vt(9,ho,4,2,"mat-option",39,uo),C(11,"async"),c(12,Co,2,0,"mat-option",40),C(13,"async"),i(),c(14,vo,2,0,"mat-error",11),i()}if(r&2){let t,a,d=R(8),m=u();l(3),s("formControl",m.driverSearchCtrl)("matAutocomplete",d),l(),s("ngIf",m.driverSearchCtrl.value&&!m.isLoadingDrivers),l(),s("ngIf",!m.driverSearchCtrl.value&&!m.isLoadingDrivers),l(),s("ngIf",m.isLoadingDrivers),l(),s("displayWith",m.displayDriverName),l(2),bt(k(11,8,m.filteredDrivers$)),l(3),K(((t=k(13,10,m.filteredDrivers$))==null?null:t.length)===0&&!m.isLoadingDrivers&&m.driverSearchCtrl.value?12:-1),l(2),s("ngIf",(a=m.orderForm.get("company_id"))==null?null:a.hasError("required"))}}function xo(r,e){if(r&1&&(n(0,"mat-option",39),o(1),i()),r&2){let t=e.$implicit;s("value",t),l(),S(t)}}function Oo(r,e){r&1&&(n(0,"mat-error"),o(1,"Requerido"),i())}function yo(r,e){r&1&&(n(0,"mat-error"),o(1,"Requerido"),i())}function Mo(r,e){r&1&&(n(0,"mat-error"),o(1,"Tel\xE9fono inv\xE1lido"),i())}function So(r,e){if(r&1&&(n(0,"mat-option",44)(1,"div",45)(2,"span"),o(3),i(),o(4," \xA0 "),n(5,"span",46),o(6),C(7,"number"),i()()()),r&2){let t=e.$implicit;s("value",t.id),l(3),p("",t.name," "),l(3),p(" - S/ ",y(7,3,t.price,"1.2-2"),"")}}function Eo(r,e){r&1&&(n(0,"mat-error"),o(1,"Requerido"),i())}function Do(r,e){r&1&&(n(0,"mat-error"),o(1,"Requerido"),i())}function Po(r,e){r&1&&(n(0,"mat-error"),o(1,"M\xEDnimo 6 caracteres"),i())}function wo(r,e){r&1&&(n(0,"mat-error"),o(1,"Requerido"),i())}function ko(r,e){r&1&&h(0,"mat-progress-spinner",47)}function Io(r,e){r&1&&(n(0,"mat-error"),o(1,"Requerido"),i())}function To(r,e){r&1&&(n(0,"mat-error"),o(1,"Requerido"),i())}function Fo(r,e){r&1&&(n(0,"mat-error"),o(1,"Monto no puede ser negativo"),i())}function Ao(r,e){if(r&1&&(n(0,"mat-option",39),o(1),i()),r&2){let t=e.$implicit;s("value",t),l(),S(t)}}var gt=class r{orderSubmit=new A;formValidityChanged=new A;orderForm;deliveryDistricts$;minDeliveryDate;shipmentTypes=["CONTRAENTREGA","SOLO ENTREGAR","CAMBIO","RECOJO"];paymentMethodsForCollection=["NO COBRAR","EFECTIVO","YAPE","PLIN","TRANSFERENCIA"];calculatedShippingCost=se(0);isCalculatingShipping=se(!1);appStore=b(Pt);selectedDistrictName=Fi(()=>{let e=this.orderForm?.get("delivery_district_id")?.value;return!e||!this._districtsCache?"":this._districtsCache.find(t=>t.id===e)?.name||""});orderService=b(X);fb=b(he);datePipe=b(G);destroy$=new z;_districtsCache=[];drivers$=Ie([]);isLoadingDrivers=!1;selectedDriver=null;driverSearchCtrl=new We("");filteredDrivers$;constructor(){this.minDeliveryDate=new Date,this.deliveryDistricts$=this.orderService.getDeliveryDistricts().pipe(Ei(e=>(this._districtsCache=e,e.filter(t=>t.isStandard)))),this.buildForm(),this.filteredDrivers$=this.driverSearchCtrl.valueChanges.pipe(Ke(""),Qe(300),Pe(),ft(e=>(this.isLoadingDrivers=!0,console.log("searchTerm",e),this.orderService.getCompanies(e||"").pipe(ue(()=>this.isLoadingDrivers=!1),Te(()=>(this.isLoadingDrivers=!1,Ie([])))))),F(this.destroy$))}isCompany(){return this.appStore.currentUser()?.role==="EMPRESA"}displayDriverName(e){return e&&e.username?e.username:""}onDriverSelected(e){this.selectedDriver=e.option.value,console.log("cliente selected:",this.selectedDriver),this.orderForm.get("company_id")?.setValue(this.selectedDriver.id),this.orderForm.markAllAsTouched(),console.log("Order form is invalid:",this.getFormErrors(this.orderForm));let t=this.orderForm.getRawValue();console.log("formValue",t)}clearSelection(){this.selectedDriver=null,this.driverSearchCtrl.setValue(""),this.orderForm.markAllAsTouched(),this.orderForm.get("company_id")?.setValue(null),console.log("Order form is invalid:",this.getFormErrors(this.orderForm))}ngOnInit(){this.orderForm.statusChanges.pipe(F(this.destroy$),Pe()).subscribe(e=>{this.formValidityChanged.emit(e==="VALID")}),this.orderForm.get("delivery_district_id")?.valueChanges.pipe(F(this.destroy$),Pe()).subscribe(e=>{if(console.log("District changed to:",e),e)if(this.packageDetailsFormGroup.get("package_size_type")?.value==="standard"){let t=this._districtsCache.find(a=>a.id===e);t&&this.calculatedShippingCost.set(parseFloat(t.price))}else this.calculatedShippingCost.set(0)}),this.packageDetailsFormGroup.get("package_size_type")?.valueChanges.pipe(F(this.destroy$),Pe()).subscribe(e=>{console.log("type",e);let t=this.orderForm.get("delivery_district_id")?.value;if(t&&e==="standard"){let a=this._districtsCache.find(d=>d.id===t);a&&this.calculatedShippingCost.set(parseFloat(a.price))}else this.calculatedShippingCost.set(0)})}resetPackageTypeSelection(){let e=this.packageDetailsFormGroup.get("package_size_type");this.calculatedShippingCost.set(0),this.isCalculatingShipping.set(!1)}get packageDetailsFormGroup(){return this.orderForm.get("package_details")}buildForm(){let e=null;this.appStore.currentUser()?.id&&(e=this.appStore.currentUser()?.id);let t=this.datePipe.transform(new Date,"yyyy-MM-dd");this.orderForm=this.fb.group({shipment_type:[this.shipmentTypes[0],O.required],recipient_name:["",O.required],recipient_phone:["",[O.required,O.pattern("^[0-9]{9}$")]],company_id:[e,O.required],delivery_district_id:[null,O.required],delivery_address:["",[O.required,O.minLength(6)]],delivery_coordinates:[""],delivery_date:[null,O.required],package_details:this.fb.group({package_size_type:["standard",O.required],package_width_cm:[{value:0,disabled:!0}],package_length_cm:[{value:0,disabled:!0}],package_height_cm:[{value:0,disabled:!0}],package_weight_kg:[{value:0,disabled:!0}]}),item_description:["",O.required],amount_to_collect_at_delivery:[0,[O.required,O.min(0)]],payment_method_for_collection:[this.paymentMethodsForCollection[0],O.required],observations:[""]})}onShippingCostCalculated(e){this.calculatedShippingCost.set(e),console.log("Shipping cost updated in OrderCreationForm:",e)}onPackageCalculationLoading(e){this.isCalculatingShipping.set(e)}onSubmit(){if(this.orderForm.invalid){this.orderForm.markAllAsTouched(),console.log("Order form is invalid:",this.getFormErrors(this.orderForm)),alert("Por favor complete todos los campos requeridos.");return}let e=this.orderForm.getRawValue(),t=_t(He(He({},e),e.package_details),{shipping_cost:this.calculatedShippingCost(),delivery_district_name:this.selectedDistrictName(),temp_id:`temp-${Date.now()}-${Math.random().toString(36).substring(2,7)}`});console.log("newOrderData",t),console.log("Submitting New Order Data:",t),this.orderSubmit.emit(t)}resetFormForNextOrder(){this.selectedDriver=null,this.driverSearchCtrl.setValue(""),this.orderForm.get("company_id")?.setValue(null);let e=this.orderForm.get("shipment_type")?.value||this.shipmentTypes[0],t=this.orderForm.get("payment_method_for_collection")?.value||this.paymentMethodsForCollection[0],a=this.datePipe.transform(new Date,"yyyy-MM-dd");this.orderForm.reset({shipment_type:e,delivery_date:a,package_details:{package_size_type:"standard"},amount_to_collect_at_delivery:0,payment_method_for_collection:t}),this.calculatedShippingCost.set(0),this.packageDetailsFormGroup.get("package_size_type")?.setValue("standard",{emitEvent:!0}),this.formValidityChanged.emit(this.orderForm.valid)}getDistrictCoverageInfo(e){return!e||!this._districtsCache||this._districtsCache.length===0?"":this._districtsCache.find(a=>a.id===e)?.name||""}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}getFormErrors(e){let t={};return Object.keys(e.controls).forEach(a=>{let d=e.get(a)?.errors;if(d&&(t[a]=d),e.get(a)instanceof $i){let m=this.getFormErrors(e.get(a));Object.keys(m).length>0&&(t[a]=m)}}),t}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=M({type:r,selectors:[["app-order-creation-form"]],outputs:{orderSubmit:"orderSubmit",formValidityChanged:"formValidityChanged"},features:[Je([Nt(),G])],decls:99,vars:29,consts:[["deliveryDatePicker",""],["autoDriver","matAutocomplete"],[1,"order-creation-form",3,"ngSubmit","formGroup"],[1,"form-section-title"],["appearance","outline","class","full-width driver-search-field",4,"ngIf"],[1,"form-grid"],["appearance","outline"],["formControlName","shipment_type"],[3,"value",4,"ngFor","ngForOf"],["matInput","","formControlName","recipient_name","placeholder","Nombre completo"],["matSuffix",""],[4,"ngIf"],["matInput","","formControlName","recipient_phone","type","tel","placeholder",""],["align","end"],["formControlName","delivery_district_id"],["class","district-option-content",3,"value",4,"ngFor","ngForOf"],["appearance","outline",1,"full-span-column"],["matInput","","formControlName","delivery_address","placeholder","Ingresar lugar de entrega (M\xEDnimo 6 caracteres)"],["matInput","","formControlName","delivery_coordinates","placeholder","-12.070,-77.012"],["matInput","","formControlName","delivery_date",3,"matDatepicker","min"],["matSuffix","",3,"for"],[1,"section-divider"],[3,"shippingCostCalculated","calculationLoading","packageFormGroup","listaDeDistritos","deliveryDistrictId"],[1,"shipping-cost-display"],[1,"cost-value"],["mode","indeterminate","diameter","20","class","cost-spinner",4,"ngIf"],["matInput","","formControlName","item_description","placeholder","Detalle del pedido"],["matInput","","formControlName","amount_to_collect_at_delivery","type","number","min","0","placeholder","S/"],["matPrefix",""],["formControlName","payment_method_for_collection"],["matInput","","formControlName","observations","placeholder","\xBFQu\xE9 env\xEDas?...","rows","3"],[1,"add-order-button-container"],["mat-flat-button","","color","accent","type","submit",3,"disabled"],["appearance","outline",1,"full-width","driver-search-field"],["type","text","placeholder","Escriba el nombre del la empresa...","aria-label","cliente","matInput","",3,"formControl","matAutocomplete"],["matSuffix","","mat-icon-button","","aria-label","Limpiar",3,"click",4,"ngIf"],["matSuffix","",4,"ngIf"],["matSuffix","","mode","indeterminate","diameter","20",4,"ngIf"],[3,"optionSelected","displayWith"],[3,"value"],["disabled",""],["matSuffix","","mat-icon-button","","aria-label","Limpiar",3,"click"],["matSuffix","","mode","indeterminate","diameter","20"],[1,"driver-option"],[1,"district-option-content",3,"value"],[2,"display","flex","justify-content","space-between","width","100%","align-items","center"],[2,"font-weight","500","color","#555"],["mode","indeterminate","diameter","20",1,"cost-spinner"]],template:function(t,a){if(t&1){let d=x();n(0,"form",2),g("ngSubmit",function(){return _(d),f(a.onSubmit())}),n(1,"h2",3),o(2,"Registrar pedido"),i(),c(3,bo,15,12,"mat-form-field",4),n(4,"div",5)(5,"mat-form-field",6)(6,"mat-label"),o(7,"Tipo de env\xEDo"),i(),n(8,"mat-select",7),c(9,xo,2,2,"mat-option",8),i()(),n(10,"mat-form-field",6)(11,"mat-label"),o(12,"Nombre del destinatario"),i(),h(13,"input",9),n(14,"mat-icon",10),o(15,"person_outline"),i(),c(16,Oo,2,0,"mat-error",11),i(),n(17,"mat-form-field",6)(18,"mat-label"),o(19,"Tel\xE9fono del destinatario"),i(),h(20,"input",12),n(21,"mat-icon",10),o(22,"phone_outline"),i(),n(23,"mat-hint",13),o(24,"No se debe agregar el +51"),i(),c(25,yo,2,0,"mat-error",11)(26,Mo,2,0,"mat-error",11),i(),n(27,"mat-form-field",6)(28,"mat-label"),o(29,"Distrito de entrega"),i(),n(30,"mat-select",14),c(31,So,8,6,"mat-option",15),C(32,"async"),i(),c(33,Eo,2,0,"mat-error",11),i(),n(34,"mat-form-field",16)(35,"mat-label"),o(36,"Direcci\xF3n de entrega"),i(),h(37,"input",17),n(38,"mat-hint",13),o(39,"No acepta caracteres especiales se borran autom\xE1ticos"),i(),c(40,Do,2,0,"mat-error",11)(41,Po,2,0,"mat-error",11),i(),n(42,"mat-form-field",6)(43,"mat-label"),o(44,"Coordenadas (Opcional)"),i(),h(45,"input",18),n(46,"mat-icon",10),o(47,"location_on_outline"),i()(),n(48,"mat-form-field",6)(49,"mat-label"),o(50,"Fecha Entrega"),i(),h(51,"input",19)(52,"mat-datepicker-toggle",20)(53,"mat-datepicker",null,0),c(55,wo,2,0,"mat-error",11),i()(),h(56,"mat-divider",21),n(57,"app-package-calculator",22),g("shippingCostCalculated",function(v){return _(d),f(a.onShippingCostCalculated(v))})("calculationLoading",function(v){return _(d),f(a.onPackageCalculationLoading(v))}),i(),n(58,"div",23),o(59," Costo de env\xEDo = "),n(60,"span",24),o(61),C(62,"number"),i(),c(63,ko,1,0,"mat-progress-spinner",25),i(),h(64,"mat-divider",21),n(65,"div",5)(66,"mat-form-field",16)(67,"mat-label"),o(68,"\xBFQu\xE9 env\xEDa?"),i(),h(69,"input",26),n(70,"mat-icon",10),o(71,"inventory_2_outline"),i(),c(72,Io,2,0,"mat-error",11),i(),n(73,"mat-form-field",6)(74,"mat-label"),o(75,"Monto total a cobrar"),i(),h(76,"input",27),n(77,"span",28),o(78,"S/\xA0"),i(),n(79,"mat-hint"),o(80,"Si solo hay que entregar colocar 0"),i(),c(81,To,2,0,"mat-error",11)(82,Fo,2,0,"mat-error",11),i(),n(83,"mat-form-field",6)(84,"mat-label"),o(85,"M\xE9todo de Pago (para cobro en entrega)"),i(),n(86,"mat-select",29),c(87,Ao,2,2,"mat-option",8),i()(),n(88,"mat-form-field",16)(89,"mat-label"),o(90,"Observaciones (Opcional)"),i(),h(91,"textarea",30),i()(),n(92,"div",31)(93,"button",32)(94,"mat-icon"),o(95,"add_shopping_cart"),i(),o(96," AGREGAR PEDIDO AL LISTADO "),n(97,"mat-icon"),o(98,"arrow_downward"),i()()()()}if(t&2){let d,m,v,Z,T,Q,B,pe,qe,je,xi,Oi=R(54);s("formGroup",a.orderForm),l(3),s("ngIf",!a.isCompany()),l(6),s("ngForOf",a.shipmentTypes),l(7),s("ngIf",(d=a.orderForm.get("recipient_name"))==null?null:d.hasError("required")),l(9),s("ngIf",(m=a.orderForm.get("recipient_phone"))==null?null:m.hasError("required")),l(),s("ngIf",(v=a.orderForm.get("recipient_phone"))==null?null:v.hasError("pattern")),l(5),s("ngForOf",k(32,24,a.deliveryDistricts$)),l(2),s("ngIf",(Z=a.orderForm.get("delivery_district_id"))==null?null:Z.hasError("required")),l(7),s("ngIf",(T=a.orderForm.get("delivery_address"))==null?null:T.hasError("required")),l(),s("ngIf",(Q=a.orderForm.get("delivery_address"))==null?null:Q.hasError("minlength")),l(10),s("matDatepicker",Oi)("min",a.minDeliveryDate),l(),s("for",Oi),l(3),s("ngIf",(B=a.orderForm.get("delivery_date"))==null?null:B.hasError("required")),l(2),s("packageFormGroup",a.packageDetailsFormGroup)("listaDeDistritos",a._districtsCache)("deliveryDistrictId",(pe=a.orderForm.get("delivery_district_id"))==null?null:pe.value),l(4),p("S/ ",y(62,26,a.calculatedShippingCost(),"1.2-2"),""),l(2),s("ngIf",a.isCalculatingShipping()),l(9),s("ngIf",(qe=a.orderForm.get("item_description"))==null?null:qe.hasError("required")),l(9),s("ngIf",(je=a.orderForm.get("amount_to_collect_at_delivery"))==null?null:je.hasError("required")),l(),s("ngIf",(xi=a.orderForm.get("amount_to_collect_at_delivery"))==null?null:xi.hasError("min")),l(5),s("ngForOf",a.paymentMethodsForCollection),l(6),s("disabled",a.orderForm.invalid||a.isCalculatingShipping())}},dependencies:[E,ge,N,Le,tt,$,_e,ie,Mt,U,re,ji,nt,ne,fe,H,j,q,Et,oe,Wi,Be,le,ae,Ee,$e,Se,st,at,lt,dt,D,V,W,I,L,Me,ye,ui,te,ee,Zt,Kt,Jt],styles:[".order-creation-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:20px}.form-section-title[_ngcontent-%COMP%]{font-size:1.5em;font-weight:500;color:#333;margin-bottom:10px;padding-bottom:10px;border-bottom:1px solid #eee}.form-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:20px 24px}.full-span-column[_ngcontent-%COMP%]{grid-column:1/-1}mat-form-field[_ngcontent-%COMP%]{width:100%}.section-divider[_ngcontent-%COMP%]{margin:24px 0}.shipping-cost-display[_ngcontent-%COMP%]{font-size:1.3em;font-weight:700;margin:16px 0;text-align:right;color:#d32f2f;display:flex;align-items:center;justify-content:flex-end;gap:8px}.add-order-button-container[_ngcontent-%COMP%]{margin-top:24px;text-align:center}.add-order-button-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:12px 24px;font-size:1.1em;letter-spacing:.5px}mat-hint[align=end][_ngcontent-%COMP%]{font-size:.75em;opacity:.7}"]})};function Ro(r,e){r&1&&(n(0,"div",4),o(1," A\xFAn no has agregado pedidos. "),i())}function No(r,e){r&1&&(n(0,"th",23),o(1,"Nombre"),i())}function Vo(r,e){if(r&1&&(n(0,"td",24)(1,"span",25),o(2),i()()),r&2){let t=e.$implicit;l(),s("matTooltip",t.recipient_name)("matTooltipDisabled",t.recipient_name.length<=20),l(),p(" ",t.recipient_name," ")}}function Lo(r,e){r&1&&(n(0,"th",23),o(1,"Tel\xE9fono"),i())}function Bo(r,e){if(r&1&&(n(0,"td",24),o(1),i()),r&2){let t=e.$implicit;l(),S(t.recipient_phone)}}function zo(r,e){r&1&&(n(0,"th",23),o(1,"F. Entrega"),i())}function Go(r,e){if(r&1&&(n(0,"td",24),o(1),C(2,"date"),i()),r&2){let t=e.$implicit;l(),p(" ",y(2,1,t.delivery_date,"dd/MM/yy")," ")}}function Uo(r,e){r&1&&(n(0,"th",23),o(1,"Distrito"),i())}function $o(r,e){if(r&1&&(n(0,"td",24),o(1),i()),r&2){let t=e.$implicit;l(),p(" ",t.delivery_district_name," ")}}function qo(r,e){r&1&&(n(0,"th",23),o(1,"Direcci\xF3n"),i())}function jo(r,e){if(r&1&&(n(0,"td",24)(1,"span",25),o(2),i()()),r&2){let t=e.$implicit;l(),s("matTooltip",t.delivery_address)("matTooltipDisabled",t.delivery_address.length<=25),l(),p(" ",t.delivery_address," ")}}function Ho(r,e){r&1&&(n(0,"th",23),o(1,"Producto"),i())}function Wo(r,e){if(r&1&&(n(0,"td",24)(1,"span",25),o(2),i()()),r&2){let t=e.$implicit;l(),s("matTooltip",t.item_description)("matTooltipDisabled",t.item_description.length<=20),l(),p(" ",t.item_description," ")}}function Xo(r,e){r&1&&(n(0,"th",23),o(1,"Cobrar"),i())}function Qo(r,e){if(r&1&&(n(0,"td",26),o(1),C(2,"currency"),i()),r&2){let t=e.$implicit;l(),p(" ",Ne(2,1,t.amount_to_collect_at_delivery,"PEN","S/ ","1.2-2")," ")}}function Ko(r,e){r&1&&(n(0,"th",23),o(1,"Costo env\xEDo"),i())}function Jo(r,e){if(r&1&&(n(0,"td",26),o(1),C(2,"currency"),i()),r&2){let t=e.$implicit;l(),p(" ",Ne(2,1,t.shipping_cost,"PEN","S/ ","1.2-2")," ")}}function Zo(r,e){r&1&&(n(0,"th",23),o(1,"M\xE9todo de Pago"),i())}function Yo(r,e){if(r&1&&(n(0,"td",24),o(1),i()),r&2){let t=e.$implicit;l(),p(" ",t.payment_method_for_collection," ")}}function ea(r,e){r&1&&(n(0,"th",23),o(1,"Observaci\xF3n"),i())}function ta(r,e){if(r&1&&(n(0,"td",24)(1,"span",25),o(2),i()()),r&2){let t=e.$implicit;l(),s("matTooltip",t.observations)("matTooltipDisabled",!t.observations||t.observations.length<=20),l(),p(" ",t.observations||"-"," ")}}function ia(r,e){r&1&&(n(0,"th",23),o(1,"Quitar"),i())}function ra(r,e){if(r&1){let t=x();n(0,"td",24)(1,"button",27),g("click",function(){let d=_(t).$implicit,m=u(2);return f(m.onRemoveOrder(d.temp_id))}),n(2,"mat-icon"),o(3,"remove_circle_outline"),i()()()}}function na(r,e){r&1&&h(0,"tr",28)}function oa(r,e){r&1&&h(0,"tr",29)}function aa(r,e){if(r&1&&(n(0,"div",5)(1,"table",6),P(2,7),c(3,No,2,0,"th",8)(4,Vo,3,3,"td",9),w(),P(5,10),c(6,Lo,2,0,"th",8)(7,Bo,2,1,"td",9),w(),P(8,11),c(9,zo,2,0,"th",8)(10,Go,3,4,"td",9),w(),P(11,12),c(12,Uo,2,0,"th",8)(13,$o,2,1,"td",9),w(),P(14,13),c(15,qo,2,0,"th",8)(16,jo,3,3,"td",9),w(),P(17,14),c(18,Ho,2,0,"th",8)(19,Wo,3,3,"td",9),w(),P(20,15),c(21,Xo,2,0,"th",8)(22,Qo,3,6,"td",16),w(),P(23,17),c(24,Ko,2,0,"th",8)(25,Jo,3,6,"td",16),w(),P(26,18),c(27,Zo,2,0,"th",8)(28,Yo,2,1,"td",9),w(),P(29,19),c(30,ea,2,0,"th",8)(31,ta,3,3,"td",9),w(),P(32,20),c(33,ia,2,0,"th",8)(34,ra,4,0,"td",9),w(),c(35,na,1,0,"tr",21)(36,oa,1,0,"tr",22),i()()),r&2){let t=u();l(),s("dataSource",t.pendingOrders),l(34),s("matHeaderRowDef",t.displayedColumns)("matHeaderRowDefSticky",!0),l(),s("matRowDefColumns",t.displayedColumns)}}var gi=class r{pendingOrders=[];removeOrder=new A;displayedColumns=["recipient_name","recipient_phone","delivery_date","delivery_district_name","delivery_address","item_description","amount_to_collect_at_delivery","shipping_cost","payment_method_for_collection","observations","actions"];constructor(){}onRemoveOrder(e){e&&this.removeOrder.emit(e)}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=M({type:r,selectors:[["app-temporary-orders-table"]],inputs:{pendingOrders:"pendingOrders"},outputs:{removeOrder:"removeOrder"},decls:6,vars:2,consts:[["ordersTable",""],[1,"temporary-orders-container","mat-elevation-z1"],[1,"list-title"],["class","no-orders-message",4,"ngIf","ngIfElse"],[1,"no-orders-message"],[1,"table-responsive-wrapper"],["mat-table","",1,"temporary-orders-table",3,"dataSource"],["matColumnDef","recipient_name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","recipient_phone"],["matColumnDef","delivery_date"],["matColumnDef","delivery_district_name"],["matColumnDef","delivery_address"],["matColumnDef","item_description"],["matColumnDef","amount_to_collect_at_delivery"],["mat-cell","","class","align-right",4,"matCellDef"],["matColumnDef","shipping_cost"],["matColumnDef","payment_method_for_collection"],["matColumnDef","observations"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],[1,"truncate-text",3,"matTooltip","matTooltipDisabled"],["mat-cell","",1,"align-right"],["mat-icon-button","","color","warn","matTooltip","Quitar pedido",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(t,a){if(t&1&&(n(0,"div",1)(1,"h3",2),o(2,"Listado de pedidos del Negocio: Nikeli Fashion"),i(),c(3,Ro,2,0,"div",3)(4,aa,37,4,"ng-template",null,0,Ye),i()),t&2){let d=R(5);l(3),s("ngIf",a.pendingOrders.length===0)("ngIfElse",d)}},dependencies:[E,N,it,G,Wt,Vt,Bt,$t,zt,Lt,qt,Gt,Ut,jt,Ht,D,W,I,L,Ge,ze],styles:[".table-responsive-wrapper[_ngcontent-%COMP%]{background-color:#6c757d!important;overflow:auto}.temporary-orders-container[_ngcontent-%COMP%]{margin-top:30px;padding:0;background-color:#fff;border-radius:8px;overflow:hidden;box-shadow:0 1px 3px #0000001f,0 1px 2px #0000003d}.list-title[_ngcontent-%COMP%]{font-size:1.2em;font-weight:500;color:#fff;background-color:#d32f2f;padding:12px 16px;margin:0;border-top-left-radius:8px;border-top-right-radius:8px}.temporary-orders-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}th.mat-header-cell[_ngcontent-%COMP%], td.mat-cell[_ngcontent-%COMP%]{padding:10px 12px;border-bottom:1px solid #e0e0e0;vertical-align:middle;text-align:left}th.mat-header-cell[_ngcontent-%COMP%]{font-weight:500;color:#000000bf;background-color:#f5f5f5;white-space:nowrap}td.mat-cell[_ngcontent-%COMP%]{color:#000000de;font-size:.9em}[matColumnDef=amount_to_collect_at_delivery].mat-header-cell[_ngcontent-%COMP%], [matColumnDef=amount_to_collect_at_delivery].mat-cell[_ngcontent-%COMP%], [matColumnDef=shipping_cost].mat-header-cell[_ngcontent-%COMP%], [matColumnDef=shipping_cost].mat-cell[_ngcontent-%COMP%]{text-align:right;justify-content:flex-end}[matColumnDef=actions][_ngcontent-%COMP%]{width:80px}[matColumnDef=actions].mat-header-cell[_ngcontent-%COMP%], [matColumnDef=actions].mat-cell[_ngcontent-%COMP%]{text-align:center;justify-content:center}.truncate-text[_ngcontent-%COMP%]{display:block;max-width:120px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.no-orders-message[_ngcontent-%COMP%]{text-align:center;padding:30px;font-style:italic;color:#6c757d;background-color:#f8f9fa;border-bottom-left-radius:8px;border-bottom-right-radius:8px}"]})};function la(r,e){if(r&1&&(n(0,"mat-option",17),o(1),C(2,"titlecase"),i()),r&2){let t=e.$implicit;s("value",t),l(),p(" ",k(2,2,t.replace("_"," "))," ")}}function da(r,e){r&1&&(n(0,"mat-error"),o(1," Debe seleccionar una opci\xF3n de traslado. "),i())}function sa(r,e){r&1&&(n(0,"mat-error",18),o(1," Debe aceptar los t\xE9rminos y condiciones. "),i())}function ma(r,e){r&1&&h(0,"mat-progress-spinner",19)}function ca(r,e){if(r&1){let t=x();n(0,"div",4)(1,"div",5)(2,"mat-form-field",6)(3,"mat-label"),o(4,"\xBFC\xF3mo se har\xE1 el traslado de los pedidos al almac\xE9n?"),i(),n(5,"mat-select",7),c(6,la,3,4,"mat-option",8),i(),c(7,da,2,0,"mat-error",9),i()(),n(8,"div",10)(9,"mat-checkbox",11),o(10," acepto los "),n(11,"a",12),o(12,"t\xE9rminos y condiciones"),i(),o(13," de Dinsides Courier "),i(),c(14,sa,2,0,"mat-error",13),i(),n(15,"div",14)(16,"button",15),g("click",function(){_(t);let d=u();return f(d.submitAllOrders())}),c(17,ma,1,0,"mat-progress-spinner",16),o(18),i()()()}if(r&2){let t=u();l(5),s("formControl",t.pickupOptionControl),l(),s("ngForOf",t.pickupOptions),l(),s("ngIf",t.pickupOptionControl.hasError("required")&&t.pickupOptionControl.touched),l(2),s("formControl",t.termsAcceptedControl),l(5),s("ngIf",t.termsAcceptedControl.hasError("required")&&t.termsAcceptedControl.touched),l(2),s("disabled",t.pendingOrders().length===0||!t.termsAcceptedControl.value||!t.pickupOptionControl.valid||t.isSubmittingBatch()),l(),s("ngIf",t.isSubmittingBatch()),l(),p(" ",t.isSubmittingBatch()?"Generando Pedidos...":"Haz click aqu\xED para guardar los pedidos"," ")}}var _i=class r{orderCreationFormComponent;pendingOrders=se([]);isSubmittingBatch=se(!1);isOrderFormValid=se(!1);pickupOptionControl=new We("RECOGER EN DOMICILIO",O.required);termsAcceptedControl=new We(!1,O.requiredTrue);pickupOptions=["RECOGER EN DOMICILIO","ENTREGAR EN ALMACEN"];orderService=b(X);router=b(Ot);snackBar=b(Ce);cdr=b(xt);destroy$=new z;constructor(){}ngOnInit(){}handleOrderAdded(e){this.pendingOrders.update(t=>[...t,e]),this.snackBar.open("Pedido agregado al listado.","OK",{duration:2e3,verticalPosition:"top"}),this.orderCreationFormComponent&&this.orderCreationFormComponent.resetFormForNextOrder(),this.cdr.detectChanges()}handleRemoveOrder(e){this.pendingOrders.update(t=>t.filter(a=>a.temp_id!==e)),this.snackBar.open("Pedido quitado del listado.","OK",{duration:2e3,verticalPosition:"top"})}onOrderFormValidityChanged(e){this.isOrderFormValid.set(e)}submitAllOrders(){if(this.pendingOrders().length===0){this.snackBar.open("No hay pedidos en el listado para enviar.","Cerrar",{duration:3e3,verticalPosition:"top"});return}if(!this.pickupOptionControl.valid){this.snackBar.open("Por favor, seleccione c\xF3mo se har\xE1 el traslado.","Cerrar",{duration:3e3,verticalPosition:"top"}),this.pickupOptionControl.markAsTouched();return}if(!this.termsAcceptedControl.value){this.snackBar.open("Debe aceptar los t\xE9rminos y condiciones.","Cerrar",{duration:3e3,verticalPosition:"top"}),this.termsAcceptedControl.markAsTouched();return}this.isSubmittingBatch.set(!0);let t={orders:this.pendingOrders().map(a=>{let v=a,{temp_id:d}=v;return yi(v,["temp_id"])}).map(a=>_t(He({},a),{type_order_transfer_to_warehouse:this.pickupOptionControl.value})),pickup_option:this.pickupOptionControl.value||"RECOGER EN DOMICILIO",terms_accepted:!0};console.log("payload",t),this.orderService.createBatchOrders(t).pipe(F(this.destroy$),Di(()=>this.isSubmittingBatch.set(!1))).subscribe({next:a=>{this.snackBar.open(a.message||"Pedidos generados exitosamente!","OK",{duration:4e3,verticalPosition:"top",panelClass:["success-snackbar"]}),this.pendingOrders.set([]),this.pickupOptionControl.reset("RECOGER_DOMICILIO"),this.termsAcceptedControl.reset(!1),this.router.navigate(["/orders"])},error:a=>{this.snackBar.open(a.message||"Error al generar los pedidos. Intente nuevamente.","Cerrar",{duration:5e3,verticalPosition:"top",panelClass:["error-snackbar"]}),console.error("Error submitting batch orders:",a)}})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=M({type:r,selectors:[["app-order-create-page"]],viewQuery:function(t,a){if(t&1&&Fe(gt,5),t&2){let d;Ae(d=Re())&&(a.orderCreationFormComponent=d.first)}},decls:4,vars:2,consts:[[1,"page-content-wrapper","order-create-page"],[3,"orderSubmit","formValidityChanged"],[3,"removeOrder","pendingOrders"],["class","final-submission-section mat-elevation-z1",4,"ngIf"],[1,"final-submission-section","mat-elevation-z1"],[1,"pickup-option-section"],["appearance","outline",1,"full-width"],[3,"formControl"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"terms-section"],["color","primary",3,"formControl"],["href","/terminos-y-condiciones","target","_blank"],["class","terms-error",4,"ngIf"],[1,"submit-batch-button-container"],["mat-flat-button","","color","primary",1,"submit-all-button",3,"click","disabled"],["mode","indeterminate","diameter","24","class","button-spinner",4,"ngIf"],[3,"value"],[1,"terms-error"],["mode","indeterminate","diameter","24",1,"button-spinner"]],template:function(t,a){t&1&&(n(0,"div",0)(1,"app-order-creation-form",1),g("orderSubmit",function(m){return a.handleOrderAdded(m)})("formValidityChanged",function(m){return a.onOrderFormValidityChanged(m)}),i(),n(2,"app-temporary-orders-table",2),g("removeOrder",function(m){return a.handleRemoveOrder(m)}),i(),c(3,ca,19,8,"div",3),i()),t&2&&(l(2),s("pendingOrders",a.pendingOrders()),l(),s("ngIf",a.pendingOrders().length>0))},dependencies:[E,ge,N,et,yt,$,U,nt,gt,gi,ot,D,V,I,Zi,Ji,Ee,j,q,oe,$e,Se,H,te,ee],styles:[".order-create-page[_ngcontent-%COMP%]{padding:0;background-color:#f4f6f8}.final-submission-section[_ngcontent-%COMP%]{margin-top:30px;padding:24px;background-color:#fff;border-radius:8px;display:flex;flex-direction:column;gap:20px}.pickup-option-section[_ngcontent-%COMP%]   .full-width[_ngcontent-%COMP%]{width:100%}.terms-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-start}.terms-section[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none;font-weight:500}.terms-section[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}.terms-section[_ngcontent-%COMP%]   .terms-error[_ngcontent-%COMP%]{font-size:.75em;margin-top:4px}.submit-batch-button-container[_ngcontent-%COMP%]{margin-top:16px;text-align:center}.submit-batch-button-container[_ngcontent-%COMP%]   .submit-all-button[_ngcontent-%COMP%]{padding:12px 28px;font-size:1.1em;font-weight:500;letter-spacing:.5px;min-width:250px}.button-spinner[_ngcontent-%COMP%]{display:inline-block;vertical-align:middle;margin-right:10px}"]})};var Yc=[{path:"",component:pi,title:"Listado de Pedidos"},{path:"create",component:_i,title:"Registrar Nuevo Pedido"}];export{Yc as ORDERS_ROUTES};
