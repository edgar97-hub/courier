import{a as Ge,b as Re}from"./chunk-VQMPHLXF.js";import{a as Be,b as je,c as $e,d as qe}from"./chunk-WF66USBX.js";import{c as Ae}from"./chunk-PKHWH5C3.js";import{a as N,b as Ne}from"./chunk-4UMFQSK3.js";import"./chunk-3PSRRXT4.js";import{a as Le,b as Ve}from"./chunk-5PZ25QHJ.js";import"./chunk-UAHG2GVE.js";import"./chunk-FR3NO5YB.js";import"./chunk-2JNWSY3M.js";import{d as Ee,e as ye}from"./chunk-6IG52UKJ.js";import{a as De,b as Oe}from"./chunk-3IGH7FBX.js";import"./chunk-7RWCIHFI.js";import{A as Se,B as be,C as Pe,E as Fe,H as Ce,I as Ie,b as re,d as I,f as ae,g as le,l as me,m as se,o as ce,p as de,q as pe,r as ue,s as ge,t as _e,u as fe,v as xe,w as he,y as ve}from"./chunk-2ONXJ7S3.js";import"./chunk-BWBG2IHT.js";import"./chunk-U3COC3EF.js";import{a as W,b as Y,d as Z,f as ee,g as te,i as ie}from"./chunk-K4QNRRQ5.js";import{a as ne,b as oe}from"./chunk-ASKMK2H5.js";import"./chunk-XRPHOQB2.js";import{a as we,b as ke,e as Me}from"./chunk-2H2YZZAU.js";import"./chunk-NUMYIFQH.js";import{Bb as U,Db as _,Eb as f,Ec as X,Gd as Ue,Hd as Te,Ib as J,Pb as P,Qb as a,Rb as L,S as T,Sb as S,T as E,Ta as y,Va as m,a as k,b as j,ba as F,cb as z,gc as V,h as $,ib as v,l as q,mb as d,na as M,rb as w,tb as H,ub as K,vb as n,wa as u,wb as i,wc as Q,xa as g,xb as p,yb as D,zb as O}from"./chunk-YUSEJVZ2.js";var x=[];for(let r=0;r<256;++r)x.push((r+256).toString(16).slice(1));function ze(r,e=0){return(x[r[e+0]]+x[r[e+1]]+x[r[e+2]]+x[r[e+3]]+"-"+x[r[e+4]]+x[r[e+5]]+"-"+x[r[e+6]]+x[r[e+7]]+"-"+x[r[e+8]]+x[r[e+9]]+"-"+x[r[e+10]]+x[r[e+11]]+x[r[e+12]]+x[r[e+13]]+x[r[e+14]]+x[r[e+15]]).toLowerCase()}var A,Ke=new Uint8Array(16);function G(){if(!A){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");A=crypto.getRandomValues.bind(crypto)}return A(Ke)}var Je=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),R={randomUUID:Je};function Qe(r,e,o){if(R.randomUUID&&!e&&!r)return R.randomUUID();r=r||{};let t=r.random??r.rng?.()??G();if(t.length<16)throw new Error("Random bytes length must be >= 16");if(t[6]=t[6]&15|64,t[8]=t[8]&63|128,e){if(o=o||0,o<0||o+16>e.length)throw new RangeError(`UUID byte range ${o}:${o+15} is out of buffer bounds`);for(let l=0;l<16;++l)e[o+l]=t[l];return e}return ze(t)}var B=Qe;function Xe(r,e){let o;return(o=e.get("id"))==null?null:o.value}function We(r,e){r&1&&(n(0,"div",14),p(1,"mat-progress-spinner",15),i())}function Ye(r,e){r&1&&(n(0,"mat-error"),a(1," Se requiere el nombre de la empresa. "),i())}function Ze(r,e){r&1&&(n(0,"mat-error"),a(1," Se requiere el ruc. "),i())}function et(r,e){if(r&1&&(D(0),a(1," Archivo actual: "),n(2,"a",59),a(3),i(),O()),r&2){let o=f(2);m(2),d("href",o.currentExcelImportTemplateUrl,y),m(),L(o.currentExcelImportTemplateUrl.split("/").pop()||"View Terms")}}function tt(r,e){r&1&&(n(0,"span",60),a(1,"A\xFAn no se ha cargado ning\xFAn archivo."),i())}function it(r,e){r&1&&(n(0,"p",34),a(1," Sube un archivo "),i())}function nt(r,e){if(r&1&&(n(0,"p",34),a(1),i()),r&2){let o=f(2);m(),S(" Selected: ",o.selectedExcelImportTemplateFile.name," ")}}function ot(r,e){if(r&1&&(D(0),a(1," Archivo actual: "),n(2,"a",59),a(3),i(),O()),r&2){let o=f(2);m(2),d("href",o.currentTermsUrl,y),m(),L(o.currentTermsUrl.split("/").pop()||"View Terms")}}function rt(r,e){r&1&&(n(0,"span",60),a(1,"A\xFAn no se ha cargado ning\xFAn PDF de T\xE9rminos y Condiciones."),i())}function at(r,e){r&1&&(n(0,"p",34),a(1," Sube un archivo PDF con tus t\xE9rminos y condiciones. "),i())}function lt(r,e){if(r&1&&(n(0,"p",34),a(1),i()),r&2){let o=f(2);m(),S(" Selected: ",o.selectedTermsFile.name," ")}}function mt(r,e){if(r&1){let o=U();n(0,"button",61),_("click",function(){u(o);let l=f(2);return g(l.removeGlobalNoticeImage())}),n(1,"mat-icon"),a(2,"delete_forever"),i(),a(3," Quitar imagen "),i()}}function st(r,e){r&1&&(n(0,"mat-error"),a(1," El porcentaje es requerido. "),i())}function ct(r,e){r&1&&(n(0,"mat-error"),a(1," Debe ser un valor entre 0 y 100. "),i())}function dt(r,e){r&1&&(n(0,"p",70),a(1),i()),r&2&&(m(),S(" Seleccionado: ",e.name," "))}function pt(r,e){r&1&&(n(0,"mat-error"),a(1,"Ingrese una URL v\xE1lida (ej. http:// o https://)."),i())}function ut(r,e){r&1&&(n(0,"mat-error"),a(1,"M\xE1ximo 30 caracteres."),i())}function gt(r,e){r&1&&p(0,"mat-divider",74)}function _t(r,e){if(r&1){let o=U();n(0,"mat-card",62)(1,"mat-card-header",63)(2,"mat-card-title"),a(3),i(),n(4,"button",64),_("click",function(){let l=u(o).$index,s=f(2);return g(s.removePromotionalSet(l))}),n(5,"mat-icon"),a(6,"delete_outline"),i()()(),n(7,"mat-card-content"),p(8,"input",65),n(9,"div",66)(10,"p",67),a(11,"Imagen del Conjunto"),i(),n(12,"div",68),p(13,"img",69),i(),n(14,"input",32,9),_("change",function(l){let s=u(o).$index,h=f(2);return g(h.onPromotionalSetFileSelected(l,s))}),i(),n(16,"button",33),_("click",function(){u(o);let l=P(15);return g(l.click())}),n(17,"mat-icon"),a(18,"cloud_upload"),i(),a(19),i(),v(20,dt,2,1,"p",70),i(),n(21,"mat-form-field",18)(22,"mat-label"),a(23,"Enlace (URL)"),i(),p(24,"input",71),n(25,"mat-icon",20),a(26,"link"),i(),v(27,pt,2,0,"mat-error"),i(),n(28,"mat-form-field",18)(29,"mat-label"),a(30,"Texto del Bot\xF3n"),i(),p(31,"input",72),v(32,ut,2,0,"mat-error"),i(),n(33,"mat-slide-toggle",73),a(34," Activo "),i()()(),v(35,gt,1,0,"mat-divider",74)}if(r&2){let o,t,l,s,h,b=e.$implicit,C=e.$index,c=e.$count;d("formGroupName",C),m(3),S("Conjunto ",C+1,""),m(10),J("alt","Vista previa de imagen del conjunto ",C+1,""),d("src",((o=b.get("imagePreviewUrl"))==null?null:o.value)||"assets/images/placeholder-image.png",y),m(6),S(" ",(t=b.get("imageFile"))!=null&&t.value?"Cambiar Imagen":"Subir Imagen"," "),m(),w((l=(l=b.get("imageFile"))==null?null:l.value)?20:-1,l),m(7),w((s=b.get("linkUrl"))!=null&&s.hasError("pattern")?27:-1),m(5),w((h=b.get("buttonText"))!=null&&h.hasError("maxlength")?32:-1),m(3),w(C!==c-1?35:-1)}}function ft(r,e){if(r&1){let o=U();n(0,"mat-card",16)(1,"mat-card-content")(2,"form",17),_("ngSubmit",function(){u(o);let l=f();return g(l.onSaveSettings())}),n(3,"h2"),a(4,"Nombre del negocio"),i(),n(5,"mat-form-field",18)(6,"mat-label"),a(7,"Nombre de la empresa"),i(),p(8,"input",19),n(9,"mat-icon",20),a(10,"storefront"),i(),v(11,Ye,2,0,"mat-error",21),i(),n(12,"mat-form-field",18)(13,"mat-label"),a(14,"RUC"),i(),p(15,"input",22),v(16,Ze,2,0,"mat-error",21),i(),n(17,"mat-form-field",18)(18,"mat-label"),a(19,"Direcci\xF3n"),i(),p(20,"input",23),i(),n(21,"div",24)(22,"mat-form-field",25)(23,"mat-label"),a(24,"Telefono"),i(),p(25,"input",26),n(26,"mat-icon",20),a(27,"phone"),i()()(),n(28,"mat-form-field",18)(29,"mat-label"),a(30,"Enlace del mapa de cobertura"),i(),p(31,"input",27),i(),n(32,"h2"),a(33,"Marca y aspectos legales"),i(),n(34,"div",28)(35,"p",29),a(36,"Logotipo de empresa"),i(),n(37,"div",30),p(38,"img",31),i(),n(39,"input",32,0),_("change",function(l){u(o);let s=f();return g(s.onLogoFileSelected(l))}),i(),n(41,"button",33),_("click",function(){u(o);let l=P(40);return g(l.click())}),n(42,"mat-icon"),a(43,"cloud_upload"),i(),a(44),i(),n(45,"p",34),a(46,"Recomendado: PNG, JPG, SVG. Max 2MB."),i()(),n(47,"div",28)(48,"p",29),a(49,"Imagen de fondo"),i(),n(50,"div",30),p(51,"img",35),i(),n(52,"input",32,1),_("change",function(l){u(o);let s=f();return g(s.onLogoFileSelected3(l))}),i(),n(54,"button",33),_("click",function(){u(o);let l=P(53);return g(l.click())}),n(55,"mat-icon"),a(56,"cloud_upload"),i(),a(57),i(),n(58,"p",34),a(59,"Recomendado: PNG, JPG, SVG. Max 2MB."),i()(),n(60,"div",28)(61,"p",29),a(62,"imagen de las tarifas"),i(),n(63,"div",30),p(64,"img",36),i(),n(65,"input",32,2),_("change",function(l){u(o);let s=f();return g(s.onLogoFileSelected4(l))}),i(),n(67,"button",33),_("click",function(){u(o);let l=P(66);return g(l.click())}),n(68,"mat-icon"),a(69,"cloud_upload"),i(),a(70),i(),n(71,"p",34),a(72,"Recomendado: PNG, JPG, SVG. Max 2MB."),i()(),n(73,"div",37)(74,"p",29),a(75," Plantilla de Excel para importaci\xF3n "),i(),n(76,"div",38),v(77,et,4,2,"ng-container",39)(78,tt,2,0,"ng-template",null,3,V),i(),n(80,"input",40,4),_("change",function(l){u(o);let s=f();return g(s.onLogoFileSelected5(l))}),i(),n(82,"button",33),_("click",function(){u(o);let l=P(81);return g(l.click())}),n(83,"mat-icon"),a(84,"cloud_upload"),i(),a(85),i(),v(86,it,2,0,"p",41)(87,nt,2,1,"p",41),i(),n(88,"div",37)(89,"p",29),a(90," T\xE9rminos y condiciones (PDF) "),i(),n(91,"div",38),v(92,ot,4,2,"ng-container",39)(93,rt,2,0,"ng-template",null,3,V),i(),n(95,"input",42,5),_("change",function(l){u(o);let s=f();return g(s.onTermsFileSelected(l))}),i(),n(97,"button",33),_("click",function(){u(o);let l=P(96);return g(l.click())}),n(98,"mat-icon"),a(99,"cloud_upload"),i(),a(100),i(),v(101,at,2,0,"p",41)(102,lt,2,1,"p",41),i(),n(103,"div",28)(104,"p",29),a(105,"imagen para avisos globales"),i(),n(106,"div",30),p(107,"img",43),i(),n(108,"input",32,6),_("change",function(l){u(o);let s=f();return g(s.onLogoFileSelected6(l))}),i(),n(110,"button",33),_("click",function(){u(o);let l=P(109);return g(l.click())}),n(111,"mat-icon"),a(112,"cloud_upload"),i(),a(113),i(),v(114,mt,4,0,"button",44),n(115,"p",34),a(116,"Recomendado: PNG, JPG, SVG. Max 2MB."),i()(),n(117,"mat-form-field",45)(118,"mat-label"),a(119,"Google Maps API Key"),i(),p(120,"input",46),i(),p(121,"mat-divider",47),n(122,"h2",48),a(123," Promoci\xF3n para M\xFAltiples Paquetes "),i(),n(124,"div",24)(125,"mat-form-field",25)(126,"mat-label"),a(127,"Porcentaje de Descuento (%)"),i(),p(128,"input",49),n(129,"mat-icon",20),a(130,"percent"),i(),n(131,"mat-hint"),a(132,"El descuento que se aplicar\xE1 a los paquetes adicionales en un mismo pedido."),i(),v(133,st,2,0,"mat-error",21)(134,ct,2,0,"mat-error",21),i()(),n(135,"div",24)(136,"mat-form-field",25)(137,"mat-label"),a(138,"Fecha de Inicio del Descuento"),i(),p(139,"input",50)(140,"mat-datepicker-toggle",51)(141,"mat-datepicker",null,7),n(143,"mat-hint"),a(144,"Opcional. Si se deja en blanco, el descuento es v\xE1lido desde siempre."),i()(),n(145,"mat-form-field",25)(146,"mat-label"),a(147,"Fecha de Fin del Descuento"),i(),p(148,"input",52)(149,"mat-datepicker-toggle",51)(150,"mat-datepicker",null,8),n(152,"mat-hint"),a(153,"Opcional. Si se deja en blanco, el descuento no tiene fecha de caducidad."),i()()(),p(154,"mat-divider",47),n(155,"div",53)(156,"h2"),a(157,"Conjuntos Promocionales/Banners (M\xE1x. 3)"),i(),n(158,"button",54),_("click",function(){u(o);let l=f();return g(l.addPromotionalSet())}),n(159,"mat-icon"),a(160,"add_circle_outline"),i(),a(161," A\xF1adir Conjunto "),i()(),n(162,"div",55),H(163,_t,36,10,null,null,Xe),i(),n(165,"mat-card-actions",56)(166,"button",57),_("click",function(){u(o);let l=f();return g(l.onDiscardChanges())}),a(167," Descartar cambios "),i(),n(168,"button",58)(169,"mat-icon"),a(170,"save"),i(),a(171),i()()()()()}if(r&2){let o,t,l,s,h=P(79),b=P(142),C=P(151),c=f();m(2),d("formGroup",c.settingsForm),m(9),d("ngIf",(o=c.settingsForm.get("business_name"))==null?null:o.hasError("required")),m(5),d("ngIf",(t=c.settingsForm.get("ruc"))==null?null:t.hasError("required")),m(22),d("src",c.logoPreviewUrl,y),m(6),S(" ",c.selectedLogoFile?"Cambiar Logo ("+c.selectedLogoFile.name+")":"Subir nuevo logotipo"," "),m(7),d("src",c.backgroundImagePreviewUrl,y),m(6),S(" ",c.selectedBackgroundImageFile?"Change imagen ("+c.selectedBackgroundImageFile.name+")":"Subir nueva imagen"," "),m(7),d("src",c.ratesImagePreviewUrl,y),m(6),S(" ",c.selectedRatesImageFile?"Cambiar imagen ("+c.selectedRatesImageFile.name+")":"Subir nueva imagen"," "),m(7),d("ngIf",c.currentExcelImportTemplateUrl)("ngIfElse",h),m(8),S(" ",c.selectedExcelImportTemplateFile?"Cambiar archivo ("+c.selectedExcelImportTemplateFile.name+")":"Subir nuevo archivo"," "),m(),d("ngIf",!c.selectedExcelImportTemplateFile),m(),d("ngIf",c.selectedExcelImportTemplateFile),m(5),d("ngIf",c.currentTermsUrl)("ngIfElse",h),m(8),S(" ",c.selectedTermsFile?"Cambiar PDF ("+c.selectedTermsFile.name+")":"Subir nuevo PDF"," "),m(),d("ngIf",!c.selectedTermsFile),m(),d("ngIf",c.selectedTermsFile),m(5),d("src",c.globalNoticeImagePreviewUrl,y),m(6),S(" ",c.selectedGlobalNoticeImageFile?"Cambiar imagen ("+c.selectedGlobalNoticeImageFile.name+")":"Subir nueva imagen"," "),m(),d("ngIf",c.globalNoticeImagePreviewUrl&&c.globalNoticeImagePreviewUrl!=="assets/images/placeholder-image.png"),m(19),d("ngIf",(l=c.settingsForm.get("multiPackageDiscountPercentage"))==null?null:l.hasError("required")),m(),d("ngIf",((s=c.settingsForm.get("multiPackageDiscountPercentage"))==null?null:s.hasError("min"))||((s=c.settingsForm.get("multiPackageDiscountPercentage"))==null?null:s.hasError("max"))),m(5),d("matDatepicker",b),m(),d("for",b),m(8),d("matDatepicker",C),m(),d("for",C),m(9),d("disabled",c.promotionalSetsFormArray.length>=3),m(5),K(c.promotionalSetsFormArray.controls),m(3),d("disabled",c.isSaving||!c.settingsForm.dirty),m(2),d("disabled",c.isSaving||c.settingsForm.invalid||!c.settingsForm.dirty),m(3),S(" ",c.isSaving?"Guardando...":"Guardar configuracion"," ")}}var He=class r{fb=M(he);settingsService=M(Ne);snackBar=M(De);settingsForm;isLoadingInitialData=!0;isSaving=!1;currentLogoUrl=null;selectedLogoFile=null;logoPreviewUrl=null;currentBackgroundImageUrl=null;selectedBackgroundImageFile=null;backgroundImagePreviewUrl=null;currentRatesImageUrl=null;selectedRatesImageFile=null;ratesImagePreviewUrl=null;currentExcelImportTemplateUrl=null;selectedExcelImportTemplateFile=null;currentTermsUrl=null;selectedTermsFile=null;currentGlobalNoticeImageUrl=null;selectedGlobalNoticeImageFile=null;globalNoticeImagePreviewUrl=null;destroy$=new q;get promotionalSetsFormArray(){return this.settingsForm.get("promotional_sets")}ngOnInit(){this.buildForm(N),this.loadCurrentSettings()}buildForm(e){this.settingsForm=this.fb.group({id:[e.id],business_name:[e.business_name,I.required],ruc:[e.ruc,I.required],address:[e.address],phone_number:[e.phone_number],logo_url:[e.logo_url],terms_conditions_url:[e.terms_conditions_url],global_notice_image_url:[e.global_notice_image_url],googleMapsApiKey:[e.googleMapsApiKey],background_image_url:[e.background_image_url],rates_image_url:[e.rates_image_url],coverage_map_url:[e.coverage_map_url],promotional_sets:this.fb.array(e.promotional_sets?.map(o=>this.createPromotionalSetGroup(o))),multiPackageDiscountPercentage:[e.multiPackageDiscountPercentage||0,[I.required,I.min(0),I.max(100)]],multiPackageDiscountStartDate:[e.multiPackageDiscountStartDate||null],multiPackageDiscountEndDate:[e.multiPackageDiscountEndDate||null]}),this.currentLogoUrl=e.logo_url,this.logoPreviewUrl=e.logo_url,this.currentBackgroundImageUrl=e.background_image_url,this.backgroundImagePreviewUrl=e.background_image_url,this.currentRatesImageUrl=e.rates_image_url,this.ratesImagePreviewUrl=e.rates_image_url,this.currentExcelImportTemplateUrl=e.excel_import_template_url,this.currentTermsUrl=e.terms_conditions_url,this.currentGlobalNoticeImageUrl=e.global_notice_image_url,this.globalNoticeImagePreviewUrl=e.global_notice_image_url,this.promotionalSetsFormArray.controls.forEach((o,t)=>{let l=e.promotional_sets[t];l&&o&&(o.addControl("imagePreviewUrl",this.fb.control(l.imageUrl)),o.addControl("imageFile",this.fb.control(null)))})}loadCurrentSettings(){this.isLoadingInitialData=!0,this.settingsService.loadSettings().pipe(F(this.destroy$),T(()=>this.isLoadingInitialData=!1)).subscribe({next:e=>{let o=e&&e.length>0?e[0]:N;this.promotionalSetsFormArray.clear(),(o.promotional_sets||[]).forEach(t=>{this.promotionalSetsFormArray.push(this.createPromotionalSetGroup(t))}),this.settingsForm.patchValue(j(k({},o),{promotional_sets:[]})),this.currentLogoUrl=o.logo_url,this.logoPreviewUrl=o.logo_url,this.currentBackgroundImageUrl=o.background_image_url,this.backgroundImagePreviewUrl=o.background_image_url,this.currentRatesImageUrl=o.rates_image_url,this.ratesImagePreviewUrl=o.rates_image_url,this.currentExcelImportTemplateUrl=o.excel_import_template_url,this.currentTermsUrl=o.terms_conditions_url,this.currentGlobalNoticeImageUrl=o.global_notice_image_url,this.globalNoticeImagePreviewUrl=o.global_notice_image_url},error:e=>{this.snackBar.open("No se pudo cargar la configuraci\xF3n actual. Int\xE9ntalo de nuevo.","Close",{duration:5e3,panelClass:["error-snackbar"],verticalPosition:"top"})}})}hasPendingFileUploads(){if(this.selectedLogoFile||this.selectedBackgroundImageFile||this.selectedTermsFile||this.selectedGlobalNoticeImageFile||this.selectedExcelImportTemplateFile)return!0;for(let e of this.promotionalSetsFormArray.controls)if(e.get("imageFile")?.value)return!0;return!1}createPromotionalSetGroup(e=null){let o=e?.id||B();return this.fb.group({id:[o,I.required],imageUrl:[e?.imageUrl||null],linkUrl:[e?.linkUrl||null,[I.pattern("https?://.+")]],buttonText:[e?.buttonText||null,[I.maxLength(30)]],isActive:[e?.isActive===void 0?!0:e.isActive],order:[e?.order||0],imageFile:[null],imagePreviewUrl:[e?.imageUrl||null]})}addPromotionalSet(){if(this.promotionalSetsFormArray.length<3){let e=this.createPromotionalSetGroup();this.promotionalSetsFormArray.push(e),this.settingsForm.markAsDirty()}else this.snackBar.open("Se permite un m\xE1ximo de 3 conjuntos promocionales.","OK",{duration:3e3,verticalPosition:"top"})}removePromotionalSet(e){this.promotionalSetsFormArray.removeAt(e),this.settingsForm.markAsDirty()}onPromotionalSetFileSelected(e,o){let l=e.target.files,s=this.promotionalSetsFormArray.at(o);if(l&&l.length>0){let h=l[0];s.patchValue({imageFile:h});let b=new FileReader;b.onload=C=>{s.patchValue({imagePreviewUrl:C.target.result})},b.readAsDataURL(h),this.settingsForm.markAsDirty()}else s.patchValue({imageFile:null,imagePreviewUrl:s.get("imageUrl")?.value||null})}onLogoFileSelected(e){let t=e.target.files;if(t&&t.length>0){this.selectedLogoFile=t[0];let l=new FileReader;l.onload=s=>{this.logoPreviewUrl=s.target.result},l.readAsDataURL(this.selectedLogoFile),this.settingsForm.get("logo_url")?.markAsDirty()}else this.selectedLogoFile=null,this.logoPreviewUrl=this.currentLogoUrl}onLogoFileSelected3(e){let t=e.target.files;if(t&&t.length>0){this.selectedBackgroundImageFile=t[0];let l=new FileReader;l.onload=s=>{this.backgroundImagePreviewUrl=s.target.result},l.readAsDataURL(this.selectedBackgroundImageFile),this.settingsForm.get("background_image_url")?.markAsDirty()}else this.selectedBackgroundImageFile=null,this.backgroundImagePreviewUrl=this.currentBackgroundImageUrl}onLogoFileSelected4(e){let t=e.target.files;if(t&&t.length>0){this.selectedRatesImageFile=t[0];let l=new FileReader;l.onload=s=>{this.ratesImagePreviewUrl=s.target.result},l.readAsDataURL(this.selectedRatesImageFile),this.settingsForm.get("rates_image_url")?.markAsDirty()}else this.selectedRatesImageFile=null,this.ratesImagePreviewUrl=this.currentRatesImageUrl}onLogoFileSelected5(e){let t=e.target.files;t&&t.length>0?(this.selectedExcelImportTemplateFile=t[0],this.settingsForm.get("terms_conditions_url")?.markAsDirty()):this.selectedExcelImportTemplateFile=null}onLogoFileSelected6(e){let t=e.target.files;if(t&&t.length>0){this.selectedGlobalNoticeImageFile=t[0];let l=new FileReader;l.onload=s=>{this.globalNoticeImagePreviewUrl=s.target.result},l.readAsDataURL(this.selectedGlobalNoticeImageFile),this.settingsForm.get("global_notice_image_url")?.markAsDirty()}else this.selectedGlobalNoticeImageFile=null,this.globalNoticeImagePreviewUrl=this.currentGlobalNoticeImageUrl}removeGlobalNoticeImage(){this.selectedGlobalNoticeImageFile=null,this.globalNoticeImagePreviewUrl="assets/images/placeholder-image.png",this.settingsForm.get("global_notice_image_url")?.setValue(null),this.settingsForm.get("global_notice_image_url")?.markAsDirty()}onTermsFileSelected(e){let t=e.target.files;t&&t.length>0?(this.selectedTermsFile=t[0],this.settingsForm.get("terms_conditions_url")?.markAsDirty(),console.log("Terms PDF selected:",this.selectedTermsFile.name)):this.selectedTermsFile=null}onSaveSettings(){return $(this,null,function*(){if(this.settingsForm.invalid){this.snackBar.open("Por favor corrija cualquier error en el formulario.","Close",{duration:3e3,panelClass:["error-snackbar"]}),this.settingsForm.markAllAsTouched();return}this.isSaving=!0;let e=k({},this.settingsForm.value),o=[];for(let t=0;t<this.promotionalSetsFormArray.length;t++){let l=this.promotionalSetsFormArray.at(t),s=k({},l.value);if(s.imageFile)try{let h=yield this.settingsService.uploadFile(s.imageFile).pipe(E(),F(this.destroy$)).toPromise();s.imageUrl=h?.file_url||s.imageUrl}catch(h){console.error(`Error uploading promotional set image ${t+1}:`,h),this.snackBar.open(`Error al cargar imagen del conjunto ${t+1}.`,"OK",{duration:3e3,verticalPosition:"top",panelClass:["error-snackbar"]})}delete s.imageFile,delete s.imagePreviewUrl,o.push(s)}if(e.promotional_sets=o,this.selectedLogoFile)try{let t=yield this.settingsService.uploadFile(this.selectedLogoFile).pipe(E(),F(this.destroy$)).toPromise();if(t?.file_url)e.logo_url=t.file_url;else throw new Error("Logo URL not returned from upload.")}catch(t){console.error("Logo upload failed:",t),this.snackBar.open("Error al cargar el logotipo. No se guardaron los ajustes.","Close",{duration:4e3,panelClass:["error-snackbar"],verticalPosition:"top"}),this.isSaving=!1;return}if(this.selectedBackgroundImageFile)try{let t=yield this.settingsService.uploadFile(this.selectedBackgroundImageFile).pipe(E(),F(this.destroy$)).toPromise();if(t?.file_url)e.background_image_url=t.file_url;else throw new Error("Logo URL not returned from upload.")}catch(t){console.error("Logo upload failed:",t),this.snackBar.open("Error al cargar el logotipo. No se guardaron los ajustes.","Close",{duration:4e3,panelClass:["error-snackbar"],verticalPosition:"top"}),this.isSaving=!1;return}if(this.selectedRatesImageFile)try{let t=yield this.settingsService.uploadFile(this.selectedRatesImageFile).pipe(E(),F(this.destroy$)).toPromise();if(t?.file_url)e.rates_image_url=t.file_url;else throw new Error("Logo URL not returned from upload.")}catch(t){console.error("Logo upload failed:",t),this.snackBar.open("Error al cargar el logotipo. No se guardaron los ajustes.","Close",{duration:4e3,panelClass:["error-snackbar"],verticalPosition:"top"}),this.isSaving=!1;return}if(this.selectedExcelImportTemplateFile)try{let t=yield this.settingsService.uploadFile(this.selectedExcelImportTemplateFile).pipe(E(),F(this.destroy$)).toPromise();if(t?.file_url)e.excel_import_template_url=t.file_url;else throw new Error("Logo URL not returned from upload.")}catch(t){console.error("Logo upload failed:",t),this.snackBar.open("Error al cargar el logotipo. No se guardaron los ajustes.","Close",{duration:4e3,panelClass:["error-snackbar"],verticalPosition:"top"}),this.isSaving=!1;return}if(this.selectedTermsFile)try{let t=yield this.settingsService.uploadFile(this.selectedTermsFile).pipe(E(),F(this.destroy$)).toPromise();if(t?.file_url)e.terms_conditions_url=t.file_url;else throw new Error("Terms & Conditions URL not returned from PDF upload.")}catch(t){console.error("Terms PDF upload failed:",t),this.snackBar.open("Terms & Conditions PDF upload failed. Settings not saved.","Close",{duration:4e3,panelClass:["error-snackbar"],verticalPosition:"top"}),this.isSaving=!1;return}if(this.selectedGlobalNoticeImageFile)try{let t=yield this.settingsService.uploadFile(this.selectedGlobalNoticeImageFile).pipe(E(),F(this.destroy$)).toPromise();if(t?.file_url)e.global_notice_image_url=t.file_url;else throw new Error("Logo URL not returned from upload.")}catch(t){console.error("Logo upload failed:",t),this.snackBar.open("Error al cargar el logotipo. No se guardaron los ajustes.","Close",{duration:4e3,panelClass:["error-snackbar"],verticalPosition:"top"}),this.isSaving=!1;return}else e.global_notice_image_url="";this.settingsService.saveSettings(e).pipe(F(this.destroy$),T(()=>this.isSaving=!1)).subscribe({next:t=>{this.snackBar.open("\xA1Configuraci\xF3n guardada exitosamente!","OK",{duration:3e3,verticalPosition:"top",panelClass:["success-snackbar"]}),this.buildForm(t),this.settingsForm.markAsPristine(),this.selectedLogoFile=null,this.selectedBackgroundImageFile=null,this.selectedRatesImageFile=null,this.selectedExcelImportTemplateFile=null,this.selectedTermsFile=null,this.selectedGlobalNoticeImageFile=null},error:t=>{this.snackBar.open("No se pudo guardar la configuraci\xF3n. Int\xE9ntalo de nuevo.","Retry",{duration:5e3,verticalPosition:"top",panelClass:["error-snackbar"]})}})})}onDiscardChanges(){this.loadCurrentSettings(),this.snackBar.open("Cambios descartados.","OK",{duration:2e3,verticalPosition:"top"})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(o){return new(o||r)};static \u0275cmp=z({type:r,selectors:[["app-settings-page"]],decls:6,vars:2,consts:[["logoUploadInput",""],["logoUploadInput3",""],["logoUploadInput4",""],["noTermsFile",""],["termsUploadInput2",""],["termsUploadInput",""],["logoUploadInput6",""],["startDatePicker",""],["endDatePicker",""],["promoSetUploadInput",""],[1,"page-container","settings-container"],[1,"page-header"],["class","spinner-overlay",4,"ngIf"],["class","settings-card",4,"ngIf"],[1,"spinner-overlay"],["mode","indeterminate","diameter","60"],[1,"settings-card"],[3,"ngSubmit","formGroup"],["appearance","outline",1,"full-width"],["matInput","","formControlName","business_name","required",""],["matSuffix",""],[4,"ngIf"],["matInput","","formControlName","ruc","required",""],["matInput","","formControlName","address"],[1,"form-row"],["appearance","outline",1,"flex-field"],["matInput","","formControlName","phone_number"],["matInput","","formControlName","coverage_map_url"],[1,"logo-section","file-upload-section"],[1,"mat-body-1","section-subtitle"],[1,"logo-preview-container"],["alt","Vista previa del logotipo",1,"logo-preview",3,"src"],["type","file","accept","image/png, image/jpeg, image/svg+xml",2,"display","none",3,"change"],["mat-stroked-button","","type","button",1,"upload-button","btn-corp-secondary",3,"click"],[1,"mat-caption","hint"],["alt","Vista previa del imagen de fondo",1,"logo-preview",3,"src"],["alt","Vista previa del imagen de las tarifas",1,"logo-preview",3,"src"],[1,"terms-pdf-section","file-upload-section"],[1,"current-file-info"],[4,"ngIf","ngIfElse"],["type","file",2,"display","none",3,"change"],["class","mat-caption hint",4,"ngIf"],["type","file","accept","application/pdf",2,"display","none",3,"change"],["alt","Vista previa de imagen para avisos globales",1,"logo-preview",3,"src"],["mat-stroked-button","","type","button","class","remove-button btn-corp-warn btn-corp-primary",3,"click",4,"ngIf"],["appearance","outline"],["matInput","","formControlName","googleMapsApiKey","placeholder","Pega tu API Key aqu\xED..."],[1,"section-divider"],[1,"discount-section-title"],["matInput","","type","number","formControlName","multiPackageDiscountPercentage","placeholder","Ej: 50","min","0","max","100"],["matInput","","formControlName","multiPackageDiscountStartDate","placeholder","dd/mm/aaaa",3,"matDatepicker"],["matSuffix","",3,"for"],["matInput","","formControlName","multiPackageDiscountEndDate","placeholder","dd/mm/aaaa",3,"matDatepicker"],[1,"section-header-with-action"],["mat-stroked-button","","type","button",1,"btn-corp-primary",3,"click","disabled"],["formArrayName","promotional_sets"],["align","end",1,"form-actions"],["mat-stroked-button","","type","button",1,"btn-corp-secondary",3,"click","disabled"],["mat-flat-button","","type","submit",1,"btn-corp-primary",3,"disabled"],["target","_blank",1,"file-link",3,"href"],[1,"no-file-text"],["mat-stroked-button","","type","button",1,"remove-button","btn-corp-warn","btn-corp-primary",3,"click"],["appearance","outlined",1,"promotional-set-item",3,"formGroupName"],[1,"item-header"],["mat-icon-button","","color","warn","type","button","matTooltip","Eliminar este conjunto",3,"click"],["type","hidden","formControlName","id"],[1,"file-upload-section","compact-upload"],[1,"mat-body-1"],[1,"logo-preview-container","small-preview"],[1,"logo-preview",3,"src","alt"],[1,"mat-caption","hint","selected-file-name"],["matInput","","formControlName","linkUrl","placeholder","https://ejemplo.com/oferta"],["matInput","","formControlName","buttonText","placeholder","Ej: Ver M\xE1s, Comprar Ahora","maxlength","30"],["formControlName","isActive","color","primary",1,"is-active-toggle"],[1,"item-divider"]],template:function(o,t){o&1&&(n(0,"div",10)(1,"div",11)(2,"h1"),a(3,"Configuraci\xF3n de la aplicaci\xF3n"),i()(),v(4,We,2,0,"div",12)(5,ft,172,32,"mat-card",13),i()),o&2&&(m(4),d("ngIf",t.isLoadingInitialData),m(),d("ngIf",!t.isLoadingInitialData&&t.settingsForm))},dependencies:[X,Q,ve,me,re,se,ae,le,fe,xe,_e,ge,ce,ue,de,pe,ie,W,ee,Z,te,Y,Ie,Ce,Se,Pe,be,Fe,ye,Ee,Me,ke,we,Te,Ue,Oe,oe,ne,Ve,Le,Re,Ge,qe,Be,je,$e,Ae],styles:[".page-container[_ngcontent-%COMP%]{padding:24px}.settings-container[_ngcontent-%COMP%]{max-width:800px;margin:0 auto}.page-header[_ngcontent-%COMP%]{margin-bottom:24px}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:2em;font-weight:500;color:var(--mat-toolbar-standard-title-text-color, #333)}.spinner-overlay[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;position:fixed;top:0;left:0;width:100%;height:100%;background-color:#ffffffb3;z-index:1000}h2[_ngcontent-%COMP%]{font-size:1.5em;margin-top:24px;margin-bottom:16px;padding-bottom:8px;border-bottom:1px solid rgba(0,0,0,.12);color:var(--mat-card-title-text-color, #333);font-weight:400}h2[_ngcontent-%COMP%]:first-of-type{margin-top:0}.full-width[_ngcontent-%COMP%]{width:100%;margin-bottom:20px}.form-row[_ngcontent-%COMP%]{display:flex;gap:20px;margin-bottom:20px}.form-row[_ngcontent-%COMP%]   .flex-field[_ngcontent-%COMP%]{flex:1}.logo-section[_ngcontent-%COMP%]{margin-bottom:24px;padding:16px;border:1px solid #e0e0e0;border-radius:4px;background-color:#fafafa}.logo-section[_ngcontent-%COMP%]   .mat-body-1[_ngcontent-%COMP%]{font-weight:500;margin-bottom:12px}.logo-preview-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;margin-bottom:16px;min-height:120px}.logo-preview[_ngcontent-%COMP%]{max-width:200px;max-height:100px;object-fit:contain;border:1px solid #ccc;border-radius:4px;background-color:#fff;padding:5px}.hint[_ngcontent-%COMP%]{display:block;text-align:center;color:#757575}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:10px;margin-top:32px;padding-top:24px;border-top:1px solid rgba(0,0,0,.12)}.file-upload-section[_ngcontent-%COMP%]{margin-bottom:24px;padding:16px;border:1px solid #e0e0e0;border-radius:8px;background-color:#f9f9f9}.file-upload-section[_ngcontent-%COMP%]   .section-subtitle[_ngcontent-%COMP%]{font-weight:500;margin-bottom:12px;font-size:1.1em;color:#424242}.logo-preview-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;margin-bottom:16px;min-height:120px;background-color:#f0f0f0;border-radius:4px}.logo-preview[_ngcontent-%COMP%]{max-width:200px;max-height:100px;object-fit:contain;border:1px dashed #ccc;padding:5px}.terms-pdf-section[_ngcontent-%COMP%]   .current-file-info[_ngcontent-%COMP%]{margin-bottom:12px;font-size:.9em}.terms-pdf-section[_ngcontent-%COMP%]   .current-file-info[_ngcontent-%COMP%]   .file-link[_ngcontent-%COMP%]{color:var(--mat-primary-default, #3f51b5);text-decoration:none;font-weight:500}.terms-pdf-section[_ngcontent-%COMP%]   .current-file-info[_ngcontent-%COMP%]   .file-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.terms-pdf-section[_ngcontent-%COMP%]   .current-file-info[_ngcontent-%COMP%]   .no-file-text[_ngcontent-%COMP%]{font-style:italic;color:#757575}.upload-button[_ngcontent-%COMP%]{display:block;margin:0 auto 8px}.hint[_ngcontent-%COMP%]{display:block;text-align:center;color:#757575;font-size:.85em}.section-divider[_ngcontent-%COMP%]{margin:32px 0}.section-header-with-action[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}.section-header-with-action[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0}.promotional-set-item[_ngcontent-%COMP%]{margin-bottom:24px;padding:16px;border-radius:8px}.promotional-set-item[_ngcontent-%COMP%]   .item-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding-bottom:12px;margin-bottom:16px;border-bottom:1px solid #eee}.promotional-set-item[_ngcontent-%COMP%]   .item-header[_ngcontent-%COMP%]   mat-card-title[_ngcontent-%COMP%]{font-size:1.1em;font-weight:500}.promotional-set-item[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]{padding-top:0}.compact-upload[_ngcontent-%COMP%]   .section-subtitle[_ngcontent-%COMP%]{font-size:.9em;margin-bottom:8px}.compact-upload[_ngcontent-%COMP%]   .logo-preview-container.small-preview[_ngcontent-%COMP%]{height:80px;width:auto;max-width:150px;margin-bottom:8px;border:1px dashed #ccc}.compact-upload[_ngcontent-%COMP%]   .logo-preview[_ngcontent-%COMP%]{max-height:100%;max-width:100%;object-fit:contain}.compact-upload[_ngcontent-%COMP%]   .upload-button[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:4px}.compact-upload[_ngcontent-%COMP%]   .hint[_ngcontent-%COMP%]{margin-top:0}.is-active-toggle[_ngcontent-%COMP%]{margin-top:16px;margin-bottom:8px;display:block}.item-divider[_ngcontent-%COMP%]{margin-top:0;margin-bottom:24px}.selected-file-name[_ngcontent-%COMP%]{font-style:italic;color:#555;font-size:.8em}.form-row[_ngcontent-%COMP%]{display:flex;gap:20px;margin-bottom:10px}@media (max-width: 600px){.form-row[_ngcontent-%COMP%]{flex-direction:column;gap:20px}}.form-row[_ngcontent-%COMP%]   .flex-field[_ngcontent-%COMP%]{padding-bottom:40px}.form-row[_ngcontent-%COMP%]   .flex-field[_ngcontent-%COMP%]   .mat-hint[_ngcontent-%COMP%]{font-size:.8em;color:#616161}"]})};export{He as SettingsPageComponent};
