import{a as Ot}from"./chunk-UHIREOIJ.js";import{a as be,b as Ee,c as Pe,d as De}from"./chunk-6HWJN4XJ.js";import{a as ct,b as dt,c as pt,d as ft,g as Ce,h as ht}from"./chunk-HGPHA7DX.js";import"./chunk-CL5SDS67.js";import{a as vt,b as Mt,c as Ct,d as yt,e as _t,f as xt,g as St,h as bt,i as Et,j as Pt,k as Dt,l as wt,m as Le,n as Se,o as It,p as Tt}from"./chunk-AHO7UDPR.js";import"./chunk-MS4AQ6UA.js";import{d as xe,e as Ft}from"./chunk-7I3QWZBN.js";import{a as ye,b as _e}from"./chunk-XC4JK7T6.js";import{a as pe,b as fe,c as ut,d as gt,e as ue,f as ge,g as he,h as ve}from"./chunk-MJOVE2YB.js";import{d as Me}from"./chunk-XTLFEAFI.js";import"./chunk-MW2V4VAY.js";import{a as st}from"./chunk-GEP52VOZ.js";import"./chunk-CSWUMH3X.js";import{d as me,e as le}from"./chunk-A2GZCIHE.js";import{a as de}from"./chunk-YSXPYM2V.js";import"./chunk-7RWCIHFI.js";import{C as oe,F as re,G as mt,b as W,d as R,f as X,g as Z,l as at,m as ot,o as ee,r as te,v as ne,x as ie,y as ae,z as rt}from"./chunk-I57H2NTY.js";import"./chunk-7SNYFGVH.js";import"./chunk-NTJKNPMM.js";import{a as Ze,b as et,d as tt,g as nt,i as it}from"./chunk-ABVOVIA5.js";import{a as K,b as J}from"./chunk-42JOKCMC.js";import{a as Xe}from"./chunk-QOYZNJPJ.js";import{a as lt,b as A,e as L}from"./chunk-JRHRK62N.js";import"./chunk-J25GVFCX.js";import{$b as u,Ac as Je,Bb as x,Cb as P,Cc as N,Dd as se,Ed as ce,Gc as Re,Hc as Ae,Ib as ke,Ic as We,J as Te,Jb as Be,Kb as Ne,Nb as D,Ob as a,Pb as w,Q as Oe,Qb as d,S as H,Ta as m,Vc as q,Xa as M,Xb as Q,Yb as Ye,a as O,aa as U,ab as k,ac as qe,b as $e,bc as g,gb as p,h as He,ha as Ue,kb as s,l as Ge,la as Qe,ma as G,t as ze,tb as i,tc as Y,u as F,ub as n,uc as B,va as y,vb as C,w as Ie,wa as _,wb as b,wc as Ke,xb as E,yc as T,zb as I}from"./chunk-NTZTTLCP.js";var j=class o{constructor(e){this.http=e}apiUrl=`${q.apiUrl}/cash-management`;authService=G(Xe);getAuthHeaders(){let e=this.authService.getAccessToken();return e?new Re({"Content-Type":"application/json",codrr_token:e}):new Re({"Content-Type":"application/json"})}getAllCashMovements(e,t=1,r=10,l,c){let h=this.getAuthHeaders();if(!this.authService.getAccessToken())return F(()=>new Error("Not authenticated to fetch cash movements."));let f=new Ae;if(e)for(let v in e)e.hasOwnProperty(v)&&e[v]&&(f=f.append(v,e[v]));return f=f.append("page_number",t.toString()),f=f.append("page_size",r.toString()),l&&(f=f.append("orderBy",l)),c&&(f=f.append("orderDirection",c)),this.http.get(`${this.apiUrl}/movements`,{params:f,headers:h})}getCashMovementSummary(e){let t=this.getAuthHeaders();if(!this.authService.getAccessToken())return F(()=>new Error("Not authenticated to fetch cash movement summary."));let r=new Ae;if(e)for(let l in e)e.hasOwnProperty(l)&&e[l]&&(r=r.append(l,e[l]));return this.http.get(`${this.apiUrl}/detailed-summary`,{params:r,headers:t})}createManualMovement(e){let t=this.getAuthHeaders();return this.authService.getAccessToken()?this.http.post(`${this.apiUrl}/manual-movement`,e,{headers:t}):F(()=>new Error("Not authenticated to create cash movement."))}updateCashMovement(e,t){let r=this.getAuthHeaders();return this.authService.getAccessToken()?this.http.put(`${this.apiUrl}/${e}`,t,{headers:r}):F(()=>new Error("Not authenticated to update cash movement."))}deleteCashMovement(e){let t=this.getAuthHeaders();return this.authService.getAccessToken()?this.http.delete(`${this.apiUrl}/${e}`,{headers:t}):F(()=>new Error("Not authenticated to delete cash movement."))}generatePdf(e){let t=this.getAuthHeaders().set("Accept","application/pdf");return this.authService.getAccessToken()?this.http.get(`${this.apiUrl}/${e}/pdf/ticket`,{headers:t,responseType:"blob"}):F(()=>new Error("Not authenticated to generate PDF."))}static \u0275fac=function(t){return new(t||o)(Qe(We))};static \u0275prov=Ue({token:o,factory:o.\u0275fac,providedIn:"root"})};function Qt(o,e){o&1&&(i(0,"mat-error"),a(1,"La fecha es requerida"),n())}function Yt(o,e){o&1&&(i(0,"mat-error"),a(1,"El monto es requerido"),n())}function qt(o,e){o&1&&(i(0,"mat-error"),a(1,"El monto debe ser mayor o igual a 0"),n())}function Kt(o,e){o&1&&(i(0,"mat-error"),a(1,"El tipo de movimiento es requerido"),n())}function Jt(o,e){if(o&1&&(i(0,"mat-option",19),a(1),n()),o&2){let t=e.$implicit;s("value",t),m(),w(t)}}function Wt(o,e){o&1&&(i(0,"mat-error"),a(1,"La forma de pago es requerida"),n())}function Xt(o,e){o&1&&C(0,"mat-spinner",20)}function Zt(o,e){o&1&&(i(0,"span"),a(1,"Guardar"),n())}var z=class o{constructor(e,t,r,l,c){this.fb=e;this.dialogRef=t;this.cashManagementService=r;this.snackBar=l;this.data=c;this.movementForm=this.fb.group({date:[new Date,R.required],amount:[null,[R.required,R.min(0)]],typeMovement:["",R.required],paymentsMethod:["",R.required],description:[""]})}movementForm;isLoading=!1;minDate=null;paymentMethods=["Efectivo","Yape/Transferencia BCP","Plin/Transferencia INTERBANK","POS"];ngOnInit(){if(this.data){let e=null;if(this.data.date){let t=this.data.date.split("-");e=new Date(parseInt(t[0]),parseInt(t[1])-1,parseInt(t[2]))}this.movementForm.patchValue($e(O({},this.data),{date:e}))}}onSave(){if(this.movementForm.valid&&!this.isLoading){this.isLoading=!0;let e=O({},this.movementForm.value);(this.data&&this.data.id?this.cashManagementService.updateCashMovement(this.data.id,e):this.cashManagementService.createManualMovement(e)).pipe(H(()=>this.isLoading=!1)).subscribe({next:r=>{this.snackBar.open("Movimiento registrado exitosamente","Cerrar",{duration:3e3}),this.dialogRef.close(!0)},error:r=>{this.snackBar.open("Error al registrar movimiento: "+r.message,"Cerrar",{duration:3e3}),console.error("Error creating cash movement:",r)}})}}onCancel(){this.dialogRef.close(!1)}static \u0275fac=function(t){return new(t||o)(M(ne),M(pe),M(j),M(de),M(fe))};static \u0275cmp=k({type:o,selectors:[["app-cash-movement-form"]],features:[Q([ht(),T])],decls:43,vars:14,consts:[["picker",""],["mat-dialog-title","",1,"page-header",2,"font-weight","700 !important"],[1,"cash-movement-dialog-content",3,"formGroup"],[1,"wrapper-form-field"],["appearance","outline",1,"cash-movement-form-field"],["matInput","","formControlName","date",3,"matDatepicker","min"],["matSuffix","",3,"for"],[4,"ngIf"],["matInput","","type","number","formControlName","amount","placeholder","Ej: 100.50"],["formControlName","typeMovement"],["value","INGRESO"],["value","EGRESO"],["formControlName","paymentsMethod"],[3,"value",4,"ngFor","ngForOf"],["matInput","","formControlName","description","placeholder","Ej: Compra de insumos","rows","3"],["align","end",1,"cash-movement-dialog-actions"],["mat-button","",1,"btn-corp-secondary",3,"click","disabled"],["mat-raised-button","","color","primary",1,"btn-corp-primary",3,"click","disabled"],["diameter","20",4,"ngIf"],[3,"value"],["diameter","20"]],template:function(t,r){if(t&1){let l=I();i(0,"h1",1),a(1,` Formulario de Movimiento de Caja
`),n(),i(2,"mat-dialog-content",2)(3,"div",3)(4,"mat-form-field",4)(5,"mat-label"),a(6,"Fecha"),n(),C(7,"input",5)(8,"mat-datepicker-toggle",6)(9,"mat-datepicker",null,0),p(11,Qt,2,0,"mat-error",7),n(),i(12,"mat-form-field",4)(13,"mat-label"),a(14,"Monto"),n(),C(15,"input",8),p(16,Yt,2,0,"mat-error",7)(17,qt,2,0,"mat-error",7),n(),i(18,"mat-form-field",4)(19,"mat-label"),a(20,"Tipo de Movimiento"),n(),i(21,"mat-select",9)(22,"mat-option",10),a(23,"Ingreso"),n(),i(24,"mat-option",11),a(25,"Egreso"),n()(),p(26,Kt,2,0,"mat-error",7),n(),i(27,"mat-form-field",4)(28,"mat-label"),a(29,"Forma de Pago"),n(),i(30,"mat-select",12),p(31,Jt,2,2,"mat-option",13),n(),p(32,Wt,2,0,"mat-error",7),n(),i(33,"mat-form-field",4)(34,"mat-label"),a(35,"Descripci\xF3n / Motivo"),n(),C(36,"textarea",14),n()()(),i(37,"mat-dialog-actions",15)(38,"button",16),x("click",function(){return y(l),_(r.onCancel())}),a(39," Cancelar "),n(),i(40,"button",17),x("click",function(){return y(l),_(r.onSave())}),p(41,Xt,1,0,"mat-spinner",18)(42,Zt,2,0,"span",7),n()()}if(t&2){let l,c,h,f,v,V=D(10);m(2),s("formGroup",r.movementForm),m(5),s("matDatepicker",V)("min",r.minDate),m(),s("for",V),m(3),s("ngIf",(l=r.movementForm.get("date"))==null?null:l.hasError("required")),m(5),s("ngIf",(c=r.movementForm.get("amount"))==null?null:c.hasError("required")),m(),s("ngIf",(h=r.movementForm.get("amount"))==null?null:h.hasError("min")),m(9),s("ngIf",(f=r.movementForm.get("typeMovement"))==null?null:f.hasError("required")),m(5),s("ngForOf",r.paymentMethods),m(),s("ngIf",(v=r.movementForm.get("paymentsMethod"))==null?null:v.hasError("required")),m(6),s("disabled",r.isLoading),m(2),s("disabled",r.movementForm.invalid||r.isLoading),m(),s("ngIf",r.isLoading),m(),s("ngIf",!r.isLoading)}},dependencies:[N,Y,B,ie,W,ot,X,Z,ee,te,le,me,re,ae,rt,oe,L,A,_e,ye,Me,De,be,Ee,Pe,Ce,ve,ue,he,ge,mt,J,K],styles:[".cash-movement-dialog-content[_ngcontent-%COMP%]{padding:.75rem;overflow-y:auto;max-height:50vh}.wrapper-form-field[_ngcontent-%COMP%]{padding:20px}.cash-movement-form-field[_ngcontent-%COMP%]{margin-bottom:.5rem}.cash-movement-dialog-actions[_ngcontent-%COMP%]{padding:.75rem 1rem;border-top:1px solid #eee;background-color:#f9f9f9}.cash-movement-action-button[_ngcontent-%COMP%]{padding:.5rem 1rem;font-size:.8rem;border-radius:.25rem;transition:all .2s ease-in-out}.cash-movement-action-button[_ngcontent-%COMP%]:hover{transform:translateY(-1px);box-shadow:0 1px 2px #0000001a}.cash-movement-action-button[color=primary][_ngcontent-%COMP%]{background-color:#007bff;color:#fff}.cash-movement-action-button[color=accent][_ngcontent-%COMP%]{background-color:#6c757d;color:#fff}@media (max-width: 768px){.cash-movement-dialog-content[_ngcontent-%COMP%]{padding:.5rem}.cash-movement-dialog-actions[_ngcontent-%COMP%]{padding:.5rem;flex-direction:column;gap:.4rem}.cash-movement-action-button[_ngcontent-%COMP%]{width:100%}}"]})};function tn(o,e){if(o&1&&(i(0,"mat-icon",6),a(1),n()),o&2){let t=P();s("color",t.data.iconColor||"primary"),m(),w(t.data.icon)}}var we=class o{constructor(e,t){this.dialogRef=e;this.data=t}static \u0275fac=function(t){return new(t||o)(M(pe),M(fe))};static \u0275cmp=k({type:o,selectors:[["app-confirm-dialog"]],decls:12,vars:8,consts:[[1,"confirm-dialog-container"],["class","dialog-icon",3,"color",4,"ngIf"],["mat-dialog-title",""],[2,"display","flex","flex-direction","row","flex-wrap","nowrap","border","0px solid black"],["mat-stroked-button","",1,"btn-corp-secondary",3,"mat-dialog-close"],["mat-raised-button","",1,"btn-corp-primary",3,"color","mat-dialog-close"],[1,"dialog-icon",3,"color"]],template:function(t,r){t&1&&(i(0,"div",0),p(1,tn,2,2,"mat-icon",1),i(2,"h2",2),a(3),n(),i(4,"mat-dialog-content")(5,"p"),a(6),n()(),i(7,"mat-dialog-actions",3)(8,"button",4),a(9),n(),i(10,"button",5),a(11),n()()()),t&2&&(m(),s("ngIf",r.data.icon),m(2),w(r.data.title),m(3),w(r.data.message),m(2),s("mat-dialog-close",!1),m(),d(" ",r.data.cancelButtonText," "),m(),s("color",r.data.confirmButtonColor)("mat-dialog-close",!0),m(),d(" ",r.data.confirmButtonText," "))},dependencies:[N,B,ve,gt,ue,he,ge,L,A,ce,se],styles:[".confirm-dialog-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:24px;text-align:center;border:2px solid var(--mat-dialog-container-border-color, #ccc);border-radius:8px}.dialog-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px;margin-bottom:16px}mat-dialog-title[_ngcontent-%COMP%]{font-size:1.5em;font-weight:700;margin-bottom:16px;color:var(--mat-dialog-title-color, inherit)}mat-dialog-content[_ngcontent-%COMP%]{margin-bottom:24px}"]})};var nn=()=>[5,10,20,50];function an(o,e){o&1&&(i(0,"div",49),C(1,"mat-spinner",50),n())}function on(o,e){if(o&1&&(i(0,"div",51)(1,"div",52)(2,"div",53)(3,"div",54),a(4,"Tipo"),n(),i(5,"div",54),a(6,"Efectivo"),n(),i(7,"div",54),a(8,"Yape / Transferencia BCP"),n(),i(9,"div",54),a(10," Plin / Transferencia INTERBANK "),n(),i(11,"div",54),a(12,"POS"),n()(),i(13,"div",55)(14,"div",56),a(15,"Ingreso"),n(),i(16,"div",56),a(17),u(18,"currency"),n(),i(19,"div",56),a(20),u(21,"currency"),n(),i(22,"div",56),a(23),u(24,"currency"),n(),i(25,"div",56),a(26),u(27,"currency"),n()(),i(28,"div",55)(29,"div",56),a(30,"Egreso"),n(),i(31,"div",56),a(32),u(33,"currency"),n(),i(34,"div",56),a(35),u(36,"currency"),n(),i(37,"div",56),a(38),u(39,"currency"),n(),i(40,"div",56),a(41),u(42,"currency"),n()(),i(43,"div",55)(44,"div",56),a(45,"Saldo"),n(),i(46,"div",56),a(47),u(48,"currency"),n(),i(49,"div",56),a(50),u(51,"currency"),n(),i(52,"div",56),a(53),u(54,"currency"),n(),i(55,"div",56),a(56),u(57,"currency"),n()(),i(58,"div",57)(59,"div",58),a(60,"Ingreso Caja"),n(),i(61,"div",59),a(62),u(63,"currency"),n()(),i(64,"div",57)(65,"div",58),a(66,"Egreso Caja"),n(),i(67,"div",59),a(68),u(69,"currency"),n()(),i(70,"div",57)(71,"div",58),a(72,"Total en Caja"),n(),i(73,"div",59),a(74),u(75,"currency"),n()()()()),o&2){let t=e.ngIf;m(17),d(" ",g(18,15,t.Efectivo.income,"S/ ")," "),m(3),d(" ",g(21,18,t["Yape/Transferencia BCP"].income,"S/ ")," "),m(3),d(" ",g(24,21,t["Plin/Transferencia INTERBANK"].income,"S/ ")," "),m(3),d(" ",g(27,24,t.POS.income,"S/ ")," "),m(6),d(" ",g(33,27,t.Efectivo.expense,"S/ ")," "),m(3),d(" ",g(36,30,t["Yape/Transferencia BCP"].expense,"S/ ")," "),m(3),d(" ",g(39,33,t["Plin/Transferencia INTERBANK"].expense,"S/ ")," "),m(3),d(" ",g(42,36,t.POS.expense,"S/ ")," "),m(6),d(" ",g(48,39,t.Efectivo.balance,"S/ ")," "),m(3),d(" ",g(51,42,t["Yape/Transferencia BCP"].balance,"S/ ")," "),m(3),d(" ",g(54,45,t["Plin/Transferencia INTERBANK"].balance,"S/ ")," "),m(3),d(" ",g(57,48,t.POS.balance,"S/ ")," "),m(6),d(" ",g(63,51,t.totalCashIncome,"S/ ")," "),m(6),d(" ",g(69,54,t.totalCashExpense,"S/ ")," "),m(6),d(" ",g(75,57,t.totalCashBalance,"S/ ")," ")}}function rn(o,e){if(o&1&&(i(0,"mat-option",60),a(1),n()),o&2){let t=e.$implicit;s("value",t),m(),w(t)}}function mn(o,e){o&1&&(i(0,"div",49),C(1,"mat-spinner",50),n())}function ln(o,e){o&1&&(i(0,"th",61),a(1," N\xB0 "),n())}function sn(o,e){if(o&1&&(i(0,"td",62),a(1),n()),o&2){let t=e.$implicit;m(),d(" ",t.code," ")}}function cn(o,e){o&1&&(i(0,"th",61),a(1," Fecha "),n())}function dn(o,e){if(o&1&&(i(0,"td",62),a(1),u(2,"date"),n()),o&2){let t=e.$implicit;m(),d(" ",g(2,1,t.date,"dd/MM/yyyy")," ")}}function pn(o,e){o&1&&(i(0,"th",61),a(1," Tipo "),n())}function fn(o,e){if(o&1&&(i(0,"td",62),a(1),n()),o&2){let t=e.$implicit;m(),d(" ",t.typeMovement," ")}}function un(o,e){o&1&&(i(0,"th",61),a(1," Monto "),n())}function gn(o,e){if(o&1&&(i(0,"td",62),a(1),u(2,"currency"),n()),o&2){let t=e.$implicit;m(),d(" ",g(2,1,t.amount,"S/ ")," ")}}function hn(o,e){o&1&&(i(0,"th",61),a(1," Forma de Pago "),n())}function vn(o,e){if(o&1&&(i(0,"td",62),a(1),n()),o&2){let t=e.$implicit;m(),d(" ",t.paymentsMethod," ")}}function Mn(o,e){o&1&&(i(0,"th",61),a(1," Descripci\xF3n "),n())}function Cn(o,e){if(o&1&&(i(0,"td",62),a(1),n()),o&2){let t=e.$implicit;m(),d(" ",t.description," ")}}function yn(o,e){o&1&&(i(0,"th",61),a(1," Usuario "),n())}function _n(o,e){if(o&1&&(i(0,"td",62),a(1),n()),o&2){let t=e.$implicit;m(),d(" ",t.user==null?null:t.user.username," ")}}function xn(o,e){o&1&&(i(0,"th",63),a(1," Acciones "),n())}function Sn(o,e){if(o&1){let t=I();i(0,"button",67),x("click",function(){y(t);let l=P().$implicit,c=P();return _(c.editMovement(l))}),i(1,"mat-icon"),a(2,"edit"),n(),i(3,"span"),a(4,"Editar"),n()()}}function bn(o,e){if(o&1){let t=I();i(0,"button",67),x("click",function(){y(t);let l=P().$implicit,c=P();return _(c.deleteMovement(l.id))}),i(1,"mat-icon"),a(2,"delete"),n(),i(3,"span"),a(4,"Eliminar"),n()()}}function En(o,e){if(o&1){let t=I();i(0,"td",64)(1,"button",65)(2,"mat-icon"),a(3,"more_vert"),n()(),i(4,"mat-menu",null,4),p(6,Sn,5,0,"button",66),i(7,"button",67),x("click",function(){let l=y(t).$implicit,c=P();return _(c.generatePdf(l.id))}),i(8,"mat-icon"),a(9,"picture_as_pdf"),n(),i(10,"span"),a(11,"Imprimir ticket"),n()(),p(12,bn,5,0,"button",66),n()()}if(o&2){let t=D(5),r=P();m(),s("matMenuTriggerFor",t),m(5),s("ngIf",r.isReceptionistOrAdmin()),m(6),s("ngIf",!r.isReceptionist())}}function Pn(o,e){o&1&&C(0,"tr",68)}function Dn(o,e){o&1&&C(0,"tr",69)}function wn(o,e){o&1&&(i(0,"tr",70)(1,"td",71),a(2," No hay movimientos de caja que coincidan con los filtros. "),n()())}var Fe=class o{constructor(e,t,r,l,c){this.fb=e;this.cashManagementService=t;this.dialog=r;this.snackBar=l;this.excelExportService=c;let h=new Date;this.filterForm=this.fb.group({startDate:[h],endDate:[h],typeMovement:[""],paymentsMethod:[""],userId:[""],search:[""]}),this.summaryFilterForm=this.fb.group({startDate:[h],endDate:[h]})}appStore=G(st);filterForm;summaryFilterForm;displayedColumns=["code","date","typeMovement","amount","paymentsMethod","description","user","actions"];paymentMethods=["Efectivo","Yape/Transferencia BCP","Plin/Transferencia INTERBANK","POS"];cashMovements=new Le([]);summary$=ze({Efectivo:{income:0,expense:0,balance:0},"Yape/Transferencia BCP":{income:0,expense:0,balance:0},"Plin/Transferencia INTERBANK":{income:0,expense:0,balance:0},POS:{income:0,expense:0,balance:0},totalCashIncome:0,totalCashExpense:0,totalCashBalance:0});totalItems=0;pageSize=10;pageNumber=1;datePipe=G(T);isLoadingResults=!1;isLoadingSummary=!1;paginator;sort;destroy$=new Ge;ngOnInit(){this.fetchCashMovements(this.filterForm.value),this.fetchCashMovementSummary(this.summaryFilterForm.value),this.filterForm.valueChanges.pipe(U(this.destroy$),Te(400),Oe((e,t)=>JSON.stringify(e)===JSON.stringify(t))).subscribe(e=>{this.fetchCashMovements(e)}),this.summaryFilterForm.valueChanges.pipe(U(this.destroy$),Te(400),Oe((e,t)=>JSON.stringify(e)===JSON.stringify(t))).subscribe(e=>{this.fetchCashMovementSummary(e)})}ngAfterViewInit(){this.cashMovements.sort=this.sort,this.sort.sortChange.pipe(U(this.destroy$)).subscribe(()=>{this.pageNumber=1,this.applyFilters()})}fetchCashMovements(e,t,r){let l=O({},e);l.startDate&&(l.startDate=this.datePipe.transform(l.startDate,"yyyy-MM-dd")||""),l.endDate&&(l.endDate=this.datePipe.transform(l.endDate,"yyyy-MM-dd")||""),l.search&&(l.search=l.search.trim()),this.isLoadingResults=!0,this.cashManagementService.getAllCashMovements(l,this.pageNumber,this.pageSize,t,r).pipe(H(()=>this.isLoadingResults=!1)).subscribe(c=>{this.cashMovements=new Le(c.movements),this.totalItems=c.total,this.cashMovements.sort=this.sort})}fetchCashMovementSummary(e){let t=O({},e);t.startDate&&(t.startDate=this.datePipe.transform(t.startDate,"yyyy-MM-dd")||""),t.endDate&&(t.endDate=this.datePipe.transform(t.endDate,"yyyy-MM-dd")||""),this.isLoadingSummary=!0,this.summary$=this.cashManagementService.getCashMovementSummary(t).pipe(H(()=>this.isLoadingSummary=!1))}applyFilters(){this.fetchCashMovements(this.filterForm.value,this.sort?.active,this.sort?.direction)}applySummaryFilters(){this.fetchCashMovementSummary(this.summaryFilterForm.value)}onPageChange(e){this.pageNumber=e.pageIndex+1,this.pageSize=e.pageSize,this.applyFilters()}openAddMovementDialog(){this.dialog.open(z,{width:"400px"}).afterClosed().subscribe(t=>{t&&this.applyFilters()})}editMovement(e){this.dialog.open(z,{width:"400px",data:e}).afterClosed().subscribe(r=>{r&&this.applyFilters()})}deleteMovement(e){let t={title:"Confirmar Eliminaci\xF3n",message:"\xBFEst\xE1s seguro de que quieres eliminar este movimiento de caja? Esta acci\xF3n no se puede deshacer.",confirmButtonText:"Eliminar",cancelButtonText:"Cancelar",confirmButtonColor:"warn"};this.dialog.open(we,{width:"350px",data:t}).afterClosed().subscribe(l=>{l&&this.cashManagementService.deleteCashMovement(e).subscribe({next:()=>{this.snackBar.open("Movimiento eliminado exitosamente","Cerrar",{duration:3e3}),this.applyFilters()},error:c=>{this.snackBar.open("Error al eliminar movimiento: "+c.message,"Cerrar",{duration:3e3}),console.error("Error deleting cash movement:",c)}})})}generatePdf(e){let t=q.apiUrl+"/cash-management/"+e+"/pdf/ticket";window.open(t,"_blank")}exportCashMovementsToExcel(){return He(this,null,function*(){let e=this.filterForm.value,t=this.summaryFilterForm.value;e.startDate&&(e.startDate=this.datePipe.transform(e.startDate,"yyyy-MM-dd")||""),e.endDate&&(e.endDate=this.datePipe.transform(e.endDate,"yyyy-MM-dd")||""),t.startDate&&(t.startDate=this.datePipe.transform(t.startDate,"yyyy-MM-dd")||""),t.endDate&&(t.endDate=this.datePipe.transform(t.endDate,"yyyy-MM-dd")||"");let r=this.cashManagementService.getAllCashMovements(e,1,999999),c=(yield Ie(r))?.movements||[],h=this.cashManagementService.getCashMovementSummary(t),f=yield Ie(h),v=[],V=[];v.push({label:"Fecha Inicio",value:this.datePipe.transform(t.startDate,"dd/MM/yyyy")}),v.push({label:"Fecha Fin",value:this.datePipe.transform(t.endDate,"dd/MM/yyyy")}),f&&(["Efectivo","Yape/Transferencia BCP","Plin/Transferencia INTERBANK","POS"].forEach(Ve=>{let $=f[Ve];$&&typeof $=="object"&&v.push({Tipo:Ve,Ingreso:$.income.toFixed(2),Egreso:$.expense.toFixed(2),Saldo:$.balance.toFixed(2)})}),v.push({label:"Total Ingresos",value:parseFloat(f.totalCashIncome.toFixed(2))}),v.push({label:"Total Egresos",value:parseFloat(f.totalCashExpense.toFixed(2))}),v.push({label:"Saldo Total",value:parseFloat(f.totalCashBalance.toFixed(2))})),c.forEach(S=>{V.push({"N\xB0":S.code,Fecha:this.datePipe.transform(S.date,"dd/MM/yyyy"),Tipo:S.typeMovement,Monto:parseFloat(S.amount.toFixed(2)),"Forma de Pago":S.paymentsMethod,Descripci\u00F3n:S.description,Usuario:S.user?.username||S.user?.email})});let Lt=`movimientos_caja_${this.datePipe.transform(new Date,"yyyyMMdd_HHmmss")}`;this.excelExportService.exportCashMovementSummaryAndDetailsToExcel(v,V,Lt,"Movimientos de Caja",this.datePipe.transform(e.startDate,"dd/MM/yyyy")||"",this.datePipe.transform(e.endDate,"dd/MM/yyyy")||"")})}isReceptionist(){return this.appStore.currentUser()?.role==="RECEPCIONISTA"}isReceptionistOrAdmin(){let e=this.appStore.currentUser()?.role;return e==="RECEPCIONISTA"||e==="ADMINISTRADOR"}static \u0275fac=function(t){return new(t||o)(M(ne),M(j),M(ut),M(de),M(Ot))};static \u0275cmp=k({type:o,selectors:[["app-cash-management-list-page"]],viewQuery:function(t,r){if(t&1&&(ke(xe,5),ke(Se,5)),t&2){let l;Be(l=Ne())&&(r.paginator=l.first),Be(l=Ne())&&(r.sort=l.first)}},features:[Q([T])],decls:120,vars:23,consts:[["summaryStartDatePicker",""],["summaryEndDatePicker",""],["startDatePicker",""],["endDatePicker",""],["actionsMenu","matMenu"],[1,"page-container"],[2,"display","flex","padding","10px"],[1,"mat-card-header"],[1,"mat-card-title",2,"padding","10px !important","padding-left","0px !important"],["mat-raised-button","","color","primary",1,"btn-corp-primary","btn-excel",3,"click"],[1,"mat-card","summary-section"],[1,"mat-card-title"],[1,"filter-form",3,"formGroup"],["appearance","outline",1,"w-full"],["matInput","","formControlName","startDate",3,"matDatepicker"],["matSuffix","",3,"for"],["matInput","","formControlName","endDate",3,"matDatepicker"],[1,"form-actions",2,"padding-bottom","10px !important"],["mat-raised-button","","color","primary",1,"btn-corp-primary",3,"click"],["class","loading-overlay",4,"ngIf"],["class","summary-table-container",4,"ngIf"],[1,"mat-card"],["formControlName","typeMovement"],["value",""],["value","INGRESO"],["value","EGRESO"],["formControlName","paymentsMethod"],[3,"value",4,"ngFor","ngForOf"],["matInput","","formControlName","search","placeholder","Buscar..."],[1,"form-actions"],["mat-raised-button","","color","accent",1,"btn-corp-primary",3,"click"],[1,""],["mat-table","","matSort","",1,"mat-table",3,"dataSource"],["matColumnDef","code"],["mat-header-cell","","mat-sort-header","","class","mat-header-cell",4,"matHeaderCellDef"],["mat-cell","","class","mat-cell",4,"matCellDef"],["matColumnDef","date"],["matColumnDef","typeMovement"],["matColumnDef","amount"],["matColumnDef","paymentsMethod"],["matColumnDef","description"],["matColumnDef","user"],["matColumnDef","actions"],["mat-header-cell","","class","mat-header-cell",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["showFirstLastButtons","",3,"page","length","pageSize","pageSizeOptions"],[1,"loading-overlay"],["diameter","30"],[1,"summary-table-container"],[1,"summary-table"],[1,"summary-header"],[1,"summary-cell","header-cell"],[1,"summary-row"],[1,"summary-cell"],[1,"summary-row","total-row"],[1,"summary-cell","total-label"],[1,"summary-cell","total-value"],[3,"value"],["mat-header-cell","","mat-sort-header","",1,"mat-header-cell"],["mat-cell","",1,"mat-cell"],["mat-header-cell","",1,"mat-header-cell"],["mat-cell",""],["mat-icon-button","","aria-label","Acciones",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click",4,"ngIf"],["mat-menu-item","",3,"click"],["mat-header-row",""],["mat-row",""],[1,"mat-row"],["colspan","7",1,"mat-cell"]],template:function(t,r){if(t&1){let l=I();i(0,"div",5)(1,"div",6)(2,"mat-card-header",7)(3,"mat-card-title",8),a(4,"Gesti\xF3n de Caja"),n()(),i(5,"button",9),x("click",function(){return y(l),_(r.exportCashMovementsToExcel())}),i(6,"mat-icon"),a(7,"cloud_download"),n(),a(8," Exportar a Excel "),n()(),i(9,"mat-card",10)(10,"mat-card-header",7)(11,"mat-card-title",11),a(12,"Resumen de Saldos"),n()(),i(13,"mat-card-content")(14,"form",12)(15,"mat-form-field",13)(16,"mat-label"),a(17,"Fecha Inicio Resumen"),n(),C(18,"input",14)(19,"mat-datepicker-toggle",15)(20,"mat-datepicker",null,0),n(),i(22,"mat-form-field",13)(23,"mat-label"),a(24,"Fecha Fin Resumen"),n(),C(25,"input",16)(26,"mat-datepicker-toggle",15)(27,"mat-datepicker",null,1),n()(),i(29,"div",17)(30,"button",18),x("click",function(){return y(l),_(r.applySummaryFilters())}),i(31,"mat-icon"),a(32,"filter_list"),n(),a(33," Aplicar Filtros Resumen "),n()(),p(34,an,2,0,"div",19)(35,on,76,60,"div",20),u(36,"async"),n()(),i(37,"mat-card",21)(38,"mat-card-header",7)(39,"mat-card-title",11),a(40,"Detalle de movimientos"),n()(),i(41,"mat-card",21)(42,"mat-card-content")(43,"form",12)(44,"mat-form-field",13)(45,"mat-label"),a(46,"Fecha Inicio"),n(),C(47,"input",14)(48,"mat-datepicker-toggle",15)(49,"mat-datepicker",null,2),n(),i(51,"mat-form-field",13)(52,"mat-label"),a(53,"Fecha Fin"),n(),C(54,"input",16)(55,"mat-datepicker-toggle",15)(56,"mat-datepicker",null,3),n(),i(58,"mat-form-field",13)(59,"mat-label"),a(60,"Tipo de Movimiento"),n(),i(61,"mat-select",22)(62,"mat-option",23),a(63,"Todos"),n(),i(64,"mat-option",24),a(65,"Ingreso"),n(),i(66,"mat-option",25),a(67,"Egreso"),n()()(),i(68,"mat-form-field",13)(69,"mat-label"),a(70,"Forma de Pago"),n(),i(71,"mat-select",26)(72,"mat-option",23),a(73,"Todos"),n(),p(74,rn,2,2,"mat-option",27),n()(),i(75,"mat-form-field",13)(76,"mat-label"),a(77,"Buscar"),n(),C(78,"input",28),n()(),i(79,"div",29)(80,"button",18),x("click",function(){return y(l),_(r.applyFilters())}),i(81,"mat-icon"),a(82,"filter_list"),n(),a(83," Aplicar Filtros "),n(),i(84,"button",30),x("click",function(){return y(l),_(r.openAddMovementDialog())}),i(85,"mat-icon"),a(86,"add"),n(),a(87," Registrar Movimiento "),n()()()(),i(88,"mat-card-content"),p(89,mn,2,0,"div",19),i(90,"div",31)(91,"table",32),b(92,33),p(93,ln,2,0,"th",34)(94,sn,2,1,"td",35),E(),b(95,36),p(96,cn,2,0,"th",34)(97,dn,3,4,"td",35),E(),b(98,37),p(99,pn,2,0,"th",34)(100,fn,2,1,"td",35),E(),b(101,38),p(102,un,2,0,"th",34)(103,gn,3,4,"td",35),E(),b(104,39),p(105,hn,2,0,"th",34)(106,vn,2,1,"td",35),E(),b(107,40),p(108,Mn,2,0,"th",34)(109,Cn,2,1,"td",35),E(),b(110,41),p(111,yn,2,0,"th",34)(112,_n,2,1,"td",35),E(),b(113,42),p(114,xn,2,0,"th",43)(115,En,13,3,"td",44),E(),p(116,Pn,1,0,"tr",45)(117,Dn,1,0,"tr",46)(118,wn,3,0,"tr",47),n(),i(119,"mat-paginator",48),x("page",function(h){return y(l),_(r.onPageChange(h))}),n()()()()()}if(t&2){let l=D(21),c=D(28),h=D(50),f=D(57);m(14),s("formGroup",r.summaryFilterForm),m(4),s("matDatepicker",l),m(),s("for",l),m(6),s("matDatepicker",c),m(),s("for",c),m(8),s("ngIf",r.isLoadingSummary),m(),s("ngIf",qe(36,20,r.summary$)),m(8),s("formGroup",r.filterForm),m(4),s("matDatepicker",h),m(),s("for",h),m(6),s("matDatepicker",f),m(),s("for",f),m(19),s("ngForOf",r.paymentMethods),m(15),s("ngIf",r.isLoadingResults),m(2),s("dataSource",r.cashMovements),m(25),s("matHeaderRowDef",r.displayedColumns),m(),s("matRowDefColumns",r.displayedColumns),m(2),s("length",r.totalItems)("pageSize",r.pageSize)("pageSizeOptions",Ye(22,nn))}},dependencies:[N,Y,B,Ke,Je,T,it,Ze,tt,nt,et,wt,vt,Ct,St,yt,Mt,bt,_t,xt,Et,Pt,Dt,Ft,xe,Tt,Se,It,le,me,re,ae,oe,L,A,lt,ce,se,_e,ye,Me,De,be,Ee,Pe,Ce,ie,at,W,X,Z,ee,te,J,K,ft,dt,ct,pt],styles:[".page-container[_ngcontent-%COMP%]{background-color:#f9fafb;min-height:100vh}@media (max-width: 640px){.btn-excel[_ngcontent-%COMP%]{padding:25px!important}}.mat-card[_ngcontent-%COMP%]{box-shadow:0 1px 2px #0000000d;border-radius:.2rem}.mat-card-header[_ngcontent-%COMP%]{padding:0rem .6rem;border-bottom:1px solid #e5e7eb}.mat-card-title[_ngcontent-%COMP%]{color:#1f2937;font-weight:900;font-size:1.4rem;padding:7px 7px 11px!important}.filter-form[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:.4rem}.mat-form-field[_ngcontent-%COMP%]{width:100%;margin-bottom:0;font-size:.75rem}.form-actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;gap:.3rem;margin-top:0!important;font-weight:700!important}.filter-form[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}.search-form[_ngcontent-%COMP%]{width:100%}@media (min-width: 640px){.form-actions[_ngcontent-%COMP%]{flex-direction:row}.search-form[_ngcontent-%COMP%]{width:70%}}.action-button[_ngcontent-%COMP%]{width:100%;padding:.3rem .6rem;font-size:.7rem;font-weight:600;border-radius:.15rem;transition:all .2s ease-in-out}@media (min-width: 640px){.action-button[_ngcontent-%COMP%]{width:auto}}.action-button[_ngcontent-%COMP%]:hover{transform:translateY(-1px);box-shadow:0 1px 2px #00000014}.summary-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(100px,1fr));gap:.4rem;text-align:center}.summary-card[_ngcontent-%COMP%]{padding:.1rem!important;background-color:#fff;border:1px solid #e5e7eb;border-radius:.2rem;box-shadow:0 1px 2px #00000005}.summary-card[_ngcontent-%COMP%]   .mat-card-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center}.summary-label[_ngcontent-%COMP%]{color:#4b5563;font-weight:700}.summary-value[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:700;margin-top:.05rem}.income-card[_ngcontent-%COMP%]{background-color:#e6ffe6;border-color:#6c6}.income-card[_ngcontent-%COMP%]   .summary-value[_ngcontent-%COMP%]{color:#28a745}.expense-card[_ngcontent-%COMP%]{background-color:#ffe6e6;border-color:#f66}.expense-card[_ngcontent-%COMP%]   .summary-value[_ngcontent-%COMP%]{color:#dc3545}.balance-card[_ngcontent-%COMP%]{background-color:#e6f7ff;border-color:#66b3ff}.balance-card[_ngcontent-%COMP%]   .summary-value.text-green-700[_ngcontent-%COMP%]{color:#28a745}.balance-card[_ngcontent-%COMP%]   .summary-value.text-red-700[_ngcontent-%COMP%]{color:#dc3545}.summary-table-container[_ngcontent-%COMP%]{width:100%;overflow-x:auto}.summary-table[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr repeat(4,minmax(100px,1fr));border:1px solid #817e7e;border-radius:4px;overflow:hidden;font-size:.85rem;min-width:600px}.summary-header[_ngcontent-%COMP%], .summary-row[_ngcontent-%COMP%]{display:contents}.summary-cell[_ngcontent-%COMP%]{padding:10px 15px;border:1px solid #848383;text-align:right;display:flex;align-items:center;justify-content:flex-end;border-bottom:0px;border-left:0px;color:#18191a;font-weight:500}.summary-cell[_ngcontent-%COMP%]:first-child{border-bottom:0px;text-align:left;justify-content:flex-start;font-weight:700;background-color:#f9f9f9}.header-cell[_ngcontent-%COMP%]{background-color:#012147;color:#fff;font-weight:700;text-align:center;justify-content:center}.header-cell[_ngcontent-%COMP%]:first-child{background-color:#012147;color:#fff;text-align:left;justify-content:flex-start}.total-row[_ngcontent-%COMP%]   .summary-cell[_ngcontent-%COMP%]{background-color:#f0f0f0;font-weight:700}.total-row[_ngcontent-%COMP%]   .summary-cell.total-label[_ngcontent-%COMP%]{text-align:right;justify-content:flex-end;grid-column:span 4}.total-row[_ngcontent-%COMP%]   .summary-cell.total-value[_ngcontent-%COMP%]{text-align:right;justify-content:flex-end}.mat-no-data-row[_ngcontent-%COMP%]   .mat-cell[_ngcontent-%COMP%]{text-align:center;padding-top:.4rem;padding-bottom:.4rem;color:#494b4e;font-style:italic}@media (max-width: 768px){.mat-table[_ngcontent-%COMP%]{display:block;overflow-x:auto;-webkit-overflow-scrolling:touch}}.total-row-content[_ngcontent-%COMP%]{display:flex;justify-content:space-between;width:100%}.total-row-label[_ngcontent-%COMP%], .total-row-value[_ngcontent-%COMP%]{font-weight:700}"]})};var Qi=[{path:"",component:Fe}];export{Qi as CASH_MANAGEMENT_ROUTES};
