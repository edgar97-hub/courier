import{a as Ht,b as $t,c as Ut,d as jt,g as Gt,i as Vt,j as Xt}from"./chunk-QMHZXVSZ.js";import{a as ft,b as Ct,c as bt,d as ue,g as vt,h as Ot}from"./chunk-IQ7P4FMO.js";import{c as xt}from"./chunk-TJBFE6ZB.js";import"./chunk-DCKO4P43.js";import"./chunk-F5X5MWHG.js";import{a as Mt,b as yt,c as Et,d as St,e as Pt,f as wt,g as Dt,h as kt,i as Tt,j as It,k as At,l as Ft,m as Nt,n as Ee,o as zt,p as Bt}from"./chunk-JKHIYGL6.js";import"./chunk-MS4AQ6UA.js";import{a as xe,b as Me,d as ye,e as Lt}from"./chunk-ATSYQBGL.js";import{b as Rt}from"./chunk-KHL7A25A.js";import{a as _e,b as he,c as fe,d as Ce,e as be,f as ve,g as N}from"./chunk-DHFR23OY.js";import"./chunk-AZZX5LIC.js";import"./chunk-CBDYSWLC.js";import{a as ht}from"./chunk-PVEGB46O.js";import{b as Oe}from"./chunk-GCXDXP4N.js";import"./chunk-VSNAKBDI.js";import{a as _t,d as de,e as ce}from"./chunk-6OTY6KZZ.js";import{a as pe,b as ge}from"./chunk-UQW3GR3N.js";import"./chunk-7RWCIHFI.js";import{B as gt,C as ut,F as se,G as le,b as Y,d as j,f as ee,g as te,l as lt,m as dt,o as re,r as ie,s as ct,t as mt,v as ne,x as oe,y as ae,z as pt}from"./chunk-FRZPWLDP.js";import"./chunk-75BOTU5P.js";import"./chunk-7P2R7QJN.js";import{i as at}from"./chunk-RANU6MQ7.js";import{a as st,b as J}from"./chunk-KQEP3EE2.js";import{a as ot}from"./chunk-EPJ5MZFE.js";import{a as me,b as A,e as E}from"./chunk-KVDTKOIM.js";import"./chunk-HPQO7K7D.js";import{Ab as w,Ac as y,Ba as O,Bd as F,Cd as S,Ec as Ue,Fc as je,G as f,Gb as ze,Gc as Z,H as Qe,Ha as Le,Hb as Be,Ib as He,Lb as W,M as Re,Mb as a,Nb as et,Nc as it,O as Ke,Ob as _,Pa as Je,Ra as l,Sc as nt,Tc as U,Va as P,Vb as tt,Wb as $e,Zb as B,_ as T,_a as M,a as Ae,aa as X,bc as H,eb as m,f as Fe,fa as q,h as Xe,hb as Ye,ib as c,j as G,k as qe,ka as p,nb as z,qc as rt,r as Ne,rb as n,s as h,sa as Ze,sb as o,sc as Q,ta as D,tb as u,u as We,ua as k,ub as C,v as V,vb as b,wc as $,xb as I,yc as K,zb as g}from"./chunk-W7HD34UB.js";var R=class i{apiUrlOrders=U.apiUrl+"/orders";apiUrl=U.apiUrl+"/districts";apiUrlUsers=U.apiUrl+"/users";apiUrlSettings=U.apiUrl+"/settings";http=p(Z);authService=p(ot);constructor(){}getAuthHeaders(){let e=this.authService.getAccessToken();return e?new Ue({"Content-Type":"application/json",codrr_token:e}):new Ue({"Content-Type":"application/json"})}getOrders(e,t=1,r=10,s="id",d="desc"){let v=new je().set("page_number",t.toString()).set("page_size",r.toString()).set("sort_field",s).set("sort_direction",d);console.log("filters",e),e&&(e.delivery_date&&(v=v.set("delivery_date",e.delivery_date)),e.status&&(v=v.set("status",e.status)),e.search_term&&e.search_term.trim()!==""&&(v=v.set("search_term",e.search_term.trim())));let Qt=this.getAuthHeaders();return this.authService.getAccessToken()?this.http.get(this.apiUrlOrders,{params:v,headers:Qt}).pipe(V(x=>x),f(this.handleError)):h(()=>new Error("Not authenticated to fetch users."))}getOrders2(e,t="id",r="desc"){let s=new je().set("sort_field",t).set("sort_direction",r);e&&(e.start_date&&(s=s.set("start_date",e.start_date)),e.end_date&&(s=s.set("end_date",e.end_date)),e.status&&(s=s.set("status",e.status)),e.search_term&&e.search_term.trim()!==""&&(s=s.set("search_term",e.search_term.trim())));let d=this.getAuthHeaders();return this.authService.getAccessToken()?this.http.get(this.apiUrlOrders+"/filtered-orders",{params:s,headers:d}).pipe(V(v=>v.items),f(this.handleError)):h(()=>new Error("Not authenticated to fetch users."))}getOrderStatuses(){return new Xe(e=>{e.next(["REGISTRADO","RECOGIDO","EN ALMACEN","EN TRANSITO","ENTREGADO","CANCELADO","RECHAZADO EN PUNTO","REPROGRAMADO"]),e.complete()})}getDeliveryDistricts(){let e=this.getAuthHeaders();return this.authService.getAccessToken()?this.http.get(`${this.apiUrl}/all`,{headers:e}).pipe(f(this.handleError)):h(()=>new Error("Not authenticated to fetch users."))}updateOrderShippingCost(e,t,r){let s=this.getAuthHeaders();if(!this.authService.getAccessToken())return h(()=>new Error("Not authenticated to fetch users."));let d={orderId:e,newValue:t,notes:r,action:"MODIFICACI\xD3N DEL COSTO DE ENV\xCDO"};return this.http.post(`${this.apiUrlOrders}/update-order-status`,{payload:d},{headers:s}).pipe(f(this.handleError))}getMaxPackageDimensions(){let e=this.getAuthHeaders();return this.authService.getAccessToken()?this.http.get(`${this.apiUrlSettings}/all`,{headers:e}).pipe(X(t=>console.log("OrderService: API response for max dimensions:",t)),V(t=>{if(console.log("apiResponse",t),t.length){let r="Est\xE1ndar : "+t[0].standard_measurements_length+"cmx"+t[0].standard_measurements_width+"cmx"+t[0].standard_measurements_height+"cm "+t[0].standard_measurements_weight+"kg",s="MEDIDAS MAXIMAS (Largo "+t[0].maximum_measurements_length+" cm x Ancho "+t[0].maximum_measurements_width+" cm x Alto "+t[0].maximum_measurements_height+" cm) y PESO MAXIMO ("+t[0].maximum_measurements_weight+" kilogramos)";return{max_length_cm:t[0].maximum_measurements_length,max_width_cm:t[0].maximum_measurements_width,max_height_cm:t[0].maximum_measurements_height,max_weight_kg:t[0].maximum_measurements_weight,sta_length_cm:t[0].standard_measurements_length,sta_width_cm:t[0].standard_measurements_width,sta_height_cm:t[0].standard_measurements_height,sta_weight_kg:t[0].standard_measurements_weight,volumetric_factor:t[0].volumetric_factor,standard_package_info:r,info_text:s}}return{max_length_cm:0,max_width_cm:0,max_height_cm:0,max_weight_kg:0,sta_length_cm:0,sta_width_cm:0,sta_height_cm:0,sta_weight_kg:0,volumetric_factor:0,standard_package_info:"",info_text:""}}),f(t=>(console.error("OrderService: API error fetching max package dimensions. Details:",t.message),Ne({max_length_cm:30,max_width_cm:25,max_height_cm:45,max_weight_kg:5,standard_package_info:"Est\xE1ndar : 30cmx15cmx20cm 1.5kg",info_text:"MEDIDAS MAXIMAS (Largo 30 cm x Ancho 25 cm x Alto 45 cm) y PESO MAXIMO (5 kilogramos)"}).pipe(Re(200))))):h(()=>new Error("Not authenticated to fetch users."))}calculateShippingCost(e){console.log("packageData",e),console.log("OrderService: Calculating shipping cost (simulated) for",e);let t=8;return e.package_size_type==="custom"&&(t=10,(e.package_weight_kg||0)>2&&(t+=5),((e.package_length_cm||0)>30||(e.package_width_cm||0)>25||(e.package_height_cm||0)>20)&&(t+=4)),e.delivery_district_id==="D003"&&(t+=2),Ne({shipping_cost:t}).pipe(Re(500))}createBatchOrders(e){let t=this.getAuthHeaders();return this.authService.getAccessToken()?this.http.post(`${this.apiUrlOrders}/batch-create`,e,{headers:t}).pipe(f(this.handleError)):h(()=>new Error("Not authenticated to fetch users."))}getAvailableDrivers(e){let t=this.getAuthHeaders();return this.authService.getAccessToken()?this.http.get(`${this.apiUrlUsers}/rol/MOTORIZED`,{headers:t}).pipe(f(this.handleError)):h(()=>new Error("Not authenticated to fetch users."))}assignDriverToOrder(e,t){let r=this.getAuthHeaders();return this.authService.getAccessToken()?this.http.put(`${this.apiUrlOrders}/assign-driver-to-order/`+e,{motorizedId:t},{headers:r}).pipe(f(this.handleError)):h(()=>new Error("Not authenticated to fetch users."))}rescheduleOrder(e,t,r){let s=this.getAuthHeaders();return this.authService.getAccessToken()?this.http.put(`${this.apiUrlOrders}/reschedule-order/`+e,{newDate:t,reason:r},{headers:s}).pipe(f(this.handleError)):h(()=>new Error("Not authenticated to fetch users."))}handleImportError(e){console.error("API Import Error:",e);let t={success:!1,message:"Error de comunicaci\xF3n con el servidor durante la importaci\xF3n.",errors:[{row:0,message:`Error: ${e.status} - ${e.statusText||"Error desconocido"}`}]};return e.error&&typeof e.error=="object"&&"message"in e.error&&(t=Ae(Ae({},t),e.error)),h(()=>t)}handleError(e){let t="An unknown error occurred!";return e.error instanceof ErrorEvent?t=`Error: ${e.error.message}`:(t=`Error Code: ${e.status}
Message: ${e.message||e.error?.message||"Server error"}`,e.status===0&&(t="Could not connect to the server. Please check your network or if the server is running.")),console.error("API Error in OrderService:",e),h(()=>new Error(t))}static \u0275fac=function(t){return new(t||i)};static \u0275prov=q({token:i,factory:i.\u0275fac,providedIn:"root"})};var Se=class i{filtersChanged=new O;filterForm;orderStatuses$;orderService=p(R);fb=p(ne);datePipe=p($);destroy$=new G;constructor(){this.filterForm=this.fb.group({delivery_date:[new Date],status:["ENTREGADO"],search_term:[""]}),this.orderStatuses$=this.orderService.getOrderStatuses()}ngOnInit(){console.log("OrderFiltersComponent: ngOnInit - Instance Created/Initialized"),this.emitSpecificFilters({delivery_date:this.filterForm.get("delivery_date")?.value,status:"ENTREGADO"}),this.filterForm.valueChanges.pipe(T(this.destroy$),Qe(400),Ke((e,t)=>JSON.stringify(e)===JSON.stringify(t))).subscribe(e=>{this.applyAllFilters(e)})}emitSpecificFilters(e){let t={delivery_date:e.delivery_date?this.datePipe.transform(e.delivery_date,"yyyy-MM-dd"):null,status:e.status!==void 0?e.status:null,search_term:e.search_term!==void 0?e.search_term:null};console.log("OrderFiltersComponent: Emitting SPECIFIC filters",t),this.filtersChanged.emit(t)}applyAllFilters(e){let t={delivery_date:e.delivery_date?this.datePipe.transform(e.delivery_date,"yyyy-MM-dd"):null,status:e.status||null,search_term:e.search_term?.trim()||null};this.filtersChanged.emit(t)}applyFilters(){let e=this.filterForm.value,t={delivery_date:e.delivery_date?this.datePipe.transform(e.delivery_date,"yyyy-MM-dd"):null,status:e.status||null,search_term:e.search_term?.trim()||null};this.filtersChanged.emit(t)}clearFilters(){this.filterForm.reset({delivery_date:new Date,status:null,search_term:""}),this.emitSpecificFilters({delivery_date:this.filterForm.get("delivery_date")?.value,status:"ENTREGADO"})}ngOnDestroy(){console.log("OrderFiltersComponent: ngOnDestroy - Instance Destroyed"),this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=M({type:i,selectors:[["app-order-filters"]],outputs:{filtersChanged:"filtersChanged"},features:[tt([Ot(),$])],decls:22,vars:3,consts:[["startDatePicker",""],[1,"filters-container",3,"formGroup"],[2,"min-width","100%"],["appearance","outline",2,"width","250px !important"],["matInput","","formControlName","delivery_date","placeholder","mm/dd/yyyy",3,"matDatepicker"],["matSuffix","",3,"for"],["appearance","outline"],["matInput","","formControlName","search_term","placeholder","Buscar..."],[1,"filter-actions"],["mat-flat-button","","type","button",1,"btn-corp-primary",3,"click"],["mat-stroked-button","","type","button",1,"btn-corp-secondary",3,"click"]],template:function(t,r){if(t&1){let s=I();n(0,"form",1)(1,"div",2)(2,"mat-form-field",3)(3,"mat-label"),a(4,"Fecha de entrega "),o(),u(5,"input",4)(6,"mat-datepicker-toggle",5)(7,"mat-datepicker",null,0),o()(),n(9,"mat-form-field",6)(10,"mat-label"),a(11,"Buscar"),o(),u(12,"input",7),o(),n(13,"div",8)(14,"button",9),g("click",function(){return D(s),k(r.applyFilters())}),n(15,"mat-icon"),a(16,"search"),o(),a(17," Buscar "),o(),n(18,"button",10),g("click",function(){return D(s),k(r.clearFilters())}),n(19,"mat-icon"),a(20,"clear_all"),o(),a(21," Limpiar "),o()()()}if(t&2){let s=W(8);c("formGroup",r.filterForm),l(5),c("matDatepicker",s),l(),c("for",s)}},dependencies:[y,oe,lt,Y,ee,te,re,ie,le,se,ae,ut,ce,de,jt,Ht,$t,Ut,vt,Rt,E,A,S,F],styles:[".filters-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:16px;align-items:flex-start;padding:16px;background-color:var(--sys-surface-container-low);border-radius:8px;margin-bottom:20px;box-shadow:0 1px 3px #00000014}mat-form-field[_ngcontent-%COMP%]{min-width:200px;flex-grow:1}.filter-actions[_ngcontent-%COMP%]{display:flex;gap:10px;align-items:center;padding-top:8px}@media (max-width: 768px){mat-form-field[_ngcontent-%COMP%]{width:calc(50% - 8px);min-width:unset}.filter-actions[_ngcontent-%COMP%]{width:100%;justify-content:flex-end;padding-top:16px}}@media (max-width: 480px){mat-form-field[_ngcontent-%COMP%]{width:100%}}"]})};var Ve=(x=>(x.REGISTRADO="REGISTRADO",x.RECOGIDO="RECOGIDO",x.EN_ALMACEN="EN ALMACEN",x.EN_TRANSITO="EN TRANSITO",x.ENTREGADO="ENTREGADO",x.CANCELADO="CANCELADO",x.RECHAZADO="RECHAZADO EN PUNTO",x.REPROGRAMADO="REPROGRAMADO",x))(Ve||{});function tr(i,e){i&1&&(n(0,"div",10)(1,"mat-icon",11),a(2,"broken_image"),o(),n(3,"p",12),a(4," No hay imagen de evidencia disponible o no se pudo cargar. "),o()())}var we=class i{constructor(e,t){this.dialogRef=e;this.data=t;this.data.order.product_delivery_photo_url||(this.isLoadingImage.set(!1),this.imageLoadFailed.set(!0))}isLoadingImage=Le(!0);imageLoadFailed=Le(!1);onImageLoad(){console.log("EVENTO: onImageLoad DISPARADO para URL:",this.data.order.product_delivery_photo_url),this.isLoadingImage.set(!1),this.imageLoadFailed.set(!1),console.log("Imagen cargada")}onImageError(){this.isLoadingImage.set(!1),this.imageLoadFailed.set(!0),console.error("Error al cargar la imagen de evidencia.")}onClose(){this.dialogRef.close()}static \u0275fac=function(t){return new(t||i)(P(_e),P(he))};static \u0275cmp=M({type:i,selectors:[["app-order-detail-dialog"]],decls:14,vars:2,consts:[[1,"dialog-container"],[1,"dialog-header","dialog-header-draggable"],["mat-dialog-title","",1,"dialog-title"],["mat-icon-button","","aria-label","Cerrar di\xE1logo","matTooltip","Cerrar",1,"close-button",3,"click"],[1,"evidence-dialog-content"],[1,"image-wrapper"],["alt","Foto del Pedido",1,"evidence-image",3,"src"],["class","placeholder-container",4,"ngIf"],["align","end",1,"dialog-actions"],["mat-flat-button","",1,"btn-corp-primary",3,"click"],[1,"placeholder-container"],[1,"placeholder-icon"],[1,"placeholder-text"]],template:function(t,r){t&1&&(n(0,"div",0)(1,"div",1)(2,"h2",2),a(3,"Foto del Pedido"),o(),n(4,"button",3),g("click",function(){return r.onClose()}),n(5,"mat-icon"),a(6,"close"),o()()(),n(7,"mat-dialog-content",4)(8,"div",5),u(9,"img",6),m(10,tr,5,0,"div",7),o()(),n(11,"mat-dialog-actions",8)(12,"button",9),g("click",function(){return r.onClose()}),a(13," Cerrar "),o()()()),t&2&&(l(9),c("src",r.data.order.product_delivery_photo_url,Je),l(),c("ngIf",!r.data.order.product_delivery_photo_url||r.imageLoadFailed()))},dependencies:[y,Q,N,Ce,ve,be,E,A,me,S,F,Oe,at,xt,Me,xe,Gt,J],styles:["[_nghost-%COMP%]{display:block}.dialog-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;max-height:calc(100vh - 80px)}.dialog-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:16px 24px;border-bottom:1px solid #e0e0e0;background-color:#f5f5f5}.dialog-header-draggable[_ngcontent-%COMP%]{cursor:move}h2.mat-mdc-dialog-title[_ngcontent-%COMP%]{margin:0;font-size:1.35em;font-weight:500;color:#455a64}.order-code-chip[_ngcontent-%COMP%]{font-size:.9em;color:#3f51b5;font-weight:500;margin-left:16px;flex-grow:1}.close-button[_ngcontent-%COMP%]{min-width:auto;padding:0;line-height:normal;color:#757575}.dialog-content[_ngcontent-%COMP%]{padding:20px 24px 24px;overflow-y:auto;flex-grow:1;background-color:#fff}.info-card[_ngcontent-%COMP%]{margin-bottom:24px;border:1px solid #eeeeee!important;box-shadow:none!important;border-radius:8px}.info-card[_ngcontent-%COMP%]:last-child{margin-bottom:0}.info-card[_ngcontent-%COMP%]   mat-card-header.compact-card-header[_ngcontent-%COMP%]{padding:12px 16px;display:flex;align-items:center;justify-content:space-between;background-color:#fafafa;border-bottom:1px solid #eeeeee}.info-card[_ngcontent-%COMP%]   mat-card-title[_ngcontent-%COMP%]{font-size:1.1em;font-weight:500;color:#546e7a;margin:0}.info-card[_ngcontent-%COMP%]   .status-badge-dialog[_ngcontent-%COMP%]{padding:4px 10px;border-radius:12px;font-size:.7rem;font-weight:600;text-transform:uppercase;color:#fff;line-height:1.2}.info-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]{padding:16px;font-size:.9rem}mat-grid-list[_ngcontent-%COMP%]{padding:0}mat-grid-tile[_ngcontent-%COMP%]     .mat-figure{align-items:flex-start;padding:8px}.detail-item[_ngcontent-%COMP%]{display:flex;align-items:center;width:100%;gap:10px}.detail-item[_ngcontent-%COMP%]   .detail-icon[_ngcontent-%COMP%]{color:#90a4ae;font-size:20px}.detail-item[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:flex;flex-direction:column;line-height:1.4}.interactive-detail-item[_ngcontent-%COMP%]{cursor:pointer}.interactive-detail-item[_ngcontent-%COMP%]:hover   .detail-value[_ngcontent-%COMP%]{color:#3f51b5;text-decoration:underline}.link-like[_ngcontent-%COMP%]{color:#5c6bc0;font-weight:500}.detail-label[_ngcontent-%COMP%]{font-size:.75em;color:#616161;margin-bottom:2px;font-weight:500;text-transform:uppercase;letter-spacing:.5px}.detail-value[_ngcontent-%COMP%]{color:#212121;word-break:break-word}.bold-value[_ngcontent-%COMP%]{font-weight:600;font-size:1.05em}.item-description[_ngcontent-%COMP%]{font-style:italic;color:#555;margin-bottom:12px;padding-bottom:12px;border-bottom:1px dashed #e0e0e0;font-size:.9em}.detail-block[_ngcontent-%COMP%]{margin-bottom:16px}.detail-block[_ngcontent-%COMP%]   .detail-label-block[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-size:.9em;font-weight:500;color:#607d8b;margin-bottom:6px}.detail-block[_ngcontent-%COMP%]   .detail-label-block[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px}.detail-block[_ngcontent-%COMP%]   .detail-value-block[_ngcontent-%COMP%]{font-size:.9em;color:#424242;padding-left:26px;white-space:pre-wrap}.dialog-actions[_ngcontent-%COMP%]{padding:16px 24px;border-top:1px solid #e0e0e0;background-color:#fafafa}.dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-left:8px}.dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-child{margin-left:0}.status-registrado[_ngcontent-%COMP%]{background-color:#6610f2;color:#fff}.status-recogido[_ngcontent-%COMP%]{background-color:#fd7e14;color:#fff}.status-en-almacen[_ngcontent-%COMP%]{background-color:#0d6efd;color:#fff}.status-en-transito[_ngcontent-%COMP%]{background-color:#0c1a77;color:#d0c8c8}.status-entregado[_ngcontent-%COMP%]{background-color:#198754;color:#fff}.status-no-entregado[_ngcontent-%COMP%]{background-color:#dc3545;color:#fff}.status-cancelado[_ngcontent-%COMP%]{background-color:#6c757d;color:#fff}.status-rechazado-en-punto[_ngcontent-%COMP%]{background-color:#ff6b6b;color:#fff}.status-reprogramado[_ngcontent-%COMP%]{background-color:#adb5bd;color:#212529}.status-desconocido[_ngcontent-%COMP%]{background-color:#9e9e9e;color:#fff}.evidence-dialog-content[_ngcontent-%COMP%]{display:flex!important;justify-content:center!important;align-items:center!important}.image-wrapper[_ngcontent-%COMP%]{width:300px;height:300px}.evidence-image[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;display:block}"]})};function rr(i,e){i&1&&(n(0,"mat-error"),a(1,"El nuevo costo es obligatorio."),o())}function ir(i,e){i&1&&(n(0,"mat-error"),a(1,"El costo no puede ser negativo."),o())}function nr(i,e){i&1&&(n(0,"mat-error"),a(1,"El motivo es obligatorio."),o())}function or(i,e){i&1&&(n(0,"mat-error"),a(1,"El motivo debe tener al menos 5 caracteres."),o())}var De=class i{constructor(e,t,r){this.fb=e;this.dialogRef=t;this.data=r}editCostForm;isLoading=!1;ngOnInit(){this.editCostForm=this.fb.group({shipping_cost:[this.data.currentShippingCost,[j.required,j.min(0)]],observation_shipping_cost_modification:["",[j.required,j.minLength(5)]]})}get shippingCostCtrl(){return this.editCostForm.get("shipping_cost")}get observationCtrl(){return this.editCostForm.get("observation_shipping_cost_modification")}onConfirm(){this.editCostForm.valid?this.dialogRef.close({newShippingCost:parseFloat(this.shippingCostCtrl?.value),observation:this.observationCtrl?.value.trim()}):this.editCostForm.markAllAsTouched()}onCancel(){this.dialogRef.close()}static \u0275fac=function(t){return new(t||i)(P(ne),P(_e),P(he))};static \u0275cmp=M({type:i,selectors:[["app-edit-shipping-cost-dialog"]],decls:31,vars:14,consts:[[1,"dialog-container"],[1,"dialog-header"],["mat-dialog-title",""],[1,"order-code-chip"],[1,"dialog-content",3,"formGroup"],[1,"current-cost-info"],["appearance","outline",1,"full-width"],["matInput","","formControlName","shipping_cost","type","number","min","0","step","0.01","required","","placeholder","0.00"],["matTextPrefix",""],["appearance","outline",1,"full-width","reason-field"],["matInput","","formControlName","observation_shipping_cost_modification","rows","2","cdkTextareaAutosize","","cdkAutosizeMinRows","2","cdkAutosizeMaxRows","4","required","","placeholder","Explique brevemente por qu\xE9 se est\xE1 modificando el costo..."],["align","end",1,"dialog-actions"],["mat-stroked-button","",1,"cancel-button","btn-corp-secondary",3,"click"],["mat-flat-button","","color","primary",1,"confirm-button","btn-corp-primary",3,"click","disabled"]],template:function(t,r){t&1&&(n(0,"div",0)(1,"div",1)(2,"h2",2),a(3,"Modificar Costo de Env\xEDo"),o(),n(4,"span",3),a(5),o()(),n(6,"mat-dialog-content",4)(7,"p",5),a(8," Costo de Env\xEDo Actual: "),n(9,"strong"),a(10),B(11,"currency"),o()(),n(12,"mat-form-field",6)(13,"mat-label"),a(14,"Nuevo Costo de Env\xEDo (S/)"),o(),u(15,"input",7),n(16,"span",8),a(17,"S/\xA0"),o(),m(18,rr,2,0,"mat-error")(19,ir,2,0,"mat-error"),o(),n(20,"mat-form-field",9)(21,"mat-label"),a(22,"Motivo del Ajuste de Costo"),o(),u(23,"textarea",10),m(24,nr,2,0,"mat-error")(25,or,2,0,"mat-error"),o()(),n(26,"mat-dialog-actions",11)(27,"button",12),g("click",function(){return r.onCancel()}),a(28," Cancelar "),o(),n(29,"button",13),g("click",function(){return r.onConfirm()}),a(30),o()()()),t&2&&(l(5),_("Pedido N\xB0: ",r.data.orderCode,""),l(),c("formGroup",r.editCostForm),l(4),et(H(11,9,r.data.currentShippingCost,"PEN","S/ ","1.2-2")),l(8),z(r.shippingCostCtrl!=null&&r.shippingCostCtrl.hasError("required")&&(r.shippingCostCtrl!=null&&r.shippingCostCtrl.touched)?18:-1),l(),z(r.shippingCostCtrl!=null&&r.shippingCostCtrl.hasError("min")&&(r.shippingCostCtrl!=null&&r.shippingCostCtrl.touched)?19:-1),l(5),z(r.observationCtrl!=null&&r.observationCtrl.hasError("required")&&(r.observationCtrl!=null&&r.observationCtrl.touched)?24:-1),l(),z(r.observationCtrl!=null&&r.observationCtrl.hasError("minlength")&&(r.observationCtrl!=null&&r.observationCtrl.touched)?25:-1),l(4),c("disabled",r.editCostForm.invalid||r.isLoading),l(),_(" ",r.isLoading?"Guardando...":"Guardar Cambios"," "))},dependencies:[y,K,oe,Y,dt,ee,te,mt,ct,re,ie,N,Ce,ve,be,le,se,ae,pt,gt,ce,de,_t,E,A,S],styles:['.dialog-container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.dialog-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:20px 24px 16px;border-bottom:1px solid #eee;background-color:#f9f9f9}.dialog-header[_ngcontent-%COMP%]   .header-icon[_ngcontent-%COMP%]{color:"";font-size:28px;height:28px;width:28px}.dialog-header[_ngcontent-%COMP%]   h2.mat-mdc-dialog-title[_ngcontent-%COMP%]{margin:0;font-size:1.3em;font-weight:500;color:"";flex-grow:1}.order-code-chip[_ngcontent-%COMP%]{font-size:.85em;color:#555;background-color:#f0f0f0;padding:4px 10px;border-radius:16px}.dialog-content[_ngcontent-%COMP%]{padding:24px;min-width:400px}.current-cost-info[_ngcontent-%COMP%]{margin-bottom:24px;font-size:1em;color:#444;padding:10px;background-color:#eceff1;border-radius:4px}.current-cost-info[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-weight:600;color:#263238}.full-width[_ngcontent-%COMP%]{width:100%}.reason-field[_ngcontent-%COMP%]{margin-top:20px}.reason-field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{min-height:70px}.dialog-actions[_ngcontent-%COMP%]{padding:16px 24px;border-top:1px solid #eee;background-color:#f9f9f9}.dialog-actions[_ngcontent-%COMP%]   .cancel-button[_ngcontent-%COMP%]{margin-right:8px}']})};var ar=()=>[10,25,50,100],sr=()=>({"highlight-row":!1});function lr(i,e){i&1&&(n(0,"div",29),u(1,"mat-progress-spinner",30),o())}function dr(i,e){i&1&&(n(0,"th",31),a(1,"N\xB0 Pedido"),o())}function cr(i,e){if(i&1&&(n(0,"td",32),a(1),o()),i&2){let t=e.$implicit;l(),_(" ",t.code," ")}}function mr(i,e){i&1&&(n(0,"th",31),a(1,"Empresa"),o())}function pr(i,e){if(i&1&&(n(0,"td",33),a(1),o()),i&2){let t=e.$implicit;c("matTooltip",t.company==null?null:t.company.username),l(),_(" ",t.company==null?null:t.company.username," ")}}function gr(i,e){i&1&&(n(0,"th",31),a(1,"Tipo Pedido"),o())}function ur(i,e){if(i&1&&(n(0,"td",34),a(1),o()),i&2){let t=e.$implicit;l(),_(" ",t.shipment_type," ")}}function _r(i,e){i&1&&(n(0,"th",31),a(1,"Destinatario"),o())}function hr(i,e){if(i&1&&(n(0,"td",33),a(1),o()),i&2){let t=e.$implicit;c("matTooltip",t.recipient_name),l(),_(" ",t.recipient_name," ")}}function fr(i,e){i&1&&(n(0,"th",31),a(1,"Telefono"),o())}function Cr(i,e){if(i&1&&(n(0,"td",34),a(1),o()),i&2){let t=e.$implicit;l(),_(" ",t.recipient_phone," ")}}function br(i,e){i&1&&(n(0,"th",31),a(1,"Distrito"),o())}function vr(i,e){if(i&1&&(n(0,"td",34),a(1),o()),i&2){let t=e.$implicit;l(),_(" ",t.delivery_district_name," ")}}function Or(i,e){i&1&&(n(0,"th",31),a(1,"Direcci\xF3n"),o())}function xr(i,e){if(i&1&&(n(0,"td",34),a(1),o()),i&2){let t=e.$implicit;l(),_(" ",t.delivery_address," ")}}function Mr(i,e){i&1&&(n(0,"th",35),a(1," Cobrar "),o())}function yr(i,e){if(i&1&&(n(0,"td",36),a(1),B(2,"currency"),o()),i&2){let t=e.$implicit;l(),_(" ",H(2,1,t.amount_to_collect_at_delivery,"PEN","","1.2-2")," ")}}function Er(i,e){i&1&&(n(0,"th",35),a(1," Costo envio "),o())}function Sr(i,e){if(i&1&&(n(0,"td",36),a(1),B(2,"currency"),o()),i&2){let t=e.$implicit;l(),_(" ",H(2,1,t.shipping_cost,"PEN","","1.2-2")," ")}}function Pr(i,e){i&1&&(n(0,"th",37),a(1," Motivo del ajuste del costo envio "),o())}function wr(i,e){if(i&1&&(n(0,"td",38),a(1),o()),i&2){let t=e.$implicit;c("matTooltip",t.observation_shipping_cost_modification),l(),_(" ",t.observation_shipping_cost_modification," ")}}function Dr(i,e){i&1&&(n(0,"th",39),a(1," Acciones "),o())}function kr(i,e){if(i&1){let t=I();n(0,"button",44),g("click",function(){D(t);let s=w().$implicit,d=w();return k(d.onViewOrderDetails(s))}),n(1,"mat-icon"),a(2,"photo"),o(),n(3,"span"),a(4,"Visualizar evidencia"),o()()}}function Tr(i,e){if(i&1){let t=I();n(0,"button",44),g("click",function(){D(t);let s=w().$implicit,d=w();return k(d.onViewPdf(s))}),n(1,"mat-icon"),a(2,"download"),o(),n(3,"span"),a(4,"Descargar evidencia"),o()()}}function Ir(i,e){if(i&1){let t=I();n(0,"button",44),g("click",function(){D(t);let s=w().$implicit,d=w();return k(d.openEditShippingCostModal(s))}),n(1,"mat-icon"),a(2,"price_change"),o(),n(3,"span"),a(4,"Modificar Costo Env\xEDo"),o()()}}function Ar(i,e){if(i&1&&(n(0,"td",40)(1,"button",41)(2,"mat-icon"),a(3,"more_vert"),o()(),n(4,"mat-menu",42,0),m(6,kr,5,0,"button",43)(7,Tr,5,0,"button",43)(8,Ir,5,0,"button",43),o()()),i&2){let t=e.$implicit,r=W(5),s=w();l(),c("matMenuTriggerFor",r),l(5),c("ngIf",t.product_delivery_photo_url),l(),c("ngIf",t.product_delivery_photo_url),l(),c("ngIf",s.hashavePermissionEdit())}}function Fr(i,e){i&1&&u(0,"tr",45)}function Nr(i,e){i&1&&u(0,"tr",46),i&2&&c("ngClass",$e(1,sr))}function Rr(i,e){if(i&1&&(n(0,"tr",47)(1,"td",48),a(2," No se encontraron pedidos que coincidan con los filtros. "),o()()),i&2){let t=w();l(),Ye("colspan",t.displayedColumns.length)}}var ke=class i{constructor(e){this.http=e}appStore=p(ht);orders=[];isLoading=!1;totalCount=0;pageSize=10;pageIndex=0;pageChanged=new O;sortChanged=new O;statusChanged=new O;motorizedChanged=new O;rescheduleChanged=new O;viewPdfClicked=new O;viewDetailsClicked=new O;shippingCostChanged=new O;displayedColumns=["code","company","shipment_type","recipient_name","recipient_phone","delivery_district_name","delivery_address","amount_to_collect_at_delivery","shipping_cost","observation_shipping_cost_modification","actions"];dataSource=new Nt;paginator;sort;dialog=p(fe);snackBar=p(pe);OrderStatus=Ve;ngOnChanges(e){e.orders&&this.orders&&(this.dataSource.data=this.orders)}ngAfterViewInit(){}canMarkAs(e,t){let r=e.status;return!1}onViewPdf(e){this.http.get(e.product_delivery_photo_url||"",{responseType:"blob"}).subscribe(t=>{let r=document.createElement("a");r.href=URL.createObjectURL(t),r.download="filename",document.body.appendChild(r),r.click(),document.body.removeChild(r)})}onSeguimiento(e){window.open("/tracking?code="+e.tracking_code,"_blank")}onViewOrderDetails(e){this.viewDetailsClicked.emit(e),this.dialog.open(we,{width:"750px",maxWidth:"90vw",maxHeight:"90vh",data:{order:e},panelClass:"order-detail-dialog-responsive",autoFocus:"dialog"})}onReschedule(e){console.log("Reschedule order:",e.code),this.snackBar.open('Funci\xF3n "Reprogramar" no implementada.',"OK",{duration:2e3})}openEditShippingCostModal(e){if(!e.id||e.shipping_cost===void 0||e.shipping_cost===null){console.error("Order ID or current shipping cost is missing for editing.",e),this.snackBar.open("No se puede modificar el costo: faltan datos del pedido.","Cerrar",{duration:3e3});return}this.dialog.open(De,{width:"500px",data:{orderCode:e.code||e.id.toString(),currentShippingCost:e.shipping_cost},disableClose:!0}).afterClosed().subscribe(r=>{r?(console.log("Edit Shipping Cost Dialog result:",r),this.shippingCostChanged.emit({orderId:e.id,newShippingCost:r.newShippingCost,observation:r.observation})):console.log("Edici\xF3n de costo de env\xEDo cancelada.")})}hashavePermissionEdit(){let e=this.appStore.currentUser()?.role;return e==="ADMINISTRADOR"||e==="RECEPCIONISTA"}static \u0275fac=function(t){return new(t||i)(P(Z))};static \u0275cmp=M({type:i,selectors:[["app-order-table"]],viewQuery:function(t,r){if(t&1&&(ze(ye,5),ze(Ee,5)),t&2){let s;Be(s=He())&&(r.paginator=s.first),Be(s=He())&&(r.sort=s.first)}},inputs:{orders:"orders",isLoading:"isLoading",totalCount:"totalCount",pageSize:"pageSize",pageIndex:"pageIndex"},outputs:{pageChanged:"pageChanged",sortChanged:"sortChanged",statusChanged:"statusChanged",motorizedChanged:"motorizedChanged",rescheduleChanged:"rescheduleChanged",viewPdfClicked:"viewPdfClicked",viewDetailsClicked:"viewDetailsClicked",shippingCostChanged:"shippingCostChanged"},features:[Ze],decls:40,vars:10,consts:[["orderActionMenu","matMenu"],[1,"table-wrapper","mat-elevation-z4"],["class","spinner-overlay",4,"ngIf"],["mat-table","","matSort","",1,"orders-table",3,"matSortChange","dataSource"],["matColumnDef","code"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","","class","",4,"matCellDef"],["matColumnDef","company"],["mat-cell","","class","truncate-texts",3,"matTooltip",4,"matCellDef"],["matColumnDef","shipment_type"],["mat-cell","",4,"matCellDef"],["matColumnDef","recipient_name"],["matColumnDef","recipient_phone"],["matColumnDef","delivery_district_name"],["matColumnDef","delivery_address"],["matColumnDef","amount_to_collect_at_delivery"],["mat-header-cell","","mat-sort-header","","class","align-right",4,"matHeaderCellDef"],["mat-cell","","class","align-right amount-cell",4,"matCellDef"],["matColumnDef","shipping_cost"],["matColumnDef","observation_shipping_cost_modification"],["mat-header-cell","","mat-sort-header","","class","align-center",4,"matHeaderCellDef"],["mat-cell","","class","truncate-texts","style","min-width: 145px; border: 0px solid black",3,"matTooltip",4,"matCellDef"],["matColumnDef","actions"],["mat-header-cell","","class","actions-column-header",4,"matHeaderCellDef"],["mat-cell","","class","actions-cell",4,"matCellDef"],["mat-header-row","","class","header-row-sticky",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","","class","data-row",3,"ngClass",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["showFirstLastButtons","","aria-label","Seleccione p\xE1gina de pedidos",3,"page","length","pageSize","pageIndex","pageSizeOptions"],[1,"spinner-overlay"],["mode","indeterminate","diameter","60"],["mat-header-cell","","mat-sort-header",""],["mat-cell","",1,""],["mat-cell","",1,"truncate-texts",3,"matTooltip"],["mat-cell",""],["mat-header-cell","","mat-sort-header","",1,"align-right"],["mat-cell","",1,"align-right","amount-cell"],["mat-header-cell","","mat-sort-header","",1,"align-center"],["mat-cell","",1,"truncate-texts",2,"min-width","145px","border","0px solid black",3,"matTooltip"],["mat-header-cell","",1,"actions-column-header"],["mat-cell","",1,"actions-cell"],["mat-icon-button","",1,"action-icon-neutral",3,"matMenuTriggerFor"],["xPosition","before"],["mat-menu-item","",3,"click",4,"ngIf"],["mat-menu-item","",3,"click"],["mat-header-row","",1,"header-row-sticky"],["mat-row","",1,"data-row",3,"ngClass"],[1,"mat-row"],[1,"no-data-cell"]],template:function(t,r){t&1&&(n(0,"div",1),m(1,lr,2,0,"div",2),n(2,"table",3),g("matSortChange",function(d){return r.sortChanged.emit(d)}),C(3,4),m(4,dr,2,0,"th",5)(5,cr,2,1,"td",6),b(),C(6,7),m(7,mr,2,0,"th",5)(8,pr,2,2,"td",8),b(),C(9,9),m(10,gr,2,0,"th",5)(11,ur,2,1,"td",10),b(),C(12,11),m(13,_r,2,0,"th",5)(14,hr,2,2,"td",8),b(),C(15,12),m(16,fr,2,0,"th",5)(17,Cr,2,1,"td",10),b(),C(18,13),m(19,br,2,0,"th",5)(20,vr,2,1,"td",10),b(),C(21,14),m(22,Or,2,0,"th",5)(23,xr,2,1,"td",10),b(),C(24,15),m(25,Mr,2,0,"th",16)(26,yr,3,6,"td",17),b(),C(27,18),m(28,Er,2,0,"th",16)(29,Sr,3,6,"td",17),b(),C(30,19),m(31,Pr,2,0,"th",20)(32,wr,2,2,"td",21),b(),C(33,22),m(34,Dr,2,0,"th",23)(35,Ar,9,4,"td",24),b(),m(36,Fr,1,0,"tr",25)(37,Nr,1,2,"tr",26)(38,Rr,3,1,"tr",27),o(),n(39,"mat-paginator",28),g("page",function(d){return r.pageChanged.emit(d)}),o()()),t&2&&(l(),c("ngIf",r.isLoading),l(),c("dataSource",r.dataSource),l(34),c("matHeaderRowDef",r.displayedColumns)("matHeaderRowDefSticky",!0),l(),c("matRowDefColumns",r.displayedColumns),l(2),c("length",r.totalCount)("pageSize",r.pageSize)("pageIndex",r.pageIndex)("pageSizeOptions",$e(9,ar)))},dependencies:[y,rt,Q,K,Ft,Mt,Et,Dt,St,yt,kt,Pt,wt,Tt,It,At,Lt,ye,Bt,Ee,zt,J,st,E,me,S,F,Me,xe,ue,Ct,ft,bt,N,ge,Oe],styles:["[_nghost-%COMP%]{display:block}.table-wrapper[_ngcontent-%COMP%]{position:relative;overflow:auto;background-color:var(--sys-surface);color:var(--sys-on-surface);margin-top:20px;box-shadow:0 4px 20px #00000014;transition:box-shadow .3s ease-in-out}.table-wrapper[_ngcontent-%COMP%]:hover{box-shadow:0 6px 25px #0000001f}.spinner-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background-color:rgba(var(--sys-surface),.85);display:flex;justify-content:center;align-items:center;z-index:100;border-radius:12px}.orders-table[_ngcontent-%COMP%]{border:1px solid black!important;min-width:100%!important;border-collapse:collapse}th.mat-header-cell[_ngcontent-%COMP%]{font-weight:600;color:var(--sys-on-surface-variant);background-color:var(--sys-surface-container-low);padding:14px 18px;border-bottom:1px solid var(--sys-outline-variant);text-transform:uppercase;font-size:.8rem;letter-spacing:.5px}td.mat-cell[_ngcontent-%COMP%]{padding:12px 18px;border-bottom:1px solid var(--sys-outline-variant);color:var(--sys-on-surface-variant);font-size:.9rem}.header-row-sticky[_ngcontent-%COMP%]{position:sticky;top:0;z-index:10;background-color:var(--sys-surface-container-low)}.data-row[_ngcontent-%COMP%]{transition:background-color .2s ease-in-out}.data-row[_ngcontent-%COMP%]:hover{background-color:var(--sys-surface-container-highest);cursor:pointer}.highlight-row[_ngcontent-%COMP%]{background-color:var(--sys-primary-container)!important;font-weight:500}.align-right[_ngcontent-%COMP%]{text-align:right;justify-content:flex-end}.amount-cell[_ngcontent-%COMP%]{font-weight:500}.actions-column-header[_ngcontent-%COMP%]{text-align:center!important}.actions-cell[_ngcontent-%COMP%]{text-align:center;white-space:nowrap}.action-icon-delivered[_ngcontent-%COMP%]{color:#4caf50}.action-icon-delivered[_ngcontent-%COMP%]:hover{color:#388e3c}.action-icon-neutral[_ngcontent-%COMP%]{color:var(--sys-on-surface-variant)}.action-icon-neutral[_ngcontent-%COMP%]:hover{color:var(--sys-on-surface)}.no-data-cell[_ngcontent-%COMP%]{text-align:center;padding:50px;font-style:italic;color:var(--sys-on-surface-variant);font-size:1rem}.mat-mdc-paginator[_ngcontent-%COMP%]{background-color:var(--sys-surface-container-low);border-bottom-left-radius:12px;border-bottom-right-radius:12px;color:var(--sys-on-surface-variant);border-top:1px solid var(--sys-outline-variant);padding:8px 0}.truncate-text[_ngcontent-%COMP%]{max-width:180px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:inline-block;vertical-align:middle}.code-cell[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#3f51b5;text-decoration:none;font-weight:500}.code-cell[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}.status-badge[_ngcontent-%COMP%]{padding:5px 12px;border-radius:16px;font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.5px;display:inline-flex;align-items:center;line-height:1}.status-registrado[_ngcontent-%COMP%]{background-color:var(--status-registrado-bg);color:var(--status-registrado-color)}.status-recogido[_ngcontent-%COMP%]{background-color:var(--status-recogido-bg);color:var(--status-recogido-color)}.status-en-almacen[_ngcontent-%COMP%]{background-color:var(--status-en-almacen-bg);color:var(--status-en-almacen-color)}.status-en-transito[_ngcontent-%COMP%]{background-color:var(--status-en-transito-bg);color:var(--status-en-transito-color)}.status-entregado[_ngcontent-%COMP%]{background-color:var(--status-entregado-bg);color:var(--status-entregado-color)}.status-no-entregado[_ngcontent-%COMP%]{background-color:var(--status-no-entregado-bg);color:var(--status-no-entregado-color)}.status-cancelado[_ngcontent-%COMP%]{background-color:var(--status-cancelado-bg);color:var(--status-cancelado-color)}.status-rechazado-en-punto[_ngcontent-%COMP%]{background-color:var(--status-rechazado-bg);color:var(--status-rechazado-color)}.status-reprogramado[_ngcontent-%COMP%]{background-color:var(--status-reprogramado-bg);color:var(--status-reprogramado-color)}@media (max-width: 768px){th.mat-header-cell[_ngcontent-%COMP%], td.mat-cell[_ngcontent-%COMP%]{padding:8px 12px;font-size:.75rem}}"]})};var Lr="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-TFG-8",zr=".xlsx",Te=class i{constructor(){}exportAsExcelFile(e,t,r="Sheet1"){if(!e||e.length===0){console.warn("No data provided for Excel export.");return}let s=Xt.json_to_sheet(e),d={Sheets:{[r]:s},SheetNames:[r]},v=Vt(d,{bookType:"xlsx",type:"array"});this.saveAsExcelFile(v,t)}saveAsExcelFile(e,t){let r=new Blob([e],{type:Lr}),s=window.URL.createObjectURL(r),d=document.createElement("a");d.href=s,d.download=`${t}${zr}`,document.body.appendChild(d),d.click(),document.body.removeChild(d),window.URL.revokeObjectURL(s)}static \u0275fac=function(t){return new(t||i)};static \u0275prov=q({token:i,factory:i.\u0275fac,providedIn:"root"})};var Ie=class i{orderService=p(R);router=p(it);snackBar=p(pe);dialog=p(fe);excelExportService=p(Te);datePipe=p($);orders=[];isLoading=!1;totalOrderCount=0;currentPageIndex=0;currentPageSize=10;currentSortField="registration_date";currentSortDirection="desc";filterCriteriaSubject=new qe({});destroy$=new G;constructor(){}ngOnInit(){this.filterCriteriaSubject.pipe(T(this.destroy$),X(()=>this.currentPageIndex=0)).subscribe(e=>{this.fetchOrders()})}getAllFilteredOrdersForExport(){return Fe(this,null,function*(){try{let e=this.filterCriteriaSubject.value;return(yield We(this.orderService.getOrders2(e,this.currentSortField,this.currentSortDirection).pipe(T(this.destroy$))))||[]}catch(e){return console.error("Error fetching all filtered orders for export:",e),this.snackBar.open("Failed to fetch data for export.","Close",{duration:3e3,panelClass:["error-snackbar"]}),[]}})}exportDataToExcel(){return Fe(this,null,function*(){this.isLoading=!0,this.snackBar.open("Preparing Excel export, this may take a moment...","",{duration:0});try{let e=yield this.getAllFilteredOrdersForExport();if(e&&e.length>0){let t=e.map(r=>({"TIPO DE ENVIO":r.shipment_type,"NOMBRE DEL DESTINATARIO":r.recipient_name,"TELEFONO DESTINATARIO 9 DIGITOS":r.recipient_phone,DISTRITO:r.delivery_district_name,"DIRECCION DE ENTREGA":r.delivery_address,"FECHA DE REGISTRO":r.createdAt?this.datePipe.transform(r.createdAt,"dd/MM/yyyy"):"N/A","FECHA DE ENTREGA":r.delivery_date,"DETALLE DEL PRODUCTO":r.item_description,"COSTO DE ENVIO":r.shipping_cost,"MONTO A COBRAR":r.amount_to_collect_at_delivery,"FORMA DE PAGO":r.payment_method_for_collection,OBSERVACION:r.observations||""}));this.excelExportService.exportAsExcelFile(t,"Listado_Pedidos_Filtrados","Pedidos"),this.snackBar.dismiss(),this.snackBar.open("Excel file exported successfully!","OK",{duration:3500,panelClass:["success-snackbar"]})}else this.snackBar.dismiss(),this.snackBar.open("No data available to export with current filters.","OK",{duration:3e3})}catch(e){console.error("Error during Excel export process:",e),this.snackBar.dismiss(),this.snackBar.open("An error occurred during Excel export.","Close",{duration:3e3,panelClass:["error-snackbar"]})}finally{this.isLoading=!1}})}fetchOrders(){this.isLoading=!0;let e=this.filterCriteriaSubject.value;this.orderService.getOrders(e,this.currentPageIndex+1,this.currentPageSize,this.currentSortField,this.currentSortDirection).pipe(T(this.destroy$),f(t=>(this.snackBar.open(t.message||"Failed to load orders.","Close",{duration:5e3,panelClass:["error-snackbar"]}),this.isLoading=!1,[]))).subscribe(t=>{this.orders=t.items,this.totalOrderCount=t.total_count||0,this.isLoading=!1,console.log("Orders fetched:",t)})}handleShippingCostChanged(e){this.isLoading=!0,console.log("OrderListPage: Shipping cost change requested",e),this.orderService.updateOrderShippingCost(e.orderId,e.newShippingCost,e.observation).subscribe({next:t=>{this.snackBar.open(`Costo de env\xEDo del pedido ${t.code} actualizado.`,"OK",{duration:3e3,panelClass:["success-snackbar"]}),this.fetchOrders()},error:t=>{this.snackBar.open(`Error al actualizar costo: ${t.message||"Intente de nuevo"}`,"Cerrar",{duration:5e3,panelClass:["error-snackbar"]}),this.isLoading=!1},complete:()=>{this.isLoading=!1}})}onFiltersChanged(e){console.log("OrderListPage: Filters changed",e),this.filterCriteriaSubject.next(e)}onPageChanged(e){console.log("OrderListPage: Page changed",e),this.currentPageIndex=e.pageIndex,this.currentPageSize=e.pageSize,this.fetchOrders()}onSortChanged(e){console.log("OrderListPage: Sort changed",e),this.currentSortField=e.active,this.currentSortDirection=e.direction,this.currentPageIndex=0,this.fetchOrders()}handleMassiveActions(e){console.log("Massive action selected:",e),this.snackBar.open(`Action: ${e} not implemented yet.`,"OK",{duration:3e3})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=M({type:i,selectors:[["app-order-list-page"]],decls:8,vars:5,consts:[[1,"page-content-wrapper"],[1,"page-title-bar"],[1,"page-title"],[1,"breadcrumbs"],[3,"filtersChanged"],[1,"orders-grid"],[3,"pageChanged","sortChanged","shippingCostChanged","orders","isLoading","totalCount","pageSize","pageIndex"]],template:function(t,r){t&1&&(n(0,"div",0)(1,"div",1)(2,"h1",2),a(3,"Listado Pedido Entregados"),o(),u(4,"div",3),o(),n(5,"app-order-filters",4),g("filtersChanged",function(d){return r.onFiltersChanged(d)}),o(),n(6,"div",5)(7,"app-order-table",6),g("pageChanged",function(d){return r.onPageChanged(d)})("sortChanged",function(d){return r.onSortChanged(d)})("shippingCostChanged",function(d){return r.handleShippingCostChanged(d)}),o()()()),t&2&&(l(7),c("orders",r.orders)("isLoading",r.isLoading)("totalCount",r.totalOrderCount)("pageSize",r.currentPageSize)("pageIndex",r.currentPageIndex))},dependencies:[y,nt,Se,ke,ge,E,S,ue],styles:[".page-content-wrapper[_ngcontent-%COMP%]{padding:20px 24px;background-color:var(--sys-surface-container-lowest);color:var(--sys-on-surface);min-height:calc(100vh - 64px)}.page-title-bar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:30px}.page-title[_ngcontent-%COMP%]{font-size:24px;font-weight:600;color:var(--sys-on-surface);margin:0}.breadcrumbs[_ngcontent-%COMP%]{font-size:14px;color:var(--sys-on-surface-variant)}.breadcrumbs[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--sys-primary);text-decoration:none}.breadcrumbs[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}.breadcrumbs[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-left:5px}.table-controls-bar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;background-color:var(--sys-surface-container-low);padding:8px 16px}.records-info[_ngcontent-%COMP%]{font-size:.9em;color:#555}.actions-group[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center}"]})};var mo=[{path:"",component:Ie}];export{mo as ORDERS_ROUTES};
