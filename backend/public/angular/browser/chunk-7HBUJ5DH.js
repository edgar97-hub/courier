import{a as Ae,b as Le,c as Ve}from"./chunk-H7P4GO3Q.js";import"./chunk-F5X5MWHG.js";import{a as Ce,b as _e,c as be,d as ve,e as De,f as Se,g as xe,h as we,i as Ee,j as Me,k as Te,l as ye,m as Pe,n as gt,o as ke,p as Ne}from"./chunk-PM3VLQI7.js";import"./chunk-MS4AQ6UA.js";import{a as Fe,b as Ie,d as ut,e as Oe}from"./chunk-3W245IEO.js";import"./chunk-AJDFE6XY.js";import{a as ct,b as mt}from"./chunk-CZEPZVE5.js";import{c as ge,h as he}from"./chunk-GXNIZWNA.js";import"./chunk-74KGK7YW.js";import{d as fe}from"./chunk-UAHG2GVE.js";import"./chunk-FR3NO5YB.js";import"./chunk-2JNWSY3M.js";import{d as ot,e as st}from"./chunk-6IG52UKJ.js";import{a as dt,b as pt}from"./chunk-3IGH7FBX.js";import"./chunk-7RWCIHFI.js";import{A as rt,B as de,D as pe,E as ue,H as nt,I as at,b as te,d as E,f as ee,g as ie,l as re,m as ne,o as ae,r as oe,t as se,u as le,w as ce,y as me}from"./chunk-2ONXJ7S3.js";import"./chunk-BWBG2IHT.js";import"./chunk-U3COC3EF.js";import{a as X,b as Jt,d as Z,f as Xt,g as Zt,i as tt}from"./chunk-K4QNRRQ5.js";import{a as et,b as it}from"./chunk-ASKMK2H5.js";import{a as Yt}from"./chunk-XRPHOQB2.js";import{a as B,b as lt,e as k}from"./chunk-2H2YZZAU.js";import"./chunk-NUMYIFQH.js";import{$ as Nt,Bb as w,Cc as Ut,Db as f,Ea as P,Eb as C,Ec as O,Gd as H,Hd as N,I as x,J as It,Jc as xt,Kb as vt,Kc as Gt,Lb as Dt,Lc as Qt,Mb as St,O as Ot,Pb as z,Q as kt,Qb as o,Qc as Kt,Rb as v,Sb as $,Sc as Y,Tb as jt,Va as l,Xc as J,Yc as Wt,Za as Vt,_b as zt,a as G,aa as At,b as yt,ba as L,bc as R,c as Pt,cb as F,cc as K,da as y,fc as qt,ia as Lt,ib as d,l as j,lb as $t,m as Ft,mb as m,na as _,rb as V,sb as Rt,t as M,tb as Bt,u as T,ub as Ht,va as Q,vb as n,wa as g,wb as a,wc as I,x as bt,xa as h,xb as b,yb as D,yc as W,zb as S}from"./chunk-YUSEJVZ2.js";var He=()=>[5,10,20,50];function je(r,t){r&1&&(n(0,"div",28),b(1,"mat-progress-spinner",29),a())}function ze(r,t){r&1&&(n(0,"th",30),o(1,"N\xB0"),a())}function qe(r,t){if(r&1&&(n(0,"td",31),o(1),a()),r&2){let e=t.$implicit;l(),v(e.code||"N/A")}}function Ue(r,t){r&1&&(n(0,"th",32),o(1," Nombre Distrito "),a())}function Ge(r,t){if(r&1&&(n(0,"td",31),o(1),a()),r&2){let e=t.$implicit;l(),v(e.name)}}function Qe(r,t){r&1&&(n(0,"th",33),o(1," Rango Peso (kg) "),a())}function Ke(r,t){if(r&1&&(n(0,"td",31),o(1),a()),r&2){let e=t.$implicit;l(),jt(" ",e.weight_from," - ",e.weight_to," ")}}function We(r,t){r&1&&(n(0,"th",34),o(1," Precio Tarifa "),a())}function Ye(r,t){if(r&1&&(n(0,"td",35),o(1),R(2,"currency"),a()),r&2){let e=t.$implicit;l(),$(" ",qt(2,1,e.price,"PEN","S/ ","1.2-2")," ")}}function Je(r,t){r&1&&(n(0,"th",36),o(1," Est\xE1ndar "),a())}function Xe(r,t){if(r&1&&(n(0,"td",37),b(1,"mat-checkbox",38),a()),r&2){let e=t.$implicit;l(),m("checked",e.isStandard)}}function Ze(r,t){r&1&&(n(0,"th",39),o(1," Express "),a())}function ti(r,t){if(r&1&&(n(0,"td",37),b(1,"mat-checkbox",38),a()),r&2){let e=t.$implicit;l(),m("checked",e.isExpress)}}function ei(r,t){r&1&&(n(0,"th",40),o(1," recargo (%) "),a())}function ii(r,t){if(r&1&&(n(0,"td",35),o(1),a()),r&2){let e=t.$implicit;l(),$(" ",e.isExpress?e.surchargePercentage:"-"," ")}}function ri(r,t){r&1&&(n(0,"th",41),o(1," Monto con Recargo "),a())}function ni(r,t){if(r&1&&(n(0,"td",35),o(1),a()),r&2){let e=t.$implicit;l(),$(" ",e.isExpress?e.montoConRecargo:"-"," ")}}function ai(r,t){r&1&&(n(0,"th",42),o(1," Acciones "),a())}function oi(r,t){if(r&1){let e=w();n(0,"td",31)(1,"button",43),f("click",function(){let s=g(e).$implicit,c=C();return h(c.onEdit(s))}),n(2,"mat-icon"),o(3,"edit"),a()(),n(4,"button",44),f("click",function(){let s=g(e).$implicit,c=C();return h(c.onDelete(s))}),n(5,"mat-icon"),o(6,"delete"),a()()()}}function si(r,t){r&1&&b(0,"tr",45)}function li(r,t){r&1&&b(0,"tr",46)}function ci(r,t){if(r&1&&(n(0,"tr",47)(1,"td",48),o(2," No se encontraron distritos que coincidan con la b\xFAsqueda. "),a()()),r&2){let e=C();l(),$t("colspan",e.displayedColumns.length)}}var ht=class r{districts=[];isLoading=!1;totalCount=0;pageSize=10;pageIndex=0;pageChanged=new P;sortChanged=new P;editDistrict=new P;deleteDistrict=new P;displayedColumns=["code","name","weight_range","price","isStandard","isExpress","surchargePercentage","montoConRecargo","actions"];dataSource=new Pe;paginator;sort;ngOnChanges(t){t.districts&&this.districts&&(this.dataSource.data=this.districts)}ngAfterViewInit(){this.sort&&this.sort.sortChange.subscribe(t=>{this.paginator&&(this.paginator.pageIndex=0),this.sortChanged.emit(t)})}onEdit(t){this.editDistrict.emit(t)}onDelete(t){this.deleteDistrict.emit(t)}handlePageEvent(t){this.pageChanged.emit(t)}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=F({type:r,selectors:[["app-district-table"]],viewQuery:function(e,i){if(e&1&&(vt(ut,5),vt(gt,5)),e&2){let s;Dt(s=St())&&(i.paginator=s.first),Dt(s=St())&&(i.sort=s.first)}},inputs:{districts:"districts",isLoading:"isLoading",totalCount:"totalCount",pageSize:"pageSize",pageIndex:"pageIndex"},outputs:{pageChanged:"pageChanged",sortChanged:"sortChanged",editDistrict:"editDistrict",deleteDistrict:"deleteDistrict"},features:[Q],decls:34,vars:10,consts:[[1,"table-container","mat-elevation-z4"],["class","spinner-overlay",4,"ngIf"],["mat-table","","matSort","","aria-label","Lista de Distritos y Tarifas",1,"districts-table",3,"matSortChange","dataSource"],["matColumnDef","code"],["mat-header-cell","","mat-sort-header","code",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","name"],["mat-header-cell","","mat-sort-header","name",4,"matHeaderCellDef"],["matColumnDef","weight_range"],["mat-header-cell","","mat-sort-header","weight_from",4,"matHeaderCellDef"],["matColumnDef","price"],["mat-header-cell","","mat-sort-header","price","class","align-right",4,"matHeaderCellDef"],["mat-cell","","class","align-right amount-cell",4,"matCellDef"],["matColumnDef","isStandard"],["mat-header-cell","","mat-sort-header","isStandard","class","align-center",4,"matHeaderCellDef"],["mat-cell","","class","align-center",4,"matCellDef"],["matColumnDef","isExpress"],["mat-header-cell","","mat-sort-header","isExpress","class","align-center",4,"matHeaderCellDef"],["matColumnDef","surchargePercentage"],["mat-header-cell","","mat-sort-header","surchargePercentage","class","align-right",4,"matHeaderCellDef"],["matColumnDef","montoConRecargo"],["mat-header-cell","","mat-sort-header","montoConRecargo","class","align-right",4,"matHeaderCellDef"],["matColumnDef","actions"],["mat-header-cell","","class","actions-column-header",4,"matHeaderCellDef"],["mat-header-row","","class","header-row-sticky",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","","class","data-row",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["showFirstLastButtons","","aria-label","Seleccione p\xE1gina de distritos",3,"page","length","pageSize","pageIndex","pageSizeOptions"],[1,"spinner-overlay"],["mode","indeterminate","diameter","50"],["mat-header-cell","","mat-sort-header","code"],["mat-cell",""],["mat-header-cell","","mat-sort-header","name"],["mat-header-cell","","mat-sort-header","weight_from"],["mat-header-cell","","mat-sort-header","price",1,"align-right"],["mat-cell","",1,"align-right","amount-cell"],["mat-header-cell","","mat-sort-header","isStandard",1,"align-center"],["mat-cell","",1,"align-center"],["disabled","true","color","primary",3,"checked"],["mat-header-cell","","mat-sort-header","isExpress",1,"align-center"],["mat-header-cell","","mat-sort-header","surchargePercentage",1,"align-right"],["mat-header-cell","","mat-sort-header","montoConRecargo",1,"align-right"],["mat-header-cell","",1,"actions-column-header"],["mat-icon-button","","matTooltip","Editar Distrito",3,"click"],["mat-icon-button","","matTooltip","Eliminar Distrito",3,"click"],["mat-header-row","",1,"header-row-sticky"],["mat-row","",1,"data-row"],[1,"mat-row"],[1,"no-data-cell"]],template:function(e,i){e&1&&(n(0,"div",0),d(1,je,2,0,"div",1),n(2,"table",2),f("matSortChange",function(c){return i.sortChanged.emit(c)}),D(3,3),d(4,ze,2,0,"th",4)(5,qe,2,1,"td",5),S(),D(6,6),d(7,Ue,2,0,"th",7)(8,Ge,2,1,"td",5),S(),D(9,8),d(10,Qe,2,0,"th",9)(11,Ke,2,2,"td",5),S(),D(12,10),d(13,We,2,0,"th",11)(14,Ye,3,6,"td",12),S(),D(15,13),d(16,Je,2,0,"th",14)(17,Xe,2,1,"td",15),S(),D(18,16),d(19,Ze,2,0,"th",17)(20,ti,2,1,"td",15),S(),D(21,18),d(22,ei,2,0,"th",19)(23,ii,2,1,"td",12),S(),D(24,20),d(25,ri,2,0,"th",21)(26,ni,2,1,"td",12),S(),D(27,22),d(28,ai,2,0,"th",23)(29,oi,7,0,"td",5),S(),d(30,si,1,0,"tr",24)(31,li,1,0,"tr",25)(32,ci,3,1,"tr",26),a(),n(33,"mat-paginator",27),f("page",function(c){return i.handlePageEvent(c)}),a()()),e&2&&(l(),m("ngIf",i.isLoading),l(),m("dataSource",i.dataSource),l(28),m("matHeaderRowDef",i.displayedColumns)("matHeaderRowDefSticky",!0),l(),m("matRowDefColumns",i.displayedColumns),l(2),m("length",i.totalCount)("pageSize",i.pageSize)("pageIndex",i.pageIndex)("pageSizeOptions",zt(9,He)))},dependencies:[O,I,Ut,ye,Ce,be,xe,ve,_e,we,De,Se,Ee,Me,Te,Oe,ut,Ne,gt,ke,it,et,k,B,N,H,Ie,Fe,mt,ct],styles:["[_nghost-%COMP%]{display:block}.table-container[_ngcontent-%COMP%]{position:relative;overflow:auto;margin-top:20px;box-shadow:0 3px 15px #00000012;transition:box-shadow .3s ease}.table-container[_ngcontent-%COMP%]:hover{box-shadow:0 5px 20px #0000001a}.spinner-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background-color:#fffc;display:flex;justify-content:center;align-items:center;z-index:100;border-radius:10px}.districts-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}th.mat-header-cell[_ngcontent-%COMP%]{font-weight:600;color:#37474f;background-color:#f8f9fa;padding:12px 16px;border-bottom:1px solid #dee2e6;font-size:.85rem;letter-spacing:.5px}td.mat-cell[_ngcontent-%COMP%]{padding:10px 16px;border-bottom:1px solid #f1f3f5;color:#495057;font-size:.9rem}.header-row-sticky[_ngcontent-%COMP%]{position:sticky;top:0;z-index:10;background-color:#f8f9fa}.data-row[_ngcontent-%COMP%]{transition:background-color .2s ease}.data-row[_ngcontent-%COMP%]:hover{background-color:#eef2f7}.align-right[_ngcontent-%COMP%]{text-align:right;justify-content:flex-end}.align-center[_ngcontent-%COMP%]{text-align:center;justify-content:center}.amount-cell[_ngcontent-%COMP%]{font-weight:500}.actions-column-header[_ngcontent-%COMP%]{text-align:center!important;width:120px}.actions-cell[_ngcontent-%COMP%]{text-align:center;white-space:nowrap}.actions-cell[_ngcontent-%COMP%]   button.mat-icon-button[_ngcontent-%COMP%]{margin:0 3px}.no-data-cell[_ngcontent-%COMP%]{text-align:center;padding:40px;font-style:italic;color:#6c757d;font-size:1rem}.mat-mdc-paginator[_ngcontent-%COMP%]{background-color:#f8f9fa;border-bottom-left-radius:10px;border-bottom-right-radius:10px;color:#495057;border-top:1px solid #dee2e6}"]})};var A=class r{apiUrl=Wt.apiUrl+"/districts";http=_(Qt);authService=_(Yt);districtNamesSubject=new Ft([]);districtNames$=this.districtNamesSubject.asObservable();loadedDistrictNames=!1;constructor(){this.loadDistrictNamesForAutocomplete().subscribe()}getAuthHeaders(){let t=this.authService.getAccessToken();return t?new xt({"Content-Type":"application/json",codrr_token:t}):new xt({"Content-Type":"application/json"})}getDistricts(t=1,e=10,i="name",s="asc",c){let p=this.getAuthHeaders();if(!this.authService.getAccessToken())return T(()=>new Error("Not authenticated to fetch users."));let u=new Gt().set("page_number",parseInt(t.toString())||1).set("page_size",e.toString()).set("sort_field",i).set("sort_directionr",s);return c&&(u=u.set("search",c)),this.http.get(this.apiUrl,{params:u,headers:p}).pipe(y(U=>console.log("Fetched districts:",U)),x(this.handleError))}getDistrictById(t){let e=this.getAuthHeaders();return this.authService.getAccessToken()?this.http.get(`${this.apiUrl}/${t}`,{headers:e}).pipe(y(i=>{console.log("SERVICE: HTTP GET successful, received district:",i)}),Ot(300),x(i=>(console.error("SERVICE: HTTP GET failed:",i),this.handleError(i)))):T(()=>new Error("Not authenticated to fetch users."))}createDistrict(t){let e=this.getAuthHeaders();return this.authService.getAccessToken()?this.http.post(this.apiUrl+"/register",t,{headers:e}).pipe(y(i=>{console.log("Created district:",i),this.addDistrictNameToAutocomplete(i.name)}),x(this.handleError)):T(()=>new Error("Not authenticated to fetch users."))}updateDistrict(t,e){let U=e,{id:i,createdAt:s,updatedAt:c}=U,p=Pt(U,["id","createdAt","updatedAt"]),u=this.getAuthHeaders();return this.authService.getAccessToken()?this.http.put(`${this.apiUrl}/edit/${t}`,p,{headers:u}).pipe(y(Tt=>{console.log("Updated district:",Tt),this.addDistrictNameToAutocomplete(Tt.name)}),x(this.handleError)):T(()=>new Error("Not authenticated to fetch users."))}deleteDistrict(t){let e=this.getAuthHeaders();return this.authService.getAccessToken()?this.http.delete(`${this.apiUrl}/delete/${t}`,{headers:e}).pipe(y(()=>console.log(`Deleted district with id: ${t}`)),x(this.handleError)):T(()=>new Error("Not authenticated to fetch users."))}loadDistrictNamesForAutocomplete(){if(this.loadedDistrictNames&&this.districtNamesSubject.value.length>0)return this.districtNames$;let t=this.getAuthHeaders();return this.authService.getAccessToken()?(console.log("DistrictService: Loading district names for autocomplete..."),this.http.get(`${this.apiUrl}?limit=1000`,{headers:t}).pipe(bt(e=>{let i=e?.items.map(c=>c.name),s=[...new Set(i)].sort();return this.districtNamesSubject.next(s),this.loadedDistrictNames=!0,console.log("DistrictService: Loaded unique names:",s),s}),x(e=>(console.error("Error loading district names for autocomplete",e),this.loadedDistrictNames=!1,M([]))))):T(()=>new Error("Not authenticated to fetch users."))}addDistrictNameToAutocomplete(t){let e=this.districtNamesSubject.value;if(t&&!e.includes(t)){let i=[...e,t].sort();this.districtNamesSubject.next(i)}}filterDistrictNames(t){let e=t.toLowerCase();return this.districtNames$.pipe(bt(i=>i.filter(s=>s.toLowerCase().includes(e))))}handleError(t){console.error("API Error:",t);let e="An error occurred. Please try again later.";return t.error instanceof ErrorEvent?e=`Client-side error: ${t.error.message}`:t.status===404?e="The requested resource was not found.":t.status===400&&t.error?.message?Array.isArray(t.error.message)?e=t.error.message.join(", "):e=t.error.message:t.status===500&&(e="A server error occurred. Please contact support."),T(()=>new Error(e))}static \u0275fac=function(e){return new(e||r)};static \u0275prov=Lt({token:r,factory:r.\u0275fac,providedIn:"root"})};function ui(r,t){if(r&1){let e=w();n(0,"button",12),f("click",function(){g(e);let s=C(),c=z(15);return h(s.clearSearch(c))}),n(1,"mat-icon"),o(2,"close"),a()()}}function gi(r,t){r&1&&(n(0,"mat-icon",13),o(1,"search"),a())}var Ct=class r{districtService=_(A);router=_(Y);snackBar=_(dt);dialog=_(ge);districts=[];totalDistricts=0;isLoading=!1;destroy$=new j;currentPageIndex=0;currentPageSize=10;currentSortField="name";currentSortDirection="asc";currentSearchTerm="";searchSubject=new j;ngOnInit(){this.loadDistricts(),this.searchSubject.pipe(It(500),kt(),L(this.destroy$)).subscribe(t=>{this.currentSearchTerm=t,this.currentPageIndex=0,this.loadDistricts()})}loadDistricts(){this.isLoading=!0,this.districtService.getDistricts(this.currentPageIndex,this.currentPageSize,this.currentSortField,this.currentSortDirection,this.currentSearchTerm).pipe(L(this.destroy$)).subscribe({next:t=>{this.districts=t.items,this.totalDistricts=t.total_count,this.isLoading=!1},error:t=>{this.isLoading=!1,this.snackBar.open(`Error cargando distritos: ${t.message||"Intente de nuevo"}`,"Cerrar",{duration:5e3,panelClass:["error-snackbar"]})}})}onSearchTermChange(t){let e=t.target.value;this.searchSubject.next(e)}clearSearch(t){t.value="",this.searchSubject.next("")}onPageChanged(t){this.currentPageIndex=t.pageIndex,this.currentPageSize=t.pageSize,this.loadDistricts()}onSortChanged(t){this.currentSortField=t.active,this.currentSortDirection=t.direction,this.currentPageIndex=0,this.loadDistricts()}navigateToCreate(){this.router.navigate(["/districts/create"])}navigateToEdit(t){this.router.navigate(["/districts/edit",t.id])}confirmAndDeleteDistrict(t){confirm(`\xBFEst\xE1 seguro de que desea eliminar el distrito/tarifa "${t.name}" (C\xF3digo: ${t.code||t.id})?`)&&this.deleteDistrict(t)}deleteDistrict(t){this.isLoading=!0,this.districtService.deleteDistrict(t.id).pipe(L(this.destroy$)).subscribe({next:()=>{this.snackBar.open(`Distrito "${t.name}" eliminado correctamente.`,"OK",{duration:3e3,panelClass:["success-snackbar"]}),this.currentPageIndex=0,this.isLoading=!1,this.loadDistricts()},error:e=>{this.isLoading=!1,this.snackBar.open(`Error al eliminar distrito: ${e.message||"Intente de nuevo"}`,"Cerrar",{duration:5e3,panelClass:["error-snackbar"]})}})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=F({type:r,selectors:[["app-district-list-page"]],decls:19,vars:7,consts:[["searchInput",""],["fxLayout","column","fxLayoutGap","24px",1,"page-container"],["fxLayout","row","fxLayoutAlign","space-between center",1,"page-header"],[1,"page-title"],["mat-flat-button","",1,"btn-corp-primary","create-button",3,"click"],["appearance","outlined",1,"filter-card"],["fxLayout","row","fxLayoutAlign","start center"],["appearance","outline","fxFlex","",1,"search-field"],["matInput","","placeholder","Ej: Carabayllo, Lince, 101...",3,"keyup"],["mat-icon-button","","matSuffix","","aria-label","Limpiar b\xFAsqueda",3,"click",4,"ngIf"],["matSuffix","",4,"ngIf"],[3,"pageChanged","sortChanged","editDistrict","deleteDistrict","districts","isLoading","totalCount","pageSize","pageIndex"],["mat-icon-button","","matSuffix","","aria-label","Limpiar b\xFAsqueda",3,"click"],["matSuffix",""]],template:function(e,i){if(e&1){let s=w();n(0,"div",1)(1,"div",2)(2,"h1",3),o(3,"Gesti\xF3n de Distritos"),a(),n(4,"button",4),f("click",function(){return g(s),h(i.navigateToCreate())}),n(5,"mat-icon"),o(6,"add_circle_outline"),a(),n(7,"span"),o(8,"Nuevo Distrito"),a()()(),n(9,"mat-card",5)(10,"mat-card-content",6)(11,"mat-form-field",7)(12,"mat-label"),o(13,"Buscar distrito por nombre"),a(),n(14,"input",8,0),f("keyup",function(p){return g(s),h(i.onSearchTermChange(p))}),a(),d(16,ui,3,0,"button",9)(17,gi,2,0,"mat-icon",10),a()()(),n(18,"app-district-table",11),f("pageChanged",function(p){return g(s),h(i.onPageChanged(p))})("sortChanged",function(p){return g(s),h(i.onSortChanged(p))})("editDistrict",function(p){return g(s),h(i.navigateToEdit(p))})("deleteDistrict",function(p){return g(s),h(i.confirmAndDeleteDistrict(p))}),a()()}if(e&2){let s=z(15);l(16),m("ngIf",s.value),l(),m("ngIf",!s.value),l(),m("districts",i.districts)("isLoading",i.isLoading)("totalCount",i.totalDistricts)("pageSize",i.currentPageSize)("pageIndex",i.currentPageIndex)}},dependencies:[O,I,J,ht,k,lt,B,N,H,pt,he,at,nt,rt,ue,st,ot,tt,X,Z],styles:["[_nghost-%COMP%]{display:block}.page-container[_ngcontent-%COMP%]{padding:28px 32px;color:var(--sys-on-background, #2c3e50);min-height:calc(100vh - 64px);box-sizing:border-box}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:15px;flex-wrap:wrap;margin-bottom:24px;padding-bottom:16px}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:2em;font-weight:500}.page-header[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{font-weight:500}.filter-card[_ngcontent-%COMP%]{margin-bottom:28px;border:1px solid var(--sys-outline-variant, transparent);border-radius:8px}.filter-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]{padding:16px 20px!important}.search-field[_ngcontent-%COMP%]{width:100%}"]})};function hi(r,t){if(r&1&&(n(0,"div",20),o(1," N\xB0: "),n(2,"span"),o(3),a()()),r&2){let e,i=C();l(3),v((e=i.districtForm.get("code"))==null?null:e.value)}}function fi(r,t){if(r&1&&(n(0,"mat-option",7),o(1),a()),r&2){let e=t.$implicit;m("value",e),l(),v(e)}}function Ci(r,t){r&1&&(n(0,"mat-error"),o(1,"El nombre del distrito es obligatorio."),a())}function _i(r,t){r&1&&(n(0,"mat-error"),o(1,"Peso Desde es obligatorio."),a())}function bi(r,t){r&1&&(n(0,"mat-error"),o(1,"Debe ser mayor o igual a 0."),a())}function vi(r,t){if(r&1&&(n(0,"mat-error"),o(1),a()),r&2){let e=C();l(),v(e.weightFromCtrl==null||e.weightFromCtrl.errors==null?null:e.weightFromCtrl.errors.weightOrder)}}function Di(r,t){if(r&1&&(n(0,"mat-error"),o(1),a()),r&2){let e=C();l(),v(e.weightFromCtrl==null||e.weightFromCtrl.errors==null?null:e.weightFromCtrl.errors.weightOrder)}}function Si(r,t){if(r&1&&(n(0,"mat-error"),o(1),a()),r&2){let e=C();l(),v(e.weightToCtrl==null||e.weightToCtrl.errors==null?null:e.weightToCtrl.errors.weightOrder)}}function xi(r,t){r&1&&(n(0,"mat-form-field",5)(1,"mat-label"),o(2,"porcentaje de recargo (%)"),a(),b(3,"input",21),a())}function wi(r,t){if(r&1&&(n(0,"div",22)(1,"span"),o(2,"Monto con Recargo: S/ "),a(),n(3,"span"),o(4),a()()),r&2){let e,i=C();l(4),v(((e=i.districtForm.get("price"))==null?null:e.value)/100*((e=i.districtForm.get("surchargePercentage"))==null?null:e.value)+((e=i.districtForm.get("price"))==null?null:e.value))}}var _t=class r{constructor(t){this.fb=t}districtToEdit=null;isLoading=!1;formSubmit=new P;formCancel=new P;districtForm;districtService=_(A);filteredDistrictNames$=M([]);ngOnInit(){this.initForm(),this.setupNameAutocomplete()}ngOnChanges(t){t.districtToEdit&&this.districtToEdit&&this.districtForm?this.districtForm.patchValue({code:this.districtToEdit.code||null,name:this.districtToEdit.name,weight_from:this.districtToEdit.weight_from,weight_to:this.districtToEdit.weight_to,price:this.districtToEdit.price,isStandard:this.districtToEdit.isStandard,isExpress:this.districtToEdit.isExpress,surchargePercentage:this.districtToEdit.surchargePercentage}):t.districtToEdit&&!this.districtToEdit&&this.districtForm&&this.districtForm.reset({isStandard:!1})}initForm(){this.districtForm=this.fb.group({code:[null],name:["",E.required],weight_from:[0,[E.required,E.min(0),this.weightRangeCrossValidator]],weight_to:[0,[E.required,E.min(0),this.weightRangeCrossValidator]],price:[0,[E.required,E.min(0)]],isStandard:[!1,E.required],isExpress:[!1],surchargePercentage:[0]}),this.districtToEdit&&this.districtForm.patchValue(this.districtToEdit)}weightRangeCrossValidator=t=>{let e=t.get("weight_from"),i=t.get("weight_to");if(!e||!i||!e.value||!i.value)return null;let s=parseFloat(e.value),c=parseFloat(i.value),p=null;if(e.hasError("weightOrder")){let u=G({},e.errors);delete u.weightOrder,e.setErrors(Object.keys(u).length>0?u:null,{emitEvent:!1})}if(i.hasError("weightOrder")){let u=G({},i.errors);delete u.weightOrder,i.setErrors(Object.keys(u).length>0?u:null,{emitEvent:!1})}if(s>c&&c!==0){let u=e.errors||{};e.setErrors(yt(G({},u),{weightOrder:"Desde no puede ser mayor que Hasta"})),p={weightRangeInvalid:!0}}return p};setupNameAutocomplete(){this.districtForm.get("name")&&(this.filteredDistrictNames$=this.districtForm.get("name").valueChanges.pipe(Nt(""),At(t=>typeof t=="string"&&t.length>0?this.districtService.filterDistrictNames(t):this.districtService.districtNames$)))}onSubmit(){if(this.districtForm.valid){let t=this.districtForm.value,e={name:t.name,weight_from:parseFloat(t.weight_from),weight_to:parseFloat(t.weight_to),price:parseFloat(t.price),isStandard:t.isStandard,isExpress:t.isExpress,surchargePercentage:parseFloat(t.surchargePercentage)};t.code!==null&&t.code!==void 0&&t.code!==""&&(e.code=parseInt(t.code,10)),this.formSubmit.emit(e)}else this.districtForm.markAllAsTouched()}onCancelClick(){this.formCancel.emit()}get nameCtrl(){return this.districtForm.get("name")}get weightFromCtrl(){return this.districtForm.get("weight_from")}get weightToCtrl(){return this.districtForm.get("weight_to")}get priceCtrl(){return this.districtForm.get("price")}static \u0275fac=function(e){return new(e||r)(Vt(ce))};static \u0275cmp=F({type:r,selectors:[["app-district-form"]],inputs:{districtToEdit:"districtToEdit",isLoading:"isLoading"},outputs:{formSubmit:"formSubmit",formCancel:"formCancel"},features:[Q],decls:51,vars:16,consts:[["autoDistrictName","matAutocomplete"],["novalidate","",1,"district-form-container",3,"ngSubmit","formGroup"],["appearance","outlined"],["style","padding-bottom: 20px",4,"ngIf"],[1,"form-row"],["appearance","outline",1,"full-width-field"],["matInput","","formControlName","name","required","","placeholder","Ej: Carabayllo",3,"matAutocomplete"],[3,"value"],["appearance","outline",1,"form-field"],["matInput","","formControlName","weight_from","type","number","min","0","step","0.01","required","","placeholder","0.00"],["matInput","","formControlName","weight_to","type","number","min","0","step","0.01","required","","placeholder","0.00"],["matInput","","formControlName","price","type","number","min","0","step","0.01","required","","placeholder","0.00"],["matTextPrefix",""],["formControlName","isStandard","color","primary",1,"standard-checkbox"],["formControlName","isExpress","color","primary",1,"standard-checkbox"],["appearance","outline","class","full-width-field",4,"ngIf"],["class","full-width-field","style","display: flex; margin-left: 10px",4,"ngIf"],["align","end",1,"card-actions"],["mat-stroked-button","","type","button",1,"btn-corp-secondary",3,"click"],["mat-flat-button","","type","submit",1,"btn-corp-primary",3,"disabled"],[2,"padding-bottom","20px"],["matInput","","formControlName","surchargePercentage","type","number","min","0","step","0.01","placeholder","0.00"],[1,"full-width-field",2,"display","flex","margin-left","10px"]],template:function(e,i){if(e&1){let s=w();n(0,"form",1),f("ngSubmit",function(){return g(s),h(i.onSubmit())}),n(1,"mat-card",2)(2,"mat-card-header")(3,"mat-card-title"),o(4),a()(),n(5,"mat-card-content"),d(6,hi,4,1,"div",3),n(7,"div",4)(8,"mat-form-field",5)(9,"mat-label"),o(10,"Nombre del Distrito"),a(),b(11,"input",6),n(12,"mat-autocomplete",null,0),Bt(14,fi,2,2,"mat-option",7,Rt),R(16,"async"),a(),d(17,Ci,2,0,"mat-error"),a()(),n(18,"div",4)(19,"mat-form-field",8)(20,"mat-label"),o(21,"Peso Desde (kg)"),a(),b(22,"input",9),d(23,_i,2,0,"mat-error")(24,bi,2,0,"mat-error")(25,vi,2,1,"mat-error"),a(),n(26,"mat-form-field",8)(27,"mat-label"),o(28,"Peso Hasta (kg)"),a(),b(29,"input",10),d(30,Di,2,1,"mat-error"),a()(),n(31,"mat-form-field",5)(32,"mat-label"),o(33,"Precio Tarifa (S/)"),a(),b(34,"input",11),n(35,"span",12),o(36,"S/ "),a(),d(37,Si,2,1,"mat-error"),a(),n(38,"div",4)(39,"mat-checkbox",13),o(40," \xBFEs tarifa est\xE1ndar para este distrito? "),a()(),n(41,"div",4)(42,"mat-checkbox",14),o(43," Express "),a()(),d(44,xi,4,0,"mat-form-field",15)(45,wi,5,1,"div",16),a(),n(46,"mat-card-actions",17)(47,"button",18),f("click",function(){return g(s),h(i.onCancelClick())}),o(48," Cancelar "),a(),n(49,"button",19),o(50),a()()()()}if(e&2){let s,c,p,u=z(13);m("formGroup",i.districtForm),l(4),v(i.districtToEdit?"Editar Distrito/Tarifa":"Crear Nuevo Distrito/Tarifa"),l(2),m("ngIf",(s=i.districtForm.get("code"))==null?null:s.value),l(5),m("matAutocomplete",u),l(3),Ht(K(16,14,i.filteredDistrictNames$)),l(3),V(i.nameCtrl!=null&&i.nameCtrl.hasError("required")&&(i.nameCtrl!=null&&i.nameCtrl.touched||i.nameCtrl!=null&&i.nameCtrl.dirty)?17:-1),l(6),V(i.weightFromCtrl!=null&&i.weightFromCtrl.hasError("required")&&(i.weightFromCtrl!=null&&i.weightFromCtrl.touched||i.weightFromCtrl!=null&&i.weightFromCtrl.dirty)?23:-1),l(),V(i.weightFromCtrl!=null&&i.weightFromCtrl.hasError("min")&&(i.weightFromCtrl!=null&&i.weightFromCtrl.touched||i.weightFromCtrl!=null&&i.weightFromCtrl.dirty)?24:-1),l(),V(i.weightFromCtrl!=null&&i.weightFromCtrl.hasError("weightOrder")&&(i.weightFromCtrl!=null&&i.weightFromCtrl.touched||i.weightFromCtrl!=null&&i.weightFromCtrl.dirty)?25:-1),l(5),V(i.weightFromCtrl!=null&&i.weightFromCtrl.hasError("weightOrder")&&(i.weightFromCtrl!=null&&i.weightFromCtrl.touched||i.weightFromCtrl!=null&&i.weightFromCtrl.dirty)?30:-1),l(7),V(i.weightToCtrl!=null&&i.weightToCtrl.hasError("weightOrder")&&(i.weightToCtrl!=null&&i.weightToCtrl.touched||i.weightToCtrl!=null&&i.weightToCtrl.dirty)?37:-1),l(7),m("ngIf",(c=i.districtForm.get("isExpress"))==null?null:c.value),l(),m("ngIf",(p=i.districtForm.get("isExpress"))==null?null:p.value),l(4),m("disabled",i.isLoading||i.districtForm.invalid),l(),$(" ",i.isLoading?"Guardando...":i.districtToEdit?"Actualizar":"Guardar"," ")}},dependencies:[O,I,W,me,re,te,ne,ee,ie,le,se,ae,oe,at,nt,rt,de,pe,st,ot,k,lt,mt,ct,Ve,Ae,fe,Le,N,tt,X,Xt,Z,Zt,Jt],styles:[".district-form-container[_ngcontent-%COMP%]{padding:10px 0}mat-card[_ngcontent-%COMP%]{border-radius:8px;padding:20px}mat-card-header[_ngcontent-%COMP%]{padding-bottom:16px;margin-bottom:20px}mat-card-header[_ngcontent-%COMP%]   mat-card-title[_ngcontent-%COMP%]{font-size:1.4em;font-weight:500}mat-card-content[_ngcontent-%COMP%]{padding-top:0}.form-row[_ngcontent-%COMP%]{display:flex;gap:20px;margin-bottom:0}.form-field[_ngcontent-%COMP%], .full-width-field[_ngcontent-%COMP%]{margin-bottom:16px}.form-field[_ngcontent-%COMP%]{flex:1}.full-width-field[_ngcontent-%COMP%]{width:100%}.standard-checkbox[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:20px}.card-actions[_ngcontent-%COMP%]{padding:16px 0 0;margin-top:24px;gap:10px}.card-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{font-weight:500}"]})};function Ei(r,t){r&1&&(n(0,"div",5),b(1,"mat-progress-spinner",6),n(2,"p"),o(3,"Cargando datos del distrito..."),a()())}function Mi(r,t){if(r&1){let e=w();n(0,"app-district-form",7),R(1,"async"),f("formSubmit",function(s){g(e);let c=C();return h(c.handleSubmit(s))})("formCancel",function(){g(e);let s=C();return h(s.handleCancel())}),a()}if(r&2){let e=C();m("districtToEdit",e.districtId?K(1,2,e.districtToEdit$):null)("isLoading",e.isSaving)}}var q=class r{route=_(Kt);router=_(Y);districtService=_(A);snackBar=_(dt);districtToEdit$=M(null);isLoading=!1;isSaving=!1;pageTitle="Crear Nuevo Distrito/Tarifa";districtId=null;destroy$=new j;ngOnInit(){this.districtId=this.route.snapshot.paramMap.get("id"),console.log("DistrictFormPage - ngOnInit - districtId from route:",this.districtId),this.districtId?(this.pageTitle="Editar Distrito/Tarifa",this.isLoading=!0,this.districtToEdit$=this.districtService.getDistrictById(this.districtId).pipe(L(this.destroy$),y(t=>{console.log("COMPONENT: Received district data in tap():",t),t||(this.snackBar.open("No se encontraron datos para el distrito.","Cerrar",{duration:5e3,panelClass:["error-snackbar"]}),this.router.navigate(["/districts"])),this.isLoading=!1}),x(t=>(this.isLoading=!1,this.snackBar.open(`Error cargando distrito: ${t.message||"Intente de nuevo"}`,"Cerrar",{duration:5e3,panelClass:["error-snackbar"]}),this.router.navigate(["/districts"]),M(null)))),this.districtToEdit$.subscribe({next:t=>console.log("COMPONENT (MANUAL SUB): Data received:",t),error:t=>console.error("COMPONENT (MANUAL SUB): Error received:",t),complete:()=>console.log("COMPONENT (MANUAL SUB): Observable completed.")})):(this.pageTitle="Crear Nuevo Distrito/Tarifa",this.districtToEdit$=M(null),this.isLoading=!1)}handleSubmit(t){this.isSaving=!0;let e;this.districtId?e=this.districtService.updateDistrict(this.districtId,t):e=this.districtService.createDistrict(t),e.pipe(L(this.destroy$)).subscribe({next:i=>{this.isSaving=!1;let s=this.districtId?"actualizado":"creado";this.snackBar.open(`${s} correctamente.`,"OK",{duration:3e3,panelClass:["success-snackbar"]}),this.router.navigate(["/districts"])},error:i=>{this.isSaving=!1,this.snackBar.open(`Error al guardar distrito: ${i.message||"Intente de nuevo"}`,"Cerrar",{duration:5e3,panelClass:["error-snackbar"]})}})}handleCancel(){this.router.navigate(["/districts"])}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=F({type:r,selectors:[["app-district-form-page"]],decls:9,vars:3,consts:[[1,"page-container","form-page-container"],[1,"page-header"],["mat-icon-button","","matTooltip","Volver a la Lista","aria-label","Volver a la lista de distritos",3,"click"],["class","loading-indicator",4,"ngIf"],[3,"districtToEdit","isLoading","formSubmit","formCancel",4,"ngIf"],[1,"loading-indicator"],["mode","indeterminate","diameter","40"],[3,"formSubmit","formCancel","districtToEdit","isLoading"]],template:function(e,i){e&1&&(n(0,"div",0)(1,"div",1)(2,"button",2),f("click",function(){return i.handleCancel()}),n(3,"mat-icon"),o(4,"arrow_back"),a()(),n(5,"h1"),o(6),a()(),d(7,Ei,4,0,"div",3)(8,Mi,2,4,"app-district-form",4),a()),e&2&&(l(6),v(i.pageTitle),l(),m("ngIf",i.isLoading),l(),m("ngIf",!i.isLoading))},dependencies:[O,I,W,J,_t,pt,it,et,N,H,k,B],styles:[".page-container[_ngcontent-%COMP%]{padding:24px}.form-page-container[_ngcontent-%COMP%]{max-width:750px;margin:20px auto;border-radius:8px;padding:24px 30px}.page-header[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:24px;padding-bottom:16px}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0 0 0 12px;font-size:1.6em;font-weight:500}.loading-indicator[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px}.loading-indicator[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:10px}"]})};var yn=[{path:"",component:Ct},{path:"create",component:q},{path:"edit/:id",component:q}];export{yn as DISTRICTS_ROUTES};
