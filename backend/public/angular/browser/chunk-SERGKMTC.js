import{a as St,b as Dt,c as wt,d as Tt,e as kt,f as It,g as At,i as Rt,j as Nt}from"./chunk-OQ4LLZMX.js";import{a as tt,d as Q,g as st,h as lt}from"./chunk-LY7ZH3B7.js";import{c as ct}from"./chunk-H3NKDVGQ.js";import"./chunk-P54CFNUJ.js";import"./chunk-F5X5MWHG.js";import{a as dt,b as mt,c as pt,d as gt,e as _t,f as ut,g as ht,h as ft,i as Ot,j as Ct,k as bt,l as vt,m as xt,n as re,o as yt,p as Pt}from"./chunk-GVTQD7MK.js";import"./chunk-MS4AQ6UA.js";import{a as Y,b as ee,d as te,e as Et}from"./chunk-V2UYO6B7.js";import{b as Mt}from"./chunk-76D75VZ6.js";import{b as J}from"./chunk-FMCWYXBX.js";import{a as rt,b as ot,c as Z,e as nt,f as it,g as at,h as q}from"./chunk-TY3YGHIS.js";import"./chunk-D6JRQKJR.js";import"./chunk-BIOBBD76.js";import"./chunk-YWJ7YDH4.js";import{a as Le}from"./chunk-QW3LQFON.js";import{d as Je,e as Ye}from"./chunk-PIM5JW6K.js";import{b as K,c as W}from"./chunk-5B4NE2BL.js";import"./chunk-SGYCFQGT.js";import{C as Ze,D as qe,b as He,f as $e,g as Ue,l as Ve,o as Ge,p as je,s as Xe,u as Ke,v as We,z as Qe}from"./chunk-5E3ALB3J.js";import"./chunk-4HLPQ3MO.js";import"./chunk-SH5IQZAH.js";import{c as Ne,h as Fe}from"./chunk-LONJ5JQN.js";import{i as ze}from"./chunk-4UISFGQU.js";import{a as Be,b as X}from"./chunk-6QWK72ZE.js";import{a as I,b as S}from"./chunk-V3XFB2MU.js";import{a as et,b as k,e as P}from"./chunk-EHVJKBXY.js";import"./chunk-ZDC23HDZ.js";import{$b as ge,$c as y,Db as De,Eb as g,Fa as Pe,Ga as w,Ha as T,L as b,N as Ee,Nb as i,Ob as a,Pb as v,Qa as x,Qb as h,Rb as f,Rc as Ae,T as me,Tb as U,Tc as G,V as ye,Vb as u,Wa as pe,Wb as V,Xc as N,Zc as Re,a as le,ac as _e,bc as ue,db as Se,ec as we,ed as fe,f as ce,fc as l,fd as Oe,gb as d,gd as j,hc as O,i as ve,ia as D,ka as H,kb as R,l as z,ld as F,m as xe,oc as Te,pa as $,pc as he,rb as E,sc as ke,t as de,u as C,wa as _,wc as Ie,x as Me,xb as p,y as B}from"./chunk-XL3VFI5A.js";var A=class r{apiUrlOrders=F.apiUrl+"/orders";apiUrl=F.apiUrl+"/districts";apiUrlUsers=F.apiUrl+"/users";apiUrlSettings=F.apiUrl+"/settings";http=_(j);authService=_(Le);constructor(){}getAuthHeaders(){let e=this.authService.getAccessToken();return e?new fe({"Content-Type":"application/json",codrr_token:e}):new fe({"Content-Type":"application/json"})}getOrders(e,t=1,o=10,s="id",c="desc"){let n=new Oe().set("page_number",t.toString()).set("page_size",o.toString()).set("sort_field",s).set("sort_direction",c);e&&(e.start_date&&(n=n.set("start_date",e.start_date)),e.end_date&&(n=n.set("end_date",e.end_date)),e.status&&(n=n.set("status",e.status)),e.search_term&&e.search_term.trim()!==""&&(n=n.set("search_term",e.search_term.trim())));let M=this.getAuthHeaders();return this.authService.getAccessToken()?this.http.get(this.apiUrlOrders,{params:n,headers:M}).pipe(B(m=>m),b(this.handleError)):C(()=>new Error("Not authenticated to fetch users."))}getOrders2(e,t="id",o="desc"){let s=new Oe().set("sort_field",t).set("sort_direction",o);e&&(e.start_date&&(s=s.set("start_date",e.start_date)),e.end_date&&(s=s.set("end_date",e.end_date)),e.status&&(s=s.set("status",e.status)),e.search_term&&e.search_term.trim()!==""&&(s=s.set("search_term",e.search_term.trim())));let c=this.getAuthHeaders();return this.authService.getAccessToken()?this.http.get(this.apiUrlOrders+"/filtered-orders",{params:s,headers:c}).pipe(B(n=>n.items),b(this.handleError)):C(()=>new Error("Not authenticated to fetch users."))}getOrderStatuses(){return new ve(e=>{e.next(["REGISTRADO","RECOGIDO","EN ALMACEN","EN TRANSITO","ENTREGADO","CANCELADO","RECHAZADO EN PUNTO","REPROGRAMADO"]),e.complete()})}getDeliveryDistricts(){let e=this.getAuthHeaders();return this.authService.getAccessToken()?this.http.get(`${this.apiUrl}/all`,{headers:e}).pipe(b(this.handleError)):C(()=>new Error("Not authenticated to fetch users."))}updateOrderStatus(e,t,o,s,c,n){let M=this.getAuthHeaders();if(!this.authService.getAccessToken())return C(()=>new Error("Not authenticated to fetch users."));let m={orderId:e,reason:o,newStatus:t,action:"CAMBIO DE ESTADO"};return s&&(m.product_delivery_photo_url=s),c&&(m.payment_method_for_shipping_cost=c),n&&(m.payment_method_for_collection=n),this.http.post(`${this.apiUrlOrders}/update-order-status`,{payload:m},{headers:M}).pipe(b(this.handleError))}getMaxPackageDimensions(){let e=this.getAuthHeaders();return this.authService.getAccessToken()?this.http.get(`${this.apiUrlSettings}/all`,{headers:e}).pipe(H(t=>console.log("OrderService: API response for max dimensions:",t)),B(t=>{if(console.log("apiResponse",t),t.length){let o="Est\xE1ndar : "+t[0].standard_measurements_length+"cmx"+t[0].standard_measurements_width+"cmx"+t[0].standard_measurements_height+"cm "+t[0].standard_measurements_weight+"kg",s="MEDIDAS MAXIMAS (Largo "+t[0].maximum_measurements_length+" cm x Ancho "+t[0].maximum_measurements_width+" cm x Alto "+t[0].maximum_measurements_height+" cm) y PESO MAXIMO ("+t[0].maximum_measurements_weight+" kilogramos)";return{max_length_cm:t[0].maximum_measurements_length,max_width_cm:t[0].maximum_measurements_width,max_height_cm:t[0].maximum_measurements_height,max_weight_kg:t[0].maximum_measurements_weight,sta_length_cm:t[0].standard_measurements_length,sta_width_cm:t[0].standard_measurements_width,sta_height_cm:t[0].standard_measurements_height,sta_weight_kg:t[0].standard_measurements_weight,volumetric_factor:t[0].volumetric_factor,standard_package_info:o,info_text:s}}return{max_length_cm:0,max_width_cm:0,max_height_cm:0,max_weight_kg:0,sta_length_cm:0,sta_width_cm:0,sta_height_cm:0,sta_weight_kg:0,volumetric_factor:0,standard_package_info:"",info_text:""}}),b(t=>(console.error("OrderService: API error fetching max package dimensions. Details:",t.message),de({max_length_cm:30,max_width_cm:25,max_height_cm:45,max_weight_kg:5,standard_package_info:"Est\xE1ndar : 30cmx15cmx20cm 1.5kg",info_text:"MEDIDAS MAXIMAS (Largo 30 cm x Ancho 25 cm x Alto 45 cm) y PESO MAXIMO (5 kilogramos)"}).pipe(me(200))))):C(()=>new Error("Not authenticated to fetch users."))}calculateShippingCost(e){console.log("packageData",e),console.log("OrderService: Calculating shipping cost (simulated) for",e);let t=8;return e.package_size_type==="custom"&&(t=10,(e.package_weight_kg||0)>2&&(t+=5),((e.package_length_cm||0)>30||(e.package_width_cm||0)>25||(e.package_height_cm||0)>20)&&(t+=4)),e.delivery_district_id==="D003"&&(t+=2),de({shipping_cost:t}).pipe(me(500))}createBatchOrders(e){let t=this.getAuthHeaders();return this.authService.getAccessToken()?this.http.post(`${this.apiUrlOrders}/batch-create`,e,{headers:t}).pipe(b(this.handleError)):C(()=>new Error("Not authenticated to fetch users."))}getAvailableDrivers(e){let t=this.getAuthHeaders();return this.authService.getAccessToken()?this.http.get(`${this.apiUrlUsers}/rol/MOTORIZED`,{headers:t}).pipe(b(this.handleError)):C(()=>new Error("Not authenticated to fetch users."))}assignDriverToOrder(e,t){let o=this.getAuthHeaders();return this.authService.getAccessToken()?this.http.put(`${this.apiUrlOrders}/assign-driver-to-order/`+e,{motorizedId:t},{headers:o}).pipe(b(this.handleError)):C(()=>new Error("Not authenticated to fetch users."))}rescheduleOrder(e,t,o){let s=this.getAuthHeaders();return this.authService.getAccessToken()?this.http.put(`${this.apiUrlOrders}/reschedule-order/`+e,{newDate:t,reason:o},{headers:s}).pipe(b(this.handleError)):C(()=>new Error("Not authenticated to fetch users."))}handleImportError(e){console.error("API Import Error:",e);let t={success:!1,message:"Error de comunicaci\xF3n con el servidor durante la importaci\xF3n.",errors:[{row:0,message:`Error: ${e.status} - ${e.statusText||"Error desconocido"}`}]};return e.error&&typeof e.error=="object"&&"message"in e.error&&(t=le(le({},t),e.error)),C(()=>t)}handleError(e){let t="An unknown error occurred!";return e.error instanceof ErrorEvent?t=`Error: ${e.error.message}`:(t=`Error Code: ${e.status}
Message: ${e.message||e.error?.message||"Server error"}`,e.status===0&&(t="Could not connect to the server. Please check your network or if the server is running.")),console.error("API Error in OrderService:",e),C(()=>new Error(t))}static \u0275fac=function(t){return new(t||r)};static \u0275prov=$({token:r,factory:r.\u0275fac,providedIn:"root"})};var oe=class r{filtersChanged=new x;filterForm;orderStatuses$;orderService=_(A);fb=_(Xe);datePipe=_(N);destroy$=new z;constructor(){this.filterForm=this.fb.group({start_date:[null],end_date:[null],status:[null],search_term:[""]}),this.orderStatuses$=this.orderService.getOrderStatuses()}ngOnInit(){this.filterForm.valueChanges.pipe(D(this.destroy$),Ee(400),ye((e,t)=>JSON.stringify(e)===JSON.stringify(t))).subscribe(()=>{this.applyFilters()})}applyFilters(){let e=this.filterForm.value,t={start_date:e.start_date?this.datePipe.transform(e.start_date,"yyyy-MM-dd"):null,end_date:e.end_date?this.datePipe.transform(e.end_date,"yyyy-MM-dd"):null,status:e.status||null,search_term:e.search_term?.trim()||null};console.log("OrderFiltersComponent: Emitting filters",t),this.filtersChanged.emit(t)}clearFilters(){this.filterForm.reset({start_date:null,end_date:null,status:null,search_term:""})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=E({type:r,selectors:[["app-order-filters"]],outputs:{filtersChanged:"filtersChanged"},features:[Te([lt(),N])],decls:22,vars:3,consts:[["startDatePicker",""],[1,"filters-container",3,"formGroup"],[2,"min-width","100%"],["appearance","outline",2,"width","250px !important"],["matInput","","formControlName","start_date","placeholder","mm/dd/yyyy",3,"matDatepicker"],["matSuffix","",3,"for"],["appearance","outline"],["matInput","","formControlName","search_term","placeholder","Buscar..."],[1,"filter-actions"],["mat-flat-button","","type","button",1,"btn-corp-primary",3,"click"],["mat-stroked-button","","type","button",1,"btn-corp-secondary",3,"click"]],template:function(t,o){if(t&1){let s=U();i(0,"form",1)(1,"div",2)(2,"mat-form-field",3)(3,"mat-label"),l(4,"Fecha de entrega "),a(),v(5,"input",4)(6,"mat-datepicker-toggle",5)(7,"mat-datepicker",null,0),a()(),i(9,"mat-form-field",6)(10,"mat-label"),l(11,"Buscar"),a(),v(12,"input",7),a(),i(13,"div",8)(14,"button",9),u("click",function(){return w(s),T(o.applyFilters())}),i(15,"mat-icon"),l(16,"search"),a(),l(17," Buscar "),a(),i(18,"button",10),u("click",function(){return w(s),T(o.clearFilters())}),i(19,"mat-icon"),l(20,"clear_all"),a(),l(21," Limpiar "),a()()()}if(t&2){let s=we(8);g("formGroup",o.filterForm),d(5),g("matDatepicker",s),d(),g("for",s)}},dependencies:[y,Ke,Ve,He,$e,Ue,Ge,je,qe,Ze,We,Qe,Ye,Je,Tt,St,Dt,wt,st,Mt,P,k,S,I],styles:[".filters-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:16px;align-items:flex-start;padding:16px;background-color:var(--sys-surface-container-low);border-radius:8px;margin-bottom:20px;box-shadow:0 1px 3px #00000014}mat-form-field[_ngcontent-%COMP%]{min-width:200px;flex-grow:1}.filter-actions[_ngcontent-%COMP%]{display:flex;gap:10px;align-items:center;padding-top:8px}@media (max-width: 768px){mat-form-field[_ngcontent-%COMP%]{width:calc(50% - 8px);min-width:unset}.filter-actions[_ngcontent-%COMP%]{width:100%;justify-content:flex-end;padding-top:16px}}@media (max-width: 480px){mat-form-field[_ngcontent-%COMP%]{width:100%}}"]})};var be=(m=>(m.REGISTRADO="REGISTRADO",m.RECOGIDO="RECOGIDO",m.EN_ALMACEN="EN ALMACEN",m.EN_TRANSITO="EN TRANSITO",m.ENTREGADO="ENTREGADO",m.CANCELADO="CANCELADO",m.RECHAZADO="RECHAZADO EN PUNTO",m.REPROGRAMADO="REPROGRAMADO",m))(be||{});function $t(r,e){r&1&&(i(0,"div",10)(1,"mat-icon",11),l(2,"broken_image"),a(),i(3,"p",12),l(4," No hay imagen de evidencia disponible o no se pudo cargar. "),a()())}var ne=class r{constructor(e,t){this.dialogRef=e;this.data=t;this.data.order.product_delivery_photo_url||(this.isLoadingImage.set(!1),this.imageLoadFailed.set(!0))}isLoadingImage=pe(!0);imageLoadFailed=pe(!1);onImageLoad(){console.log("EVENTO: onImageLoad DISPARADO para URL:",this.data.order.product_delivery_photo_url),this.isLoadingImage.set(!1),this.imageLoadFailed.set(!1),console.log("Imagen cargada")}onImageError(){this.isLoadingImage.set(!1),this.imageLoadFailed.set(!0),console.error("Error al cargar la imagen de evidencia.")}onClose(){this.dialogRef.close()}static \u0275fac=function(t){return new(t||r)(R(rt),R(ot))};static \u0275cmp=E({type:r,selectors:[["app-order-detail-dialog"]],decls:14,vars:2,consts:[["cdkDrag","","cdkDragRootElement",".cdk-overlay-pane","cdkDragHandle",".dialog-header-draggable",1,"dialog-container"],[1,"dialog-header","dialog-header-draggable"],["mat-dialog-title","",1,"dialog-title"],["mat-icon-button","","aria-label","Cerrar di\xE1logo","matTooltip","Cerrar",1,"close-button",3,"click"],[1,"evidence-dialog-content"],[1,"image-wrapper"],["alt","Foto del Pedido",1,"evidence-image",3,"src"],["class","placeholder-container",4,"ngIf"],["align","end",1,"dialog-actions"],["mat-flat-button","",1,"btn-corp-primary",3,"click"],[1,"placeholder-container"],[1,"placeholder-icon"],[1,"placeholder-text"]],template:function(t,o){t&1&&(i(0,"div",0)(1,"div",1)(2,"h2",2),l(3,"Foto del Pedido"),a(),i(4,"button",3),u("click",function(){return o.onClose()}),i(5,"mat-icon"),l(6,"close"),a()()(),i(7,"mat-dialog-content",4)(8,"div",5),v(9,"img",6),p(10,$t,5,0,"div",7),a()(),i(11,"mat-dialog-actions",8)(12,"button",9),u("click",function(){return o.onClose()}),l(13,"Close"),a()()()),t&2&&(d(9),g("src",o.data.order.product_delivery_photo_url,Se),d(),g("ngIf",!o.data.order.product_delivery_photo_url||o.imageLoadFailed()))},dependencies:[y,G,q,nt,at,it,P,k,et,S,I,J,ze,ct,ee,Y,At,It,kt,X],styles:["[_nghost-%COMP%]{display:block}.dialog-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;max-height:calc(100vh - 80px)}.dialog-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:16px 24px;border-bottom:1px solid #e0e0e0;background-color:#f5f5f5}.dialog-header-draggable[_ngcontent-%COMP%]{cursor:move}h2.mat-mdc-dialog-title[_ngcontent-%COMP%]{margin:0;font-size:1.35em;font-weight:500;color:#455a64}.order-code-chip[_ngcontent-%COMP%]{font-size:.9em;color:#3f51b5;font-weight:500;margin-left:16px;flex-grow:1}.close-button[_ngcontent-%COMP%]{min-width:auto;padding:0;line-height:normal;color:#757575}.dialog-content[_ngcontent-%COMP%]{padding:20px 24px 24px;overflow-y:auto;flex-grow:1;background-color:#fff}.info-card[_ngcontent-%COMP%]{margin-bottom:24px;border:1px solid #eeeeee!important;box-shadow:none!important;border-radius:8px}.info-card[_ngcontent-%COMP%]:last-child{margin-bottom:0}.info-card[_ngcontent-%COMP%]   mat-card-header.compact-card-header[_ngcontent-%COMP%]{padding:12px 16px;display:flex;align-items:center;justify-content:space-between;background-color:#fafafa;border-bottom:1px solid #eeeeee}.info-card[_ngcontent-%COMP%]   mat-card-title[_ngcontent-%COMP%]{font-size:1.1em;font-weight:500;color:#546e7a;margin:0}.info-card[_ngcontent-%COMP%]   .status-badge-dialog[_ngcontent-%COMP%]{padding:4px 10px;border-radius:12px;font-size:.7rem;font-weight:600;text-transform:uppercase;color:#fff;line-height:1.2}.info-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]{padding:16px;font-size:.9rem}mat-grid-list[_ngcontent-%COMP%]{padding:0}mat-grid-tile[_ngcontent-%COMP%]     .mat-figure{align-items:flex-start;padding:8px}.detail-item[_ngcontent-%COMP%]{display:flex;align-items:center;width:100%;gap:10px}.detail-item[_ngcontent-%COMP%]   .detail-icon[_ngcontent-%COMP%]{color:#90a4ae;font-size:20px}.detail-item[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:flex;flex-direction:column;line-height:1.4}.interactive-detail-item[_ngcontent-%COMP%]{cursor:pointer}.interactive-detail-item[_ngcontent-%COMP%]:hover   .detail-value[_ngcontent-%COMP%]{color:#3f51b5;text-decoration:underline}.link-like[_ngcontent-%COMP%]{color:#5c6bc0;font-weight:500}.detail-label[_ngcontent-%COMP%]{font-size:.75em;color:#616161;margin-bottom:2px;font-weight:500;text-transform:uppercase;letter-spacing:.5px}.detail-value[_ngcontent-%COMP%]{color:#212121;word-break:break-word}.bold-value[_ngcontent-%COMP%]{font-weight:600;font-size:1.05em}.item-description[_ngcontent-%COMP%]{font-style:italic;color:#555;margin-bottom:12px;padding-bottom:12px;border-bottom:1px dashed #e0e0e0;font-size:.9em}.detail-block[_ngcontent-%COMP%]{margin-bottom:16px}.detail-block[_ngcontent-%COMP%]   .detail-label-block[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-size:.9em;font-weight:500;color:#607d8b;margin-bottom:6px}.detail-block[_ngcontent-%COMP%]   .detail-label-block[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px}.detail-block[_ngcontent-%COMP%]   .detail-value-block[_ngcontent-%COMP%]{font-size:.9em;color:#424242;padding-left:26px;white-space:pre-wrap}.dialog-actions[_ngcontent-%COMP%]{padding:16px 24px;border-top:1px solid #e0e0e0;background-color:#fafafa}.dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-left:8px}.dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-child{margin-left:0}.status-registrado[_ngcontent-%COMP%]{background-color:#6610f2;color:#fff}.status-recogido[_ngcontent-%COMP%]{background-color:#fd7e14;color:#fff}.status-en-almacen[_ngcontent-%COMP%]{background-color:#0d6efd;color:#fff}.status-en-transito[_ngcontent-%COMP%]{background-color:#0c1a77;color:#d0c8c8}.status-entregado[_ngcontent-%COMP%]{background-color:#198754;color:#fff}.status-no-entregado[_ngcontent-%COMP%]{background-color:#dc3545;color:#fff}.status-cancelado[_ngcontent-%COMP%]{background-color:#6c757d;color:#fff}.status-rechazado-en-punto[_ngcontent-%COMP%]{background-color:#ff6b6b;color:#fff}.status-reprogramado[_ngcontent-%COMP%]{background-color:#adb5bd;color:#212529}.status-desconocido[_ngcontent-%COMP%]{background-color:#9e9e9e;color:#fff}"]})};var Ut=()=>[10,25,50,100],Vt=()=>({"highlight-row":!1});function Gt(r,e){r&1&&(i(0,"div",35),v(1,"mat-progress-spinner",36),a())}function jt(r,e){r&1&&(i(0,"th",37),l(1,"N\xB0 Pedido"),a())}function Xt(r,e){if(r&1&&(i(0,"td",38),l(1),a()),r&2){let t=e.$implicit;d(),O(" ",t.code," ")}}function Kt(r,e){r&1&&(i(0,"th",37),l(1,"Empresa"),a())}function Wt(r,e){if(r&1&&(i(0,"td",39),l(1),a()),r&2){let t=e.$implicit;g("matTooltip",t.company==null?null:t.company.username),d(),O(" ",t.company==null?null:t.company.username," ")}}function Qt(r,e){r&1&&(i(0,"th",37),l(1,"Destinatario"),a())}function Zt(r,e){if(r&1&&(i(0,"td",39),l(1),a()),r&2){let t=e.$implicit;g("matTooltip",t.recipient_name),d(),O(" ",t.recipient_name," ")}}function qt(r,e){r&1&&(i(0,"th",37),l(1,"Distrito"),a())}function Jt(r,e){if(r&1&&(i(0,"td",40),l(1),a()),r&2){let t=e.$implicit;d(),O(" ",t.delivery_district_name," ")}}function Yt(r,e){r&1&&(i(0,"th",41),l(1," Motorizado "),a())}function er(r,e){if(r&1&&(i(0,"td",40),l(1),a()),r&2){let t=e.$implicit;d(),O(" ",t.assigned_driver==null?null:t.assigned_driver.username," ")}}function tr(r,e){r&1&&(i(0,"th",42),l(1," Monto Cobrar "),a())}function rr(r,e){if(r&1&&(i(0,"td",43),l(1),ke(2,"currency"),a()),r&2){let t=e.$implicit;d(),O(" ",Ie(2,1,t.amount_to_collect_at_delivery,"PEN","S/ ","1.2-2")," ")}}function or(r,e){r&1&&(i(0,"th",44),l(1," Estado "),a())}function nr(r,e){if(r&1&&(i(0,"td",40),l(1),a()),r&2){let t=e.$implicit;d(),O(" ",t.status," ")}}function ir(r,e){r&1&&(i(0,"th",45),l(1," Efectivo(Monto cobrar) "),a())}function ar(r,e){if(r&1&&(i(0,"td",40),l(1),a()),r&2){let t=e.$implicit;d(),O(" ",t.efectivo_monto_cobrar," ")}}function sr(r,e){r&1&&(i(0,"th",46),l(1," Pago directo(Monto cobrar) "),a())}function lr(r,e){if(r&1&&(i(0,"td",40),l(1),a()),r&2){let t=e.$implicit;d(),O(" ",t.pago_directo_monto_cobrar," ")}}function cr(r,e){r&1&&(i(0,"th",47),l(1," Efectivo(Costo servicio) "),a())}function dr(r,e){if(r&1&&(i(0,"td",40),l(1),a()),r&2){let t=e.$implicit;d(),O(" ",t.efectivo_costo_servicio," ")}}function mr(r,e){r&1&&(i(0,"th",48),l(1," Pago directo(Costo servicio) "),a())}function pr(r,e){if(r&1&&(i(0,"td",40),l(1),a()),r&2){let t=e.$implicit;d(),O(" ",t.pago_directo_costo_servicio," ")}}function gr(r,e){r&1&&(i(0,"th",49),l(1," Usuario de creacion "),a())}function _r(r,e){if(r&1&&(i(0,"td",40),l(1),a()),r&2){let t=e.$implicit;d(),O(" ",t.user==null?null:t.user.username," ")}}function ur(r,e){r&1&&(i(0,"th",50),l(1," Acciones "),a())}function hr(r,e){if(r&1){let t=U();i(0,"td",51)(1,"button",52),u("click",function(){let s=w(t).$implicit,c=V();return T(c.onViewOrderDetails(s))}),i(2,"mat-icon"),l(3,"photo"),a()(),i(4,"button",52),u("click",function(){let s=w(t).$implicit,c=V();return T(c.onViewPdf(s))}),i(5,"mat-icon"),l(6,"download"),a()()()}}function fr(r,e){r&1&&v(0,"tr",53)}function Or(r,e){r&1&&v(0,"tr",54),r&2&&g("ngClass",he(1,Vt))}function Cr(r,e){if(r&1&&(i(0,"tr",55)(1,"td",56),l(2," No se encontraron pedidos que coincidan con los filtros. "),a()()),r&2){let t=V();d(),De("colspan",t.displayedColumns.length)}}var ie=class r{constructor(e){this.http=e}orders=[];isLoading=!1;totalCount=0;pageSize=10;pageIndex=0;pageChanged=new x;sortChanged=new x;statusChanged=new x;motorizedChanged=new x;rescheduleChanged=new x;viewPdfClicked=new x;viewDetailsClicked=new x;displayedColumns=["code","company","recipient_name","delivery_district_name","motorizado","status","amount_to_collect_at_delivery","efectivo_monto_cobrar","pago_directo_monto_cobrar","efectivo_costo_servicio","pago_directo_costo_servicio","usuario_creacion"];dataSource=new xt;paginator;sort;dialog=_(Z);snackBar=_(K);OrderStatus=be;ngOnChanges(e){e.orders&&this.orders&&(this.dataSource.data=this.orders)}ngAfterViewInit(){}canMarkAs(e,t){let o=e.status;return!1}onViewPdf(e){this.http.get(e.product_delivery_photo_url||"",{responseType:"blob"}).subscribe(t=>{let o=document.createElement("a");o.href=URL.createObjectURL(t),o.download="filename",document.body.appendChild(o),o.click(),document.body.removeChild(o)})}onSeguimiento(e){window.open("/tracking?code="+e.tracking_code,"_blank")}changeOrderStatus(e,t){console.log(`Changing status of order ${e.code} to ${t}`),this.statusChanged.emit({orderId:e.id,newStatus:t})}getStatusClass(e){return e?`status-${e.toLowerCase().replace(/[\s_]+/g,"-")}`:"status-desconocido"}getAvailableStatuses(e){switch(e.status){case"REGISTRADO":return["RECOGIDO","CANCELADO"];case"RECOGIDO":return["EN ALMACEN","CANCELADO"];case"EN ALMACEN":return["EN TRANSITO","CANCELADO"];case"EN TRANSITO":case"EN TRANSITO":return["ENTREGADO","CANCELADO","RECHAZADO EN PUNTO","REPROGRAMADO"];case"REPROGRAMADO":return["EN TRANSITO","CANCELADO"];default:return[]}}onViewOrderDetails(e){this.viewDetailsClicked.emit(e),this.dialog.open(ne,{width:"750px",maxWidth:"90vw",maxHeight:"90vh",data:{order:e},panelClass:"order-detail-dialog-responsive",autoFocus:"dialog"})}onUploadProof(e){console.log("Upload proof for order:",e.code),this.snackBar.open('Funci\xF3n "Subir Prueba" no implementada.',"OK",{duration:2e3})}onReschedule(e){console.log("Reschedule order:",e.code),this.snackBar.open('Funci\xF3n "Reprogramar" no implementada.',"OK",{duration:2e3})}isAdminOrDriver(){return!0}isAdminUser(){return!0}static \u0275fac=function(t){return new(t||r)(R(j))};static \u0275cmp=E({type:r,selectors:[["app-order-table"]],viewQuery:function(t,o){if(t&1&&(ge(te,5),ge(re,5)),t&2){let s;_e(s=ue())&&(o.paginator=s.first),_e(s=ue())&&(o.sort=s.first)}},inputs:{orders:"orders",isLoading:"isLoading",totalCount:"totalCount",pageSize:"pageSize",pageIndex:"pageIndex"},outputs:{pageChanged:"pageChanged",sortChanged:"sortChanged",statusChanged:"statusChanged",motorizedChanged:"motorizedChanged",rescheduleChanged:"rescheduleChanged",viewPdfClicked:"viewPdfClicked",viewDetailsClicked:"viewDetailsClicked"},features:[Pe],decls:46,vars:10,consts:[[1,"table-wrapper","mat-elevation-z4"],["class","spinner-overlay",4,"ngIf"],["mat-table","","matSort","",1,"orders-table",3,"matSortChange","dataSource"],["matColumnDef","code"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","","class","",4,"matCellDef"],["matColumnDef","company"],["mat-cell","","class","truncate-texts",3,"matTooltip",4,"matCellDef"],["matColumnDef","recipient_name"],["matColumnDef","delivery_district_name"],["mat-cell","",4,"matCellDef"],["matColumnDef","motorizado"],["mat-header-cell","","mat-sort-header","code",4,"matHeaderCellDef"],["matColumnDef","amount_to_collect_at_delivery"],["mat-header-cell","","mat-sort-header","","class","align-right",4,"matHeaderCellDef"],["mat-cell","","class","align-right amount-cell",4,"matCellDef"],["matColumnDef","status"],["mat-header-cell","","mat-sort-header","","class","status-column-header",4,"matHeaderCellDef"],["matColumnDef","efectivo_monto_cobrar"],["mat-header-cell","","mat-sort-header","efectivo_monto_cobrar",4,"matHeaderCellDef"],["matColumnDef","pago_directo_monto_cobrar"],["mat-header-cell","","mat-sort-header","pago_directo_monto_cobrar",4,"matHeaderCellDef"],["matColumnDef","efectivo_costo_servicio"],["mat-header-cell","","mat-sort-header","efectivo_costo_servicio",4,"matHeaderCellDef"],["matColumnDef","pago_directo_costo_servicio"],["mat-header-cell","","mat-sort-header","pago_directo_costo_servicio",4,"matHeaderCellDef"],["matColumnDef","usuario_creacion"],["mat-header-cell","","mat-sort-header","usuario_creacion",4,"matHeaderCellDef"],["matColumnDef","actions"],["mat-header-cell","","class","actions-column-header",4,"matHeaderCellDef"],["mat-cell","","class","actions-cell",4,"matCellDef"],["mat-header-row","","class","header-row-sticky",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","","class","data-row",3,"ngClass",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["showFirstLastButtons","","aria-label","Seleccione p\xE1gina de pedidos",3,"page","length","pageSize","pageIndex","pageSizeOptions"],[1,"spinner-overlay"],["mode","indeterminate","diameter","60"],["mat-header-cell","","mat-sort-header",""],["mat-cell","",1,""],["mat-cell","",1,"truncate-texts",3,"matTooltip"],["mat-cell",""],["mat-header-cell","","mat-sort-header","code"],["mat-header-cell","","mat-sort-header","",1,"align-right"],["mat-cell","",1,"align-right","amount-cell"],["mat-header-cell","","mat-sort-header","",1,"status-column-header"],["mat-header-cell","","mat-sort-header","efectivo_monto_cobrar"],["mat-header-cell","","mat-sort-header","pago_directo_monto_cobrar"],["mat-header-cell","","mat-sort-header","efectivo_costo_servicio"],["mat-header-cell","","mat-sort-header","pago_directo_costo_servicio"],["mat-header-cell","","mat-sort-header","usuario_creacion"],["mat-header-cell","",1,"actions-column-header"],["mat-cell","",1,"actions-cell"],["mat-menu-item","",3,"click"],["mat-header-row","",1,"header-row-sticky"],["mat-row","",1,"data-row",3,"ngClass"],[1,"mat-row"],[1,"no-data-cell"]],template:function(t,o){t&1&&(i(0,"div",0),p(1,Gt,2,0,"div",1),i(2,"table",2),u("matSortChange",function(c){return o.sortChanged.emit(c)}),h(3,3),p(4,jt,2,0,"th",4)(5,Xt,2,1,"td",5),f(),h(6,6),p(7,Kt,2,0,"th",4)(8,Wt,2,2,"td",7),f(),h(9,8),p(10,Qt,2,0,"th",4)(11,Zt,2,2,"td",7),f(),h(12,9),p(13,qt,2,0,"th",4)(14,Jt,2,1,"td",10),f(),h(15,11),p(16,Yt,2,0,"th",12)(17,er,2,1,"td",10),f(),h(18,13),p(19,tr,2,0,"th",14)(20,rr,3,6,"td",15),f(),h(21,16),p(22,or,2,0,"th",17)(23,nr,2,1,"td",10),f(),h(24,18),p(25,ir,2,0,"th",19)(26,ar,2,1,"td",10),f(),h(27,20),p(28,sr,2,0,"th",21)(29,lr,2,1,"td",10),f(),h(30,22),p(31,cr,2,0,"th",23)(32,dr,2,1,"td",10),f(),h(33,24),p(34,mr,2,0,"th",25)(35,pr,2,1,"td",10),f(),h(36,26),p(37,gr,2,0,"th",27)(38,_r,2,1,"td",10),f(),h(39,28),p(40,ur,2,0,"th",29)(41,hr,7,0,"td",30),f(),p(42,fr,1,0,"tr",31)(43,Or,1,2,"tr",32)(44,Cr,3,1,"tr",33),a(),i(45,"mat-paginator",34),u("page",function(c){return o.pageChanged.emit(c)}),a()()),t&2&&(d(),g("ngIf",o.isLoading),d(),g("dataSource",o.dataSource),d(40),g("matHeaderRowDef",o.displayedColumns)("matHeaderRowDefSticky",!0),d(),g("matRowDefColumns",o.displayedColumns),d(2),g("length",o.totalCount)("pageSize",o.pageSize)("pageIndex",o.pageIndex)("pageSizeOptions",he(9,Ut)))},dependencies:[y,Ae,G,Re,vt,dt,pt,ht,gt,mt,ft,_t,ut,Ot,Ct,bt,Et,te,Pt,re,yt,X,Be,P,S,I,ee,Y,Q,tt,q,W,J],styles:["[_nghost-%COMP%]{display:block}.table-wrapper[_ngcontent-%COMP%]{position:relative;overflow:auto;background-color:var(--sys-surface);color:var(--sys-on-surface);margin-top:20px;box-shadow:0 4px 20px #00000014;transition:box-shadow .3s ease-in-out}.table-wrapper[_ngcontent-%COMP%]:hover{box-shadow:0 6px 25px #0000001f}.spinner-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background-color:rgba(var(--sys-surface),.85);display:flex;justify-content:center;align-items:center;z-index:100;border-radius:12px}.orders-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}th.mat-header-cell[_ngcontent-%COMP%]{font-weight:600;color:var(--sys-on-surface-variant);background-color:var(--sys-surface-container-low);padding:14px 18px;border-bottom:1px solid var(--sys-outline-variant);text-transform:uppercase;font-size:.8rem;letter-spacing:.5px}td.mat-cell[_ngcontent-%COMP%]{padding:12px 18px;border-bottom:1px solid var(--sys-outline-variant);color:var(--sys-on-surface-variant);font-size:.9rem}.header-row-sticky[_ngcontent-%COMP%]{position:sticky;top:0;z-index:10;background-color:var(--sys-surface-container-low)}.data-row[_ngcontent-%COMP%]{transition:background-color .2s ease-in-out}.data-row[_ngcontent-%COMP%]:hover{background-color:var(--sys-surface-container-highest);cursor:pointer}.highlight-row[_ngcontent-%COMP%]{background-color:var(--sys-primary-container)!important;font-weight:500}.align-right[_ngcontent-%COMP%]{text-align:right;justify-content:flex-end}.amount-cell[_ngcontent-%COMP%]{font-weight:500}.actions-column-header[_ngcontent-%COMP%]{text-align:center!important}.actions-cell[_ngcontent-%COMP%]{display:flex;text-align:center;white-space:nowrap}.actions-cell[_ngcontent-%COMP%]   button.mat-icon-button[_ngcontent-%COMP%]{margin:0 2px;color:var(--sys-on-surface-variant);transition:color .2s ease}.actions-cell[_ngcontent-%COMP%]   button.mat-icon-button[_ngcontent-%COMP%]:hover{color:var(--sys-primary)}.action-icon-delivered[_ngcontent-%COMP%]{color:#4caf50}.action-icon-delivered[_ngcontent-%COMP%]:hover{color:#388e3c}.action-icon-neutral[_ngcontent-%COMP%]{color:var(--sys-on-surface-variant)}.action-icon-neutral[_ngcontent-%COMP%]:hover{color:var(--sys-on-surface)}.no-data-cell[_ngcontent-%COMP%]{text-align:center;padding:50px;font-style:italic;color:var(--sys-on-surface-variant);font-size:1rem}.mat-mdc-paginator[_ngcontent-%COMP%]{background-color:var(--sys-surface-container-low);border-bottom-left-radius:12px;border-bottom-right-radius:12px;color:var(--sys-on-surface-variant);border-top:1px solid var(--sys-outline-variant);padding:8px 0}.truncate-text[_ngcontent-%COMP%]{max-width:180px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:inline-block;vertical-align:middle}.code-cell[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#3f51b5;text-decoration:none;font-weight:500}.code-cell[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}.status-badge[_ngcontent-%COMP%]{padding:5px 12px;border-radius:16px;font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.5px;display:inline-flex;align-items:center;line-height:1}.status-registrado[_ngcontent-%COMP%]{background-color:var(--status-registrado-bg);color:var(--status-registrado-color)}.status-recogido[_ngcontent-%COMP%]{background-color:var(--status-recogido-bg);color:var(--status-recogido-color)}.status-en-almacen[_ngcontent-%COMP%]{background-color:var(--status-en-almacen-bg);color:var(--status-en-almacen-color)}.status-en-transito[_ngcontent-%COMP%]{background-color:var(--status-en-transito-bg);color:var(--status-en-transito-color)}.status-entregado[_ngcontent-%COMP%]{background-color:var(--status-entregado-bg);color:var(--status-entregado-color)}.status-no-entregado[_ngcontent-%COMP%]{background-color:var(--status-no-entregado-bg);color:var(--status-no-entregado-color)}.status-cancelado[_ngcontent-%COMP%]{background-color:var(--status-cancelado-bg);color:var(--status-cancelado-color)}.status-rechazado-en-punto[_ngcontent-%COMP%]{background-color:var(--status-rechazado-bg);color:var(--status-rechazado-color)}.status-reprogramado[_ngcontent-%COMP%]{background-color:var(--status-reprogramado-bg);color:var(--status-reprogramado-color)}@media (max-width: 768px){th.mat-header-cell[_ngcontent-%COMP%], td.mat-cell[_ngcontent-%COMP%]{padding:8px 12px;font-size:.75rem}}"]})};var br="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-TFG-8",vr=".xlsx",ae=class r{constructor(){}exportAsExcelFile(e,t,o="Sheet1"){if(!e||e.length===0){console.warn("No data provided for Excel export.");return}let s=Nt.json_to_sheet(e),c={Sheets:{[o]:s},SheetNames:[o]},n=Rt(c,{bookType:"xlsx",type:"array"});this.saveAsExcelFile(n,t)}saveAsExcelFile(e,t){let o=new Blob([e],{type:br}),s=window.URL.createObjectURL(o),c=document.createElement("a");c.href=s,c.download=`${t}${vr}`,document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(s)}static \u0275fac=function(t){return new(t||r)};static \u0275prov=$({token:r,factory:r.\u0275fac,providedIn:"root"})};var se=class r{orderService=_(A);router=_(Ne);snackBar=_(K);dialog=_(Z);excelExportService=_(ae);datePipe=_(N);orders=[];isLoading=!1;totalOrderCount=0;currentPageIndex=0;currentPageSize=10;currentSortField="registration_date";currentSortDirection="desc";filterCriteriaSubject=new xe({});destroy$=new z;constructor(){}ngOnInit(){this.filterCriteriaSubject.pipe(D(this.destroy$),H(()=>this.currentPageIndex=0)).subscribe(e=>{this.fetchOrders()})}getAllFilteredOrdersForExport(){return ce(this,null,function*(){try{let e=this.filterCriteriaSubject.value;return(yield Me(this.orderService.getOrders2(e,this.currentSortField,this.currentSortDirection).pipe(D(this.destroy$))))||[]}catch(e){return console.error("Error fetching all filtered orders for export:",e),this.snackBar.open("Failed to fetch data for export.","Close",{duration:3e3,panelClass:["error-snackbar"]}),[]}})}exportDataToExcel(){return ce(this,null,function*(){this.isLoading=!0,this.snackBar.open("Preparando la exportaci\xF3n a Excel, esto puede tardar un momento...","",{duration:0});try{let e={amount_to_collect_at_delivery:0,efectivo_monto_cobrar:0,pago_directo_monto_cobrar:0,shipping_cost:0,efectivo_costo_servicio:0,pago_directo_costo_servicio:0,diferencia:0},t=yield this.getAllFilteredOrdersForExport();if(t&&t.length>0){let o=t.map(n=>{n.efectivo_monto_cobrar=n.payment_method_for_collection==="Efectivo"?n.amount_to_collect_at_delivery:0,n.pago_directo_monto_cobrar=n.payment_method_for_collection==="Pago directo"?n.amount_to_collect_at_delivery:0,n.efectivo_costo_servicio=n.payment_method_for_shipping_cost==="Efectivo"?n.shipping_cost:0,n.pago_directo_costo_servicio=n.payment_method_for_shipping_cost==="Pago directo"?n.shipping_cost:0;let M=0,m=n.amount_to_collect_at_delivery;if(n.amount_to_collect_at_delivery!==0){let zt=n.efectivo_costo_servicio||n.pago_directo_costo_servicio;n.pago_directo_monto_cobrar===n.amount_to_collect_at_delivery?m=0:M=m,zt===0&&(M=m-n.shipping_cost)}return e.amount_to_collect_at_delivery+=Number(n.amount_to_collect_at_delivery)||0,e.efectivo_monto_cobrar+=n.efectivo_monto_cobrar,e.pago_directo_monto_cobrar+=n.pago_directo_monto_cobrar,e.shipping_cost+=Number(n.shipping_cost)||0,e.efectivo_costo_servicio+=n.efectivo_costo_servicio,e.pago_directo_costo_servicio+=n.pago_directo_costo_servicio,e.diferencia+=M,{"N\xB0 PEDIDO":n.code,"TIPO DE PEDIDO":n.shipment_type,EMPRESA:n.company?.username,CLIENTE:n.recipient_name,DISTRITO:n.delivery_district_name,"FECHA DE REGISTRO":n.createdAt?this.datePipe.transform(n.createdAt,"dd/MM/yyyy"):"N/A",ESTADO:n.status,"MONTO A COBRAR":n.amount_to_collect_at_delivery,"EFECTIVO (MONTO COBRAR)":n.efectivo_monto_cobrar,"PAGO DIRECTO (MONTO COBRAR)":n.pago_directo_monto_cobrar,"COSTO ENVIO":n.shipping_cost,"EFECTIVO (COSTO ENVIO)":n.efectivo_costo_servicio,"PAGO DIRECTO (COSTO ENVIO)":n.pago_directo_costo_servicio,DIFERENCIA:M}}),s={"N\xB0 PEDIDO":"","TIPO DE PEDIDO":"",EMPRESA:"",CLIENTE:"",DISTRITO:"","FECHA DE REGISTRO":"",ESTADO:"","MONTO A COBRAR":null,"EFECTIVO (MONTO COBRAR)":null,"PAGO DIRECTO (MONTO COBRAR)":null,"COSTO ENVIO":null,"EFECTIVO (COSTO ENVIO)":null,"PAGO DIRECTO (COSTO ENVIO)":null,DIFERENCIA:null},c={"N\xB0 PEDIDO":"TOTALES","TIPO DE PEDIDO":"",EMPRESA:"",CLIENTE:"",DISTRITO:"","FECHA DE REGISTRO":"",ESTADO:"","MONTO A COBRAR":e.amount_to_collect_at_delivery,"EFECTIVO (MONTO COBRAR)":e.efectivo_monto_cobrar,"PAGO DIRECTO (MONTO COBRAR)":e.pago_directo_monto_cobrar,"COSTO ENVIO":e.shipping_cost,"EFECTIVO (COSTO ENVIO)":e.efectivo_costo_servicio,"PAGO DIRECTO (COSTO ENVIO)":e.pago_directo_costo_servicio,DIFERENCIA:e.diferencia};o.push(s),o.push(c),this.excelExportService.exportAsExcelFile(o,"Listado_Pedidos_Filtrados","Pedidos"),this.snackBar.dismiss(),this.snackBar.open("Archivo de Excel exportado exitosamente!","OK",{duration:3500,panelClass:["success-snackbar"]})}else this.snackBar.dismiss(),this.snackBar.open("No hay datos disponibles para exportar con los filtros actuales.","OK",{duration:3e3})}catch(e){console.error("Error during Excel export process:",e),this.snackBar.dismiss(),this.snackBar.open("Se produjo un error durante la exportaci\xF3n a Excel.","Close",{duration:3e3,panelClass:["error-snackbar"]})}finally{this.isLoading=!1}})}fetchOrders(){this.isLoading=!0;let e=this.filterCriteriaSubject.value;this.orderService.getOrders(e,this.currentPageIndex+1,this.currentPageSize,this.currentSortField,this.currentSortDirection).pipe(D(this.destroy$),b(t=>(this.snackBar.open(t.message||"Failed to load orders.","Close",{duration:5e3,panelClass:["error-snackbar"]}),this.isLoading=!1,[]))).subscribe(t=>{t.items.forEach(o=>{o.efectivo_monto_cobrar=o.payment_method_for_collection==="Efectivo"?o.amount_to_collect_at_delivery:0,o.pago_directo_monto_cobrar=o.payment_method_for_collection==="Pago directo"?o.amount_to_collect_at_delivery:0,o.pos_monto_cobrar=o.payment_method_for_collection==="POS"?o.amount_to_collect_at_delivery:0,o.efectivo_costo_servicio=o.payment_method_for_shipping_cost==="Efectivo"?o.shipping_cost:0,o.pago_directo_costo_servicio=o.payment_method_for_shipping_cost==="Pago directo"?o.shipping_cost:0,o.pos_costo_servicio=o.payment_method_for_shipping_cost==="POS"?o.shipping_cost:0}),this.orders=t.items,this.totalOrderCount=t.total_count||0,this.isLoading=!1,console.log("Orders fetched:",t)})}handleStatusChanged(e){this.isLoading=!0,console.log("OrderListPage: Status change requested",e),this.orderService.updateOrderStatus(e.orderId,e.newStatus,e.reason||"",e.proofOfDeliveryImageUrl,e.shippingCostPaymentMethod,e.collectionPaymentMethod).subscribe({next:t=>{this.snackBar.open(`Estado del pedido ${t.code} actualizado a ${e.newStatus}.`,"OK",{duration:3e3,panelClass:["success-snackbar"]}),this.fetchOrders()},error:t=>{this.snackBar.open(`Error al actualizar estado: ${t.message||"Intente de nuevo"}`,"Cerrar",{duration:5e3,panelClass:["error-snackbar"]}),this.isLoading=!1},complete:()=>{this.isLoading=!1}})}handleMotorizedChanged(e){console.log("orderId",e.orderId),console.log("motorizedId",e.motorizedId),this.orderService.assignDriverToOrder(e.orderId,e.motorizedId).subscribe({next:t=>{this.snackBar.open(`Motorizado ${t.assigned_driver?.username} asignado al pedido ${t.code}.`,"OK",{duration:3e3,panelClass:["success-snackbar"]}),this.fetchOrders()},error:t=>{this.snackBar.open(`Error al asignar motorizado: ${t.message||"Intente de nuevo"}`,"Cerrar",{duration:5e3,panelClass:["error-snackbar"]})}})}handleRescheduleChanged(e){let t=new Date(e.newDate).toISOString();this.orderService.rescheduleOrder(e.orderId,t||"",e.reason).subscribe({next:o=>{this.snackBar.open(`Pedido ${o.code} reprogramado para ${this.datePipe.transform(o.delivery_date,"dd/MM/yyyy")}.`,"OK",{duration:3500,panelClass:["success-snackbar"]}),this.fetchOrders()},error:o=>{this.snackBar.open(`Error al reprogramar pedido: ${o.message||"Intente de nuevo"}`,"Cerrar",{duration:5e3,panelClass:["error-snackbar"]})}})}onFiltersChanged(e){console.log("OrderListPage: Filters changed",e),this.filterCriteriaSubject.next(e)}onPageChanged(e){console.log("OrderListPage: Page changed",e),this.currentPageIndex=e.pageIndex,this.currentPageSize=e.pageSize,this.fetchOrders()}onSortChanged(e){console.log("OrderListPage: Sort changed",e),this.currentSortField=e.active,this.currentSortDirection=e.direction,this.currentPageIndex=0,this.fetchOrders()}handleMassiveActions(e){console.log("Massive action selected:",e),this.snackBar.open(`Action: ${e} not implemented yet.`,"OK",{duration:3e3})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=E({type:r,selectors:[["app-order-list-page"]],decls:10,vars:5,consts:[[1,"page-content-wrapper"],[1,"page-title-bar"],[1,"page-title"],[1,"breadcrumbs"],[3,"filtersChanged"],["mat-flat-button","",1,"btn-corp-primary",3,"click"],[1,"orders-grid"],[3,"pageChanged","sortChanged","statusChanged","motorizedChanged","rescheduleChanged","orders","isLoading","totalCount","pageSize","pageIndex"]],template:function(t,o){t&1&&(i(0,"div",0)(1,"div",1)(2,"h1",2),l(3,"Lista de cierre de caja"),a(),v(4,"div",3),a(),i(5,"app-order-filters",4),u("filtersChanged",function(c){return o.onFiltersChanged(c)}),a(),i(6,"button",5),u("click",function(){return o.exportDataToExcel()}),l(7," Exportar a Excel "),a(),i(8,"div",6)(9,"app-order-table",7),u("pageChanged",function(c){return o.onPageChanged(c)})("sortChanged",function(c){return o.onSortChanged(c)})("statusChanged",function(c){return o.handleStatusChanged(c)})("motorizedChanged",function(c){return o.handleMotorizedChanged(c)})("rescheduleChanged",function(c){return o.handleRescheduleChanged(c)}),a()()()),t&2&&(d(9),g("orders",o.orders)("isLoading",o.isLoading)("totalCount",o.totalOrderCount)("pageSize",o.currentPageSize)("pageIndex",o.currentPageIndex))},dependencies:[y,Fe,oe,ie,W,P,k,S,Q],styles:[".page-content-wrapper[_ngcontent-%COMP%]{padding:20px 24px;background-color:var(--sys-surface-container-lowest);color:var(--sys-on-surface);min-height:calc(100vh - 64px)}.page-title-bar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:30px}.page-title[_ngcontent-%COMP%]{font-size:24px;font-weight:600;color:var(--sys-on-surface);margin:0}.breadcrumbs[_ngcontent-%COMP%]{font-size:14px;color:var(--sys-on-surface-variant)}.breadcrumbs[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--sys-primary);text-decoration:none}.breadcrumbs[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}.breadcrumbs[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-left:5px}.table-controls-bar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;background-color:var(--sys-surface-container-low);border-radius:8px;padding:8px 16px}.records-info[_ngcontent-%COMP%]{font-size:.9em;color:#555}.actions-group[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center}.orders-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr;gap:20px}@media (min-width: 768px){.orders-grid[_ngcontent-%COMP%]{grid-template-columns:1fr 1fr}}"]})};var Fn=[{path:"",component:se,title:"Listado de Pedidos"}];export{Fn as ORDERS_ROUTES};
