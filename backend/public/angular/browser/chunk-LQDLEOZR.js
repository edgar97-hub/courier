import{b as A}from"./chunk-TQ7VEWE7.js";import{a as y}from"./chunk-G4FQLWAW.js";import{Aa as M,Ga as R,Ha as I,Nc as k,a as o,b as p,f as b,fa as v,jc as m,ka as u,kc as l}from"./chunk-KWE5B57V.js";function D(t){let e=m(()=>t());return B(e)?new Proxy(t,{get(n,r){return r in e?(R(n[r])||Object.defineProperty(n,r,{value:l(()=>n()[r]),configurable:!0}),D(n[r])):n[r]}}):t}var L=[WeakSet,WeakMap,Promise,Date,Error,RegExp,ArrayBuffer,DataView,Function];function B(t){if(t===null||typeof t!="object"||H(t))return!1;let e=Object.getPrototypeOf(t);if(e===Object.prototype)return!0;for(;e&&e!==Object.prototype;){if(L.includes(e.constructor))return!1;e=Object.getPrototypeOf(e)}return e===Object.prototype}function H(t){return typeof t?.[Symbol.iterator]=="function"}var F=new WeakMap,i=Symbol("STATE_SOURCE");function d(t,...e){t[i].update(n=>e.reduce((r,f)=>o(o({},r),typeof f=="function"?f(r):f),n)),z(t)}function _(t){return t[i]()}function q(t){return F.get(t[i])||[]}function z(t){let e=q(t);for(let n of e){let r=m(()=>_(t));n(r)}}function P(...t){let e=[...t],n=typeof e[0]=="function"?{}:e.shift(),r=e;return(()=>{class s{constructor(){let a=r.reduce((g,O)=>O(g),V()),{stateSignals:h,props:T,methods:W,hooks:K}=a,S=o(o(o({},h),T),W);this[i]=a[i];for(let g of Reflect.ownKeys(S))this[g]=S[g];let{onInit:j,onDestroy:w}=K;j&&j(),w&&u(M).onDestroy(w)}static \u0275fac=function(h){return new(h||s)};static \u0275prov=v({token:s,factory:s.\u0275fac,providedIn:n.providedIn||null})}return s})()}function V(){return{[i]:I({}),stateSignals:{},props:{},methods:{},hooks:{}}}function $(t){return e=>{let n=t(o(o(o({[i]:e[i]},e.stateSignals),e.props),e.methods));return Reflect.ownKeys(n),p(o({},e),{props:o(o({},e.props),n)})}}function C(t){return $(t)}function x(t){return e=>{let n=t(o(o(o({[i]:e[i]},e.stateSignals),e.props),e.methods));return Reflect.ownKeys(n),p(o({},e),{methods:o(o({},e.methods),n)})}}function E(t){return e=>{let n=typeof t=="function"?t():t,r=Reflect.ownKeys(n);e[i].update(s=>o(o({},s),n));let f=r.reduce((s,c)=>{let a=l(()=>e[i]()[c]);return p(o({},s),{[c]:D(a)})},{});return p(o({},e),{stateSignals:o(o({},e.stateSignals),f)})}}var U={isLoading:!1,error:null},ae=P({providedIn:"root"},E(U),C((t,e=u(y))=>({currentUser:l(()=>e.currentUser()),isAuthenticated:l(()=>e.isAuthenticated())})),x((t,e=u(k),n=u(y),r=u(A))=>({login(s){return b(this,null,function*(){d(t,{isLoading:!0,error:null});try{let c=yield n.loginPromise(s);console.log("authResponse",c),r.open(`Bienvenido de nuevo, ${c.user.username}!`,"OK",{duration:3e3,verticalPosition:"top",panelClass:["success-snackbar"]}),n.getCurrentUserFromBackend().subscribe(),c.user.role==="EMPRESA"?e.navigate(["/orders/create"]):e.navigate(["dashboard"])}catch(c){let a=c.message||"Login failed. Please try again.";d(t,{error:a}),r.open(a,"Retry",{duration:5e3,verticalPosition:"top",panelClass:["error-snackbar"]})}finally{d(t,{isLoading:!1})}})},logout(){n.logout(),d(t,U),r.open("Se ha cerrado la sesi\xF3n.","OK",{duration:3e3,verticalPosition:"top"})},clearError(){d(t,{error:null})}})));export{ae as a};
