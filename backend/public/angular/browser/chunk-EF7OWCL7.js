import{a as ze}from"./chunk-G5BWZTXP.js";import{a as Ae,b as Fe,d as Le,e as Ne,f as De,i as Re}from"./chunk-EPOJPPLL.js";import"./chunk-ZHQNQEFC.js";import"./chunk-MUR4FGFA.js";import{a as we,b as Ie}from"./chunk-PHH6JU56.js";import{d as be,e as ve}from"./chunk-E35XVMLM.js";import{A as xe,D as Oe,G as he,H as ke,b as le,d as y,f as se,g as pe,l as ge,o as ue,r as fe,t as _e,v as Ce,x as Me,z as Pe}from"./chunk-43WGTYKX.js";import"./chunk-3VA5ILTZ.js";import{a as ne,b as ie,d as oe,e as re,g as ae,i as ce}from"./chunk-JPSKUWSR.js";import{a as de,b as me}from"./chunk-O7CKCNSQ.js";import{c as Te,f as ye}from"./chunk-6QAU3IBA.js";import"./chunk-E5NRZ37D.js";import{Ab as $,Cb as b,Cc as K,Db as l,Dc as Z,Ed as Ee,Fd as Se,I,Ic as X,Jc as Y,Ka as M,Oc as J,Pb as r,Q as A,Qb as v,Qc as Q,Rb as s,S as F,Sb as U,Ua as a,Vc as ee,Wc as te,ac as d,ba as k,bb as z,bc as C,cc as f,da as L,dc as T,hb as p,ia as N,l as E,lb as _,na as u,nb as B,qb as m,sb as V,t as S,tb as G,tc as H,u as w,ub as o,vb as i,vc as q,wa as D,wb as P,xa as R,yc as j,zc as W}from"./chunk-DQQKDGFN.js";var O=class n{API_TRACKING_URL=te.apiUrl+"/orders";http=u(Y);getOrderByTrackingCode(t){return!t||t.trim()===""?S(null):(console.log(`TrackingService: Fetching order with tracking code: ${t}`),this.http.get(this.API_TRACKING_URL+"/tracking",{params:new X().set("tracking_code",t.trim())}).pipe(L(e=>console.log("TrackingService: Fetched order:",e)),I(this.handleError)))}handleError(t){console.error("API Error in TrackingService:",t);let e="No se pudo obtener la informaci\xF3n del pedido. Por favor, intente m\xE1s tarde.";return t.status===404?e="C\xF3digo de seguimiento no encontrado. Verifique el c\xF3digo e intente de nuevo.":t.error&&typeof t.error=="string"&&t.error.length<100?e=t.error:t.message,w(()=>new Error(e))}static \u0275fac=function(e){return new(e||n)};static \u0275prov=N({token:n,factory:n.\u0275fac,providedIn:"root"})};var Ve=(n,t)=>t.id;function Ge(n,t){n&1&&(o(0,"mat-error"),r(1,"El c\xF3digo de seguimiento es obligatorio."),i())}function $e(n,t){n&1&&(o(0,"mat-error"),r(1,"El c\xF3digo debe tener al menos 5 caracteres."),i())}function Ue(n,t){n&1&&(P(0,"mat-progress-spinner",10),o(1,"span"),r(2,"Rastreando..."),i())}function He(n,t){n&1&&(o(0,"span"),r(1,"Rastrear"),i())}function qe(n,t){if(n&1&&(o(0,"mat-card",7)(1,"mat-card-content",11)(2,"mat-icon",12),r(3,"error_outline"),i(),o(4,"span"),r(5),i()()()),n&2){let e=l();a(5),v(e.errorMessage())}}function je(n,t){if(n&1&&(o(0,"div",24)(1,"mat-icon"),r(2,"event"),i(),o(3,"span")(4,"span"),r(5,"Entrega Estimada:"),i(),r(6),d(7,"date"),d(8,"default"),i()()),n&2){let e=l();a(6),s(" ",f(8,4,f(7,1,e.delivery_date,"fullDate"),"N/A"),"")}}function We(n,t){if(n&1){let e=$();o(0,"div",25),b("click",function(){D(e);let g=l(),x=l();return R(x.openMap(g.delivery_coordinates))}),o(1,"mat-icon",26),r(2,"location_on"),i(),o(3,"span"),r(4,"Ver en Mapa (Destino)"),i()()}}function Ke(n,t){if(n&1&&(o(0,"div",31)(1,"mat-icon",34),r(2,"short_text"),i(),r(3),i()),n&2){let e=l().$implicit;a(3),s(" ",e.notes," ")}}function Ze(n,t){if(n&1&&(o(0,"div",32),r(1),d(2,"titlecase"),d(3,"titlecase"),i()),n&2){let e=l().$implicit;a(),U(" De: ",C(2,2,e.previousValue)," \u2192 A: ",C(3,4,e.newValue)," ")}}function Xe(n,t){n&1&&P(0,"div",33)}function Ye(n,t){if(n&1&&(o(0,"mat-list-item",27)(1,"mat-icon",28),r(2),i(),o(3,"div",29),r(4),d(5,"titlecase"),i(),o(6,"div",30),r(7),d(8,"date"),i(),p(9,Ke,4,1,"div",31)(10,Ze,4,6,"div",32),i(),p(11,Xe,1,0,"div",33),d(12,"slice")),n&2){let e=t.$implicit,c=t.$index,g=l(2),x=l();B("first-item",c===0),a(),_("color",x.getTimelineIconColor(e)),a(),v(x.getTimelineIcon(e)),a(2),s(" ",C(5,9,e.action)," "),a(3),s(" ",f(8,11,e.createdAt,"dd/MM/yyyy HH:mm")," "),a(2),m(e.notes?9:-1),a(),m(e.previousValue&&e.newValue&&e.action.toUpperCase().includes("ESTADO")?10:-1),a(),m(c<T(12,14,g.logs,0,10).length-1?11:-1)}}function Je(n,t){if(n&1&&(o(0,"mat-list",22),V(1,Ye,13,18,null,null,Ve),d(3,"slice"),i()),n&2){let e=l();a(),G(T(3,0,e.logs,0,10))}}function Qe(n,t){n&1&&(o(0,"p",23),r(1," No hay historial de seguimiento disponible para este pedido. "),i())}function et(n,t){if(n&1&&(o(0,"mat-card",8)(1,"mat-card-header",13)(2,"div")(3,"mat-card-title"),r(4),i(),o(5,"mat-card-subtitle",14),r(6),d(7,"default"),i()(),o(8,"span",15),r(9),d(10,"titlecase"),i()(),o(11,"mat-card-content")(12,"div",16)(13,"div",17)(14,"mat-icon"),r(15,"description"),i(),o(16,"span",18)(17,"span"),r(18,"Contenido:"),i(),r(19),d(20,"default"),i()(),o(21,"div",17)(22,"mat-icon"),r(23,"home"),i(),o(24,"span",18)(25,"span"),r(26,"Destino:"),i(),r(27),d(28,"titlecase"),d(29,"default"),i()(),p(30,je,9,7,"div",19)(31,We,5,0,"div",20),i(),P(32,"mat-divider",21),o(33,"h3"),r(34,"Historial de Seguimiento"),i(),p(35,Je,4,4,"mat-list",22)(36,Qe,2,0,"p",23),i()()),n&2){let e=t,c=l();a(4),s("Pedido: ",e.code||e.tracking_code,""),a(2),s("Destinatario: ",f(7,9,e.recipient_name,"N/A"),""),a(2),_("ngClass",c.getStatusBadgeClass(e.status)),a(),s(" ",C(10,12,e.status)," "),a(10),s(" ",f(20,14,e.item_description,"No especificado"),""),a(8),s(" ",f(29,19,C(28,17,e.delivery_district_name),"N/A"),""),a(3),_("ngIf",e.delivery_date),a(),m(e.delivery_coordinates?31:-1),a(4),m(e.logs&&e.logs.length>0?35:36)}}function tt(n,t){n&1&&(o(0,"mat-card",9)(1,"mat-card-content",35)(2,"mat-icon"),r(3,"info_outline"),i(),o(4,"span"),r(5,"No se encontr\xF3 informaci\xF3n para el c\xF3digo de seguimiento ingresado."),i()()())}var h=class n{route=u(J);router=u(Q);fb=u(Ce);trackingService=u(O);trackingForm;trackedOrder=M(null);isLoading=M(!1);errorMessage=M(null);searchAttempted=M(!1);destroy$=new E;constructor(){this.trackingForm=this.fb.group({trackingCode:["",[y.required,y.minLength(5)]]}),this.route.queryParamMap.pipe(k(this.destroy$),A((t,e)=>t.get("code")===e.get("code"))).subscribe(t=>{let e=t.get("code");console.log("codeFromUrl",e),e&&(this.trackingForm.patchValue({trackingCode:e}),this.submitTracking())})}ngOnInit(){}get trackingCodeCtrl(){return this.trackingForm.get("trackingCode")}submitTracking(){if(this.searchAttempted.set(!0),this.errorMessage.set(null),this.trackedOrder.set(null),this.trackingForm.invalid){this.trackingForm.markAllAsTouched();return}let t=this.trackingCodeCtrl?.value.trim();t&&(this.isLoading.set(!0),this.router.navigate([],{relativeTo:this.route,queryParams:{code:t},queryParamsHandling:"merge"}),this.trackingService.getOrderByTrackingCode(t).pipe(k(this.destroy$),F(()=>this.isLoading.set(!1))).subscribe({next:e=>{this.trackedOrder.set(e),e||this.errorMessage.set("C\xF3digo de seguimiento no encontrado.")},error:e=>{this.trackedOrder.set(null),this.errorMessage.set(e.message||"Ocurri\xF3 un error al buscar el pedido.")}}))}getTimelineIcon(t){let e=t.newValue?.toUpperCase()||"";return e.includes("ENTREGADO")?"check_circle":e.includes("TRANSITO")||e.includes("RECOGIDO")?"local_shipping":e.includes("ALMACEN")?"inventory_2":e.includes("REGISTRADO")?"receipt_long":e.includes("CANCELADO")?"cancel":e.includes("RECHAZADO EN PUNTO")?"report_problem":e.includes("REPROGRAMADO")?"event_repeat":"fiber_manual_record"}getTimelineIconColor(t){let e=t.action.toUpperCase();if(e.includes("ENTREGADO"))return"primary";if(e.includes("CANCELADO")||e.includes("INCIDENCIA")||e.includes("NO_ENTREGADO"))return"warn"}getStatusBadgeClass(t){return t?`status-${t.toString().toLowerCase().replace(/[\s_]+/g,"-")}`:"status-desconocido"}openMap(t){t&&window.open(`https://www.google.com/maps/search/?api=1&query=${t}`,"_blank")}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=z({type:n,selectors:[["app-tracking-page"]],decls:23,vars:7,consts:[[1,"tracking-page-container"],[1,"tracking-form-card","mat-elevation-z4"],[1,"tracking-form",3,"ngSubmit","formGroup"],["appearance","outline",1,"full-width"],["matInput","","formControlName","trackingCode","placeholder","Ej: TRK12345XYZ","required",""],["matSuffix",""],["mat-flat-button","","type","submit",1,"track-button","btn-corp-primary",3,"disabled"],[1,"result-card","error-card","mat-elevation-z2"],[1,"result-card","order-details-card","mat-elevation-z2"],[1,"result-card","info-card","mat-elevation-z2"],["mode","indeterminate","diameter","20","strokeWidth","3"],[1,"error-message"],["color","warn"],[1,"order-details-header"],[2,"font-weight","700"],[1,"status-badge-tracking",2,"font-weight","700 !important",3,"ngClass"],[1,"order-summary"],[1,"summary-item"],[2,"font-weight","700 !important"],["class","summary-item","style","font-weight: 700 !important",4,"ngIf"],["matTooltip","Ver \xFAltima ubicaci\xF3n conocida o destino en mapa",1,"summary-item","map-link"],[1,"section-divider"],[1,"tracking-timeline"],[1,"no-history-message"],[1,"summary-item",2,"font-weight","700 !important"],["matTooltip","Ver \xFAltima ubicaci\xF3n conocida o destino en mapa",1,"summary-item","map-link",3,"click"],["color","primary"],[1,"timeline-item"],["matListItemIcon","",1,"timeline-icon",3,"color"],["matListItemTitle","",1,"timeline-action",2,"font-weight","700 !important"],["matListItemLine","",1,"timeline-date",2,"font-weight","700 !important"],["matListItemLine","",1,"timeline-notes",2,"font-weight","700 !important"],["matListItemLine","",1,"timeline-change",2,"font-weight","700 !important"],[1,"timeline-connector",2,"font-weight","700 !important"],[1,"notes-icon"],[1,"info-message"]],template:function(e,c){if(e&1&&(o(0,"div",0)(1,"mat-card",1)(2,"mat-card-header")(3,"mat-card-title"),r(4,"Rastrear Pedido"),i(),o(5,"mat-card-subtitle"),r(6,"Ingrese su c\xF3digo de seguimiento para ver el estado de su env\xEDo."),i()(),o(7,"mat-card-content")(8,"form",2),b("ngSubmit",function(){return c.submitTracking()}),o(9,"mat-form-field",3)(10,"mat-label"),r(11,"C\xF3digo de Seguimiento"),i(),P(12,"input",4),o(13,"mat-icon",5),r(14,"search"),i(),p(15,Ge,2,0,"mat-error")(16,$e,2,0,"mat-error"),i(),o(17,"button",6),p(18,Ue,3,0)(19,He,2,0,"span"),i()()()(),p(20,qe,6,1,"mat-card",7)(21,et,37,22,"mat-card",8)(22,tt,6,0,"mat-card",9),i()),e&2){let g;a(8),_("formGroup",c.trackingForm),a(7),m(c.trackingCodeCtrl!=null&&c.trackingCodeCtrl.hasError("required")&&(c.trackingCodeCtrl!=null&&c.trackingCodeCtrl.touched)?15:-1),a(),m(c.trackingCodeCtrl!=null&&c.trackingCodeCtrl.hasError("minlength")&&(c.trackingCodeCtrl!=null&&c.trackingCodeCtrl.touched)?16:-1),a(),_("disabled",c.isLoading()),a(),m(c.isLoading()?18:19),a(2),m(c.searchAttempted()&&!c.isLoading()&&c.errorMessage()?20:-1),a(),m((g=c.trackedOrder())?21:c.searchAttempted()&&!c.isLoading()&&!c.errorMessage()?22:-1,g)}},dependencies:[Z,H,q,K,j,W,ee,Me,ge,le,se,pe,_e,ue,fe,ke,he,Pe,xe,Oe,ve,be,ye,Te,Se,Ee,me,de,ce,ne,oe,ae,re,ie,Re,Ne,De,Le,we,Fe,Ae,Ie,ze],styles:['.tracking-page-container[_ngcontent-%COMP%]{padding:24px;max-width:900px;margin:20px auto;background-color:#f4f6f8;min-height:calc(100vh - 64px)}.tracking-form-card[_ngcontent-%COMP%]{margin-bottom:30px;padding:20px 24px;border-radius:8px;background-color:#fff;box-shadow:0 2px 8px #00000014}.tracking-form-card[_ngcontent-%COMP%]   mat-card-title[_ngcontent-%COMP%]{font-size:1.6em;font-weight:500;color:#303f9f}.tracking-form-card[_ngcontent-%COMP%]   mat-card-subtitle[_ngcontent-%COMP%]{margin-bottom:20px;color:#616161}.tracking-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.tracking-form[_ngcontent-%COMP%]   .full-width[_ngcontent-%COMP%]{width:100%}.track-button[_ngcontent-%COMP%]{padding:10px 0;font-weight:700!important;font-size:1.1em;text-transform:uppercase;letter-spacing:.5px;min-height:48px}.track-button[_ngcontent-%COMP%]   mat-progress-spinner[_ngcontent-%COMP%]{margin-right:8px}.track-button[_ngcontent-%COMP%]   mat-progress-spinner[_ngcontent-%COMP%]     circle{stroke:currentColor!important}.track-button[_ngcontent-%COMP%]   span[_ngcontent-%COMP%] + span[_ngcontent-%COMP%]{margin-left:8px}.result-card[_ngcontent-%COMP%]{margin-top:24px;border-radius:8px;padding:0;background-color:#fff;box-shadow:0 2px 8px #0000000f}.order-details-card[_ngcontent-%COMP%]   mat-card-header.order-details-header[_ngcontent-%COMP%]{padding:20px 24px;background-color:#e8eaf6;border-bottom:1px solid #c5cae9;display:flex;justify-content:space-between;align-items:center}.order-details-card[_ngcontent-%COMP%]   mat-card-header.order-details-header[_ngcontent-%COMP%]   mat-card-title[_ngcontent-%COMP%]{font-size:1.3em;font-weight:500;margin-bottom:4px;color:#283593}.order-details-card[_ngcontent-%COMP%]   mat-card-header.order-details-header[_ngcontent-%COMP%]   mat-card-subtitle[_ngcontent-%COMP%]{font-size:.9em;color:#546e7a}.order-details-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]{padding:24px}.status-badge-tracking[_ngcontent-%COMP%]{padding:6px 14px;border-radius:16px;font-size:.85rem;font-weight:600;text-transform:uppercase;color:#fff;line-height:1.2}.order-summary[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:20px;margin-bottom:24px}.order-summary[_ngcontent-%COMP%]   .summary-item[_ngcontent-%COMP%]{display:flex;align-items:center;padding:12px;background-color:#f8f9fa;border-radius:6px;border:1px solid #e9ecef}.order-summary[_ngcontent-%COMP%]   .summary-item[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:12px;color:#78909c}.order-summary[_ngcontent-%COMP%]   .summary-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.95em;color:#495057}.order-summary[_ngcontent-%COMP%]   .summary-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#212529;font-weight:500}.order-summary[_ngcontent-%COMP%]   .map-link[_ngcontent-%COMP%]{cursor:pointer}.order-summary[_ngcontent-%COMP%]   .map-link[_ngcontent-%COMP%]:hover{background-color:#e8eaf6;border-color:#9fa8da}.order-summary[_ngcontent-%COMP%]   .map-link[_ngcontent-%COMP%]:hover   span[_ngcontent-%COMP%]{color:#283593}.order-summary[_ngcontent-%COMP%]   .map-link[_ngcontent-%COMP%]:hover   mat-icon[_ngcontent-%COMP%]{color:#3f51b5}.section-divider[_ngcontent-%COMP%]{margin:24px 0;border-top-color:#e0e0e0}h3[_ngcontent-%COMP%]{font-size:1.25em;font-weight:500;margin-bottom:16px;color:#455a64;padding-bottom:8px;border-bottom:1px solid #e0e0e0}.tracking-timeline[_ngcontent-%COMP%]{padding-left:0;position:relative}.tracking-timeline[_ngcontent-%COMP%]:before{content:"";position:absolute;left:20px;top:10px;bottom:10px;width:2px;background-color:#d1d5db;z-index:0}.timeline-item[_ngcontent-%COMP%]{position:relative;padding-left:50px!important;padding-bottom:20px!important;min-height:160px}.timeline-item[_ngcontent-%COMP%]   .timeline-icon[_ngcontent-%COMP%]{position:absolute;left:-8px;top:4px;background-color:#fdfeff;border-radius:50%;z-index:1;font-size:28px;width:28px;height:28px}.timeline-item[_ngcontent-%COMP%]   .timeline-action[_ngcontent-%COMP%]{font-weight:500;font-size:1.05em;color:#374151;margin-bottom:4px}.timeline-item[_ngcontent-%COMP%]   .timeline-date[_ngcontent-%COMP%]{font-size:.8em;color:#6b7280;margin-bottom:6px}.timeline-item[_ngcontent-%COMP%]   .timeline-notes[_ngcontent-%COMP%]{font-size:.85em;color:#4b5563;display:flex;align-items:center}.timeline-item[_ngcontent-%COMP%]   .timeline-notes[_ngcontent-%COMP%]   .notes-icon[_ngcontent-%COMP%]{font-size:16px;width:16px;height:16px;margin-right:6px;opacity:.7}.timeline-item[_ngcontent-%COMP%]   .timeline-change[_ngcontent-%COMP%]{font-size:.8em;color:#4b5563;font-style:italic;margin-top:4px}.error-card[_ngcontent-%COMP%], .info-card[_ngcontent-%COMP%]{margin-top:20px;text-align:center;background-color:#fff}.error-card[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%], .error-card[_ngcontent-%COMP%]   .info-message[_ngcontent-%COMP%], .info-card[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%], .info-card[_ngcontent-%COMP%]   .info-message[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:20px;font-size:1.1em;color:#4b5563}.error-card[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%], .error-card[_ngcontent-%COMP%]   .info-message[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%], .info-card[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%], .info-card[_ngcontent-%COMP%]   .info-message[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:40px;width:40px;height:40px;margin-bottom:10px}.error-card[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%], .info-card[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#ef4444}.error-card[_ngcontent-%COMP%]   .info-message[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%], .info-card[_ngcontent-%COMP%]   .info-message[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#3b82f6}.no-history-message[_ngcontent-%COMP%]{font-style:italic;color:#6b7280;padding:20px 0;text-align:center}.status-registrado[_ngcontent-%COMP%]{background-color:#6610f2;color:#fff}.status-recogido[_ngcontent-%COMP%]{background-color:#fd7e14;color:#fff}.status-en-almacen[_ngcontent-%COMP%]{background-color:#0d6efd;color:#fff;white-space:nowrap}.status-en-transito[_ngcontent-%COMP%]{background-color:#0c1a77;color:#d0c8c8;white-space:nowrap}.status-entregado[_ngcontent-%COMP%]{background-color:#198754;color:#fff}.status-anulado[_ngcontent-%COMP%]{background-color:#dc3545;color:#fff;white-space:nowrap}.status-cancelado[_ngcontent-%COMP%]{background-color:#6c757d;color:#fff}.status-rechazado-en-punto[_ngcontent-%COMP%]{background-color:#ff6b6b;color:#fff;white-space:nowrap}.status-reprogramado[_ngcontent-%COMP%]{background-color:#adb5bd;color:#212529}']})};var Xt=[{path:"",component:h}];export{Xt as TRACKING_ROUTES};
