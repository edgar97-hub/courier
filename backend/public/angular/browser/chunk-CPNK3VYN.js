import{a as ze}from"./chunk-5P5HMDTF.js";import{a as de,b as le}from"./chunk-LS42GOGO.js";import{a as Ae,b as Fe,d as Le,e as Ne,f as Re,h as De}from"./chunk-JDXMLECF.js";import{a as Ie,b as we}from"./chunk-MELD4LZZ.js";import"./chunk-TKRH7WHC.js";import{a as ne,b as ie,d as oe,e as re,g as ae,i as ce}from"./chunk-W4CSZLWO.js";import{C as ke,D as he,J as be,K as ve,b as me,d as y,f as se,g as ge,l as pe,o as ue,p as fe,r as _e,s as Ce,u as Me,v as xe,w as Pe,z as Oe}from"./chunk-U3WC6S2W.js";import{a as Ee,b as Se}from"./chunk-YAUGPVR6.js";import{b as Te,e as ye}from"./chunk-PNZEVFCU.js";import"./chunk-OJN7FPAP.js";import{$ as h,$b as f,Ac as Z,Bb as b,Cb as m,Fc as X,G as w,Gc as Y,Ia as M,Kc as J,Mb as r,Mc as Q,Nb as v,O as A,Ob as s,Pb as U,Q as F,Rc as ee,Sc as te,Ta as a,Zb as d,_b as C,ab as z,ac as T,ba as L,ga as N,gb as g,j as E,kb as _,la as u,mb as B,pb as l,qc as H,r as S,rb as V,s as I,sb as G,sc as q,tb as o,ua as R,ub as i,va as D,vb as x,vc as j,wc as W,zb as $,zc as K}from"./chunk-4RYFT4MT.js";var O=class n{API_TRACKING_URL=te.apiUrl+"/orders";http=u(Y);getOrderByTrackingCode(t){return!t||t.trim()===""?S(null):(console.log(`TrackingService: Fetching order with tracking code: ${t}`),this.http.get(this.API_TRACKING_URL+"/tracking",{params:new X().set("tracking_code",t.trim())}).pipe(L(e=>console.log("TrackingService: Fetched order:",e)),w(this.handleError)))}handleError(t){console.error("API Error in TrackingService:",t);let e="No se pudo obtener la informaci\xF3n del pedido. Por favor, intente m\xE1s tarde.";return t.status===404?e="C\xF3digo de seguimiento no encontrado. Verifique el c\xF3digo e intente de nuevo.":t.error&&typeof t.error=="string"&&t.error.length<100?e=t.error:t.message,I(()=>new Error(e))}static \u0275fac=function(e){return new(e||n)};static \u0275prov=N({token:n,factory:n.\u0275fac,providedIn:"root"})};var Ve=(n,t)=>t.id;function Ge(n,t){n&1&&(o(0,"mat-error"),r(1,"El c\xF3digo de seguimiento es obligatorio."),i())}function $e(n,t){n&1&&(o(0,"mat-error"),r(1,"El c\xF3digo debe tener al menos 5 caracteres."),i())}function Ue(n,t){n&1&&(x(0,"mat-progress-spinner",10),o(1,"span"),r(2,"Rastreando..."),i())}function He(n,t){n&1&&(o(0,"span"),r(1,"Rastrear"),i())}function qe(n,t){if(n&1&&(o(0,"mat-card",7)(1,"mat-card-content",11)(2,"mat-icon",12),r(3,"error_outline"),i(),o(4,"span"),r(5),i()()()),n&2){let e=m();a(5),v(e.errorMessage())}}function je(n,t){if(n&1&&(o(0,"div",16)(1,"mat-icon"),r(2,"event"),i(),o(3,"span")(4,"strong"),r(5,"Entrega Estimada:"),i(),r(6),d(7,"date"),d(8,"default"),i()()),n&2){let e=m();a(6),s(" ",f(8,4,f(7,1,e.delivery_date,"fullDate"),"N/A"),"")}}function We(n,t){if(n&1){let e=$();o(0,"div",22),b("click",function(){R(e);let p=m(),P=m();return D(P.openMap(p.delivery_coordinates))}),o(1,"mat-icon",23),r(2,"location_on"),i(),o(3,"span"),r(4,"Ver en Mapa (Destino)"),i()()}}function Ke(n,t){if(n&1&&(o(0,"div",28)(1,"mat-icon",31),r(2,"short_text"),i(),r(3),i()),n&2){let e=m().$implicit;a(3),s(" ",e.notes," ")}}function Ze(n,t){if(n&1&&(o(0,"div",29),r(1),d(2,"titlecase"),d(3,"titlecase"),i()),n&2){let e=m().$implicit;a(),U(" De: ",C(2,2,e.previousValue)," \u2192 A: ",C(3,4,e.newValue)," ")}}function Xe(n,t){n&1&&x(0,"div",30)}function Ye(n,t){if(n&1&&(o(0,"mat-list-item",24)(1,"mat-icon",25),r(2),i(),o(3,"div",26),r(4),d(5,"titlecase"),i(),o(6,"div",27),r(7),d(8,"date"),i(),g(9,Ke,4,1,"div",28)(10,Ze,4,6,"div",29),i(),g(11,Xe,1,0,"div",30),d(12,"slice")),n&2){let e=t.$implicit,c=t.$index,p=m(2),P=m();B("first-item",c===0),a(),_("color",P.getTimelineIconColor(e)),a(),v(P.getTimelineIcon(e)),a(2),s(" ",C(5,9,e.action)," "),a(3),s(" ",f(8,11,e.createdAt,"dd/MM/yyyy HH:mm")," "),a(2),l(e.notes?9:-1),a(),l(e.previousValue&&e.newValue&&e.action.toUpperCase().includes("ESTADO")?10:-1),a(),l(c<T(12,14,p.logs,0,10).length-1?11:-1)}}function Je(n,t){if(n&1&&(o(0,"mat-list",20),V(1,Ye,13,18,null,null,Ve),d(3,"slice"),i()),n&2){let e=m();a(),G(T(3,0,e.logs,0,10))}}function Qe(n,t){n&1&&(o(0,"p",21),r(1," No hay historial de seguimiento disponible para este pedido. "),i())}function et(n,t){if(n&1&&(o(0,"mat-card",8)(1,"mat-card-header",13)(2,"div")(3,"mat-card-title"),r(4),i(),o(5,"mat-card-subtitle"),r(6),d(7,"default"),i()(),o(8,"span",14),r(9),d(10,"titlecase"),i()(),o(11,"mat-card-content")(12,"div",15)(13,"div",16)(14,"mat-icon"),r(15,"description"),i(),o(16,"span")(17,"strong"),r(18,"Contenido:"),i(),r(19),d(20,"default"),i()(),o(21,"div",16)(22,"mat-icon"),r(23,"home"),i(),o(24,"span")(25,"strong"),r(26,"Destino:"),i(),r(27),d(28,"titlecase"),d(29,"default"),i()(),g(30,je,9,7,"div",17)(31,We,5,0,"div",18),i(),x(32,"mat-divider",19),o(33,"h3"),r(34,"Historial de Seguimiento"),i(),g(35,Je,4,4,"mat-list",20)(36,Qe,2,0,"p",21),i()()),n&2){let e=t,c=m();a(4),s("Pedido: ",e.code||e.tracking_code,""),a(2),s("Destinatario: ",f(7,9,e.recipient_name,"N/A"),""),a(2),_("ngClass",c.getStatusBadgeClass(e.status)),a(),s(" ",C(10,12,e.status)," "),a(10),s(" ",f(20,14,e.item_description,"No especificado"),""),a(8),s(" ",f(29,19,C(28,17,e.delivery_district_name),"N/A"),""),a(3),_("ngIf",e.delivery_date),a(),l(e.delivery_coordinates?31:-1),a(4),l(e.logs&&e.logs.length>0?35:36)}}function tt(n,t){n&1&&(o(0,"mat-card",9)(1,"mat-card-content",32)(2,"mat-icon"),r(3,"info_outline"),i(),o(4,"span"),r(5,"No se encontr\xF3 informaci\xF3n para el c\xF3digo de seguimiento ingresado."),i()()())}var k=class n{route=u(J);router=u(Q);fb=u(Ce);trackingService=u(O);trackingForm;trackedOrder=M(null);isLoading=M(!1);errorMessage=M(null);searchAttempted=M(!1);destroy$=new E;constructor(){this.trackingForm=this.fb.group({trackingCode:["",[y.required,y.minLength(5)]]}),this.route.queryParamMap.pipe(h(this.destroy$),A((t,e)=>t.get("code")===e.get("code"))).subscribe(t=>{let e=t.get("code");console.log("codeFromUrl",e),e&&(this.trackingForm.patchValue({trackingCode:e}),this.submitTracking())})}ngOnInit(){}get trackingCodeCtrl(){return this.trackingForm.get("trackingCode")}submitTracking(){if(this.searchAttempted.set(!0),this.errorMessage.set(null),this.trackedOrder.set(null),this.trackingForm.invalid){this.trackingForm.markAllAsTouched();return}let t=this.trackingCodeCtrl?.value.trim();t&&(this.isLoading.set(!0),this.router.navigate([],{relativeTo:this.route,queryParams:{code:t},queryParamsHandling:"merge"}),this.trackingService.getOrderByTrackingCode(t).pipe(h(this.destroy$),F(()=>this.isLoading.set(!1))).subscribe({next:e=>{this.trackedOrder.set(e),e||this.errorMessage.set("C\xF3digo de seguimiento no encontrado.")},error:e=>{this.trackedOrder.set(null),this.errorMessage.set(e.message||"Ocurri\xF3 un error al buscar el pedido.")}}))}getTimelineIcon(t){let e=t.newValue?.toUpperCase()||"";return e.includes("ENTREGADO")?"check_circle":e.includes("TRANSITO")||e.includes("RECOGIDO")?"local_shipping":e.includes("ALMACEN")?"inventory_2":e.includes("REGISTRADO")?"receipt_long":e.includes("CANCELADO")?"cancel":e.includes("RECHAZADO EN PUNTO")?"report_problem":e.includes("REPROGRAMADO")?"event_repeat":"fiber_manual_record"}getTimelineIconColor(t){let e=t.action.toUpperCase();if(e.includes("ENTREGADO"))return"primary";if(e.includes("CANCELADO")||e.includes("INCIDENCIA")||e.includes("NO_ENTREGADO"))return"warn"}getStatusBadgeClass(t){return t?`status-${t.toString().toLowerCase().replace(/[\s_]+/g,"-")}`:"status-desconocido"}openMap(t){t&&window.open(`https://www.google.com/maps/search/?api=1&query=${t}`,"_blank")}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=z({type:n,selectors:[["app-tracking-page"]],decls:23,vars:7,consts:[[1,"tracking-page-container"],[1,"tracking-form-card","mat-elevation-z4"],[1,"tracking-form",3,"ngSubmit","formGroup"],["appearance","outline",1,"full-width"],["matInput","","formControlName","trackingCode","placeholder","Ej: TRK12345XYZ","required",""],["matSuffix",""],["mat-flat-button","","color","primary","type","submit",1,"track-button",3,"disabled"],[1,"result-card","error-card","mat-elevation-z2"],[1,"result-card","order-details-card","mat-elevation-z2"],[1,"result-card","info-card","mat-elevation-z2"],["mode","indeterminate","diameter","20","strokeWidth","3"],[1,"error-message"],["color","warn"],[1,"order-details-header"],[1,"status-badge-tracking",3,"ngClass"],[1,"order-summary"],[1,"summary-item"],["class","summary-item",4,"ngIf"],["matTooltip","Ver \xFAltima ubicaci\xF3n conocida o destino en mapa",1,"summary-item","map-link"],[1,"section-divider"],[1,"tracking-timeline"],[1,"no-history-message"],["matTooltip","Ver \xFAltima ubicaci\xF3n conocida o destino en mapa",1,"summary-item","map-link",3,"click"],["color","primary"],[1,"timeline-item"],["matListItemIcon","",1,"timeline-icon",3,"color"],["matListItemTitle","",1,"timeline-action"],["matListItemLine","",1,"timeline-date"],["matListItemLine","",1,"timeline-notes"],["matListItemLine","",1,"timeline-change"],[1,"timeline-connector"],[1,"notes-icon"],[1,"info-message"]],template:function(e,c){if(e&1&&(o(0,"div",0)(1,"mat-card",1)(2,"mat-card-header")(3,"mat-card-title"),r(4,"Rastrear Pedido"),i(),o(5,"mat-card-subtitle"),r(6,"Ingrese su c\xF3digo de seguimiento para ver el estado de su env\xEDo."),i()(),o(7,"mat-card-content")(8,"form",2),b("ngSubmit",function(){return c.submitTracking()}),o(9,"mat-form-field",3)(10,"mat-label"),r(11,"C\xF3digo de Seguimiento"),i(),x(12,"input",4),o(13,"mat-icon",5),r(14,"search"),i(),g(15,Ge,2,0,"mat-error")(16,$e,2,0,"mat-error"),i(),o(17,"button",6),g(18,Ue,3,0)(19,He,2,0,"span"),i()()()(),g(20,qe,6,1,"mat-card",7)(21,et,37,22,"mat-card",8)(22,tt,6,0,"mat-card",9),i()),e&2){let p;a(8),_("formGroup",c.trackingForm),a(7),l(c.trackingCodeCtrl!=null&&c.trackingCodeCtrl.hasError("required")&&(c.trackingCodeCtrl!=null&&c.trackingCodeCtrl.touched)?15:-1),a(),l(c.trackingCodeCtrl!=null&&c.trackingCodeCtrl.hasError("minlength")&&(c.trackingCodeCtrl!=null&&c.trackingCodeCtrl.touched)?16:-1),a(),_("disabled",c.isLoading()),a(),l(c.isLoading()?18:19),a(2),l(c.searchAttempted()&&!c.isLoading()&&c.errorMessage()?20:-1),a(),l((p=c.trackedOrder())?21:c.searchAttempted()&&!c.isLoading()&&!c.errorMessage()?22:-1,p)}},dependencies:[Z,H,q,K,j,W,ee,Me,pe,me,se,ge,_e,ue,fe,he,ke,xe,Pe,Oe,ve,be,ye,Te,Se,Ee,le,de,ce,ne,oe,ae,re,ie,De,Ne,Re,Le,Ie,Fe,Ae,we,ze],styles:['.tracking-page-container[_ngcontent-%COMP%]{padding:24px;max-width:900px;margin:20px auto;background-color:#f4f6f8;min-height:calc(100vh - 64px)}.tracking-form-card[_ngcontent-%COMP%]{margin-bottom:30px;padding:20px 24px;border-radius:8px;background-color:#fff;box-shadow:0 2px 8px #00000014}.tracking-form-card[_ngcontent-%COMP%]   mat-card-title[_ngcontent-%COMP%]{font-size:1.6em;font-weight:500;color:#303f9f}.tracking-form-card[_ngcontent-%COMP%]   mat-card-subtitle[_ngcontent-%COMP%]{margin-bottom:20px;color:#616161}.tracking-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.tracking-form[_ngcontent-%COMP%]   .full-width[_ngcontent-%COMP%]{width:100%}.track-button[_ngcontent-%COMP%]{padding:10px 0;font-size:1.1em;text-transform:uppercase;letter-spacing:.5px;min-height:48px}.track-button[_ngcontent-%COMP%]   mat-progress-spinner[_ngcontent-%COMP%]{margin-right:8px}.track-button[_ngcontent-%COMP%]   mat-progress-spinner[_ngcontent-%COMP%]     circle{stroke:currentColor!important}.track-button[_ngcontent-%COMP%]   span[_ngcontent-%COMP%] + span[_ngcontent-%COMP%]{margin-left:8px}.result-card[_ngcontent-%COMP%]{margin-top:24px;border-radius:8px;padding:0;background-color:#fff;box-shadow:0 2px 8px #0000000f}.order-details-card[_ngcontent-%COMP%]   mat-card-header.order-details-header[_ngcontent-%COMP%]{padding:20px 24px;background-color:#e8eaf6;border-bottom:1px solid #c5cae9;display:flex;justify-content:space-between;align-items:center}.order-details-card[_ngcontent-%COMP%]   mat-card-header.order-details-header[_ngcontent-%COMP%]   mat-card-title[_ngcontent-%COMP%]{font-size:1.3em;font-weight:500;margin-bottom:4px;color:#283593}.order-details-card[_ngcontent-%COMP%]   mat-card-header.order-details-header[_ngcontent-%COMP%]   mat-card-subtitle[_ngcontent-%COMP%]{font-size:.9em;color:#546e7a}.order-details-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]{padding:24px}.status-badge-tracking[_ngcontent-%COMP%]{padding:6px 14px;border-radius:16px;font-size:.85rem;font-weight:600;text-transform:uppercase;color:#fff;line-height:1.2}.order-summary[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:20px;margin-bottom:24px}.order-summary[_ngcontent-%COMP%]   .summary-item[_ngcontent-%COMP%]{display:flex;align-items:center;padding:12px;background-color:#f8f9fa;border-radius:6px;border:1px solid #e9ecef}.order-summary[_ngcontent-%COMP%]   .summary-item[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:12px;color:#78909c}.order-summary[_ngcontent-%COMP%]   .summary-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.95em;color:#495057}.order-summary[_ngcontent-%COMP%]   .summary-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#212529;font-weight:500}.order-summary[_ngcontent-%COMP%]   .map-link[_ngcontent-%COMP%]{cursor:pointer}.order-summary[_ngcontent-%COMP%]   .map-link[_ngcontent-%COMP%]:hover{background-color:#e8eaf6;border-color:#9fa8da}.order-summary[_ngcontent-%COMP%]   .map-link[_ngcontent-%COMP%]:hover   span[_ngcontent-%COMP%]{color:#283593}.order-summary[_ngcontent-%COMP%]   .map-link[_ngcontent-%COMP%]:hover   mat-icon[_ngcontent-%COMP%]{color:#3f51b5}.section-divider[_ngcontent-%COMP%]{margin:24px 0;border-top-color:#e0e0e0}h3[_ngcontent-%COMP%]{font-size:1.25em;font-weight:500;margin-bottom:16px;color:#455a64;padding-bottom:8px;border-bottom:1px solid #e0e0e0}.tracking-timeline[_ngcontent-%COMP%]{padding-left:0;position:relative}.tracking-timeline[_ngcontent-%COMP%]:before{content:"";position:absolute;left:20px;top:10px;bottom:10px;width:2px;background-color:#d1d5db;z-index:0}.timeline-item[_ngcontent-%COMP%]{position:relative;padding-left:50px!important;padding-bottom:20px!important;min-height:160px}.timeline-item[_ngcontent-%COMP%]   .timeline-icon[_ngcontent-%COMP%]{position:absolute;left:-8px;top:4px;background-color:#fdfeff;border-radius:50%;z-index:1;font-size:28px;width:28px;height:28px}.timeline-item[_ngcontent-%COMP%]   .timeline-action[_ngcontent-%COMP%]{font-weight:500;font-size:1.05em;color:#374151;margin-bottom:4px}.timeline-item[_ngcontent-%COMP%]   .timeline-date[_ngcontent-%COMP%]{font-size:.8em;color:#6b7280;margin-bottom:6px}.timeline-item[_ngcontent-%COMP%]   .timeline-notes[_ngcontent-%COMP%]{font-size:.85em;color:#4b5563;display:flex;align-items:center}.timeline-item[_ngcontent-%COMP%]   .timeline-notes[_ngcontent-%COMP%]   .notes-icon[_ngcontent-%COMP%]{font-size:16px;width:16px;height:16px;margin-right:6px;opacity:.7}.timeline-item[_ngcontent-%COMP%]   .timeline-change[_ngcontent-%COMP%]{font-size:.8em;color:#4b5563;font-style:italic;margin-top:4px}.error-card[_ngcontent-%COMP%], .info-card[_ngcontent-%COMP%]{margin-top:20px;text-align:center;background-color:#fff}.error-card[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%], .error-card[_ngcontent-%COMP%]   .info-message[_ngcontent-%COMP%], .info-card[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%], .info-card[_ngcontent-%COMP%]   .info-message[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:20px;font-size:1.1em;color:#4b5563}.error-card[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%], .error-card[_ngcontent-%COMP%]   .info-message[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%], .info-card[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%], .info-card[_ngcontent-%COMP%]   .info-message[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:40px;width:40px;height:40px;margin-bottom:10px}.error-card[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%], .info-card[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#ef4444}.error-card[_ngcontent-%COMP%]   .info-message[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%], .info-card[_ngcontent-%COMP%]   .info-message[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#3b82f6}.no-history-message[_ngcontent-%COMP%]{font-style:italic;color:#6b7280;padding:20px 0;text-align:center}.status-registrado[_ngcontent-%COMP%]{background-color:#06b6d4;color:#fff}.status-recogido[_ngcontent-%COMP%], .status-en-transito[_ngcontent-%COMP%]{background-color:#3b82f6;color:#fff}.status-entregado[_ngcontent-%COMP%]{background-color:#22c55e;color:#fff}.status-cancelado[_ngcontent-%COMP%]{background-color:#6b7280;color:#fff}.status-rechazado-en-punto[_ngcontent-%COMP%]{background-color:#ef4444;color:#fff}.status-reprogramado[_ngcontent-%COMP%]{background-color:#a855f7;color:#fff}']})};var Xt=[{path:"",component:k,title:"Rastrear Pedido"}];export{Xt as TRACKING_ROUTES};
