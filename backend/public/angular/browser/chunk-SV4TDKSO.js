import{a as Ge}from"./chunk-DXCMAUC3.js";import{c as Te}from"./chunk-WEOB6OMV.js";import{a as Ae,b as Ve,c as qe}from"./chunk-RJIBCMAW.js";import"./chunk-MS4AQ6UA.js";import{b as Ie}from"./chunk-SNHOSZ4S.js";import{d as we}from"./chunk-JJSTB54W.js";import"./chunk-YRCWJJOQ.js";import"./chunk-2JNWSY3M.js";import{d as De,e as Ee}from"./chunk-44LGRUYF.js";import"./chunk-7RWCIHFI.js";import{A as Me,D as Se,G as ye,H as Pe,b as le,d as _,f as ce,g as me,h as se,j as pe,l as de,m as ge,n as ue,o as _e,r as fe,s as he,t as Ce,v as ke,w as ve,x as be,z as xe}from"./chunk-ICWTIKD4.js";import"./chunk-BWBG2IHT.js";import"./chunk-U3COC3EF.js";import{a as Y,b as Z,d as ee,e as te,g as ie,h as ae,i as re}from"./chunk-K4QNRRQ5.js";import{a as oe,b as ne}from"./chunk-ASKMK2H5.js";import"./chunk-XRPHOQB2.js";import"./chunk-NUMYIFQH.js";import{$ as L,Bb as E,Bc as Q,Db as M,Eb as O,Ec as X,Gd as Oe,Hd as Fe,I as A,J as V,Ka as C,Pb as B,Q as q,Qb as n,Rb as k,Sb as U,Va as l,aa as N,ba as $,bc as v,cb as z,cc as S,da as P,dc as H,ib as d,l as G,mb as c,na as D,rb as R,t as y,tb as W,ub as j,vb as o,wa as b,wb as a,wc as J,x as T,xa as x,xb as g,yc as K}from"./chunk-YUSEJVZ2.js";var $e=(t,e)=>e.id;function ze(t,e){if(t&1){let r=E();o(0,"button",27),M("click",function(){b(r);let m=O();return x(m.clearDistrictSelection())}),o(1,"mat-icon"),n(2,"close"),a()()}}function Re(t,e){t&1&&(o(0,"mat-icon",28),n(1,"person_search"),a())}function We(t,e){t&1&&g(0,"mat-progress-spinner",29)}function je(t,e){if(t&1&&(o(0,"mat-option",13)(1,"div",30)(2,"span"),n(3),a()()()),t&2){let r=e.$implicit;c("value",r),l(3),k(r.name_and_price)}}function Be(t,e){t&1&&(o(0,"mat-option",14),n(1,"No se encontraron resultados."),a())}function Ue(t,e){t&1&&(o(0,"mat-error"),n(1,"Requerido"),a())}function He(t,e){t&1&&(o(0,"mat-error"),n(1,"M\xEDn. 1"),a())}function Je(t,e){t&1&&(o(0,"mat-error"),n(1,"Requerido"),a())}function Ke(t,e){t&1&&(o(0,"mat-error"),n(1,"M\xEDn. 1"),a())}function Qe(t,e){t&1&&(o(0,"mat-error"),n(1,"Requerido"),a())}function Xe(t,e){t&1&&(o(0,"mat-error"),n(1,"M\xEDn. 1"),a())}function Ye(t,e){t&1&&(o(0,"mat-error"),n(1,"Requerido"),a())}function Ze(t,e){t&1&&(o(0,"mat-error"),n(1,"M\xEDn. 0.1"),a())}function et(t,e){t&1&&g(0,"mat-progress-spinner",31)}function tt(t,e){if(t&1&&(o(0,"div",32)(1,"span",33),n(2,"Costo de Env\xEDo:"),a(),o(3,"span",34),n(4),v(5,"number"),a()()),t&2){let r=O();l(4),U("S/ ",H(5,1,r.shippingCostCalculated(),"1.2-2"),"")}}function it(t,e){if(t&1&&(o(0,"div",35)(1,"span"),n(2),a()()),t&2){let r=e.ngIf;l(2),k(r.info_text)}}var Le=class t{packageFormGroup;deliveryDistrictId=null;maxDimensions$;standardPackageLabel=C("");volumetric_factor=C(0);shippingCostCalculated=C(0);isCalculating=C(!1);orderService=D(Ge);destroy$=new G;fb=D(ke);districtsCache=[];ditricts$=y([]);isLoadingDistricts=!1;selectedDistrict=null;districSearchCtrl=new pe("");filteredDistricts$;constructor(){this.orderService.getDeliveryDistricts().pipe(T(e=>{this.districtsCache=e})).subscribe(),this.filteredDistricts$=this.districSearchCtrl.valueChanges.pipe(L(""),V(300),q(),N(e=>(this.isLoadingDistricts=!0,this.orderService.getDistricts(e||"").pipe(P(()=>this.isLoadingDistricts=!1),A(()=>(this.isLoadingDistricts=!1,y([])))))),$(this.destroy$)),this.packageFormGroup=this.fb.group({package_size_type:["custom",_.required],package_width_cm:[0,_.required],package_length_cm:[0,_.required],package_height_cm:[0,_.required],package_weight_kg:[0,_.required],delivery_district_id:[null,_.required]}),this.maxDimensions$=this.orderService.getMaxPackageDimensions().pipe(P(e=>{if(e.standard_package_info&&e.volumetric_factor){let r="La medida est\xE1ndar es "+e.sta_length_cm+"cm"+e.sta_width_cm+"cm"+e.sta_height_cm+"cm "+e.sta_weight_kg+"kg";this.standardPackageLabel.set(r),this.volumetric_factor.set(e.volumetric_factor)}}))}ngOnInit(){}onCalculateCustomCost(){if(console.log("this.packageFormGroup.get",this.packageFormGroup.get("delivery_district_id")?.value),!this.packageFormGroup.get("delivery_district_id")?.value){alert("Por favor, seleccione un distrito de entrega primero.");return}["package_width_cm","package_length_cm","package_height_cm","package_weight_kg"].forEach(m=>{let s=this.packageFormGroup.get(m);if(s?.markAsTouched(),s?.invalid){console.log("Custom dimensions form is invalid");return}});let r={delivery_district_id:this.packageFormGroup.get("delivery_district_id")?.value,package_size_type:"custom",package_width_cm:this.packageFormGroup.get("package_width_cm")?.value,package_length_cm:this.packageFormGroup.get("package_length_cm")?.value,package_height_cm:this.packageFormGroup.get("package_height_cm")?.value,package_weight_kg:this.packageFormGroup.get("package_weight_kg")?.value};function i(m,s){for(let p of s)if(m>=p.weight_from&&m<=p.weight_to)return p}if(r.package_width_cm&&r.package_length_cm&&r.package_height_cm&&r.package_weight_kg&&this.volumetric_factor()){this.isCalculating.set(!0);let m=r.package_length_cm*r.package_width_cm*r.package_height_cm/this.volumetric_factor(),s=0,p=r.package_weight_kg;m>r.package_weight_kg&&(p=m);let f=this.districtsCache?.find(u=>u.id===r.delivery_district_id);if(f){let u=this.districtsCache?.filter(h=>h.name===f?.name);u&&(s=i(p,u)?.price||0)}s===0&&alert("No hay ninguna tarifa asociada con el peso ("+p+") del distrito seleccionado."),console.log("peso_cobrado",p),console.log("precio",s),this.shippingCostCalculated.set(s),this.isCalculating.set(!1)}else alert("las entradas no son validas")}displayDistricName(e){return e&&e.name_and_price?e.name_and_price:""}onDistrictSelected(e){this.selectedDistrict=e.option.value,console.log("district selected:",this.selectedDistrict),this.packageFormGroup.get("delivery_district_id")?.setValue(this.selectedDistrict.id),this.packageFormGroup.markAllAsTouched(),console.log("Order form is invalid:",this.getFormErrors(this.packageFormGroup));let r=this.packageFormGroup.getRawValue();console.log("formValue",r)}clearDistrictSelection(){this.selectedDistrict=null,this.districSearchCtrl.setValue(""),this.packageFormGroup.markAllAsTouched(),this.packageFormGroup.get("delivery_district_id")?.setValue(null),console.log("Order form is invalid:",this.getFormErrors(this.packageFormGroup))}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}getFormErrors(e){let r={};return Object.keys(e.controls).forEach(i=>{let m=e.get(i)?.errors;if(m&&(r[i]=m),e.get(i)instanceof se){let s=this.getFormErrors(e.get(i));Object.keys(s).length>0&&(r[i]=s)}}),r}static \u0275fac=function(r){return new(r||t)};static \u0275cmp=z({type:t,selectors:[["app-terms-conditions-display"]],decls:60,vars:27,consts:[["autoDistric","matAutocomplete"],["appearance","outlined",1,"calculator-card"],[1,"calculator-card-header"],["mat-card-avatar","",1,"header-avatar"],[1,"calculator-card-content"],[3,"formGroup"],[1,"standard-package-info"],["appearance","outline",1,"driver-search-field"],["type","text","placeholder","Escriba el nombre del distrito...","aria-label","distrito","matInput","",3,"formControl","matAutocomplete"],["matSuffix","","mat-icon-button","","aria-label","Limpiar",3,"click",4,"ngIf"],["matSuffix","",4,"ngIf"],["matSuffix","","mode","indeterminate","diameter","20",4,"ngIf"],[3,"optionSelected","displayWith"],[3,"value"],["disabled",""],[1,"custom-dimensions-grid"],["appearance","outline"],["matInput","","type","number","formControlName","package_length_cm","placeholder","0","required","","min","1"],[4,"ngIf"],["matInput","","type","number","formControlName","package_width_cm","placeholder","0","required","","min","1"],["matInput","","type","number","formControlName","package_height_cm","placeholder","0","required","","min","1"],["matInput","","type","number","formControlName","package_weight_kg","placeholder","0.0","required","","min","0.1","step","0.1"],[1,"calculate-action-container"],["mat-flat-button","","type","button",1,"calculate-button","btn-corp-primary",3,"click"],["mode","indeterminate","diameter","20","class","button-spinner",4,"ngIf"],["class","shipping-cost-result",4,"ngIf"],["class","info-banner max-dimensions-info",4,"ngIf"],["matSuffix","","mat-icon-button","","aria-label","Limpiar",3,"click"],["matSuffix",""],["matSuffix","","mode","indeterminate","diameter","20"],[1,"driver-option"],["mode","indeterminate","diameter","20",1,"button-spinner"],[1,"shipping-cost-result"],[1,"cost-label"],[1,"cost-value"],[1,"info-banner","max-dimensions-info"]],template:function(r,i){if(r&1){let m=E();o(0,"mat-card",1)(1,"mat-card-header",2)(2,"div",3)(3,"mat-icon"),n(4,"calculate"),a()(),o(5,"mat-card-title"),n(6,"Calculadora de Costo de Env\xEDo"),a(),o(7,"mat-card-subtitle"),n(8,"Estime el costo de su env\xEDo"),a()(),o(9,"mat-card-content",4)(10,"form",5)(11,"p",6),n(12),a(),o(13,"mat-form-field",7)(14,"mat-label"),n(15,"Buscar y Seleccionar distrito"),a(),g(16,"input",8),d(17,ze,3,0,"button",9)(18,Re,2,0,"mat-icon",10)(19,We,1,0,"mat-progress-spinner",11),o(20,"mat-autocomplete",12,0),M("optionSelected",function(p){return b(m),x(i.onDistrictSelected(p))}),W(22,je,4,2,"mat-option",13,$e),v(24,"async"),d(25,Be,2,0,"mat-option",14),v(26,"async"),a()(),o(27,"div",15)(28,"mat-form-field",16)(29,"mat-label"),n(30,"Largo (cm)"),a(),g(31,"input",17),d(32,Ue,2,0,"mat-error",18)(33,He,2,0,"mat-error",18),a(),o(34,"mat-form-field",16)(35,"mat-label"),n(36,"Ancho (cm)"),a(),g(37,"input",19),d(38,Je,2,0,"mat-error",18)(39,Ke,2,0,"mat-error",18),a(),o(40,"mat-form-field",16)(41,"mat-label"),n(42,"Alto (cm)"),a(),g(43,"input",20),d(44,Qe,2,0,"mat-error",18)(45,Xe,2,0,"mat-error",18),a(),o(46,"mat-form-field",16)(47,"mat-label"),n(48,"Peso (kg)"),a(),g(49,"input",21),d(50,Ye,2,0,"mat-error",18)(51,Ze,2,0,"mat-error",18),a()(),o(52,"div",22)(53,"button",23),M("click",function(){return b(m),x(i.onCalculateCustomCost())}),d(54,et,1,0,"mat-progress-spinner",24),o(55,"span"),n(56),a()(),d(57,tt,6,4,"div",25),a(),d(58,it,3,1,"div",26),v(59,"async"),a()()()}if(r&2){let m,s,p,f,u,h,F,w,I,Ne=B(21);l(10),c("formGroup",i.packageFormGroup),l(2),k(i.standardPackageLabel()),l(4),c("formControl",i.districSearchCtrl)("matAutocomplete",Ne),l(),c("ngIf",i.districSearchCtrl.value&&!i.isLoadingDistricts),l(),c("ngIf",!i.districSearchCtrl.value&&!i.isLoadingDistricts),l(),c("ngIf",i.isLoadingDistricts),l(),c("displayWith",i.displayDistricName),l(2),j(S(24,21,i.filteredDistricts$)),l(3),R(((m=S(26,23,i.filteredDistricts$))==null?null:m.length)===0&&!i.isLoadingDistricts&&i.districSearchCtrl.value?25:-1),l(7),c("ngIf",(s=i.packageFormGroup.get("package_length_cm"))==null?null:s.hasError("required")),l(),c("ngIf",(p=i.packageFormGroup.get("package_length_cm"))==null?null:p.hasError("min")),l(5),c("ngIf",(f=i.packageFormGroup.get("package_width_cm"))==null?null:f.hasError("required")),l(),c("ngIf",(u=i.packageFormGroup.get("package_width_cm"))==null?null:u.hasError("min")),l(5),c("ngIf",(h=i.packageFormGroup.get("package_height_cm"))==null?null:h.hasError("required")),l(),c("ngIf",(F=i.packageFormGroup.get("package_height_cm"))==null?null:F.hasError("min")),l(5),c("ngIf",(w=i.packageFormGroup.get("package_weight_kg"))==null?null:w.hasError("required")),l(),c("ngIf",(I=i.packageFormGroup.get("package_weight_kg"))==null?null:I.hasError("min")),l(3),c("ngIf",i.isCalculating()),l(2),k(i.isCalculating()?"Calculando...":"CALCULAR COSTO"),l(),c("ngIf",i.shippingCostCalculated()!==null&&i.shippingCostCalculated()!==void 0),l(),c("ngIf",S(59,25,i.maxDimensions$))}},dependencies:[X,J,K,Q,ne,oe,Fe,Oe,re,Y,ae,ee,ie,te,Z,Pe,ye,xe,Me,Se,Te,be,de,le,ge,ce,me,Ce,he,ue,_e,fe,ve,Ee,De,Ie,we,qe,Ae,Ve],styles:["[_nghost-%COMP%]{display:block}.calculator-card[_ngcontent-%COMP%]{max-width:700px;margin:24px auto;border-radius:12px;border:1px solid #e0e0e0;background-color:#fff;box-shadow:0 4px 12px #00000014}.calculator-card-header[_ngcontent-%COMP%]{padding:20px 14px;border-bottom:1px solid #eeeeee;background-color:#f8f9fa}.calculator-card-header[_ngcontent-%COMP%]   .header-avatar[_ngcontent-%COMP%]{background-color:#012147;color:#fff;display:flex;justify-content:center;align-items:center}.calculator-card-header[_ngcontent-%COMP%]   mat-card-title[_ngcontent-%COMP%]{font-size:1.6em;font-weight:500;color:#263238}.calculator-card-header[_ngcontent-%COMP%]   mat-card-subtitle[_ngcontent-%COMP%]{font-size:.95em;color:#546e7a}.standard-package-info[_ngcontent-%COMP%]{font-size:1em;color:#455a64;margin-bottom:15px;padding:12px;background-color:#eceff1;border-left:4px solid #f97c06;border-radius:4px}.full-width-field[_ngcontent-%COMP%]{width:100%;margin-bottom:20px}.district-option[_ngcontent-%COMP%]{display:flex;justify-content:space-between;width:100%;align-items:center}.district-option[_ngcontent-%COMP%]   .district-price[_ngcontent-%COMP%]{font-weight:500;color:#424242;font-size:.9em}.custom-dimensions-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:20px;margin-top:10px;margin-bottom:14px;align-items:start}.custom-dimensions-grid[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{margin-bottom:0}.calculate-action-container[_ngcontent-%COMP%]{display:flex;justify-content:space-around;align-items:center;margin-top:10px;margin-bottom:10px}.calculate-button[_ngcontent-%COMP%]{padding:10px 24px;font-size:1em;font-weight:500;border-radius:6px;color:#f7f8fe;background-color:#f97c06;border:0px;cursor:pointer}.info-banner[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;margin-top:24px;padding:12px 16px;border-radius:6px;font-size:.9em}.max-dimensions-info[_ngcontent-%COMP%]{background-color:#f5f5f5;color:#616161;border:1px solid #e0e0e0}.max-dimensions-info[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#78909c}.shipping-cost-result[_ngcontent-%COMP%]{margin-top:28px;padding:16px;border-radius:8px;border:1px solid #e0e0e0;text-align:center;background-color:#f9f9f9}.shipping-cost-result[_ngcontent-%COMP%]   .cost-label[_ngcontent-%COMP%]{font-size:1.1em;color:#37474f;display:block;margin-bottom:8px}.shipping-cost-result[_ngcontent-%COMP%]   .cost-value[_ngcontent-%COMP%]{font-size:2em;font-weight:700;color:#d32f2f}.shipping-cost-result[_ngcontent-%COMP%]   .error-label[_ngcontent-%COMP%]{color:#c62828}.shipping-cost-result[_ngcontent-%COMP%]   .error-value[_ngcontent-%COMP%]{font-size:1em;color:#c62828;font-weight:500}"]})};export{Le as PackageCalculatorComponent};
