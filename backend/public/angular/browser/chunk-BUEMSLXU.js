import{a as Dt}from"./chunk-Q26YYUTK.js";import{a as ye,b as Se,c as be,d as Ee}from"./chunk-6HWJN4XJ.js";import{a as ot,b as rt,c as mt,d as lt,g as ve,h as dt}from"./chunk-HGPHA7DX.js";import"./chunk-CL5SDS67.js";import{a as pt,b as ft,c as ut,d as gt,e as ht,f as vt,g as Mt,h as Ct,i as _t,j as xt,k as yt,l as St,n as xe,o as Et,p as Pt}from"./chunk-AHO7UDPR.js";import"./chunk-MS4AQ6UA.js";import{d as _e,e as bt}from"./chunk-7I3QWZBN.js";import{a as Me,b as Ce}from"./chunk-XC4JK7T6.js";import{a as ce,b as de,c as st,d as ct,e as pe,f as fe,g as ue,h as ge}from"./chunk-MJOVE2YB.js";import{d as he}from"./chunk-XTLFEAFI.js";import"./chunk-MW2V4VAY.js";import"./chunk-CSWUMH3X.js";import{d as oe,e as re}from"./chunk-A2GZCIHE.js";import{a as se}from"./chunk-YSXPYM2V.js";import"./chunk-7RWCIHFI.js";import{C as ie,F as ae,G as it,b as K,d as k,f as J,g as W,l as et,m as tt,o as X,r as Z,v as ee,x as te,y as ne,z as nt}from"./chunk-I57H2NTY.js";import"./chunk-7SNYFGVH.js";import"./chunk-NTJKNPMM.js";import{a as Ke,b as Je,d as We,g as Xe,i as Ze}from"./chunk-ABVOVIA5.js";import{a as Y,b as q}from"./chunk-42JOKCMC.js";import{a as qe}from"./chunk-QOYZNJPJ.js";import{a as at,b as B,e as N}from"./chunk-JRHRK62N.js";import"./chunk-J25GVFCX.js";import{$b as f,Ac as Qe,Bb as x,Cb as I,Cc as O,Dd as me,Ed as le,Gc as Be,Hc as Ne,Ib as Ie,Ic as Ye,J as $e,Jb as Te,Kb as Fe,Nb as T,Ob as a,Pb as b,Q as Ve,Qb as d,S as P,Ta as m,Vc as Q,Xa as h,Xb as G,Yb as Oe,a as we,aa as He,ab as w,ac as ke,b as Re,bc as u,gb as p,h as Ae,ha as ze,kb as c,l as je,la as Ge,ma as z,t as j,tb as i,tc as U,u as E,ub as n,uc as F,va as C,vb as M,wa as _,wb as y,wc as Ue,xb as S,yc as D,zb as $}from"./chunk-NTZTTLCP.js";var L=class o{constructor(e){this.http=e}apiUrl=`${Q.apiUrl}/cash-management`;authService=z(qe);getAuthHeaders(){let e=this.authService.getAccessToken();return e?new Be({"Content-Type":"application/json",codrr_token:e}):new Be({"Content-Type":"application/json"})}getAllCashMovements(e,t=1,r=10){let l=this.getAuthHeaders();if(!this.authService.getAccessToken())return E(()=>new Error("Not authenticated to fetch cash movements."));let s=new Ne;if(e)for(let g in e)e.hasOwnProperty(g)&&e[g]&&(s=s.append(g,e[g]));return s=s.append("page_number",t.toString()),s=s.append("page_size",r.toString()),this.http.get(`${this.apiUrl}/movements`,{params:s,headers:l})}getCashMovementSummary(e){let t=this.getAuthHeaders();if(!this.authService.getAccessToken())return E(()=>new Error("Not authenticated to fetch cash movement summary."));let r=new Ne;if(e)for(let l in e)e.hasOwnProperty(l)&&e[l]&&(r=r.append(l,e[l]));return this.http.get(`${this.apiUrl}/detailed-summary`,{params:r,headers:t})}createManualMovement(e){let t=this.getAuthHeaders();return this.authService.getAccessToken()?this.http.post(`${this.apiUrl}/manual-movement`,e,{headers:t}):E(()=>new Error("Not authenticated to create cash movement."))}updateCashMovement(e,t){let r=this.getAuthHeaders();return this.authService.getAccessToken()?this.http.put(`${this.apiUrl}/${e}`,t,{headers:r}):E(()=>new Error("Not authenticated to update cash movement."))}deleteCashMovement(e){let t=this.getAuthHeaders();return this.authService.getAccessToken()?this.http.delete(`${this.apiUrl}/${e}`,{headers:t}):E(()=>new Error("Not authenticated to delete cash movement."))}generatePdf(e){let t=this.getAuthHeaders().set("Accept","application/pdf");return this.authService.getAccessToken()?this.http.get(`${this.apiUrl}/${e}/pdf/ticket`,{headers:t,responseType:"blob"}):E(()=>new Error("Not authenticated to generate PDF."))}static \u0275fac=function(t){return new(t||o)(Ge(Ye))};static \u0275prov=ze({token:o,factory:o.\u0275fac,providedIn:"root"})};function $t(o,e){o&1&&(i(0,"mat-error"),a(1,"La fecha es requerida"),n())}function Vt(o,e){o&1&&(i(0,"mat-error"),a(1,"El monto es requerido"),n())}function Ht(o,e){o&1&&(i(0,"mat-error"),a(1,"El monto debe ser mayor o igual a 0"),n())}function zt(o,e){o&1&&(i(0,"mat-error"),a(1,"El tipo de movimiento es requerido"),n())}function Gt(o,e){if(o&1&&(i(0,"mat-option",19),a(1),n()),o&2){let t=e.$implicit;c("value",t),m(),b(t)}}function Ut(o,e){o&1&&(i(0,"mat-error"),a(1,"La forma de pago es requerida"),n())}function Qt(o,e){o&1&&M(0,"mat-spinner",20)}function Yt(o,e){o&1&&(i(0,"span"),a(1,"Guardar"),n())}var V=class o{constructor(e,t,r,l,s){this.fb=e;this.dialogRef=t;this.cashManagementService=r;this.snackBar=l;this.data=s;this.movementForm=this.fb.group({date:[new Date,k.required],amount:[null,[k.required,k.min(0)]],typeMovement:["",k.required],paymentsMethod:["",k.required],description:[""]})}movementForm;isLoading=!1;minDate=null;paymentMethods=["Efectivo","Yape/Transferencia BCP","Plin/Transferencia INTERBANK","POS"];ngOnInit(){if(this.data){let e=null;if(this.data.date){let t=this.data.date.split("-");e=new Date(parseInt(t[0]),parseInt(t[1])-1,parseInt(t[2]))}this.movementForm.patchValue(Re(we({},this.data),{date:e}))}}onSave(){if(this.movementForm.valid&&!this.isLoading){this.isLoading=!0;let e=we({},this.movementForm.value);(this.data&&this.data.id?this.cashManagementService.updateCashMovement(this.data.id,e):this.cashManagementService.createManualMovement(e)).pipe(P(()=>this.isLoading=!1)).subscribe({next:r=>{this.snackBar.open("Movimiento registrado exitosamente","Cerrar",{duration:3e3}),this.dialogRef.close(!0)},error:r=>{this.snackBar.open("Error al registrar movimiento: "+r.message,"Cerrar",{duration:3e3}),console.error("Error creating cash movement:",r)}})}}onCancel(){this.dialogRef.close(!1)}static \u0275fac=function(t){return new(t||o)(h(ee),h(ce),h(L),h(se),h(de))};static \u0275cmp=w({type:o,selectors:[["app-cash-movement-form"]],features:[G([dt(),D])],decls:43,vars:14,consts:[["picker",""],["mat-dialog-title","",1,"page-header",2,"font-weight","700 !important"],[1,"cash-movement-dialog-content",3,"formGroup"],[1,"wrapper-form-field"],["appearance","outline",1,"cash-movement-form-field"],["matInput","","formControlName","date",3,"matDatepicker","min"],["matSuffix","",3,"for"],[4,"ngIf"],["matInput","","type","number","formControlName","amount","placeholder","Ej: 100.50"],["formControlName","typeMovement"],["value","INGRESO"],["value","EGRESO"],["formControlName","paymentsMethod"],[3,"value",4,"ngFor","ngForOf"],["matInput","","formControlName","description","placeholder","Ej: Compra de insumos","rows","3"],["align","end",1,"cash-movement-dialog-actions"],["mat-button","",1,"btn-corp-secondary",3,"click","disabled"],["mat-raised-button","","color","primary",1,"btn-corp-primary",3,"click","disabled"],["diameter","20",4,"ngIf"],[3,"value"],["diameter","20"]],template:function(t,r){if(t&1){let l=$();i(0,"h1",1),a(1,` Formulario de Movimiento de Caja
`),n(),i(2,"mat-dialog-content",2)(3,"div",3)(4,"mat-form-field",4)(5,"mat-label"),a(6,"Fecha"),n(),M(7,"input",5)(8,"mat-datepicker-toggle",6)(9,"mat-datepicker",null,0),p(11,$t,2,0,"mat-error",7),n(),i(12,"mat-form-field",4)(13,"mat-label"),a(14,"Monto"),n(),M(15,"input",8),p(16,Vt,2,0,"mat-error",7)(17,Ht,2,0,"mat-error",7),n(),i(18,"mat-form-field",4)(19,"mat-label"),a(20,"Tipo de Movimiento"),n(),i(21,"mat-select",9)(22,"mat-option",10),a(23,"Ingreso"),n(),i(24,"mat-option",11),a(25,"Egreso"),n()(),p(26,zt,2,0,"mat-error",7),n(),i(27,"mat-form-field",4)(28,"mat-label"),a(29,"Forma de Pago"),n(),i(30,"mat-select",12),p(31,Gt,2,2,"mat-option",13),n(),p(32,Ut,2,0,"mat-error",7),n(),i(33,"mat-form-field",4)(34,"mat-label"),a(35,"Descripci\xF3n / Motivo"),n(),M(36,"textarea",14),n()()(),i(37,"mat-dialog-actions",15)(38,"button",16),x("click",function(){return C(l),_(r.onCancel())}),a(39," Cancelar "),n(),i(40,"button",17),x("click",function(){return C(l),_(r.onSave())}),p(41,Qt,1,0,"mat-spinner",18)(42,Yt,2,0,"span",7),n()()}if(t&2){let l,s,g,H,v,R=T(10);m(2),c("formGroup",r.movementForm),m(5),c("matDatepicker",R)("min",r.minDate),m(),c("for",R),m(3),c("ngIf",(l=r.movementForm.get("date"))==null?null:l.hasError("required")),m(5),c("ngIf",(s=r.movementForm.get("amount"))==null?null:s.hasError("required")),m(),c("ngIf",(g=r.movementForm.get("amount"))==null?null:g.hasError("min")),m(9),c("ngIf",(H=r.movementForm.get("typeMovement"))==null?null:H.hasError("required")),m(5),c("ngForOf",r.paymentMethods),m(),c("ngIf",(v=r.movementForm.get("paymentsMethod"))==null?null:v.hasError("required")),m(6),c("disabled",r.isLoading),m(2),c("disabled",r.movementForm.invalid||r.isLoading),m(),c("ngIf",r.isLoading),m(),c("ngIf",!r.isLoading)}},dependencies:[O,U,F,te,K,tt,J,W,X,Z,re,oe,ae,ne,nt,ie,N,B,Ce,Me,he,Ee,ye,Se,be,ve,ge,pe,ue,fe,it,q,Y],styles:[".cash-movement-dialog-content[_ngcontent-%COMP%]{padding:.75rem;overflow-y:auto;max-height:50vh}.wrapper-form-field[_ngcontent-%COMP%]{padding:20px}.cash-movement-form-field[_ngcontent-%COMP%]{margin-bottom:.5rem}.cash-movement-dialog-actions[_ngcontent-%COMP%]{padding:.75rem 1rem;border-top:1px solid #eee;background-color:#f9f9f9}.cash-movement-action-button[_ngcontent-%COMP%]{padding:.5rem 1rem;font-size:.8rem;border-radius:.25rem;transition:all .2s ease-in-out}.cash-movement-action-button[_ngcontent-%COMP%]:hover{transform:translateY(-1px);box-shadow:0 1px 2px #0000001a}.cash-movement-action-button[color=primary][_ngcontent-%COMP%]{background-color:#007bff;color:#fff}.cash-movement-action-button[color=accent][_ngcontent-%COMP%]{background-color:#6c757d;color:#fff}@media (max-width: 768px){.cash-movement-dialog-content[_ngcontent-%COMP%]{padding:.5rem}.cash-movement-dialog-actions[_ngcontent-%COMP%]{padding:.5rem;flex-direction:column;gap:.4rem}.cash-movement-action-button[_ngcontent-%COMP%]{width:100%}}"]})};function Kt(o,e){if(o&1&&(i(0,"mat-icon",6),a(1),n()),o&2){let t=I();c("color",t.data.iconColor||"primary"),m(),b(t.data.icon)}}var Pe=class o{constructor(e,t){this.dialogRef=e;this.data=t}static \u0275fac=function(t){return new(t||o)(h(ce),h(de))};static \u0275cmp=w({type:o,selectors:[["app-confirm-dialog"]],decls:12,vars:8,consts:[[1,"confirm-dialog-container"],["class","dialog-icon",3,"color",4,"ngIf"],["mat-dialog-title",""],[2,"display","flex","flex-direction","row","flex-wrap","nowrap","border","0px solid black"],["mat-stroked-button","",1,"btn-corp-secondary",3,"mat-dialog-close"],["mat-raised-button","",1,"btn-corp-primary",3,"color","mat-dialog-close"],[1,"dialog-icon",3,"color"]],template:function(t,r){t&1&&(i(0,"div",0),p(1,Kt,2,2,"mat-icon",1),i(2,"h2",2),a(3),n(),i(4,"mat-dialog-content")(5,"p"),a(6),n()(),i(7,"mat-dialog-actions",3)(8,"button",4),a(9),n(),i(10,"button",5),a(11),n()()()),t&2&&(m(),c("ngIf",r.data.icon),m(2),b(r.data.title),m(3),b(r.data.message),m(2),c("mat-dialog-close",!1),m(),d(" ",r.data.cancelButtonText," "),m(),c("color",r.data.confirmButtonColor)("mat-dialog-close",!0),m(),d(" ",r.data.confirmButtonText," "))},dependencies:[O,F,ge,ct,pe,ue,fe,N,B,le,me],styles:[".confirm-dialog-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:24px;text-align:center;border:2px solid var(--mat-dialog-container-border-color, #ccc);border-radius:8px}.dialog-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px;margin-bottom:16px}mat-dialog-title[_ngcontent-%COMP%]{font-size:1.5em;font-weight:700;margin-bottom:16px;color:var(--mat-dialog-title-color, inherit)}mat-dialog-content[_ngcontent-%COMP%]{margin-bottom:24px}"]})};var Jt=()=>[],Wt=()=>[5,10,20,50];function Xt(o,e){if(o&1&&(i(0,"mat-option",43),a(1),n()),o&2){let t=e.$implicit;c("value",t),m(),b(t)}}function Zt(o,e){o&1&&(i(0,"div",44),M(1,"mat-spinner",45),n())}function en(o,e){if(o&1&&(i(0,"div",46)(1,"div",47)(2,"div",48)(3,"div",49),a(4,"Tipo"),n(),i(5,"div",49),a(6,"Efectivo"),n(),i(7,"div",49),a(8,"Yape / Transferencia BCP"),n(),i(9,"div",49),a(10," Plin / Transferencia INTERBANK "),n(),i(11,"div",49),a(12,"POS"),n()(),i(13,"div",50)(14,"div",51),a(15,"Ingreso"),n(),i(16,"div",51),a(17),f(18,"currency"),n(),i(19,"div",51),a(20),f(21,"currency"),n(),i(22,"div",51),a(23),f(24,"currency"),n(),i(25,"div",51),a(26),f(27,"currency"),n()(),i(28,"div",50)(29,"div",51),a(30,"Egreso"),n(),i(31,"div",51),a(32),f(33,"currency"),n(),i(34,"div",51),a(35),f(36,"currency"),n(),i(37,"div",51),a(38),f(39,"currency"),n(),i(40,"div",51),a(41),f(42,"currency"),n()(),i(43,"div",50)(44,"div",51),a(45,"Saldo"),n(),i(46,"div",51),a(47),f(48,"currency"),n(),i(49,"div",51),a(50),f(51,"currency"),n(),i(52,"div",51),a(53),f(54,"currency"),n(),i(55,"div",51),a(56),f(57,"currency"),n()(),i(58,"div",52)(59,"div",53),a(60,"Ingreso Caja"),n(),i(61,"div",54),a(62),f(63,"currency"),n()(),i(64,"div",52)(65,"div",53),a(66,"Egreso Caja"),n(),i(67,"div",54),a(68),f(69,"currency"),n()(),i(70,"div",52)(71,"div",53),a(72,"Total en Caja"),n(),i(73,"div",54),a(74),f(75,"currency"),n()()()()),o&2){let t=e.ngIf;m(17),d(" ",u(18,15,t.Efectivo.income,"S/ ")," "),m(3),d(" ",u(21,18,t["Yape/Transferencia BCP"].income,"S/ ")," "),m(3),d(" ",u(24,21,t["Plin/Transferencia INTERBANK"].income,"S/ ")," "),m(3),d(" ",u(27,24,t.POS.income,"S/ ")," "),m(6),d(" ",u(33,27,t.Efectivo.expense,"S/ ")," "),m(3),d(" ",u(36,30,t["Yape/Transferencia BCP"].expense,"S/ ")," "),m(3),d(" ",u(39,33,t["Plin/Transferencia INTERBANK"].expense,"S/ ")," "),m(3),d(" ",u(42,36,t.POS.expense,"S/ ")," "),m(6),d(" ",u(48,39,t.Efectivo.balance,"S/ ")," "),m(3),d(" ",u(51,42,t["Yape/Transferencia BCP"].balance,"S/ ")," "),m(3),d(" ",u(54,45,t["Plin/Transferencia INTERBANK"].balance,"S/ ")," "),m(3),d(" ",u(57,48,t.POS.balance,"S/ ")," "),m(6),d(" ",u(63,51,t.totalCashIncome,"S/ ")," "),m(6),d(" ",u(69,54,t.totalCashExpense,"S/ ")," "),m(6),d(" ",u(75,57,t.totalCashBalance,"S/ ")," ")}}function tn(o,e){o&1&&(i(0,"div",44),M(1,"mat-spinner",45),n())}function nn(o,e){o&1&&(i(0,"th",55),a(1," N\xB0 "),n())}function an(o,e){if(o&1&&(i(0,"td",56),a(1),n()),o&2){let t=e.$implicit;m(),d(" ",t.code," ")}}function on(o,e){o&1&&(i(0,"th",55),a(1," Fecha "),n())}function rn(o,e){if(o&1&&(i(0,"td",56),a(1),f(2,"date"),n()),o&2){let t=e.$implicit;m(),d(" ",u(2,1,t.date,"dd/MM/yyyy")," ")}}function mn(o,e){o&1&&(i(0,"th",55),a(1," Tipo "),n())}function ln(o,e){if(o&1&&(i(0,"td",56),a(1),n()),o&2){let t=e.$implicit;m(),d(" ",t.typeMovement," ")}}function sn(o,e){o&1&&(i(0,"th",55),a(1," Monto "),n())}function cn(o,e){if(o&1&&(i(0,"td",56),a(1),f(2,"currency"),n()),o&2){let t=e.$implicit;m(),d(" ",u(2,1,t.amount,"S/ ")," ")}}function dn(o,e){o&1&&(i(0,"th",55),a(1," Forma de Pago "),n())}function pn(o,e){if(o&1&&(i(0,"td",56),a(1),n()),o&2){let t=e.$implicit;m(),d(" ",t.paymentsMethod," ")}}function fn(o,e){o&1&&(i(0,"th",55),a(1," Descripci\xF3n "),n())}function un(o,e){if(o&1&&(i(0,"td",56),a(1),n()),o&2){let t=e.$implicit;m(),d(" ",t.description," ")}}function gn(o,e){o&1&&(i(0,"th",55),a(1," Usuario "),n())}function hn(o,e){if(o&1&&(i(0,"td",56),a(1),n()),o&2){let t=e.$implicit;m(),d(" ",t.user==null?null:t.user.username," ")}}function vn(o,e){o&1&&(i(0,"th",57),a(1," Acciones "),n())}function Mn(o,e){if(o&1){let t=$();i(0,"td",58)(1,"button",59)(2,"mat-icon"),a(3,"more_vert"),n()(),i(4,"mat-menu",null,2)(6,"button",60),x("click",function(){let l=C(t).$implicit,s=I();return _(s.editMovement(l))}),i(7,"mat-icon"),a(8,"edit"),n(),i(9,"span"),a(10,"Editar"),n()(),i(11,"button",60),x("click",function(){let l=C(t).$implicit,s=I();return _(s.generatePdf(l.id))}),i(12,"mat-icon"),a(13,"picture_as_pdf"),n(),i(14,"span"),a(15,"Imprimir ticket"),n()(),i(16,"button",60),x("click",function(){let l=C(t).$implicit,s=I();return _(s.deleteMovement(l.id))}),i(17,"mat-icon"),a(18,"delete"),n(),i(19,"span"),a(20,"Eliminar"),n()()()()}if(o&2){let t=T(5);m(),c("matMenuTriggerFor",t)}}function Cn(o,e){o&1&&M(0,"tr",61)}function _n(o,e){o&1&&M(0,"tr",62)}function xn(o,e){o&1&&(i(0,"tr",63)(1,"td",64),a(2," No hay movimientos de caja que coincidan con los filtros. "),n()())}var De=class o{constructor(e,t,r,l,s){this.fb=e;this.cashManagementService=t;this.dialog=r;this.snackBar=l;this.excelExportService=s;let g=new Date;this.filterForm=this.fb.group({startDate:[g],endDate:[g],typeMovement:[""],paymentsMethod:[""],userId:[""]})}filterForm;displayedColumns=["code","date","typeMovement","amount","paymentsMethod","description","user","actions"];paymentMethods=["Efectivo","Yape/Transferencia BCP","Plin/Transferencia INTERBANK","POS"];cashMovements$=j([]);summary$=j({Efectivo:{income:0,expense:0,balance:0},"Yape/Transferencia BCP":{income:0,expense:0,balance:0},"Plin/Transferencia INTERBANK":{income:0,expense:0,balance:0},POS:{income:0,expense:0,balance:0},totalCashIncome:0,totalCashExpense:0,totalCashBalance:0});totalItems=0;pageSize=10;pageNumber=1;datePipe=z(D);isLoadingResults=!1;isLoadingSummary=!1;paginator;sort;destroy$=new je;ngOnInit(){this.applyFilters(),this.filterForm.valueChanges.pipe(He(this.destroy$),$e(400),Ve((e,t)=>JSON.stringify(e)===JSON.stringify(t))).subscribe(e=>{this.applyAllFilters(e)})}applyAllFilters(e){let t=e;t.startDate&&(t.startDate=this.datePipe.transform(t.startDate,"yyyy-MM-dd")||""),t.endDate&&(t.endDate=this.datePipe.transform(t.endDate,"yyyy-MM-dd")||""),this.isLoadingResults=!0,this.cashManagementService.getAllCashMovements(t,this.pageNumber,this.pageSize).pipe(P(()=>this.isLoadingResults=!1)).subscribe(r=>{this.cashMovements$=j(r.movements),this.totalItems=r.total}),this.isLoadingSummary=!0,this.summary$=this.cashManagementService.getCashMovementSummary(t).pipe(P(()=>this.isLoadingSummary=!1))}applyFilters(){let e=this.filterForm.value;e.startDate&&(e.startDate=this.datePipe.transform(e.startDate,"yyyy-MM-dd")||""),e.endDate&&(e.endDate=this.datePipe.transform(e.endDate,"yyyy-MM-dd")||""),this.isLoadingResults=!0,this.cashManagementService.getAllCashMovements(e,this.pageNumber,this.pageSize).pipe(P(()=>this.isLoadingResults=!1)).subscribe(t=>{this.cashMovements$=j(t.movements),this.totalItems=t.total}),this.isLoadingSummary=!0,this.summary$=this.cashManagementService.getCashMovementSummary(e).pipe(P(()=>this.isLoadingSummary=!1))}onPageChange(e){this.pageNumber=e.pageIndex+1,this.pageSize=e.pageSize,this.applyFilters()}openAddMovementDialog(){this.dialog.open(V,{width:"400px"}).afterClosed().subscribe(t=>{t&&this.applyFilters()})}editMovement(e){this.dialog.open(V,{width:"400px",data:e}).afterClosed().subscribe(r=>{r&&this.applyFilters()})}deleteMovement(e){let t={title:"Confirmar Eliminaci\xF3n",message:"\xBFEst\xE1s seguro de que quieres eliminar este movimiento de caja? Esta acci\xF3n no se puede deshacer.",confirmButtonText:"Eliminar",cancelButtonText:"Cancelar",confirmButtonColor:"warn"};this.dialog.open(Pe,{width:"350px",data:t}).afterClosed().subscribe(l=>{l&&this.cashManagementService.deleteCashMovement(e).subscribe({next:()=>{this.snackBar.open("Movimiento eliminado exitosamente","Cerrar",{duration:3e3}),this.applyFilters()},error:s=>{this.snackBar.open("Error al eliminar movimiento: "+s.message,"Cerrar",{duration:3e3}),console.error("Error deleting cash movement:",s)}})})}generatePdf(e){let t=Q.apiUrl+"/cash-management/"+e+"/pdf/ticket";window.open(t,"_blank")}exportCashMovementsToExcel(){return Ae(this,null,function*(){let e=this.filterForm.value;e.startDate&&(e.startDate=this.datePipe.transform(e.startDate,"yyyy-MM-dd")||""),e.endDate&&(e.endDate=this.datePipe.transform(e.endDate,"yyyy-MM-dd")||"");let r=(yield this.cashManagementService.getAllCashMovements(e,1,9999).toPromise())?.movements||[],l=yield this.cashManagementService.getCashMovementSummary(e).toPromise(),s=[],g=[];s.push({label:"Fecha Inicio",value:this.datePipe.transform(e.startDate,"dd/MM/yyyy")}),s.push({label:"Fecha Fin",value:this.datePipe.transform(e.endDate,"dd/MM/yyyy")}),l&&(["Efectivo","Yape/Transferencia BCP","Plin/Transferencia INTERBANK","POS"].forEach(R=>{let A=l[R];A&&typeof A=="object"&&s.push({Tipo:R,Ingreso:A.income.toFixed(2),Egreso:A.expense.toFixed(2),Saldo:A.balance.toFixed(2)})}),s.push({label:"Total Ingresos",value:parseFloat(l.totalCashIncome.toFixed(2))}),s.push({label:"Total Egresos",value:parseFloat(l.totalCashExpense.toFixed(2))}),s.push({label:"Saldo Total",value:parseFloat(l.totalCashBalance.toFixed(2))})),r.forEach(v=>{g.push({"N\xB0":v.code,Fecha:this.datePipe.transform(v.date,"dd/MM/yyyy"),Tipo:v.typeMovement,Monto:parseFloat(v.amount.toFixed(2)),"Forma de Pago":v.paymentsMethod,Descripci\u00F3n:v.description,Usuario:v.user?.username||v.user?.email})});let H=`movimientos_caja_${this.datePipe.transform(new Date,"yyyyMMdd_HHmmss")}`;this.excelExportService.exportCashMovementSummaryAndDetailsToExcel(s,g,H,"Movimientos de Caja")})}static \u0275fac=function(t){return new(t||o)(h(ee),h(L),h(st),h(se),h(Dt))};static \u0275cmp=w({type:o,selectors:[["app-cash-management-list-page"]],viewQuery:function(t,r){if(t&1&&(Ie(_e,5),Ie(xe,5)),t&2){let l;Te(l=Fe())&&(r.paginator=l.first),Te(l=Fe())&&(r.sort=l.first)}},features:[G([D])],decls:96,vars:21,consts:[["startDatePicker",""],["endDatePicker",""],["actionsMenu","matMenu"],[1,"page-container"],[1,"mat-card"],[1,"mat-card-header"],[1,"mat-card-title",2,"padding","10px !important"],[1,"filter-form",3,"formGroup"],["appearance","outline",1,"w-full"],["matInput","","formControlName","startDate",3,"matDatepicker"],["matSuffix","",3,"for"],["matInput","","formControlName","endDate",3,"matDatepicker"],["formControlName","typeMovement"],["value",""],["value","INGRESO"],["value","EGRESO"],["formControlName","paymentsMethod"],[3,"value",4,"ngFor","ngForOf"],[1,"form-actions"],["mat-raised-button","","color","primary",1,"btn-corp-primary",3,"click"],["mat-raised-button","","color","accent",1,"btn-corp-primary",3,"click"],[1,"mat-card","summary-section"],[1,"mat-card-title"],["class","loading-overlay",4,"ngIf"],["class","summary-table-container",4,"ngIf"],[1,""],["mat-table","","matSort","",1,"mat-table",3,"dataSource"],["matColumnDef","code"],["mat-header-cell","","mat-sort-header","","class","mat-header-cell",4,"matHeaderCellDef"],["mat-cell","","class","mat-cell",4,"matCellDef"],["matColumnDef","date"],["matColumnDef","typeMovement"],["matColumnDef","amount"],["matColumnDef","paymentsMethod"],["matColumnDef","description"],["matColumnDef","user"],["matColumnDef","actions"],["mat-header-cell","","class","mat-header-cell",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["showFirstLastButtons","",3,"page","length","pageSize","pageSizeOptions"],[3,"value"],[1,"loading-overlay"],["diameter","30"],[1,"summary-table-container"],[1,"summary-table"],[1,"summary-header"],[1,"summary-cell","header-cell"],[1,"summary-row"],[1,"summary-cell"],[1,"summary-row","total-row"],[1,"summary-cell","total-label"],[1,"summary-cell","total-value"],["mat-header-cell","","mat-sort-header","",1,"mat-header-cell"],["mat-cell","",1,"mat-cell"],["mat-header-cell","",1,"mat-header-cell"],["mat-cell",""],["mat-icon-button","","aria-label","Acciones",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-header-row",""],["mat-row",""],[1,"mat-row"],["colspan","7",1,"mat-cell"]],template:function(t,r){if(t&1){let l=$();i(0,"div",3)(1,"mat-card",4)(2,"mat-card-header",5)(3,"mat-card-title",6),a(4,"Gesti\xF3n de Caja"),n()(),i(5,"mat-card-content")(6,"form",7)(7,"mat-form-field",8)(8,"mat-label"),a(9,"Fecha Inicio"),n(),M(10,"input",9)(11,"mat-datepicker-toggle",10)(12,"mat-datepicker",null,0),n(),i(14,"mat-form-field",8)(15,"mat-label"),a(16,"Fecha Fin"),n(),M(17,"input",11)(18,"mat-datepicker-toggle",10)(19,"mat-datepicker",null,1),n(),i(21,"mat-form-field",8)(22,"mat-label"),a(23,"Tipo de Movimiento"),n(),i(24,"mat-select",12)(25,"mat-option",13),a(26,"Todos"),n(),i(27,"mat-option",14),a(28,"Ingreso"),n(),i(29,"mat-option",15),a(30,"Egreso"),n()()(),i(31,"mat-form-field",8)(32,"mat-label"),a(33,"Forma de Pago"),n(),i(34,"mat-select",16)(35,"mat-option",13),a(36,"Todos"),n(),p(37,Xt,2,2,"mat-option",17),n()()(),i(38,"div",18)(39,"button",19),x("click",function(){return C(l),_(r.applyFilters())}),i(40,"mat-icon"),a(41,"filter_list"),n(),a(42," Aplicar Filtros "),n(),i(43,"button",20),x("click",function(){return C(l),_(r.openAddMovementDialog())}),i(44,"mat-icon"),a(45,"add"),n(),a(46," Registrar Movimiento "),n(),i(47,"button",19),x("click",function(){return C(l),_(r.exportCashMovementsToExcel())}),i(48,"mat-icon"),a(49,"cloud_download"),n(),a(50," Exportar a Excel "),n()()()(),i(51,"mat-card",21)(52,"mat-card-header",5)(53,"mat-card-title",22),a(54,"Resumen de Saldos"),n()(),i(55,"mat-card-content"),p(56,Zt,2,0,"div",23)(57,en,76,60,"div",24),f(58,"async"),n()(),i(59,"mat-card",4)(60,"mat-card-header",5)(61,"mat-card-title",22),a(62,"Detalle de movimientos"),n()(),i(63,"mat-card-content"),p(64,tn,2,0,"div",23),i(65,"div",25)(66,"table",26),f(67,"async"),y(68,27),p(69,nn,2,0,"th",28)(70,an,2,1,"td",29),S(),y(71,30),p(72,on,2,0,"th",28)(73,rn,3,4,"td",29),S(),y(74,31),p(75,mn,2,0,"th",28)(76,ln,2,1,"td",29),S(),y(77,32),p(78,sn,2,0,"th",28)(79,cn,3,4,"td",29),S(),y(80,33),p(81,dn,2,0,"th",28)(82,pn,2,1,"td",29),S(),y(83,34),p(84,fn,2,0,"th",28)(85,un,2,1,"td",29),S(),y(86,35),p(87,gn,2,0,"th",28)(88,hn,2,1,"td",29),S(),y(89,36),p(90,vn,2,0,"th",37)(91,Mn,21,1,"td",38),S(),p(92,Cn,1,0,"tr",39)(93,_n,1,0,"tr",40)(94,xn,3,0,"tr",41),n(),i(95,"mat-paginator",42),x("page",function(g){return C(l),_(r.onPageChange(g))}),n()()()()()}if(t&2){let l=T(13),s=T(20);m(6),c("formGroup",r.filterForm),m(4),c("matDatepicker",l),m(),c("for",l),m(6),c("matDatepicker",s),m(),c("for",s),m(19),c("ngForOf",r.paymentMethods),m(19),c("ngIf",r.isLoadingSummary),m(),c("ngIf",ke(58,15,r.summary$)),m(7),c("ngIf",r.isLoadingResults),m(2),c("dataSource",ke(67,17,r.cashMovements$)||Oe(19,Jt)),m(26),c("matHeaderRowDef",r.displayedColumns),m(),c("matRowDefColumns",r.displayedColumns),m(2),c("length",r.totalItems)("pageSize",r.pageSize)("pageSizeOptions",Oe(20,Wt))}},dependencies:[O,U,F,Ue,Qe,D,Ze,Ke,We,Xe,Je,St,pt,ut,Mt,gt,ft,Ct,ht,vt,_t,xt,yt,bt,_e,Pt,xe,Et,re,oe,ae,ne,ie,N,B,at,le,me,Ce,Me,he,Ee,ye,Se,be,ve,te,et,K,J,W,X,Z,q,Y,lt,rt,ot,mt],styles:[".page-container[_ngcontent-%COMP%]{background-color:#f9fafb;min-height:100vh}.mat-card[_ngcontent-%COMP%]{box-shadow:0 1px 2px #0000000d;border-radius:.2rem}.mat-card-header[_ngcontent-%COMP%]{padding:0rem .6rem;border-bottom:1px solid #e5e7eb}.mat-card-title[_ngcontent-%COMP%]{color:#1f2937;font-weight:900;font-size:1.4rem;padding:7px 7px 11px!important}.filter-form[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:.4rem}.mat-form-field[_ngcontent-%COMP%]{width:100%;margin-bottom:0;font-size:.75rem}.form-actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:flex-end;gap:.3rem;margin-top:0!important;font-weight:700!important}@media (min-width: 640px){.form-actions[_ngcontent-%COMP%]{flex-direction:row}}.action-button[_ngcontent-%COMP%]{width:100%;padding:.3rem .6rem;font-size:.7rem;font-weight:600;border-radius:.15rem;transition:all .2s ease-in-out}@media (min-width: 640px){.action-button[_ngcontent-%COMP%]{width:auto}}.action-button[_ngcontent-%COMP%]:hover{transform:translateY(-1px);box-shadow:0 1px 2px #00000014}.summary-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(100px,1fr));gap:.4rem;text-align:center}.summary-card[_ngcontent-%COMP%]{padding:.1rem!important;background-color:#fff;border:1px solid #e5e7eb;border-radius:.2rem;box-shadow:0 1px 2px #00000005}.summary-card[_ngcontent-%COMP%]   .mat-card-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center}.summary-label[_ngcontent-%COMP%]{color:#4b5563;font-weight:700}.summary-value[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:700;margin-top:.05rem}.income-card[_ngcontent-%COMP%]{background-color:#e6ffe6;border-color:#6c6}.income-card[_ngcontent-%COMP%]   .summary-value[_ngcontent-%COMP%]{color:#28a745}.expense-card[_ngcontent-%COMP%]{background-color:#ffe6e6;border-color:#f66}.expense-card[_ngcontent-%COMP%]   .summary-value[_ngcontent-%COMP%]{color:#dc3545}.balance-card[_ngcontent-%COMP%]{background-color:#e6f7ff;border-color:#66b3ff}.balance-card[_ngcontent-%COMP%]   .summary-value.text-green-700[_ngcontent-%COMP%]{color:#28a745}.balance-card[_ngcontent-%COMP%]   .summary-value.text-red-700[_ngcontent-%COMP%]{color:#dc3545}.summary-table-container[_ngcontent-%COMP%]{width:100%;overflow-x:auto}.summary-table[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr repeat(4,minmax(100px,1fr));border:1px solid #817e7e;border-radius:4px;overflow:hidden;font-size:.85rem;min-width:600px}.summary-header[_ngcontent-%COMP%], .summary-row[_ngcontent-%COMP%]{display:contents}.summary-cell[_ngcontent-%COMP%]{padding:10px 15px;border:1px solid #848383;text-align:right;display:flex;align-items:center;justify-content:flex-end;border-bottom:0px;border-left:0px;color:#18191a;font-weight:500}.summary-cell[_ngcontent-%COMP%]:first-child{border-bottom:0px;text-align:left;justify-content:flex-start;font-weight:700;background-color:#f9f9f9}.header-cell[_ngcontent-%COMP%]{background-color:#012147;color:#fff;font-weight:700;text-align:center;justify-content:center}.header-cell[_ngcontent-%COMP%]:first-child{background-color:#012147;color:#fff;text-align:left;justify-content:flex-start}.total-row[_ngcontent-%COMP%]   .summary-cell[_ngcontent-%COMP%]{background-color:#f0f0f0;font-weight:700}.total-row[_ngcontent-%COMP%]   .summary-cell.total-label[_ngcontent-%COMP%]{text-align:right;justify-content:flex-end;grid-column:span 4}.total-row[_ngcontent-%COMP%]   .summary-cell.total-value[_ngcontent-%COMP%]{text-align:right;justify-content:flex-end}.mat-no-data-row[_ngcontent-%COMP%]   .mat-cell[_ngcontent-%COMP%]{text-align:center;padding-top:.4rem;padding-bottom:.4rem;color:#494b4e;font-style:italic}@media (max-width: 768px){.mat-table[_ngcontent-%COMP%]{display:block;overflow-x:auto;-webkit-overflow-scrolling:touch}}.total-row-content[_ngcontent-%COMP%]{display:flex;justify-content:space-between;width:100%}.total-row-label[_ngcontent-%COMP%], .total-row-value[_ngcontent-%COMP%]{font-weight:700}"]})};var Ai=[{path:"",component:De}];export{Ai as CASH_MANAGEMENT_ROUTES};
